(self.webpackChunkvideo_call_client=self.webpackChunkvideo_call_client||[]).push([[725],{4035:(k,S,a)=>{var d=a(3781),p=a(7732),o=a(4082),s=a(2040);k.exports.Backoff=d,k.exports.FunctionCall=s,k.exports.FibonacciStrategy=o,k.exports.ExponentialStrategy=p,k.exports.fibonacci=function(i){return new d(new o(i))},k.exports.exponential=function(i){return new d(new p(i))},k.exports.call=function(i,t,e){var r=Array.prototype.slice.call(arguments);return i=r[0],t=r.slice(1,r.length-1),new s(i,t,e=r[r.length-1])}},3781:(k,S,a)=>{var d=a(3105),p=a(3726);function s(i){d.EventEmitter.call(this),this.backoffStrategy_=i,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}a(1732).inherits(s,d.EventEmitter),s.prototype.failAfter=function(i){p.checkArgument(i>0,"Expected a maximum number of retry greater than 0 but got %s.",i),this.maxNumberOfRetry_=i},s.prototype.backoff=function(i){p.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",i),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,i))},s.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},s.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},k.exports=s},2040:(k,S,a)=>{var d=a(3105),p=a(3726),o=a(1732),s=a(3781),i=a(4082);function t(e,r,n){d.EventEmitter.call(this),p.checkIsFunction(e,"Expected fn to be a function."),p.checkIsArray(r,"Expected args to be an array."),p.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=r,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=t.DEFAULT_RETRY_PREDICATE_,this.state_=t.State_.PENDING}o.inherits(t,d.EventEmitter),t.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},t.DEFAULT_RETRY_PREDICATE_=function(e){return!0},t.prototype.isPending=function(){return this.state_==t.State_.PENDING},t.prototype.isRunning=function(){return this.state_==t.State_.RUNNING},t.prototype.isCompleted=function(){return this.state_==t.State_.COMPLETED},t.prototype.isAborted=function(){return this.state_==t.State_.ABORTED},t.prototype.setStrategy=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},t.prototype.retryIf=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},t.prototype.getLastResult=function(){return this.lastResult_.concat()},t.prototype.getNumRetries=function(){return this.numRetries_},t.prototype.failAfter=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},t.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=t.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},t.prototype.start=function(e){p.checkState(!this.isAborted(),"FunctionCall is aborted."),p.checkState(this.isPending(),"FunctionCall already started.");var r=this.strategy_||new i;this.backoff_=e?e(r):new s(r),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=t.State_.RUNNING,this.doCall_(!1)},t.prototype.doCall_=function(e){e&&this.numRetries_++;var r=["call"].concat(this.arguments_);d.EventEmitter.prototype.emit.apply(this,r);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},t.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},t.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,d.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var r=e[0];r&&this.retryPredicate_(r)?this.backoff_.backoff(r):(this.state_=t.State_.COMPLETED,this.doCallback_())}},t.prototype.handleBackoff_=function(e,r,n){this.emit("backoff",e,r,n)},k.exports=t},7732:(k,S,a)=>{var d=a(1732),p=a(3726),o=a(1975);function s(i){o.call(this,i),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=s.DEFAULT_FACTOR,i&&void 0!==i.factor&&(p.checkArgument(i.factor>1,"Exponential factor should be greater than 1 but got %s.",i.factor),this.factor_=i.factor)}d.inherits(s,o),s.DEFAULT_FACTOR=2,s.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},s.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},k.exports=s},4082:(k,S,a)=>{var d=a(1732),p=a(1975);function o(s){p.call(this,s),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}d.inherits(o,p),o.prototype.next_=function(){var s=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=s,s},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},k.exports=o},1975:(k,S,a)=>{function o(i){return null!=i}function s(i){if(o((i=i||{}).initialDelay)&&i.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(o(i.maxDelay)&&i.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=i.initialDelay||100,this.maxDelay_=i.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(o(i.randomisationFactor)&&(i.randomisationFactor<0||i.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=i.randomisationFactor||0}a(3105),a(1732),s.prototype.getMaxDelay=function(){return this.maxDelay_},s.prototype.getInitialDelay=function(){return this.initialDelay_},s.prototype.next=function(){var i=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(i*t)},s.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},s.prototype.reset=function(){this.reset_()},s.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},k.exports=s},9568:(k,S,a)=>{"use strict";var d=a(8540),p=a(44),o=p(d("String.prototype.indexOf"));k.exports=function(i,t){var e=d(i,!!t);return"function"==typeof e&&o(i,".prototype.")>-1?p(e):e}},44:(k,S,a)=>{"use strict";var d=a(5396),p=a(8540),o=p("%Function.prototype.apply%"),s=p("%Function.prototype.call%"),i=p("%Reflect.apply%",!0)||d.call(s,o),t=p("%Object.getOwnPropertyDescriptor%",!0),e=p("%Object.defineProperty%",!0),r=p("%Math.max%");if(e)try{e({},"a",{value:1})}catch(l){e=null}k.exports=function(v){var y=i(d,s,arguments);if(t&&e){var m=t(y,"length");m.configurable&&e(y,"length",{value:1+r(0,v.length-(arguments.length-1))})}return y};var n=function(){return i(d,o,arguments)};e?e(k.exports,"apply",{value:n}):k.exports.apply=n},3105:k=>{"use strict";var d,S="object"==typeof Reflect?Reflect:null,a=S&&"function"==typeof S.apply?S.apply:function(b,L,R){return Function.prototype.apply.call(b,L,R)};d=S&&"function"==typeof S.ownKeys?S.ownKeys:Object.getOwnPropertySymbols?function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:function(b){return Object.getOwnPropertyNames(b)};var o=Number.isNaN||function(b){return b!=b};function s(){s.init.call(this)}k.exports=s,k.exports.once=function(C,b){return new Promise(function(L,R){function w(_){C.removeListener(b,g),R(_)}function g(){"function"==typeof C.removeListener&&C.removeListener("error",w),L([].slice.call(arguments))}P(C,b,g,{once:!0}),"error"!==b&&function(C,b,L){"function"==typeof C.on&&P(C,"error",b,{once:!0})}(C,w)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var i=10;function t(C){if("function"!=typeof C)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}function e(C){return void 0===C._maxListeners?s.defaultMaxListeners:C._maxListeners}function r(C,b,L,R){var w,g,_;if(t(L),void 0===(g=C._events)?(g=C._events=Object.create(null),C._eventsCount=0):(void 0!==g.newListener&&(C.emit("newListener",b,L.listener?L.listener:L),g=C._events),_=g[b]),void 0===_)_=g[b]=L,++C._eventsCount;else if("function"==typeof _?_=g[b]=R?[L,_]:[_,L]:R?_.unshift(L):_.push(L),(w=e(C))>0&&_.length>w&&!_.warned){_.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=C,A.type=b,A.count=_.length,function(C){console&&console.warn&&console.warn(C)}(A)}return C}function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(C,b,L){var R={fired:!1,wrapFn:void 0,target:C,type:b,listener:L},w=n.bind(R);return w.listener=L,R.wrapFn=w,w}function v(C,b,L){var R=C._events;if(void 0===R)return[];var w=R[b];return void 0===w?[]:"function"==typeof w?L?[w.listener||w]:[w]:L?function(C){for(var b=new Array(C.length),L=0;L<b.length;++L)b[L]=C[L].listener||C[L];return b}(w):m(w,w.length)}function y(C){var b=this._events;if(void 0!==b){var L=b[C];if("function"==typeof L)return 1;if(void 0!==L)return L.length}return 0}function m(C,b){for(var L=new Array(b),R=0;R<b;++R)L[R]=C[R];return L}function P(C,b,L,R){if("function"==typeof C.on)R.once?C.once(b,L):C.on(b,L);else{if("function"!=typeof C.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C);C.addEventListener(b,function w(g){R.once&&C.removeEventListener(b,w),L(g)})}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(C){if("number"!=typeof C||C<0||o(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");i=C}}),s.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(b){if("number"!=typeof b||b<0||o(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this},s.prototype.getMaxListeners=function(){return e(this)},s.prototype.emit=function(b){for(var L=[],R=1;R<arguments.length;R++)L.push(arguments[R]);var w="error"===b,g=this._events;if(void 0!==g)w=w&&void 0===g.error;else if(!w)return!1;if(w){var _;if(L.length>0&&(_=L[0]),_ instanceof Error)throw _;var A=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw A.context=_,A}var I=g[b];if(void 0===I)return!1;if("function"==typeof I)a(I,this,L);else{var M=I.length,j=m(I,M);for(R=0;R<M;++R)a(j[R],this,L)}return!0},s.prototype.on=s.prototype.addListener=function(b,L){return r(this,b,L,!1)},s.prototype.prependListener=function(b,L){return r(this,b,L,!0)},s.prototype.once=function(b,L){return t(L),this.on(b,l(this,b,L)),this},s.prototype.prependOnceListener=function(b,L){return t(L),this.prependListener(b,l(this,b,L)),this},s.prototype.off=s.prototype.removeListener=function(b,L){var R,w,g,_,A;if(t(L),void 0===(w=this._events))return this;if(void 0===(R=w[b]))return this;if(R===L||R.listener===L)0==--this._eventsCount?this._events=Object.create(null):(delete w[b],w.removeListener&&this.emit("removeListener",b,R.listener||L));else if("function"!=typeof R){for(g=-1,_=R.length-1;_>=0;_--)if(R[_]===L||R[_].listener===L){A=R[_].listener,g=_;break}if(g<0)return this;0===g?R.shift():function(C,b){for(;b+1<C.length;b++)C[b]=C[b+1];C.pop()}(R,g),1===R.length&&(w[b]=R[0]),void 0!==w.removeListener&&this.emit("removeListener",b,A||L)}return this},s.prototype.removeAllListeners=function(b){var L,R,w;if(void 0===(R=this._events))return this;if(void 0===R.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==R[b]&&(0==--this._eventsCount?this._events=Object.create(null):delete R[b]),this;if(0===arguments.length){var _,g=Object.keys(R);for(w=0;w<g.length;++w)"removeListener"!==(_=g[w])&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(L=R[b]))this.removeListener(b,L);else if(void 0!==L)for(w=L.length-1;w>=0;w--)this.removeListener(b,L[w]);return this},s.prototype.listeners=function(b){return v(this,b,!0)},s.prototype.rawListeners=function(b){return v(this,b,!1)},s.listenerCount=function(C,b){return"function"==typeof C.listenerCount?C.listenerCount(b):y.call(C,b)},s.prototype.listenerCount=y,s.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}},708:k=>{var S=Object.prototype.hasOwnProperty,a=Object.prototype.toString;k.exports=function(p,o,s){if("[object Function]"!==a.call(o))throw new TypeError("iterator must be a function");var i=p.length;if(i===+i)for(var t=0;t<i;t++)o.call(s,p[t],t,p);else for(var e in p)S.call(p,e)&&o.call(s,p[e],e,p)}},1609:k=>{"use strict";var S="Function.prototype.bind called on incompatible ",a=Array.prototype.slice,d=Object.prototype.toString,p="[object Function]";k.exports=function(s){var i=this;if("function"!=typeof i||d.call(i)!==p)throw new TypeError(S+i);for(var e,t=a.call(arguments,1),r=function(){if(this instanceof e){var m=i.apply(this,t.concat(a.call(arguments)));return Object(m)===m?m:this}return i.apply(s,t.concat(a.call(arguments)))},n=Math.max(0,i.length-t.length),l=[],v=0;v<n;v++)l.push("$"+v);if(e=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(r),i.prototype){var y=function(){};y.prototype=i.prototype,e.prototype=new y,y.prototype=null}return e}},5396:(k,S,a)=>{"use strict";var d=a(1609);k.exports=Function.prototype.bind||d},8540:(k,S,a)=>{"use strict";var d,p=SyntaxError,o=Function,s=TypeError,i=function(A){try{return o('"use strict"; return ('+A+").constructor;")()}catch(I){}},t=Object.getOwnPropertyDescriptor;if(t)try{t({},"")}catch(A){t=null}var e=function(){throw new s},r=t?function(){try{return e}catch(A){try{return t(arguments,"callee").get}catch(I){return e}}}():e,n=a(9326)(),l=Object.getPrototypeOf||function(A){return A.__proto__},v={},y="undefined"==typeof Uint8Array?d:l(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?d:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?d:ArrayBuffer,"%ArrayIteratorPrototype%":n?l([][Symbol.iterator]()):d,"%AsyncFromSyncIteratorPrototype%":d,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?d:Atomics,"%BigInt%":"undefined"==typeof BigInt?d:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?d:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?d:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?d:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?d:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?d:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?d:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?d:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":n?l(l([][Symbol.iterator]())):d,"%JSON%":"object"==typeof JSON?JSON:d,"%Map%":"undefined"==typeof Map?d:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&n?l((new Map)[Symbol.iterator]()):d,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?d:Promise,"%Proxy%":"undefined"==typeof Proxy?d:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?d:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?d:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&n?l((new Set)[Symbol.iterator]()):d,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?d:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":n?l(""[Symbol.iterator]()):d,"%Symbol%":n?Symbol:d,"%SyntaxError%":p,"%ThrowTypeError%":r,"%TypedArray%":y,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?d:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?d:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?d:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?d:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?d:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?d:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?d:WeakSet},f=function A(I){var M;if("%AsyncFunction%"===I)M=i("async function () {}");else if("%GeneratorFunction%"===I)M=i("function* () {}");else if("%AsyncGeneratorFunction%"===I)M=i("async function* () {}");else if("%AsyncGenerator%"===I){var j=A("%AsyncGeneratorFunction%");j&&(M=j.prototype)}else if("%AsyncIteratorPrototype%"===I){var H=A("%AsyncGenerator%");H&&(M=l(H.prototype))}return m[I]=M,M},u={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},c=a(5396),h=a(7709),P=c.call(Function.call,Array.prototype.concat),C=c.call(Function.apply,Array.prototype.splice),b=c.call(Function.call,String.prototype.replace),L=c.call(Function.call,String.prototype.slice),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,w=/\\(\\)?/g,g=function(I){var M=L(I,0,1),j=L(I,-1);if("%"===M&&"%"!==j)throw new p("invalid intrinsic syntax, expected closing `%`");if("%"===j&&"%"!==M)throw new p("invalid intrinsic syntax, expected opening `%`");var H=[];return b(I,R,function(U,N,J,ee){H[H.length]=J?b(ee,w,"$1"):N||U}),H},_=function(I,M){var H,j=I;if(h(u,j)&&(j="%"+(H=u[j])[0]+"%"),h(m,j)){var U=m[j];if(U===v&&(U=f(j)),void 0===U&&!M)throw new s("intrinsic "+I+" exists, but is not available. Please file an issue!");return{alias:H,name:j,value:U}}throw new p("intrinsic "+I+" does not exist!")};k.exports=function(I,M){if("string"!=typeof I||0===I.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof M)throw new s('"allowMissing" argument must be a boolean');var j=g(I),H=j.length>0?j[0]:"",U=_("%"+H+"%",M),N=U.name,J=U.value,ee=!1,Z=U.alias;Z&&(H=Z[0],C(j,P([0,1],Z)));for(var V=1,D=!0;V<j.length;V+=1){var O=j[V],T=L(O,0,1),F=L(O,-1);if(('"'===T||"'"===T||"`"===T||'"'===F||"'"===F||"`"===F)&&T!==F)throw new p("property names with quotes must have matching quotes");if(("constructor"===O||!D)&&(ee=!0),h(m,N="%"+(H+="."+O)+"%"))J=m[N];else if(null!=J){if(!(O in J)){if(!M)throw new s("base intrinsic for "+I+" exists, but the property is not available.");return}if(t&&V+1>=j.length){var Q=t(J,O);J=(D=!!Q)&&"get"in Q&&!("originalValue"in Q.get)?Q.get:J[O]}else D=h(J,O),J=J[O];D&&!ee&&(m[N]=J)}}return J}},9326:(k,S,a)=>{"use strict";var d="undefined"!=typeof Symbol&&Symbol,p=a(9045);k.exports=function(){return"function"==typeof d&&"function"==typeof Symbol&&"symbol"==typeof d("foo")&&"symbol"==typeof Symbol("bar")&&p()}},9045:k=>{"use strict";k.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var a={},d=Symbol("test"),p=Object(d);if("string"==typeof d||"[object Symbol]"!==Object.prototype.toString.call(d)||"[object Symbol]"!==Object.prototype.toString.call(p))return!1;for(d in a[d]=42,a)return!1;if("function"==typeof Object.keys&&0!==Object.keys(a).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(a).length)return!1;var s=Object.getOwnPropertySymbols(a);if(1!==s.length||s[0]!==d||!Object.prototype.propertyIsEnumerable.call(a,d))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(a,d);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},1407:(k,S,a)=>{"use strict";var d=a(9045);k.exports=function(){return d()&&!!Symbol.toStringTag}},7709:(k,S,a)=>{"use strict";var d=a(5396);k.exports=d.call(Function.call,Object.prototype.hasOwnProperty)},9879:k=>{k.exports="function"==typeof Object.create?function(a,d){d&&(a.super_=d,a.prototype=Object.create(d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:function(a,d){if(d){a.super_=d;var p=function(){};p.prototype=d.prototype,a.prototype=new p,a.prototype.constructor=a}}},7316:(k,S,a)=>{"use strict";var d=a(1407)(),o=a(9568)("Object.prototype.toString"),s=function(r){return!(d&&r&&"object"==typeof r&&Symbol.toStringTag in r)&&"[object Arguments]"===o(r)},i=function(r){return!!s(r)||null!==r&&"object"==typeof r&&"number"==typeof r.length&&r.length>=0&&"[object Array]"!==o(r)&&"[object Function]"===o(r.callee)},t=function(){return s(arguments)}();s.isLegacyArguments=i,k.exports=t?s:i},2197:(k,S,a)=>{"use strict";var e,d=Object.prototype.toString,p=Function.prototype.toString,o=/^\s*(?:function)?\*/,s=a(1407)(),i=Object.getPrototypeOf;k.exports=function(n){if("function"!=typeof n)return!1;if(o.test(p.call(n)))return!0;if(!s)return"[object GeneratorFunction]"===d.call(n);if(!i)return!1;if(void 0===e){var v=function(){if(!s)return!1;try{return Function("return function*() {}")()}catch(r){}}();e=!!v&&i(v)}return i(n)===e}},7579:(k,S,a)=>{"use strict";var d=a(708),p=a(5127),o=a(9568),s=o("Object.prototype.toString"),i=a(1407)(),t="undefined"==typeof globalThis?global:globalThis,e=p(),r=o("Array.prototype.indexOf",!0)||function(u,c){for(var h=0;h<u.length;h+=1)if(u[h]===c)return h;return-1},n=o("String.prototype.slice"),l={},v=a(7168),y=Object.getPrototypeOf;i&&v&&y&&d(e,function(f){var u=new t[f];if(Symbol.toStringTag in u){var c=y(u),h=v(c,Symbol.toStringTag);if(!h){var P=y(c);h=v(P,Symbol.toStringTag)}l[f]=h.get}}),k.exports=function(u){if(!u||"object"!=typeof u)return!1;if(!i||!(Symbol.toStringTag in u)){var c=n(s(u),8,-1);return r(e,c)>-1}return!!v&&function(u){var c=!1;return d(l,function(h,P){if(!c)try{c=h.call(u)===P}catch(C){}}),c}(u)}},3726:(k,S,a)=>{k.exports=a(1637)},1637:(k,S,a)=>{var d=a(1732),p=k.exports=a(2628);function o(r,n,l,v){var m=new r(d.format.apply(this,[l=l||""].concat(v)));throw Error.captureStackTrace(m,n),m}function s(r,n,l){o(p.IllegalArgumentError,r,n,l)}function i(r,n,l){o(p.IllegalStateError,r,n,l)}function t(r){var n=typeof r;if("object"==n){if(!r)return"null";if(r instanceof Array)return"array"}return n}function e(r){return function(n,l){var v=t(n);if(v==r)return n;s(arguments.callee,l||'Expected "'+r+'" but got "'+v+'".',Array.prototype.slice.call(arguments,2))}}k.exports.checkArgument=function(r,n){r||s(arguments.callee,n,Array.prototype.slice.call(arguments,2))},k.exports.checkState=function(r,n){r||i(arguments.callee,n,Array.prototype.slice.call(arguments,2))},k.exports.checkIsDef=function(r,n){if(void 0!==r)return r;s(arguments.callee,n||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},k.exports.checkIsDefAndNotNull=function(r,n){if(null!=r)return r;s(arguments.callee,n||'Expected value to be defined and not null but got "'+t(r)+'".',Array.prototype.slice.call(arguments,2))},k.exports.checkIsString=e("string"),k.exports.checkIsArray=e("array"),k.exports.checkIsNumber=e("number"),k.exports.checkIsBoolean=e("boolean"),k.exports.checkIsFunction=e("function"),k.exports.checkIsObject=e("object")},2628:(k,S,a)=>{var d=a(1732);function p(s){Error.call(this,s),this.message=s}function o(s){Error.call(this,s),this.message=s}d.inherits(p,Error),p.prototype.name="IllegalArgumentError",d.inherits(o,Error),o.prototype.name="IllegalStateError",k.exports.IllegalStateError=o,k.exports.IllegalArgumentError=p},4209:(k,S,a)=>{"use strict";var d=a(617);k.exports=function(o,s,i,t){var e,r=new Error("Canceled");return new d(function(l,v,y){var m;o(function(u){return y()?d.reject(r):(m=s(u),i(m).then(function(h){if(y())throw r;return e=h()}))}).then(function(u){if(y())throw u.disconnect(),r;l(t(m,u))}).catch(function(u){v(u)})},function(){e&&e.cancel()})}},3232:(k,S,a)=>{"use strict";var d=a(4135).MediaStreamTrack,p=a(4911),o=p.guessBrowser,s=p.guessBrowserVersion,i=a(4209),t=a(5085),e=a(3472),r=a(3066),n=a(7217),l=a(1865),v=l.LocalAudioTrack,y=l.LocalDataTrack,m=l.LocalVideoTrack,f=a(6062),u=a(7970),c=a(9003),h=a(3761),P=h.asLocalTrack,C=h.buildLogLevels,b=h.filterObject,L=h.isNonArrayObject,R=a(9917),w=R.DEFAULT_ENVIRONMENT,g=R.DEFAULT_LOG_LEVEL,_=R.DEFAULT_LOGGER_NAME,A=R.DEFAULT_REALM,I=R.DEFAULT_REGION,M=R.WS_SERVER,j=R.SDK_NAME,H=R.SDK_VERSION,U=R.typeErrors,N=a(617),J=a(8326),ee=a(7394),Z=a(6901).kG,V="safari"===o()&&s(),D=0,O=!1,T=!1;if(V){var F=V.major;T=F<12||12===F&&V.minor<1}var q=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),$=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function Y(B,z,le){le.forEach(function(ge){var _e=ge.didWarn,be=ge.name,Ee=ge.newName,Oe=ge.shouldDelete;be in B&&void 0!==B[be]&&(Ee&&Oe&&(B[Ee]=B[be]),Oe&&delete B[be],!_e&&!["error","off"].includes(z.level)&&(z.warn('The ConnectOptions "'+be+'" is '+(Ee?'deprecated and scheduled for removal. Please use "'+Ee+'" instead.':"no longer applicable and will be ignored.")),ge.didWarn=!0))})}function te(B,z,le,ge,_e,be){var Ee=B.createLocalParticipantSignaling(le,ge);return z.debug("Creating a new LocalParticipant:",Ee),new _e.LocalParticipant(Ee,be,_e)}function re(B,z,le){var ge=new u(z,le,B),_e=B.log;return _e.debug("Creating a new Room:",ge),le.on("stateChanged",function be(Ee){"disconnected"===Ee&&(_e.info("Disconnected from Room:",ge.toString()),le.removeListener("stateChanged",be))}),ge}function W(B,z,le,ge,_e,be){return z.log.debug("Creating a new RoomSignaling"),le.connect(be._signaling,B,ge,_e,z)}function E(B,z){var le=B.log;return B.shouldStopLocalTracks=!B.tracks,B.shouldStopLocalTracks?le.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(le.info("Getting LocalTracks"),le.debug("Options:",B)),B.createLocalTracks(B).then(function(_e){var be=z(_e);return be.catch(function(){B.shouldStopLocalTracks&&(le.info("The automatically acquired LocalTracks will now be stopped"),_e.forEach(function(Oe){Oe.stop()}))}),be})}function x(B){var z="string"==typeof B?{codec:B}:B;switch(z.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},z);case"vp8":return Object.assign({simulcast:!1},z);default:return z}}k.exports=function(B,z){if(void 0===z&&(z={}),!L(z))return N.reject(U.INVALID_TYPE("options","object"));var Oe,le=z.Log||ee,ge=z.loggerName||_,_e=z.logLevel||g,be=C(_e),Ee="[connect #"+ ++D+"]";try{Oe=new le("default",Ee,be,ge)}catch(me){return N.reject(me)}Y(z,Oe,q);var Ie="auto"===z.preferredVideoCodecs;if(Ie&&(z.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),z.maxVideoBitrate&&Ie)return Oe.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),N.reject(U.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));var fe={};"string"==typeof(z=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:w,eventListener:null,insights:!0,LocalAudioTrack:v,LocalDataTrack:y,LocalParticipant:e,LocalVideoTrack:m,Log:le,MediaStreamTrack:d,loggerName:ge,logLevel:_e,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:A,region:I,signaling:c},b(z))).wsServerInsights&&(fe.gateway=z.wsServerInsights);var G=new(z.insights?r:n)(B,j,H,z.environment,z.realm,fe),K=M(z.environment,z.region),ne=new J(G,Date.now(),Oe,z.eventListener);if((z=Object.assign({eventObserver:ne,wsServer:K},z)).log=Oe,T&&!O&&"error"!==Oe.logLevel&&"off"!==Oe.logLevel&&(O=!0,Oe.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),"string"!=typeof B)return N.reject(U.INVALID_TYPE("token","string"));var ie=Object.assign({},z);if(delete ie.name,"tracks"in z){if(!Array.isArray(z.tracks))return N.reject(U.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{z.tracks=z.tracks.map(function(me){return P(me,ie)})}catch(me){return N.reject(me)}}var ce=Z(z.bandwidthProfile);if(ce)return N.reject(ce);z.clientTrackSwitchOffControl="disabled",z.contentPreferencesMode="disabled",z.bandwidthProfile&&(z.clientTrackSwitchOffControl="auto",z.contentPreferencesMode="auto",z.bandwidthProfile.video&&(Y(z.bandwidthProfile.video,Oe,$),z.clientTrackSwitchOffControl="maxTracks"in z.bandwidthProfile.video?"disabled":"manual"===z.bandwidthProfile.video.clientTrackSwitchOffControl?"manual":"auto",z.contentPreferencesMode="renderDimensions"in z.bandwidthProfile.video?"disabled":"manual"===z.bandwidthProfile.video.contentPreferencesMode?"manual":"auto"));var Ce=new(0,z.signaling)(z.wsServer,z);Oe.info("Connecting to a Room"),Oe.debug("Options:",z);var Ae=new t({maxAudioBitrate:z.maxAudioBitrate,maxVideoBitrate:z.maxVideoBitrate},Ie),xe={audio:z.preferredAudioCodecs.map(x),video:z.preferredVideoCodecs.map(x)},Pe=new f(L(z.networkQuality)?z.networkQuality:{}),Re=i(E.bind(null,z),te.bind(null,Ce,Oe,Ae,Pe,z),W.bind(null,B,z,Ce,Ae,xe),re.bind(null,z));return Re.then(function(me){return G.connect(me.sid,me.localParticipant.sid),Oe.info("Connected to Room:",me.toString()),Oe.info("Room name:",me.name),Oe.debug("Room:",me),me.once("disconnected",function(){return G.disconnect()}),me},function(me){G.disconnect(),Re._isCanceled?Oe.info("Attempt to connect to a Room was canceled"):Oe.info("Error while connecting to a Room:",me)}),Re}},9292:(k,S,a)=>{"use strict";var d=a(9917),p=d.DEFAULT_LOG_LEVEL,o=d.DEFAULT_LOGGER_NAME;function s(e,r){r=Object.assign({loggerName:o,logLevel:p},r);var n={};n.loggerName=r.loggerName,n.logLevel=r.logLevel,delete r.loggerName,delete r.logLevel;var l=r.createLocalTracks;return delete r.createLocalTracks,n[e]=!(Object.keys(r).length>0)||r,l(n).then(function(v){return v[0]})}k.exports={audio:function(e){return s("audio",e)},video:function(e){return s("video",e)}}},8953:function(k,S,a){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(w){for(var g,_=1,A=arguments.length;_<A;_++)for(var I in g=arguments[_])Object.prototype.hasOwnProperty.call(g,I)&&(w[I]=g[I]);return w}).apply(this,arguments)},p=this&&this.__awaiter||function(w,g,_,A){return new(_||(_=Promise))(function(M,j){function H(J){try{N(A.next(J))}catch(ee){j(ee)}}function U(J){try{N(A.throw(J))}catch(ee){j(ee)}}function N(J){J.done?M(J.value):function(M){return M instanceof _?M:new _(function(j){j(M)})}(J.value).then(H,U)}N((A=A.apply(w,g||[])).next())})},o=this&&this.__generator||function(w,g){var A,I,M,j,_={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return j={next:H(0),throw:H(1),return:H(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j;function H(N){return function(J){return function(N){if(A)throw new TypeError("Generator is already executing.");for(;_;)try{if(A=1,I&&(M=2&N[0]?I.return:N[0]?I.throw||((M=I.return)&&M.call(I),0):I.next)&&!(M=M.call(I,N[1])).done)return M;switch(I=0,M&&(N=[2&N[0],M.value]),N[0]){case 0:case 1:M=N;break;case 4:return _.label++,{value:N[1],done:!1};case 5:_.label++,I=N[1],N=[0];continue;case 7:N=_.ops.pop(),_.trys.pop();continue;default:if(!(M=(M=_.trys).length>0&&M[M.length-1])&&(6===N[0]||2===N[0])){_=0;continue}if(3===N[0]&&(!M||N[1]>M[0]&&N[1]<M[3])){_.label=N[1];break}if(6===N[0]&&_.label<M[1]){_.label=M[1],M=N;break}if(M&&_.label<M[2]){_.label=M[2],_.ops.push(N);break}M[2]&&_.ops.pop(),_.trys.pop();continue}N=g.call(w,_)}catch(J){N=[6,J],I=0}finally{A=M=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([N,J])}}},s=this&&this.__read||function(w,g){var _="function"==typeof Symbol&&w[Symbol.iterator];if(!_)return w;var I,j,A=_.call(w),M=[];try{for(;(void 0===g||g-- >0)&&!(I=A.next()).done;)M.push(I.value)}catch(H){j={error:H}}finally{try{I&&!I.done&&(_=A.return)&&_.call(A)}finally{if(j)throw j.error}}return M},i=this&&this.__spreadArray||function(w,g){for(var _=0,A=g.length,I=w.length;_<A;_++,I++)w[I]=g[_];return w};Object.defineProperty(S,"__esModule",{value:!0}),S.createLocalTracks=void 0;var t=a(3761),e=t.asLocalTrack,r=t.buildLogLevels,n=a(4135),l=n.getUserMedia,v=n.MediaStreamTrack,y=a(1865),m=y.LocalAudioTrack,f=y.LocalDataTrack,u=y.LocalVideoTrack,c=a(7394),h=a(9917),P=h.DEFAULT_LOG_LEVEL,C=h.DEFAULT_LOGGER_NAME,b=a(8201),L=0;S.createLocalTracks=function(w){return p(this,void 0,void 0,function(){var g,_,A,I,M,j,H,U,N,J,ee,Z;return o(this,function(V){switch(V.label){case 0:if(_=d({audio:g=!(w&&("audio"in w||"video"in w)),getUserMedia:l,loggerName:C,logLevel:P,LocalAudioTrack:m,LocalDataTrack:f,LocalVideoTrack:u,MediaStreamTrack:v,Log:c,video:g},w),A="[createLocalTracks #"+ ++L+"]",I=r(_.logLevel),M=new _.Log("default",A,I,_.loggerName),delete(j=Object.assign({log:M},_)).name,!1===_.audio&&!1===_.video)return M.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(_.tracks)return M.info("Adding user-provided LocalTracks"),M.debug("LocalTracks:",_.tracks),[2,_.tracks];(H={audio:"object"==typeof _.audio&&_.audio.name?{name:_.audio.name}:{},video:"object"==typeof _.video&&_.video.name?{name:_.video.name}:{}}).audio.isCreatedByCreateLocalTracks=!0,H.video.isCreatedByCreateLocalTracks=!0,"object"==typeof _.audio&&"boolean"==typeof _.audio.workaroundWebKitBug1208516&&(H.audio.workaroundWebKitBug1208516=_.audio.workaroundWebKitBug1208516),"object"==typeof _.video&&"boolean"==typeof _.video.workaroundWebKitBug1208516&&(H.video.workaroundWebKitBug1208516=_.video.workaroundWebKitBug1208516),"object"==typeof _.audio&&delete _.audio.name,"object"==typeof _.video&&delete _.video.name,U={audio:_.audio,video:_.video},N="object"==typeof _.audio&&_.audio.workaroundWebKitBug180748,V.label=1;case 1:return V.trys.push([1,3,,4]),[4,N?b(M,_.getUserMedia,U):_.getUserMedia(U)];case 2:return J=V.sent(),ee=i(i([],s(J.getAudioTracks())),s(J.getVideoTracks())),M.info("Call to getUserMedia successful; got MediaStreamTracks:",ee),[2,ee.map(function(D){return e(D,d(d({},H[D.kind]),j))})];case 3:throw Z=V.sent(),M.warn("Call to getUserMedia failed:",Z),Z;case 4:return[2]}})})}},1144:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(747),o=a(2630),s=function(i){function t(e){var r=i.call(this,e.label,e.maxPacketLifeTime,e.maxRetransmits,e.ordered)||this;return Object.defineProperties(r,{_dataChannel:{value:e}}),e.binaryType="arraybuffer",e.addEventListener("message",function(n){r.emit("message",n.data)}),e.addEventListener("close",function(){r.emit("close")}),r}return d(t,i),t.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},t.prototype.toDataTransport=function(){return new o(this._dataChannel)},t}(p);k.exports=s},920:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(747),o=a(3761).makeUUID,s=function(i){function t(e,r,n){var l=i.call(this,o(),e,r,n)||this;return Object.defineProperties(l,{_clones:{value:new Set},_dataChannels:{value:new Set}}),l}return d(t,i),t.prototype._addClone=function(e){this._clones.add(e)},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.addDataChannel=function(e){return this._dataChannels.add(e),this},t.prototype.clone=function(){var e=this,r=new t(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(r),r.once("stopped",function(){return e.removeClone(r)}),r},t.prototype.removeDataChannel=function(e){return this._dataChannels.delete(e),this},t.prototype.send=function(e){return this._dataChannels.forEach(function(r){try{r.send(e)}catch(n){}}),this._clones.forEach(function(r){try{r.send(e)}catch(n){}}),this},t.prototype.stop=function(){this._dataChannels.forEach(function(e){return e.close()}),this._clones.forEach(function(e){return e.stop()}),i.prototype.stop.call(this)},t}(p);k.exports=s},747:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){var l=s.call(this,t,"data")||this;return Object.defineProperties(l,{maxPacketLifeTime:{enumerable:!0,value:e},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:n}}),l}return d(i,s),i}(a(8699));k.exports=o},2630:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){var e=s.call(this)||this;return Object.defineProperties(e,{_dataChannel:{value:t},_messageQueue:{value:[]}}),t.addEventListener("open",function(){e._messageQueue.splice(0).forEach(function(r){return e._publish(r)})}),t.addEventListener("message",function(r){var n=r.data;try{var l=JSON.parse(n);e.emit("message",l)}catch(v){}}),e.publish({type:"ready"}),e}return d(i,s),i.prototype._publish=function(t){var e=JSON.stringify(t);try{this._dataChannel.send(e)}catch(r){}},i.prototype.publish=function(t){var e=this._dataChannel;return"closing"!==e.readyState&&"closed"!==e.readyState&&("connecting"===e.readyState?(this._messageQueue.push(t),!0):(this._publish(t),!0))},i}(a(3105).EventEmitter);k.exports=o},5085:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return t=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},t),Object.defineProperties(r,{maxAudioBitrate:{value:t.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:t.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:e}}),r}return d(i,s),i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(t){var e=this;t=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},t),["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,l){return e[l]!==t[l]&&(e[l]=t[l],n=!0),n},!1)&&this.emit("changed")},i}(a(3105).EventEmitter);k.exports=o},5737:(k,S,a)=>{"use strict";var d=a(3105).EventEmitter,p=a(3761).hidePrivateAndCertainPublicPropertiesInClass;k.exports=p(d,["domain"])},8987:function(k,S,a){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(f){for(var u,c=1,h=arguments.length;c<h;c++)for(var P in u=arguments[c])Object.prototype.hasOwnProperty.call(u,P)&&(f[P]=u[P]);return f}).apply(this,arguments)};Object.defineProperty(S,"__esModule",{value:!0});var p=a(8953),o=a(712),s={connect:a(3232),createLocalAudioTrack:a(9292).audio,createLocalVideoTrack:a(9292).video,isSupported:a(563)(),version:a(1730).version,Logger:a(6828),LocalAudioTrack:a(1865).LocalAudioTrack,LocalDataTrack:a(1865).LocalDataTrack,LocalVideoTrack:a(1865).LocalVideoTrack};k.exports={connect:function(f,u){var c=d({createLocalTracks:p.createLocalTracks},u);return s.connect(f,c)},createLocalAudioTrack:function(f){var u=d({createLocalTracks:p.createLocalTracks},f);return s.createLocalAudioTrack(u)},createLocalVideoTrack:function(f){var u=d({createLocalTracks:p.createLocalTracks},f);return s.createLocalVideoTrack(u)},createLocalTracks:p.createLocalTracks,runPreflight:o.runPreflight,isSupported:s.isSupported,version:s.version,Logger:s.Logger,LocalAudioTrack:s.LocalAudioTrack,LocalVideoTrack:s.LocalVideoTrack,LocalDataTrack:s.LocalDataTrack}},3472:function(k,S,a){"use strict";var L,d=this&&this.__extends||(L=function(R,w){return(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(g[A]=_[A])})(R,w)},function(R,w){if("function"!=typeof w&&null!==w)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function g(){this.constructor=R}L(R,w),R.prototype=null===w?Object.create(w):(g.prototype=w.prototype,new g)}),p=a(4135).MediaStreamTrack,o=a(3761),s=o.asLocalTrack,i=o.asLocalTrackPublication,t=o.trackClass,e=a(9917),r=e.typeErrors,n=e.trackPriority,l=a(6901).Wv,v=a(1865),y=v.LocalAudioTrack,m=v.LocalDataTrack,f=v.LocalVideoTrack,u=a(4167),c=a(7969),h=a(6156),C=function(L){function R(w,g,_){var A=this,I=(_=Object.assign({LocalAudioTrack:y,LocalVideoTrack:f,LocalDataTrack:m,MediaStreamTrack:p,LocalAudioTrackPublication:u,LocalVideoTrackPublication:h,LocalDataTrackPublication:c,shouldStopLocalTracks:!1,tracks:g},_)).shouldStopLocalTracks?new Set(g.filter(function(M){return"data"!==M.kind})):new Set;return A=L.call(this,w,_)||this,Object.defineProperties(A,{_eventObserver:{value:_.eventObserver},_LocalAudioTrack:{value:_.LocalAudioTrack},_LocalDataTrack:{value:_.LocalDataTrack},_LocalVideoTrack:{value:_.LocalVideoTrack},_MediaStreamTrack:{value:_.MediaStreamTrack},_LocalAudioTrackPublication:{value:_.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:_.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:_.LocalVideoTrackPublication},_tracksToStop:{value:I},signalingRegion:{enumerable:!0,get:function(){return w.signalingRegion}}}),A._handleTrackSignalingEvents(),A}return d(R,L),R.prototype._addTrack=function(w,g,_){var A=L.prototype._addTrack.call(this,w,g);return A&&"disconnected"!==this.state&&this._addLocalTrack(w,_),A},R.prototype._addLocalTrack=function(w,g){this._signaling.addTrack(w._trackSender,w.name,g),this._log.info("Added a new "+t(w,!0)+":",w.id),this._log.debug(t(w,!0)+":",w)},R.prototype._removeTrack=function(w,g){var _=L.prototype._removeTrack.call(this,w,g);return _&&"disconnected"!==this.state&&(this._signaling.removeTrack(w._trackSender),this._log.info("Removed a "+t(w,!0)+":",w.id),this._log.debug(t(w,!0)+":",w)),_},R.prototype._getTrackEvents=function(){return L.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},R.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},R.prototype._handleTrackSignalingEvents=function(){var w=this,g=this._log;if("disconnected"!==this.state){var _=this._signaling;this.on("trackDisabled",A),this.on("trackEnabled",I),this.on("trackStopped",M),this._tracks.forEach(function(H){w._addLocalTrack(H,n.PRIORITY_STANDARD),w._getOrCreateLocalTrackPublication(H).catch(function(U){g.warn("Failed to get or create LocalTrackPublication for "+H+":",U)})});var j=this;_.on("stateChanged",function H(U){g.debug("Transitioned to state:",U),"disconnected"===U?(g.debug("Removing LocalTrack event listeners"),_.removeListener("stateChanged",H),j.removeListener("trackDisabled",A),j.removeListener("trackEnabled",I),j.removeListener("trackStopped",M),j._tracks.forEach(function(N){var J=M(N);J&&N._trackSender.removeClone(J._trackTransceiver)}),g.info("LocalParticipant disconnected. Stopping "+j._tracksToStop.size+" automatically-acquired LocalTracks"),j._tracksToStop.forEach(function(N){N.stop()})):"connected"===U&&(g.info("reconnected"),setTimeout(function(){return j.emit("reconnected")},0))})}function A(H){var U=_.getPublication(H._trackSender);U&&(U.disable(),g.debug("Disabled the "+t(H,!0)+":",H.id))}function I(H){var U=_.getPublication(H._trackSender);U&&(U.enable(),g.debug("Enabled the "+t(H,!0)+":",H.id))}function M(H){var U=_.getPublication(H._trackSender);return U&&U.stop(),U}},R.prototype._getOrCreateLocalTrackPublication=function(w){var g=b(this.tracks,w);if(g)return Promise.resolve(g);var _=this._log,A=this,I=this._signaling.getPublication(w._trackSender);if(!I)return Promise.reject(new Error("Unexpected error: The "+w+" cannot be published"));function M(j){A.unpublishTrack(j.track)}return new Promise(function(j,H){I.on("updated",function U(){var N=I.error;if(N)return I.removeListener("updated",U),_.warn("Failed to publish the "+t(w,!0)+": "+N.message),A._removeTrack(w,w.id),setTimeout(function(){A.emit("trackPublicationFailed",N,w)}),void H(N);if(!A._tracks.has(w.id))return I.removeListener("updated",U),void H(new Error("The "+w+" was unpublished"));if(I.sid){I.removeListener("updated",U);var ee={log:_,LocalAudioTrackPublication:A._LocalAudioTrackPublication,LocalDataTrackPublication:A._LocalDataTrackPublication,LocalVideoTrackPublication:A._LocalVideoTrackPublication};(g=b(A.tracks,w))||(g=i(w,I,M,ee),A._addTrackPublication(g));var Z=A._signaling.state;("connected"===Z||"connecting"===Z)&&(w._processorEventObserver&&w._processorEventObserver.on("event",function(V){A._eventObserver.emit("event",{name:V.name,payload:V.data,group:"video-processor",level:"info"})}),w.processedTrack&&(w._captureFrames(),w._setSenderMediaStreamTrack(!0))),"connected"===Z&&setTimeout(function(){A.emit("trackPublished",g)}),j(g)}})})},R.prototype.publishTrack=function(w,g){var A,_=b(this.tracks,w);if(_)return Promise.resolve(_);g=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},g);try{A=s(w,g)}catch(j){return Promise.reject(j)}var I=Object.values(n);if(!I.includes(g.priority))return Promise.reject(r.INVALID_VALUE("LocalTrackPublishOptions.priority",I));var M=this._addTrack(A,A.id,g.priority)||this._tracks.get(A.id);return this._getOrCreateLocalTrackPublication(M)},R.prototype.publishTracks=function(w){if(!Array.isArray(w))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(w.map(this.publishTrack,this))},R.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},R.prototype.setNetworkQualityConfiguration=function(w){if("object"!=typeof w||null===w)throw r.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(g){if(g in w&&("number"!=typeof w[g]||isNaN(w[g])))throw r.INVALID_TYPE("networkQualityConfiguration."+g,"number")}),this._signaling.setNetworkQualityConfiguration(w),this},R.prototype.setParameters=function(w){if(void 0!==w&&"object"!=typeof w)throw r.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(w){if(this._signaling.getParameters().adaptiveSimulcast&&w.maxVideoBitrate)throw r.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(g){if(void 0!==w[g]&&"number"!=typeof w[g]&&null!==w[g])throw r.INVALID_TYPE("encodingParameters."+g,"number, null or undefined")})}else null===w&&(w={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(w),this},R.prototype.unpublishTrack=function(w){l(w,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var g=this._tracks.get(w.id);if(!g)return null;if(this._signaling.getPublication(g._trackSender).publishFailed(new Error("The "+g+" was unpublished")),!(g=this._removeTrack(g,g.id)))return null;var A=b(this.tracks,g);return A&&this._removeTrackPublication(A),A},R.prototype.unpublishTracks=function(w){var g=this;if(!Array.isArray(w))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return w.reduce(function(_,A){var I=g.unpublishTrack(A);return I?_.concat(I):_},[])},R}(a(5513));function b(L,R){return Array.from(L.values()).find(function(w){return w.track===R||w.track.mediaStreamTrack===R})||null}k.exports=C},13:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype._start=function(){s.prototype._start.call(this),this._dummyEl&&(this._dummyEl.srcObject=null,this._dummyEl=null)},i.prototype.attach=function(){return s.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return s.prototype.detach.apply(this,arguments)},i}(a(3014));k.exports=o},1865:(k,S,a)=>{"use strict";k.exports={LocalAudioTrack:a(7121),LocalVideoTrack:a(9646),LocalDataTrack:a(7913)}},7121:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(7292);function o(s,i){var t=new p(s,i);return Object.setPrototypeOf(t,o.prototype),t}d(o,p),k.exports=o},7913:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(1317);function o(s){var i=new p(s);return Object.setPrototypeOf(i,o.prototype),i}d(o,p),k.exports=o},9646:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(149);function o(s,i){var t=new p(s,i);return Object.setPrototypeOf(t,o.prototype),t}d(o,p),k.exports=o},5142:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(5737),o=a(3761),s=o.buildLogLevels,i=o.valueToJSON,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=0,n=function(l){function v(y,m,f){var u;f=Object.assign({name:y,log:null,logLevel:t},f),u=l.call(this)||this;var c=String(f.name),h=s(f.logLevel),P=f.log?f.log.createLog("media",u):new e("media",u,h,f.loggerName);return Object.defineProperties(u,{_instanceId:{value:++r},_log:{value:P},kind:{enumerable:!0,value:m},name:{enumerable:!0,value:c}}),u}return d(v,l),v.prototype.toJSON=function(){return i(this)},v}(p);k.exports=n},7292:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(13),i=function(t){function e(r,n){return t.call(this,r,n)||this}return d(e,t),e.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},e.prototype.attach=function(r){return(r=t.prototype.attach.call(this,r)).muted=!0,r},e.prototype._end=function(){return t.prototype._end.apply(this,arguments)},e.prototype.disable=function(){return t.prototype.disable.apply(this,arguments)},e.prototype.enable=function(){return t.prototype.enable.apply(this,arguments)},e.prototype.restart=function(){return t.prototype.restart.apply(this,arguments)},e.prototype.stop=function(){return t.prototype.stop.apply(this,arguments)},e}(a(6217)(p));k.exports=i},4167:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},1317:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(5142),o=a(920),s=function(i){function t(e){var r,l=new(0,(e=Object.assign({DataTrackSender:o,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},e)).DataTrackSender)(e.maxPacketLifeTime,e.maxRetransmits,e.ordered);return r=i.call(this,l.id,"data",e)||this,Object.defineProperties(r,{_trackSender:{value:l},id:{enumerable:!0,value:l.id},maxPacketLifeTime:{enumerable:!0,value:e.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:e.maxRetransmits},ordered:{enumerable:!0,value:e.ordered},reliable:{enumerable:!0,value:null===e.maxPacketLifeTime&&null===e.maxRetransmits}}),r}return d(t,i),t.prototype.send=function(e){this._trackSender.send(e)},t}(p);k.exports=s},7969:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},6217:function(k,S,a){"use strict";var L,d=this&&this.__extends||(L=function(R,w){return(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(g[A]=_[A])})(R,w)},function(R,w){if("function"!=typeof w&&null!==w)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function g(){this.constructor=R}L(R,w),R.prototype=null===w?Object.create(w):(g.prototype=w.prototype,new g)}),p=a(4135).getUserMedia,o=a(4911),s=o.guessBrowser,i=o.isIOSChrome,t=a(3761),e=t.capitalize,r=t.defer,n=t.isUserMediaTrack,l=t.waitForSometime,v=t.waitForEvent,y=a(9917).typeErrors.ILLEGAL_INVOKE,m=a(3305),f=a(4139),u=a(296),c=a(9388),h=a(8201),P=a(5550);function b(L){var R=L._log,w=L.kind,g={audio:m,video:f}[w],_=L._dummyEl,A=L.mediaStreamTrack,I=null;function H(){return Promise.race([v(A,"unmute"),l(50)]).then(function(){return D=L.mediaStreamTrack.muted,O=L.isStopped&&!!L._workaroundWebKitBug1208516Cleanup,Promise.resolve().then(function(){return"visible"===document.visibilityState&&!I&&(D||O||_.play().then(function(){return g(_)}).then(function(Z){return Z?R.warn("Silence detected"):R.info("Non-silence detected"),Z}).catch(function(Z){R.warn("Failed to detect silence:",Z)}).finally(function(){_.pause()}))});var D,O}).then(function(Z){return Z&&!I&&(I=r(),L._restart().finally(function(){_=L._dummyEl,J(),A=L.mediaStreamTrack,N(),I.resolve(),I=null}).catch(function(D){R.error("failed to restart track: ",D)})),(I&&I.promise||Promise.resolve()).finally(function(){return c.resolveDeferred(w)})}).catch(function(Z){R.error("error in maybeRestart: "+Z.message)})}function U(){var Z=L._log,V=L.kind;Z.info("Muted"),Z.debug("LocalMediaTrack:",L),c.startDeferred(V)}function N(){A.addEventListener("ended",H),A.addEventListener("mute",U),A.addEventListener("unmute",H)}function J(){A.removeEventListener("ended",H),A.removeEventListener("mute",U),A.removeEventListener("unmute",H)}var ee=function(Z){return!!Z&&H()};return u.onVisibilityChange(1,ee),N(),function(){u.offVisibilityChange(1,ee),J()}}k.exports=function(L){return function(R){function w(g,_){var A=this,I=("safari"===s()||i())&&n(g)&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState;_=Object.assign({getUserMedia:p,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:I,gUMSilentTrackWorkaround:h},_);var M=new P(g),j=M.kind;return A=R.call(this,M,_)||this,Object.defineProperties(A,{_constraints:{value:"object"==typeof _[j]?_[j]:{},writable:!0},_getUserMedia:{value:_.getUserMedia},_gUMSilentTrackWorkaround:{value:_.gUMSilentTrackWorkaround},_workaroundWebKitBug1208516:{value:_.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:_.isCreatedByCreateLocalTracks},_trackSender:{value:M},id:{enumerable:!0,value:M.id},isEnabled:{enumerable:!0,get:function(){return M.enabled}},isStopped:{enumerable:!0,get:function(){return"ended"===M.readyState}}}),A._workaroundWebKitBug1208516&&(A._workaroundWebKitBug1208516Cleanup=b(A)),A}return d(w,R),w.prototype._end=function(){this._didCallEnd||(R.prototype._end.call(this),this._didCallEnd=!0,this.emit("stopped",this))},w.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),R.prototype._initialize.call(this)},w.prototype._reacquireTrack=function(g){var _,A=this,I=A._getUserMedia,M=A._gUMSilentTrackWorkaround,j=A._log,H=A.mediaStreamTrack.kind;j.info("Re-acquiring the MediaStreamTrack"),j.debug("Constraints:",g);var U=Object.assign({audio:!1,video:!1},((_={})[H]=g,_));return(this._workaroundWebKitBug1208516Cleanup?M(j,I,U):I(U)).then(function(J){return J.getTracks()[0]})},w.prototype._restart=function(g){var _=this,A=this._log;return g=g||this._constraints,this._stop(),this._reacquireTrack(g).catch(function(I){throw A.error("Failed to re-acquire the MediaStreamTrack:",{error:I,constraints:g}),I}).then(function(I){return A.info("Re-acquired the MediaStreamTrack"),A.debug("MediaStreamTrack:",I),_._constraints=Object.assign({},g),_._setMediaStreamTrack(I)})},w.prototype._setMediaStreamTrack=function(g){var _=this;return g.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){_._unprocessedTrack=g}):this._trackSender.setMediaStreamTrack(g).catch(function(A){_._log.warn("setMediaStreamTrack failed:",{error:A,mediaStreamTrack:g})})).then(function(){_._initialize(),_._getAllAttachedElements().forEach(function(A){return _._attach(A)})})},w.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},w.prototype.enable=function(g){return(g="boolean"!=typeof g||g)!==this.mediaStreamTrack.enabled&&(this._log.info((g?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=g,this.emit(g?"enabled":"disabled",this)),this},w.prototype.disable=function(){return this.enable(!1)},w.prototype.restart=function(g){var _=this,A=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(y("restart","can only be called on a Local"+e(A)+"Track that is created using createLocalTracks or createLocal"+e(A)+"Track."));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var I=this._restart(g);return this._workaroundWebKitBug1208516&&(I=I.finally(function(){_._workaroundWebKitBug1208516Cleanup=b(_)})),I},w.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},w}(L)}},5181:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(1102),o=a(9917),s=o.typeErrors,i=o.trackPriority,t=function(e){function r(n,l,v,y){var m=e.call(this,l.name,n.sid,y)||this;return Object.defineProperties(m,{_reemitTrackEvent:{value:function(){return m.emit(m.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:n},_unpublish:{value:v},isTrackEnabled:{enumerable:!0,get:function(){return"data"===this.track.kind||this.track.isEnabled}},kind:{enumerable:!0,value:l.kind},priority:{enumerable:!0,get:function(){return n.updatedPriority}},track:{enumerable:!0,value:l}}),l.on("disabled",m._reemitTrackEvent),l.on("enabled",m._reemitTrackEvent),m}return d(r,e),r.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},r.prototype.setPriority=function(n){var l=Object.values(i);if(!l.includes(n))throw s.INVALID_VALUE("priority",l);return this._signaling.setPriority(n),this},r.prototype.unpublish=function(){return this.track.removeListener("disabled",this._reemitTrackEvent),this.track.removeListener("enabled",this._reemitTrackEvent),this._unpublish(this),this},r}(p);k.exports=t},149:function(k,S,a){"use strict";var y,d=this&&this.__extends||(y=function(m,f){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(u[h]=c[h])})(m,f)},function(m,f){if("function"!=typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function u(){this.constructor=m}y(m,f),m.prototype=null===f?Object.create(f):(u.prototype=f.prototype,new u)}),p=a(4911),o=p.guessBrowser,s=p.isIOSChrome,i=a(4139),t=a(6217),e=a(1676),r=a(3761).isUserMediaTrack,l=function(y){function m(f,u){var c=this;return u=Object.assign({workaroundSilentLocalVideo:("safari"===o()||s())&&r(f)&&"undefined"!=typeof document&&"function"==typeof document.createElement},u),c=y.call(this,f,u)||this,Object.defineProperties(c,{_workaroundSilentLocalVideo:{value:u.workaroundSilentLocalVideo?v:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),c._workaroundSilentLocalVideo&&(c._workaroundSilentLocalVideoCleanup=c._workaroundSilentLocalVideo(c,document)),c}return d(m,y),m.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},m.prototype._checkIfCanCaptureFrames=function(){return y.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},m.prototype._end=function(){return y.prototype._end.apply(this,arguments)},m.prototype._setSenderMediaStreamTrack=function(f){var u=this,c=this.mediaStreamTrack,h=f?this.processedTrack:c;return this._trackSender.setMediaStreamTrack(h).catch(function(P){return u._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:P,mediaStreamTrack:h})}).then(function(){u._unprocessedTrack=f?c:null})},m.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var f=y.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),f):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},m.prototype.removeProcessor=function(){var f=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var u=y.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return f._updateElementsMediaStreamTrack()}),u},m.prototype.disable=function(){var f=y.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),f},m.prototype.enable=function(f){void 0===f&&(f=!0);var u=y.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=f,f&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),u},m.prototype.restart=function(){var f=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var u=y.prototype.restart.apply(this,arguments);return this.processor&&u.then(function(){f._restartProcessor()}),this._workaroundSilentLocalVideo&&u.finally(function(){f._workaroundSilentLocalVideoCleanup=f._workaroundSilentLocalVideo(f,document)}),u},m.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),y.prototype.stop.apply(this,arguments)},m}(t(e));function v(y,m){var f=y._log,u=y._dummyEl,c=y.mediaStreamTrack;function h(){!y.isEnabled||(f.info("Unmuted, checking silence"),u.play().then(function(){return i(u,m)}).then(function(P){if(P)return f.warn("Silence detected, restarting"),y._stop(),y._restart();f.info("Non-silent frames detected, so no need to restart")}).catch(function(P){f.warn("Failed to detect silence and restart:",P)}).finally(function(){(u=y._dummyEl).paused||u.pause(),c.removeEventListener("unmute",h),(c=y.mediaStreamTrack).addEventListener("unmute",h)}))}return c.addEventListener("unmute",h),function(){c.removeEventListener("unmute",h)}}k.exports=l},6156:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},3014:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var C in P)Object.prototype.hasOwnProperty.call(P,C)&&(h[C]=P[C])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=a(4911),o=p.guessBrowser,s=p.isIOSChrome,i=a(4135).MediaStream,t=a(3761),e=t.waitForEvent,r=t.waitForSometime,n=a(9388),v=function(f){function u(c,h){var P=this;h=Object.assign({playPausedElementsIfNotBackgrounded:("safari"===o()||s())&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},h),P=f.call(this,c.id,c.kind,h)||this;var C=!1;return h=Object.assign({MediaStream:i},h),Object.defineProperties(P,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return C},set:function(b){C=b}},_playPausedElementsIfNotBackgrounded:{value:h.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:h.workaroundWebKitBug212780||h.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:h.MediaStream},isStarted:{enumerable:!0,get:function(){return C}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||c.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),P._initialize(),P}return d(u,f),u.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},u.prototype._initialize=function(){var c=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack.addEventListener("ended",function h(){c._end(),c.mediaStreamTrack.removeEventListener("ended",h)}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},u.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},u.prototype.attach=function(c){var h=this;return"string"==typeof c?c=this._selectElement(c):c||(c=this._createElement()),this._log.debug("Attempting to attach to element:",c),c=this._attach(c),this._shouldShimAttachedElements&&!this._elShims.has(c)&&this._elShims.set(c,function(f,u){void 0===u&&(u=null);var c=f.pause,h=f.play,P=!1;f.pause=function(){return P=!0,c.call(f)},f.play=function(){return P=!1,h.call(f)};var C=u?function(){P||u()}:null;return C&&f.addEventListener("pause",C),{pausedIntentionally:function(){return P},unShim:function(){f.pause=c,f.play=h,C&&f.removeEventListener("pause",C)}}}(c,this._playPausedElementsIfNotBackgrounded?function(){return function(f,u){var c=f.tagName.toLowerCase();u.warn("Unintentionally paused:",f),Promise.race([e(document,"visibilitychange"),r(1e3)]).then(function(){"visible"===document.visibilityState&&n.whenResolved("audio").then(function(){return u.info("Playing unintentionally paused <"+c+"> element"),u.debug("Element:",f),f.play()}).then(function(){u.info("Successfully played unintentionally paused <"+c+"> element"),u.debug("Element:",f)}).catch(function(h){u.warn("Error while playing unintentionally paused <"+c+"> element:",{error:h,el:f})})})}(c,h._log)}:null)),c},u.prototype._attach=function(c,h){void 0===h&&(h=this.processedTrack||this.mediaStreamTrack);var P=c.srcObject;return P instanceof this._MediaStream||(P=new this._MediaStream),P["audio"===h.kind?"getAudioTracks":"getVideoTracks"]().forEach(function(b){P.removeTrack(b)}),P.addTrack(h),c.srcObject=P,c.autoplay=!0,c.playsInline=!0,this._attachments.has(c)||this._attachments.add(c),c},u.prototype._selectElement=function(c){var h=document.querySelector(c);if(!h)throw new Error("Selector matched no element: "+c);return h},u.prototype._updateElementsMediaStreamTrack=function(){var c=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(h){return c._attach(h)})},u.prototype._createElement=function(){return"undefined"!=typeof document?document.createElement(this.kind):null},u.prototype.detach=function(c){var h;return h="string"==typeof c?[this._selectElement(c)]:c?[c]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",h),this._detachElements(h),c?h[0]:h},u.prototype._detachElements=function(c){return c.map(this._detachElement.bind(this))},u.prototype._detachElement=function(c){if(!this._attachments.has(c))return c;var h=c.srcObject;return h instanceof this._MediaStream&&h.removeTrack(this.processedTrack||this.mediaStreamTrack),this._attachments.delete(c),this._shouldShimAttachedElements&&this._elShims.has(c)&&(this._elShims.get(c).unShim(),this._elShims.delete(c)),c},u.prototype._getAllAttachedElements=function(){var c=[];return this._attachments.forEach(function(h){c.push(h)}),c},u}(a(5142));k.exports=v},6804:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i}(a(6583));k.exports=o},698:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(13),i=function(t){function e(r,n,l,v,y,m,f){return t.call(this,r,n,l,v,y,m,f)||this}return d(e,t),e.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},e.prototype.setPriority=function(r){return t.prototype.setPriority.call(this,r)},e}(a(1204)(p));k.exports=i},6292:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},2096:function(k,S,a){"use strict";var n,d=this&&this.__extends||(n=function(l,v){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,m){y.__proto__=m}||function(y,m){for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(y[f]=m[f])})(l,v)},function(l,v){if("function"!=typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function y(){this.constructor=l}n(l,v),l.prototype=null===v?Object.create(v):(y.prototype=v.prototype,new y)}),p=this&&this.__read||function(n,l){var v="function"==typeof Symbol&&n[Symbol.iterator];if(!v)return n;var m,u,y=v.call(n),f=[];try{for(;(void 0===l||l-- >0)&&!(m=y.next()).done;)f.push(m.value)}catch(c){u={error:c}}finally{try{m&&!m.done&&(v=y.return)&&v.call(y)}finally{if(u)throw u.error}}return f},o=this&&this.__spreadArray||function(n,l){for(var v=0,y=l.length,m=n.length;v<y;v++,m++)n[m]=l[v];return n},s=a(5142),i=a(9917),t=i.typeErrors,e=i.trackPriority,r=function(n){function l(v,y,m){var f=n.call(this,y.id,"data",m)||this;return Object.defineProperties(f,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:y.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:y.maxRetransmits},ordered:{enumerable:!0,value:y.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:null===y.maxPacketLifeTime&&null===y.maxRetransmits},sid:{enumerable:!0,value:v}}),y.on("message",function(u){f.emit("message",u,f)}),f}return d(l,n),l.prototype.setPriority=function(v){var y=o([null],p(Object.values(e)));if(!y.includes(v))throw t.INVALID_VALUE("priority",y);return this._priority=v,this},l.prototype._setEnabled=function(){},l.prototype._setSwitchedOff=function(v){this._isSwitchedOff!==v&&(this._isSwitchedOff=v,this.emit(v?"switchedOff":"switchedOn",this))},l}(s);k.exports=r},2046:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},1204:function(k,S,a){"use strict";var m,d=this&&this.__extends||(m=function(f,u){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var P in h)Object.prototype.hasOwnProperty.call(h,P)&&(c[P]=h[P])})(f,u)},function(f,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function c(){this.constructor=f}m(f,u),f.prototype=null===u?Object.create(u):(c.prototype=u.prototype,new c)}),p=this&&this.__read||function(m,f){var u="function"==typeof Symbol&&m[Symbol.iterator];if(!u)return m;var h,C,c=u.call(m),P=[];try{for(;(void 0===f||f-- >0)&&!(h=c.next()).done;)P.push(h.value)}catch(b){C={error:b}}finally{try{h&&!h.done&&(u=c.return)&&u.call(c)}finally{if(C)throw C.error}}return P},o=this&&this.__spreadArray||function(m,f){for(var u=0,c=f.length,h=m.length;u<c;u++,h++)m[h]=f[u];return m},s=a(9917),i=s.typeErrors,t=s.trackPriority,e=a(4911),r=e.guessBrowser,n=e.isIOSChrome,l=a(296);k.exports=function(m){return function(f){function u(c,h,P,C,b,L,R){var w=this;return R=Object.assign({workaroundWebKitBug212780:("safari"===r()||n())&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},R),w=f.call(this,h,R)||this,Object.defineProperties(w,{_isEnabled:{value:P,writable:!0},_isSwitchedOff:{value:C,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:b},_setRenderHint:{value:function(g){w._log.debug("updating render hint:",g),L(g)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:c},_workaroundWebKitBug212780:{value:R.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),w}return d(u,f),u.prototype.setPriority=function(c){var h=o([null],p(Object.values(t)));if(!h.includes(c))throw i.INVALID_VALUE("priority",h);return this._priority!==c&&(this._priority=c,this._setPriority(c)),this},u.prototype._setEnabled=function(c){this._isEnabled!==c&&(this._isEnabled=c,this.emit(this._isEnabled?"enabled":"disabled",this))},u.prototype._setSwitchedOff=function(c){this._isSwitchedOff!==c&&(this._isSwitchedOff=c,this.emit(c?"switchedOff":"switchedOn",this))},u.prototype.attach=function(c){var h=f.prototype.attach.call(this,c);return!0!==this.mediaStreamTrack.enabled&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||function(m){var f=m._log,u=m.kind;function c(h){!h||m._attachments.forEach(function(P){var C=m._elShims.get(P);P.paused&&C&&!C.pausedIntentionally()&&(f.info("Playing inadvertently paused <"+u+"> element"),f.debug("Element:",P),f.debug("RemoteMediaTrack:",m),P.play().then(function(){f.info("Successfully played inadvertently paused <"+u+"> element"),f.debug("Element:",P),f.debug("RemoteMediaTrack:",m)}).catch(function(L){f.warn("Error while playing inadvertently paused <"+u+"> element:",{err:L,el:P,remoteMediaTrack:m})}))})}return l.onVisibilityChange(2,c),function(){l.offVisibilityChange(2,c)}}(this)),h},u.prototype.detach=function(c){var h=f.prototype.detach.call(this,c);return 0===this._attachments.size&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),h},u}(m)}},4610:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t.name,t.sid,e)||this;Object.defineProperties(r,{_signaling:{value:t},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return t.isEnabled}},kind:{enumerable:!0,value:t.kind},publishPriority:{enumerable:!0,get:function(){return t.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=t.error,l=t.isEnabled,v=t.isSwitchedOff,y=t.priority;return t.on("updated",function(){if(n!==t.error)return n=t.error,void r.emit("subscriptionFailed",t.error);l!==t.isEnabled&&(l=t.isEnabled,r.track&&r.track._setEnabled(t.isEnabled),r.emit(t.isEnabled?"trackEnabled":"trackDisabled")),v!==t.isSwitchedOff&&(r._log.debug(r.trackSid+": "+(v?"OFF":"ON")+" => "+(t.isSwitchedOff?"OFF":"ON")),v=t.isSwitchedOff,r.track?(r.track._setSwitchedOff(t.isSwitchedOff),r.emit(v?"trackSwitchedOff":"trackSwitchedOn",r.track)):v&&r._log.warn("Track was not subscribed when switched Off.")),y!==t.priority&&r.emit("publishPriorityChanged",y=t.priority)}),r}return d(i,s),i.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i.prototype._subscribed=function(t){!this._track&&t&&(this._track=t,this.emit("subscribed",t))},i.prototype._unsubscribe=function(){if(this._track){var t=this._track;this._track=null,this.emit("unsubscribed",t)}},i}(a(1102));k.exports=o},9984:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var C in P)Object.prototype.hasOwnProperty.call(P,C)&&(h[C]=P[C])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,b,h=c.call(f),C=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)C.push(P.value)}catch(L){b={error:L}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(b)throw b.error}}return C},o=a(1204),s=a(1676),i=a(296),t=a(5092).NullObserver,e=a(1190),l=function(f){function u(c,h,P,C,b,L,R){var w=this;return R=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},R),R=Object.assign({IntersectionObserver:"undefined"==typeof IntersectionObserver||"auto"!==R.clientTrackSwitchOffControl?t:IntersectionObserver,ResizeObserver:"undefined"==typeof ResizeObserver||"auto"!==R.contentPreferencesMode?t:ResizeObserver},R),w=f.call(this,c,h,P,C,b,L,R)||this,Object.defineProperties(w,{_enableDocumentVisibilityTurnOff:{value:!0===R.enableDocumentVisibilityTurnOff&&"auto"===R.clientTrackSwitchOffControl},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:R.clientTrackSwitchOffControl},_contentPreferencesMode:{value:R.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new e(function(){w._setRenderHint({enabled:!1})},50,!1)},_resizeObserver:{value:new R.ResizeObserver(function(g){g.find(function(A){return!w._invisibleElements.has(A.target)})&&m(w)})},_intersectionObserver:{value:new R.IntersectionObserver(function(g){var _=!1;g.forEach(function(A){!w._invisibleElements.has(A.target)!==A.isIntersecting&&(A.isIntersecting?(w._log.debug("intersectionObserver detected: Off => On"),w._invisibleElements.delete(A.target)):(w._log.debug("intersectionObserver detected: On => Off"),w._invisibleElements.add(A.target)),_=!0)}),_&&(y(w),m(w))},{threshold:.25})}}),w}return d(u,f),u.prototype._start=function(c){var h=f.prototype._start.call(this,c);return y(this),h},u.prototype.switchOn=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},u.prototype.switchOff=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},u.prototype.setContentPreferences=function(c){if("manual"!==this._contentPreferencesMode)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return c.renderDimensions&&this._setRenderHint({renderDimensions:c.renderDimensions}),this},u.prototype._unObservePip=function(c){var h=this._elToPipCallbacks.get(c);h&&(c.removeEventListener("enterpictureinpicture",h.onEnterPip),c.removeEventListener("leavepictureinpicture",h.onLeavePip),this._elToPipCallbacks.delete(c))},u.prototype._observePip=function(c){var h=this;if(!this._elToPipCallbacks.get(c)){var C=function(R){return h._onEnterPip(R,c)},b=function(R){return h._onLeavePip(R,c)};c.addEventListener("enterpictureinpicture",C),c.addEventListener("leavepictureinpicture",b),this._elToPipCallbacks.set(c,{onEnterPip:C,onLeavePip:b,onResizePip:function(R){return h._onResizePip(R,c)}})}},u.prototype._onEnterPip=function(c,h){this._log.debug("onEnterPip");var P=c.pictureInPictureWindow;this._elToPipWindows.set(h,P);var C=this._elToPipCallbacks.get(h).onResizePip;P.addEventListener("resize",C),y(this)},u.prototype._onLeavePip=function(c,h){this._log.debug("onLeavePip"),this._elToPipWindows.delete(h);var P=this._elToPipCallbacks.get(h).onResizePip;c.pictureInPictureWindow.removeEventListener("resize",P),y(this)},u.prototype._onResizePip=function(){m(this)},u.prototype.attach=function(c){var h=f.prototype.attach.call(this,c);return"auto"===this._clientTrackSwitchOffControl&&this._invisibleElements.add(h),this._intersectionObserver.observe(h),this._resizeObserver.observe(h),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||function(f){function u(){y(f)}return i.onVisibilityChange(1,u),function(){i.offVisibilityChange(1,u)}}(this)),this._observePip(h),h},u.prototype.detach=function(c){var h=this,P=f.prototype.detach.call(this,c);return(Array.isArray(P)?P:[P]).forEach(function(b){h._intersectionObserver.unobserve(b),h._resizeObserver.unobserve(b),h._invisibleElements.delete(b),h._unObservePip(b)}),0===this._attachments.size&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),y(this),m(this),P},u.prototype.addProcessor=function(){return f.prototype.addProcessor.apply(this,arguments)},u.prototype.removeProcessor=function(){return f.prototype.removeProcessor.apply(this,arguments)},u.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},u.prototype.setPriority=function(c){return f.prototype.setPriority.call(this,c)},u}(o(s));function y(f){if("auto"===f._clientTrackSwitchOffControl){var u=f._getAllAttachedElements().filter(function(P){return!f._invisibleElements.has(P)});!0==(f._getAllAttachedElements().filter(function(P){return f._elToPipWindows.has(P)}).length>0||"visible"===document.visibilityState&&u.length>0)?(f._turnOffTimer.clear(),f._setRenderHint({enabled:!0})):f._turnOffTimer.isSet||f._turnOffTimer.start()}}function m(f){if("auto"===f._contentPreferencesMode){var u=f._getAllAttachedElements().filter(function(w){return!f._invisibleElements.has(w)}),c=f._getAllAttachedElements().map(function(w){var g=f._elToPipWindows.get(w);return g?{clientHeight:g.height,clientWidth:g.width}:{clientHeight:0,clientWidth:0}}),h=u.concat(c);if(h.length>0){var C=p(h.sort(function(w,g){return g.clientHeight+g.clientWidth-w.clientHeight-w.clientWidth-1}),1)[0];f._setRenderHint({renderDimensions:{height:C.clientHeight,width:C.clientWidth}})}}}k.exports=l},9780:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},5550:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=this&&this.__read||function(i,t){var e="function"==typeof Symbol&&i[Symbol.iterator];if(!e)return i;var n,v,r=e.call(i),l=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)l.push(n.value)}catch(y){v={error:y}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(v)throw v.error}}return l},s=function(i){function t(e){var r=i.call(this,e.id,e)||this;return Object.defineProperties(r,{_clones:{value:new Set},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{get:function(){return!!this._clones.size}}}),r}return d(t,i),t.prototype.clone=function(){var e=new t(this.track.clone());return this._clones.add(e),e},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.setMediaStreamTrack=function(e){var r=this,n=Array.from(this._clones),l=Array.from(this._senders);return Promise.all(n.map(function(v){return v.setMediaStreamTrack(e.clone())}).concat(l.map(function(v){return r._replaceTrack(v,e)}))).finally(function(){r._track=e})},t.prototype.addSender=function(e,r){return this._senders.add(e),r&&this._senderToPublisherHintCallbacks.set(e,r),this},t.prototype.removeSender=function(e){return this._senders.delete(e),this._senderToPublisherHintCallbacks.delete(e),this},t.prototype.setPublisherHint=function(e){var n=p(Array.from(this._senderToPublisherHintCallbacks.values()),1)[0];return n?n(e):Promise.resolve("COULD_NOT_APPLY_HINT")},t.prototype._replaceTrack=function(e,r){var n=this;return e.replaceTrack(r).then(function(l){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),l})},t}(a(6583));k.exports=s},1102:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(5737),o=a(3761),s=o.buildLogLevels,i=o.valueToJSON,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=0,n=function(l){function v(y,m,f){var u=l.call(this)||this;f=Object.assign({logLevel:t},f);var c=s(f.logLevel);return Object.defineProperties(u,{_instanceId:{value:r++},_log:{value:f.log?f.log.createLog("default",u):new e("default",u,c,f.loggerName)},trackName:{enumerable:!0,value:y},trackSid:{enumerable:!0,value:m}}),u}return d(v,l),v.prototype.toJSON=function(){return i(this)},v.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},v}(p);k.exports=n},6583:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e.kind)||this;return Object.defineProperties(r,{_track:{value:e,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return d(i,s),i.prototype.stop=function(){this.track.stop(),s.prototype.stop.call(this)},i}(a(8699));k.exports=o},6679:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(3105).EventEmitter,o=a(9917).DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,s=function(i){function t(e){var r=i.call(this)||this;return Object.defineProperties(r,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:e},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),r.on("add",function(n){r._lastStatsSaveTime=Date.now(),r._lastStatsPublishTime=Date.now(),r._processorInfo=n,r._stats=[],r._reemitEvent("add",r._getEventData())}),r.on("remove",function(){var n=r._getEventData();r._lastStatsSaveTime=null,r._lastStatsPublishTime=null,r._processorInfo=null,r._stats=null,r._reemitEvent("remove",n)}),r.on("start",function(){r._reemitEvent("start",r._getEventData())}),r.on("stop",function(n){r._reemitEvent("stop",Object.assign({message:n},r._getEventData()))}),r.on("stats",function(){return r._maybeEmitStats()}),r}return d(t,i),t.prototype._getEventData=function(){if(!this._processorInfo)return{};var e=this._processorInfo,r=e.processor,m={captureHeight:e.captureHeight,captureWidth:e.captureWidth,inputFrameRate:e.inputFrameRate,isRemoteVideoTrack:e.isRemoteVideoTrack};return m.name=r._name||"VideoProcessor",["assetsPath","blurFilterRadius","fitType","isSimdEnabled","maskBlurRadius","version"].forEach(function(f){var u=r["_"+f];void 0!==u&&(m[f]=u)}),Object.keys(m).forEach(function(f){var u=m[f];"boolean"==typeof u&&(m[f]=u?"true":"false")}),m},t.prototype._maybeEmitStats=function(){if(this._stats&&this._processorInfo){var e=this._processorInfo.processor._benchmark;if(e){var r=Date.now();if(!(r-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:e.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(y){n[y]=e.getAverageDelay(y)}),this._lastStatsSaveTime=r,this._stats.push(n),!(r-this._lastStatsPublishTime<o)){this._lastStatsPublishTime=r;var v=this._stats.splice(0).reduce(function(y,m,f){return Object.keys(n).forEach(function(u){y[u]||(y[u]=0),y[u]=(y[u]*f+m[u])/(f+1)}),y},{});Object.keys(v).forEach(function(y){v[y]=parseFloat(v[y].toFixed(2))}),this._reemitEvent("stats",Object.assign({},v,this._getEventData()))}}}}},t.prototype._reemitEvent=function(e,r){this._log.debug("VideoProcessor:"+e,r),this.emit("event",{name:e,data:r})},t}(p);k.exports=s},1676:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(3014),o=a(6679),s=a(9917).DEFAULT_FRAME_RATE,i=function(e){function r(n,l){var v=e.call(this,n,l)||this;return Object.defineProperties(v,{_captureTimeoutId:{value:null,writable:!0},_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),v._processorEventObserver=new(l.VideoProcessorEventObserver||o)(v._log),v}return d(r,e),r.prototype._checkIfCanCaptureFrames=function(n){void 0===n&&(n=!1);var l=!0,v="",y=this.mediaStreamTrack;return y.enabled||(l=!1,v="MediaStreamTrack is disabled"),"ended"===y.readyState&&(l=!1,v="MediaStreamTrack is ended"),this.processor||(l=!1,v="VideoProcessor not detected."),!this._attachments.size&&!n&&(l=!1,v="VideoTrack is not publishing and there is no attached element."),v&&this._log.debug(v),{canCaptureFrames:l,message:v}},r.prototype._captureFrames=function(){var n=this;if(this._isCapturing)this._log.debug("Ignoring captureFrames call. Capture is already in progress");else{if(!this._checkIfCanCaptureFrames().canCaptureFrames)return this._isCapturing=!1,void this._log.debug("Cannot capture frames. Ignoring captureFrames call.");this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var v,l=Date.now();this._dummyEl.play().then(function(){var y=function(f){clearTimeout(n._captureTimeoutId);var u=n.mediaStreamTrack.getSettings().frameRate,P=Math.floor(1e3/(void 0===u?s:u))-v;(P<0||"number"!=typeof v)&&(P=0),n._captureTimeoutId=setTimeout(f,P)},m=function(){var f=n._checkIfCanCaptureFrames();if(!f.canCaptureFrames)return n._isCapturing=!1,n._processorEventObserver.emit("stop",f.message),void n._log.debug("Cannot capture frames. Stopping capturing frames.");l=Date.now();var u=n.mediaStreamTrack.getSettings(),c=u.width,h=void 0===c?0:c,P=u.height,C=void 0===P?0:P;n._inputFrame.width!==h&&(n._inputFrame.width=h,n._inputFrame.height=C,n._outputFrame&&(n._outputFrame.width=h,n._outputFrame.height=C)),n._inputFrame.getContext("2d").drawImage(n._dummyEl,0,0,h,C);var b=null;try{b=n.processor.processFrame(n._inputFrame,n._outputFrame)}catch(L){n._log.debug("Exception detected after calling processFrame.",L)}(b instanceof Promise?b:Promise.resolve(b)).then(function(){n._outputFrame&&(n.processedTrack.requestFrame(),n._processorEventObserver.emit("stats"))}).finally(function(){v=Date.now()-l,y(m)})};y(m)}).catch(function(y){return n._log.error("Video element cannot be played",{error:y,track:n})})}},r.prototype._initialize=function(){var n=this;e.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){t(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight)},this._dummyEl.onresize=function(){t(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight,n.isStarted&&(n._log.debug("Dimensions changed:",n.dimensions),n.emit(r.DIMENSIONS_CHANGED,n)))})},r.prototype._restartProcessor=function(){var n=this.processor;n&&(this.removeProcessor(n),this.addProcessor(n))},r.prototype._start=function(n){return this.dimensions.width=n.videoWidth,this.dimensions.height=n.videoHeight,this._log.debug("Dimensions:",this.dimensions),e.prototype._start.call(this,n)},r.prototype.addProcessor=function(n){var l=this;if("function"!=typeof OffscreenCanvas)return this._log.warn("Adding a VideoProcessor is not supported in this browser.");if(!n||"function"!=typeof n.processFrame)throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",n),this._unmuteHandler||(this._unmuteHandler=function(){l._log.debug("mediaStreamTrack unmuted"),l.processedTrack.muted&&(l._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),l._restartProcessor())},this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler));var v=this.mediaStreamTrack.getSettings(),y=v.width,m=void 0===y?0:y,f=v.height,u=void 0===f?0:f,c=v.frameRate,h=void 0===c?s:c;return this._inputFrame=new OffscreenCanvas(m,u),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=m,this._outputFrame.height=u,this.processedTrack=this._outputFrame.captureStream(0).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=n,this._processorEventObserver.emit("add",{processor:n,captureHeight:u,captureWidth:m,inputFrameRate:h,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack")}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},r.prototype.attach=function(){var n=e.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),n},r.prototype.detach=function(){return e.prototype.detach.apply(this,arguments)},r.prototype.removeProcessor=function(n){if(!n)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(n!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",n),clearTimeout(this._captureTimeoutId),this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame.getContext("2d").clearRect(0,0,this._inputFrame.width,this._inputFrame.height),this._outputFrame.getContext("2d").clearRect(0,0,this._outputFrame.width,this._outputFrame.height),this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},r}(p);function t(e,r){return e.dimensions.width!==r.videoWidth||e.dimensions.height!==r.videoHeight}i.DIMENSIONS_CHANGED="dimensionsChanged",k.exports=i},6062:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=this&&this.__read||function(l,v){var y="function"==typeof Symbol&&l[Symbol.iterator];if(!y)return l;var f,c,m=y.call(l),u=[];try{for(;(void 0===v||v-- >0)&&!(f=m.next()).done;)u.push(f.value)}catch(h){c={error:h}}finally{try{f&&!f.done&&(y=m.return)&&y.call(m)}finally{if(c)throw c.error}}return u},o=a(3105).EventEmitter,s=a(9917),i=s.DEFAULT_NQ_LEVEL_LOCAL,t=s.DEFAULT_NQ_LEVEL_REMOTE,e=s.MAX_NQ_LEVEL,r=a(3761).inRange,n=function(l){function v(y){var m=l.call(this)||this;return y=Object.assign({local:i,remote:t},y),Object.defineProperties(m,{local:{value:r(y.local,i,e)?y.local:i,writable:!0},remote:{value:r(y.remote,t,e)?y.remote:t,writable:!0}}),m}return d(v,l),v.prototype.update=function(y){var m=this;y=Object.assign({local:this.local,remote:this.remote},y),[["local",i,3],["remote",t,3]].forEach(function(f){var u=p(f,3),c=u[0],h=u[1];m[c]="number"==typeof y[c]&&r(y[c],h,u[2])?y[c]:h})},v}(o);k.exports=n},5513:function(k,S,a){"use strict";var P,d=this&&this.__extends||(P=function(C,b){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,R){L.__proto__=R}||function(L,R){for(var w in R)Object.prototype.hasOwnProperty.call(R,w)&&(L[w]=R[w])})(C,b)},function(C,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function L(){this.constructor=C}P(C,b),C.prototype=null===b?Object.create(b):(L.prototype=b.prototype,new L)}),p=this&&this.__read||function(P,C){var b="function"==typeof Symbol&&P[Symbol.iterator];if(!b)return P;var R,g,L=b.call(P),w=[];try{for(;(void 0===C||C-- >0)&&!(R=L.next()).done;)w.push(R.value)}catch(_){g={error:_}}finally{try{R&&!R.done&&(b=L.return)&&b.call(L)}finally{if(g)throw g.error}}return w},o=this&&this.__spreadArray||function(P,C){for(var b=0,L=C.length,R=P.length;b<L;b++,R++)P[R]=C[b];return P},s=a(5737),i=a(698),t=a(6292),e=a(2096),r=a(2046),n=a(9984),l=a(9780),v=a(3761),y=0,m=function(P){function C(b,L){var R=P.call(this)||this,w=function(P){var C=P.map(function(w){return[w.id,w]}),b=C.filter(function(w){return"audio"===w[1].kind}),L=C.filter(function(w){return"video"===w[1].kind});return{audioTracks:b,dataTracks:C.filter(function(w){return"data"===w[1].kind}),tracks:C,videoTracks:L}}((L=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:t,RemoteDataTrack:e,RemoteDataTrackPublication:r,RemoteVideoTrack:n,RemoteVideoTrackPublication:l,tracks:[]},L)).tracks),g=L.log.createLog("default",R),_=new Map(w.audioTracks),A=new Map(w.dataTracks),I=new Map(w.tracks),M=new Map(w.videoTracks);return Object.defineProperties(R,{_RemoteAudioTrack:{value:L.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:L.RemoteAudioTrackPublication},_RemoteDataTrack:{value:L.RemoteDataTrack},_RemoteDataTrackPublication:{value:L.RemoteDataTrackPublication},_RemoteVideoTrack:{value:L.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:L.RemoteVideoTrackPublication},_audioTracks:{value:_},_dataTracks:{value:A},_instanceId:{value:++y},_clientTrackSwitchOffControl:{value:L.clientTrackSwitchOffControl},_contentPreferencesMode:{value:L.contentPreferencesMode},_log:{value:g},_signaling:{value:b},_tracks:{value:I},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:M},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return b.identity}},networkQualityLevel:{enumerable:!0,get:function(){return b.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return b.networkQualityStats}},sid:{enumerable:!0,get:function(){return b.sid}},state:{enumerable:!0,get:function(){return b.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map}}),R._tracks.forEach(c.bind(null,R)),b.on("networkQualityLevelChanged",function(){return R.emit("networkQualityLevelChanged",R.networkQualityLevel,R.networkQualityStats&&(R.networkQualityStats.audio||R.networkQualityStats.video)?R.networkQualityStats:null)}),function(P,C){var b=P._log;"disconnected"!==P.state&&C.on("stateChanged",function L(R){b.debug("Transitioned to state:",R),P.emit(R,P),"disconnected"===R&&(b.debug("Removing Track event reemitters"),C.removeListener("stateChanged",L),P._tracks.forEach(function(w){var g=P._trackEventReemitters.get(w.id);w&&g&&g.forEach(function(_,A){w.removeListener(A,_)})}),C.tracks.forEach(function(w){var g=P._tracks.get(w.id),_=P._trackEventReemitters.get(w.id);g&&_&&_.forEach(function(A,I){g.removeListener(I,A)})}),P._trackEventReemitters.clear(),P.tracks.forEach(function(w){P._trackPublicationEventReemitters.get(w.trackSid).forEach(function(g,_){w.removeListener(_,g)})}),P._trackPublicationEventReemitters.clear())})}(R,b),g.info("Created a new Participant"+(R.identity?": "+R.identity:"")),R}return d(C,P),C.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},C.prototype._getTrackPublicationEvents=function(){return[]},C.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},C.prototype._addTrack=function(b,L){var R=this._log;return this._tracks.has(L)?null:(this._tracks.set(L,b),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[b.kind].set(L,b),c(this,b,L),R.info("Added a new "+v.trackClass(b)+":",L),R.debug(v.trackClass(b)+":",b),b)},C.prototype._addTrackPublication=function(b){var L=this._log;return this.tracks.has(b.trackSid)?null:(this.tracks.set(b.trackSid,b),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[b.kind].set(b.trackSid,b),function(P,C){var b=new Map;"disconnected"!==P.state&&(P._getTrackPublicationEvents().forEach(function(L){var R=p(L,2),w=R[0],g=R[1];b.set(w,function(){for(var _=[],A=0;A<arguments.length;A++)_[A]=arguments[A];P.emit.apply(P,o(o([g],p(_)),[C]))}),C.on(w,b.get(w))}),P._trackPublicationEventReemitters.set(C.trackSid,b))}(this,b),L.info("Added a new "+v.trackPublicationClass(b)+":",b.trackSid),L.debug(v.trackPublicationClass(b)+":",b),b)},C.prototype._handleTrackSignalingEvents=function(){var b=this,L=b._log,R=b._clientTrackSwitchOffControl,w=b._contentPreferencesMode,g=this;if("disconnected"!==this.state){var _=this._RemoteAudioTrack,A=this._RemoteAudioTrackPublication,I=this._RemoteVideoTrack,M=this._RemoteVideoTrackPublication,j=this._RemoteDataTrack,H=this._RemoteDataTrackPublication,U=this._signaling;U.on("trackAdded",N),U.on("trackRemoved",J),U.tracks.forEach(N),U.on("stateChanged",function V(D){"disconnected"===D?(L.debug("Removing event listeners"),U.removeListener("stateChanged",V),U.removeListener("trackAdded",N),U.removeListener("trackRemoved",J)):"connected"===D&&(L.info("reconnected"),setTimeout(function(){return g.emit("reconnected")},0))})}function N(V){var O=new(0,{audio:A,data:H,video:M}[V.kind])(V,{log:L});g._addTrackPublication(O);var T=V.isSubscribed;T&&ee(V),g._trackSignalingUpdatedEventCallbacks.set(V.sid,function(){if(T!==V.isSubscribed){if(T=V.isSubscribed)return void ee(V);!function(V){var D=p(Array.from(g._tracks.entries()).find(function(Q){return p(Q,2)[1].sid===V.sid}),2),O=D[0],T=D[1],F=g.tracks.get(V.sid);T&&g._removeTrack(T,F,O)}(V)}}),V.on("updated",g._trackSignalingUpdatedEventCallbacks.get(V.sid))}function J(V){V.isSubscribed&&V.setTrackTransceiver(null);var D=g._trackSignalingUpdatedEventCallbacks.get(V.sid);D&&(V.removeListener("updated",D),g._trackSignalingUpdatedEventCallbacks.delete(V.sid));var O=g.tracks.get(V.sid);O&&g._removeTrackPublication(O)}function ee(V){var D=V.isEnabled,O=V.name,T=V.kind,F=V.sid,Q=V.trackTransceiver,q=V.isSwitchedOff,$={audio:_,video:I,data:j}[T],X=g.tracks.get(F);if($&&T===Q.kind){var ae={log:L,name:O,clientTrackSwitchOffControl:R,contentPreferencesMode:w},ye="data"===T?new $(F,Q,ae):new $(F,Q,D,q,function(he){return U.updateSubscriberTrackPriority(F,he)},function(he){V.isSubscribed&&U.updateTrackRenderHint(F,he)},ae);g._addTrack(ye,X,Q.id)}}},C.prototype._removeTrack=function(b,L){if(!this._tracks.has(L))return null;this._tracks.delete(L),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[b.kind].delete(L),(this._trackEventReemitters.get(L)||new Map).forEach(function(_,A){b.removeListener(A,_)});var g=this._log;return g.info("Removed a "+v.trackClass(b)+":",L),g.debug(v.trackClass(b)+":",b),b},C.prototype._removeTrackPublication=function(b){if(!(b=this.tracks.get(b.trackSid)))return null;this.tracks.delete(b.trackSid),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[b.kind].delete(b.trackSid),(this._trackPublicationEventReemitters.get(b.trackSid)||new Map).forEach(function(g,_){b.removeListener(_,g)});var w=this._log;return w.info("Removed a "+v.trackPublicationClass(b)+":",b.trackSid),w.debug(v.trackPublicationClass(b)+":",b),b},C.prototype.toJSON=function(){return v.valueToJSON(this)},C}(s);function c(P,C,b){var L=new Map;"disconnected"!==P.state&&(P._getTrackEvents().forEach(function(R){var w=R[0],g=R[1];L.set(w,function(){var _=[g].concat([].slice.call(arguments));return P.emit.apply(P,o([],p(_)))}),C.on(w,L.get(w))}),P._trackEventReemitters.set(b,L))}k.exports=m},8267:function(k,S){"use strict";var a=this&&this.__awaiter||function(e,r,n,l){return new(n||(n=Promise))(function(y,m){function f(h){try{c(l.next(h))}catch(P){m(P)}}function u(h){try{c(l.throw(h))}catch(P){m(P)}}function c(h){h.done?y(h.value):function(y){return y instanceof n?y:new n(function(m){m(y)})}(h.value).then(f,u)}c((l=l.apply(e,r||[])).next())})},d=this&&this.__generator||function(e,r){var l,v,y,m,n={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return m={next:f(0),throw:f(1),return:f(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m;function f(c){return function(h){return function(c){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,v&&(y=2&c[0]?v.return:c[0]?v.throw||((y=v.return)&&y.call(v),0):v.next)&&!(y=y.call(v,c[1])).done)return y;switch(v=0,y&&(c=[2&c[0],y.value]),c[0]){case 0:case 1:y=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,v=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(!(y=(y=n.trys).length>0&&y[y.length-1])&&(6===c[0]||2===c[0])){n=0;continue}if(3===c[0]&&(!y||c[1]>y[0]&&c[1]<y[3])){n.label=c[1];break}if(6===c[0]&&n.label<y[1]){n.label=y[1],y=c;break}if(y&&n.label<y[2]){n.label=y[2],n.ops.push(c);break}y[2]&&n.ops.pop(),n.trys.pop();continue}c=r.call(e,n)}catch(h){c=[6,h],v=0}finally{l=y=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,h])}}},p=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y};function o(e,r,n,l){var v=[];return e.forEach(function(y){(0===l.length||l.includes(y.type))&&(0===n.length||n.includes(y.kind))&&"number"==typeof y[r]&&v.push(y[r])}),v}function i(e){return[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}].reduce(function(n,l){var v=[l.key];l.altKeys&&(v=v.concat(l.altKeys));var y=v.find(function(m){return m in e});return y&&typeof e[y]===l.type&&(n[l.key]=e[y]),n},{})}Object.defineProperty(S,"__esModule",{value:!0}),S.getCombinedConnectionStats=void 0,S.getCombinedConnectionStats=function(e){var r=e.publisher,n=e.subscriber;return a(this,void 0,void 0,function(){var l,v,y,m,f,u,c,h,P,C,b,L,R,w,g;return d(this,function(_){switch(_.label){case 0:return[4,Promise.all([r,n].map(function(A){return A.getStats()}))];case 1:return l=p.apply(void 0,[_.sent(),2]),v=l[0],m=o(y=l[1],"timestamp",["audio"],["inbound-rtp"]),f=m.length>0?m[0]:0,u=o(y,"jitter",["audio"],["inbound-rtp"]).reduce(function(A,I){return Math.max(A,I)},0),c=o(y,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(A,I){return A+I},0),h=o(y,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(A,I){return A+I},0),P=o(v,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(A,I){return Math.max(A,I)},0),C=o(y,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(A,I){return Math.max(A,I)},0),b=1e3*(C||P),L=o(v,"bytesSent",[],["candidate-pair"]).reduce(function(A,I){return A+I},0),R=o(y,"bytesReceived",[],["candidate-pair"]).reduce(function(A,I){return A+I},0),w=function(e){var r=null,n=[];e.forEach(function(f){"transport"===f.type&&f.selectedCandidatePairId?r=f.selectedCandidatePairId:"candidate-pair"===f.type&&n.push(f)});var l=n.find(function(f){return f.selected||r&&f.id===r});if(!l)return null;var v=l,y=e.get(v.localCandidateId),m=e.get(v.remoteCandidateId);return y&&m?{localCandidate:i(y),remoteCandidate:i(m)}:null}(y),g=[],y.forEach(function(A){("local-candidate"===A.type||"remote-candidate"===A.type)&&g.push(i(A))}),[2,{timestamp:f,jitter:u,packets:c,packetsLost:h,roundTripTime:b,bytesSent:L,bytesReceived:R,selectedIceCandidatePairStats:w,iceCandidateStats:g}]}})})}},8259:(k,S,a)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getTurnCredentials=void 0;var d=a(9616),p=a(9917).ICE_VERSION,o=a(7061),s=o.createTwilioError,i=o.SignalingConnectionError,t=a(3105);S.getTurnCredentials=function(r,n){return new Promise(function(l,v){var y=new t.EventEmitter,f=new d(n,{networkMonitor:null,eventObserver:y,helloBody:{edge:"roaming",preflight:!0,token:r,type:"ice",version:p}}),u=!1;f.once("close",function(){u||(u=!0,v(new i))}),f.on("message",function(c){var h=c.code,P=c.message,b=c.type;("iced"===b||"error"===b)&&!u&&(u=!0,"iced"===b?l(c.ice_servers):v(s(h,P)),f.close())})})}},2316:function(k,S){"use strict";var a=this&&this.__read||function(o,s){var i="function"==typeof Symbol&&o[Symbol.iterator];if(!i)return o;var e,n,t=i.call(o),r=[];try{for(;(void 0===s||s-- >0)&&!(e=t.next()).done;)r.push(e.value)}catch(l){n={error:l}}finally{try{e&&!e.done&&(i=t.return)&&i.call(t)}finally{if(n)throw n.error}}return r},d=this&&this.__spreadArray||function(o,s){for(var i=0,t=s.length,e=o.length;i<t;i++,e++)o[e]=s[i];return o};Object.defineProperty(S,"__esModule",{value:!0}),S.makeStat=void 0,S.makeStat=function(o){return o&&o.length?{min:Math.min.apply(Math,d([],a(o))),max:Math.max.apply(Math,d([],a(o))),average:o.reduce(function(e,r){return e+r},0)/o.length}:null}},608:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.mosToScore=S.calculateMOS=void 0;var a=94.768;S.calculateMOS=function(o,s,i){var t=o+2*s+10,e=0;switch(!0){case t<160:e=a-t/40;break;case t<1e3:e=a-(t-120)/10}switch(!0){case i<=e/2.5:e=Math.max(e-2.5*i,6.52);break;default:e=0}return 1+.035*e+7e-6*e*(e-60)*(100-e)},S.mosToScore=function(o){return o?o>4.2?5:o>4?4:o>3.6?3:o>3?2:1:0}},712:function(k,S,a){"use strict";var ee,d=this&&this.__extends||(ee=function(Z,V){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,O){D.__proto__=O}||function(D,O){for(var T in O)Object.prototype.hasOwnProperty.call(O,T)&&(D[T]=O[T])})(Z,V)},function(Z,V){if("function"!=typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function D(){this.constructor=Z}ee(Z,V),Z.prototype=null===V?Object.create(V):(D.prototype=V.prototype,new D)}),p=this&&this.__assign||function(){return(p=Object.assign||function(ee){for(var Z,V=1,D=arguments.length;V<D;V++)for(var O in Z=arguments[V])Object.prototype.hasOwnProperty.call(Z,O)&&(ee[O]=Z[O]);return ee}).apply(this,arguments)},o=this&&this.__awaiter||function(ee,Z,V,D){return new(V||(V=Promise))(function(T,F){function Q(X){try{$(D.next(X))}catch(ae){F(ae)}}function q(X){try{$(D.throw(X))}catch(ae){F(ae)}}function $(X){X.done?T(X.value):function(T){return T instanceof V?T:new V(function(F){F(T)})}(X.value).then(Q,q)}$((D=D.apply(ee,Z||[])).next())})},s=this&&this.__generator||function(ee,Z){var D,O,T,F,V={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return F={next:Q(0),throw:Q(1),return:Q(2)},"function"==typeof Symbol&&(F[Symbol.iterator]=function(){return this}),F;function Q($){return function(X){return function($){if(D)throw new TypeError("Generator is already executing.");for(;V;)try{if(D=1,O&&(T=2&$[0]?O.return:$[0]?O.throw||((T=O.return)&&T.call(O),0):O.next)&&!(T=T.call(O,$[1])).done)return T;switch(O=0,T&&($=[2&$[0],T.value]),$[0]){case 0:case 1:T=$;break;case 4:return V.label++,{value:$[1],done:!1};case 5:V.label++,O=$[1],$=[0];continue;case 7:$=V.ops.pop(),V.trys.pop();continue;default:if(!(T=(T=V.trys).length>0&&T[T.length-1])&&(6===$[0]||2===$[0])){V=0;continue}if(3===$[0]&&(!T||$[1]>T[0]&&$[1]<T[3])){V.label=$[1];break}if(6===$[0]&&V.label<T[1]){V.label=T[1],T=$;break}if(T&&V.label<T[2]){V.label=T[2],V.ops.push($);break}T[2]&&V.ops.pop(),V.trys.pop();continue}$=Z.call(ee,V)}catch(X){$=[6,X],O=0}finally{D=T=0}if(5&$[0])throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}([$,X])}}};Object.defineProperty(S,"__esModule",{value:!0}),S.runPreflight=S.PreflightTest=void 0;var i=a(9917),t=a(1960),e=a(608),r=a(8267),n=a(8259),l=a(2316),v=a(9860),y=a(9806),m=a(3761),f=a(9917).WS_SERVER,u=a(7394),c=a(5737),h=a(2100),P=a(8326),C=a(3066),b=a(3187),L=b.createSID,R=b.sessionSID,w=a(7061),g=w.SignalingConnectionTimeoutError,_=w.MediaConnectionError;function j(ee){return null!=ee}var H=0,U=function(ee){function Z(V,D){var O=ee.call(this)||this;O._testTiming=new t.Timer,O._dtlsTiming=new t.Timer,O._iceTiming=new t.Timer,O._peerConnectionTiming=new t.Timer,O._mediaTiming=new t.Timer,O._connectTiming=new t.Timer,O._sentBytesMovingAverage=new h,O._packetLossMovingAverage=new h,O._progressEvents=[],O._receivedBytesMovingAverage=new h;var F=D.environment,Q=void 0===F?"prod":F,q=D.region,X=D.duration,ae=void 0===X?1e4:X,ue=D.wsServer||f(Q,void 0===q?"gll":q);return O._log=new u("default",O,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),O._testDuration=ae,O._instanceId=H++,O._testTiming.start(),O._runPreflightTest(V,Q,ue),O}return d(Z,ee),Z.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},Z.prototype.stop=function(){this._stopped=!0},Z.prototype._generatePreflightReport=function(V){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:l.makeStat(null==V?void 0:V.jitter),rtt:l.makeStat(null==V?void 0:V.rtt),packetLoss:l.makeStat(null==V?void 0:V.packetLoss)},selectedIceCandidatePairStats:V?V.selectedIceCandidatePairStats:null,iceCandidateStats:V?V.iceCandidateStats:[],progressEvents:this._progressEvents,mos:l.makeStat(null==V?void 0:V.mos)}},Z.prototype._executePreflightStep=function(V,D,O){return o(this,void 0,void 0,function(){var T,F,Q,q;return s(this,function(X){switch(X.label){case 0:if(this._log.debug("Executing step: ",V),T=this._testDuration+1e4,this._stopped)throw new Error("stopped");F=Promise.resolve().then(D),Q=null,q=new Promise(function(ae,ue){Q=setTimeout(function(){ue(O||new Error(V+" timeout."))},T)}),X.label=1;case 1:return X.trys.push([1,,3,4]),[4,Promise.race([q,F])];case 2:return[2,X.sent()];case 3:return null!==Q&&clearTimeout(Q),[7];case 4:return[2]}})})},Z.prototype._collectNetworkTimings=function(V){var D=this;return new Promise(function(O){var T;V.addEventListener("iceconnectionstatechange",function(){"checking"===V.iceConnectionState&&D._iceTiming.start(),"connected"===V.iceConnectionState&&(D._iceTiming.stop(),D._updateProgress("iceConnected"),(!T||T&&"connected"===T.state)&&O())}),V.addEventListener("connectionstatechange",function(){"connecting"===V.connectionState&&D._peerConnectionTiming.start(),"connected"===V.connectionState&&(D._peerConnectionTiming.stop(),D._updateProgress("peerConnectionConnected"))});var Q=V.getSenders().map(function(q){return q.transport}).find(j);void 0!==Q&&(T=Q).addEventListener("statechange",function(){"connecting"===T.state&&D._dtlsTiming.start(),"connected"===T.state&&(D._dtlsTiming.stop(),D._updateProgress("dtlsConnected"),"connected"===V.iceConnectionState&&O())})})},Z.prototype._setupInsights=function(V){var O=V.environment,F=V.realm,$=new C(V.token,i.SDK_NAME,i.SDK_VERSION,void 0===O?i.DEFAULT_ENVIRONMENT:O,void 0===F?i.DEFAULT_REALM:F,{});$.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var X=new P($,Date.now(),this._log),ae=void 0;return{reportToInsights:function(ue){var de,ye,he=ue.report,ve=he.stats.jitter||ae,pe=he.stats.rtt||ae,we=he.stats.packetLoss||ae,Se=he.mos||ae,ke=new Map;he.iceCandidateStats.forEach(function(te){if(te.candidateType&&te.protocol){var re=ke.get(te.candidateType)||[];re.indexOf(te.protocol)<0&&re.push(te.protocol),ke.set(te.candidateType,re)}});var oe=JSON.stringify(Object.fromEntries(ke)),Y={name:"report",group:"preflight",level:he.error?"error":"info",payload:{sessionSID:R,preflightSID:L("PF"),progressEvents:JSON.stringify(he.progressEvents),testTiming:he.testTiming,dtlsTiming:he.networkTiming.dtls,iceTiming:he.networkTiming.ice,peerConnectionTiming:he.networkTiming.peerConnection,connectTiming:he.networkTiming.connect,mediaTiming:he.networkTiming.media,selectedLocalCandidate:null===(de=he.selectedIceCandidatePairStats)||void 0===de?void 0:de.localCandidate,selectedRemoteCandidate:null===(ye=he.selectedIceCandidatePairStats)||void 0===ye?void 0:ye.remoteCandidate,iceCandidateStats:oe,jitterStats:ve,rttStats:pe,packetLossStats:we,mosStats:Se,error:he.error}};X.emit("event",Y),setTimeout(function(){return $.disconnect()},2e3)}}},Z.prototype._runPreflightTest=function(V,D,O){return o(this,void 0,void 0,function(){var T,F,Q,q,$,X,ae,ue,de,ye,he,ve,pe=this;return s(this,function(we){switch(we.label){case 0:T=[],F=[],Q=this._setupInsights({token:V,environment:D}).reportToInsights,we.label=1;case 1:return we.trys.push([1,8,9,10]),q=[],[4,this._executePreflightStep("Acquire media",function(){return[v.syntheticAudio(),y.syntheticVideo({width:640,height:480})]})];case 2:return T=we.sent(),this._updateProgress("mediaAcquired"),this.emit("debug",{localTracks:T}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return n.getTurnCredentials(V,O)},new g)];case 3:return $=we.sent(),this._connectTiming.stop(),this._updateProgress("connected"),X=new RTCPeerConnection({iceServers:$,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),ae=new RTCPeerConnection({iceServers:$,bundlePolicy:"max-bundle"}),F.push(X),F.push(ae),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return o(pe,void 0,void 0,function(){var Se,ke,oe,Y;return s(this,function(te){switch(te.label){case 0:return X.addEventListener("icecandidate",function(re){return re.candidate&&ae.addIceCandidate(re.candidate)}),ae.addEventListener("icecandidate",function(re){return re.candidate&&X.addIceCandidate(re.candidate)}),T.forEach(function(re){return X.addTrack(re)}),Se=new Promise(function(re){var W=[];ae.addEventListener("track",function(E){W.push(E.track),W.length===T.length&&re(W)})}),[4,X.createOffer()];case 1:return ke=te.sent(),[4,X.setLocalDescription(oe=ke)];case 2:return te.sent(),[4,ae.setRemoteDescription(oe)];case 3:return te.sent(),[4,ae.createAnswer()];case 4:return Y=te.sent(),[4,ae.setLocalDescription(Y)];case 5:return te.sent(),[4,X.setRemoteDescription(Y)];case 6:return te.sent(),[4,this._collectNetworkTimings(X)];case 7:return te.sent(),[2,Se]}})})},new _)];case 4:return ue=we.sent(),this.emit("debug",{remoteTracks:ue}),ue.forEach(function(Se){Se.addEventListener("ended",function(){return pe._log.warn(Se.kind+":ended")}),Se.addEventListener("mute",function(){return pe._log.warn(Se.kind+":muted")}),Se.addEventListener("unmute",function(){return pe._log.warn(Se.kind+":unmuted")})}),this._updateProgress("mediaSubscribed"),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(Se){var ke=document.createElement("video");ke.autoplay=!0,ke.playsInline=!0,ke.muted=!0,ke.srcObject=new MediaStream(ue),q.push(ke),pe.emit("debugElement",ke),ke.oncanplay=Se})},new _)];case 5:return we.sent(),this._mediaTiming.stop(),this._updateProgress("mediaStarted"),[4,this._executePreflightStep("Collect stats for duration",function(){return pe._collectRTCStatsForDuration(pe._testDuration,{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]},X,ae)})];case 6:return de=we.sent(),[4,this._executePreflightStep("Generate report",function(){return pe._generatePreflightReport(de)})];case 7:return ye=we.sent(),Q({report:ye}),this.emit("completed",ye),[3,10];case 8:return he=we.sent(),ve=this._generatePreflightReport(),Q({report:p(p({},ve),{error:null==he?void 0:he.toString()})}),this.emit("failed",he,ve),[3,10];case 9:return F.forEach(function(Se){return Se.close()}),T.forEach(function(Se){return Se.stop()}),[7];case 10:return[2]}})})},Z.prototype._collectRTCStats=function(V,D,O){return o(this,void 0,void 0,function(){var T,F,Q,q,$,X,ae,ue,de,ye,he,ve,pe,we;return s(this,function(Se){switch(Se.label){case 0:return[4,r.getCombinedConnectionStats({publisher:D,subscriber:O})];case 1:return T=Se.sent(),F=T.timestamp,Q=T.bytesSent,q=T.bytesReceived,$=T.packets,X=T.packetsLost,ae=T.roundTripTime,de=T.selectedIceCandidatePairStats,ye=T.iceCandidateStats,he=V.jitter.length>0,V.jitter.push(ue=T.jitter),V.rtt.push(ae),this._sentBytesMovingAverage.putSample(Q,F),this._receivedBytesMovingAverage.putSample(q,F),this._packetLossMovingAverage.putSample(X,$),he&&(V.outgoingBitrate.push(1e3*this._sentBytesMovingAverage.get()*8),V.incomingBitrate.push(1e3*this._receivedBytesMovingAverage.get()*8),ve=this._packetLossMovingAverage.get(),pe=Math.min(100,100*ve),V.packetLoss.push(pe),we=e.calculateMOS(ae,ue,ve),V.mos.push(we)),V.selectedIceCandidatePairStats||(V.selectedIceCandidatePairStats=de),0===V.iceCandidateStats.length&&(V.iceCandidateStats=ye),[2]}})})},Z.prototype._collectRTCStatsForDuration=function(V,D,O,T){return o(this,void 0,void 0,function(){var F,Q,q;return s(this,function($){switch($.label){case 0:return F=Date.now(),Q=Math.min(1e3,V),[4,m.waitForSometime(Q)];case 1:return $.sent(),[4,this._collectRTCStats(D,O,T)];case 2:return $.sent(),(q=V-(Date.now()-F))>0?[4,this._collectRTCStatsForDuration(q,D,O,T)]:[3,4];case 3:D=$.sent(),$.label=4;case 4:return[2,D]}})})},Z.prototype._updateProgress=function(V){var D=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:D,name:V}),this.emit("progress",V)},Z}(c);S.PreflightTest=U,S.runPreflight=function(ee,Z){return void 0===Z&&(Z={}),new U(ee,Z)}},9860:(k,S,a)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.syntheticAudio=void 0,S.syntheticAudio=function(){var p=a(9057),o={},s=p.getOrCreate(o),i=s.createOscillator(),t=i.connect(s.createMediaStreamDestination());i.start();var e=t.stream.getAudioTracks()[0],r=e.stop;return e.stop=function(){r.call(e),p.release(o)},e}},9806:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.syntheticVideo=void 0,S.syntheticVideo=function(d){var p=void 0===d?{}:d,o=p.width,s=void 0===o?640:o,i=p.height,t=void 0===i?480:i,e=Object.assign(document.createElement("canvas"),{width:s,height:t}),r=e.getContext("2d");r.fillStyle="green",r.fillRect(0,0,e.width,e.height);var n=!1;requestAnimationFrame(function m(){if(!n){var f=Math.round(255*Math.random()),u=Math.round(255*Math.random()),c=Math.round(255*Math.random()),h=Math.round(255*Math.random());r.fillStyle="rgba("+f+", "+u+", "+c+", "+h+")",r.fillRect(Math.random()*s,Math.random()*t,50,50),requestAnimationFrame(m)}});var v=e.captureStream(30).getTracks()[0],y=v.stop;return v.stop=function(){n=!0,y.call(v)},v}},1960:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Timer=void 0;var a=function(){function d(){this._end=void 0,this.start()}return d.prototype.start=function(){return this._start=Date.now(),this},d.prototype.stop=function(){return this._end=Date.now(),this},d.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:void 0===this._end?void 0:this._end-this._start}},d}();S.Timer=a},5468:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var l,y,n=r.call(t),v=[];try{for(;(void 0===e||e-- >0)&&!(l=n.next()).done;)v.push(l.value)}catch(m){y={error:m}}finally{try{l&&!l.done&&(r=n.return)&&r.call(n)}finally{if(y)throw y.error}}return v},o=this&&this.__spreadArray||function(t,e){for(var r=0,n=e.length,l=t.length;r<n;r++,l++)t[l]=e[r];return t},i=function(t){function e(){var r=t.call(this)||this;return Object.defineProperties(r,{_queuedEvents:{value:new Map}}),r}return d(e,t),e.prototype.dequeue=function(r){var n=this,l=!0;if(!r)return this._queuedEvents.forEach(function(y,m){l=this.dequeue(m)&&l},this),l;var v=this._queuedEvents.get(r)||[];return this._queuedEvents.delete(r),v.reduce(function(y,m){return n.emit.apply(n,o([],p([r].concat(m))))&&y},l)},e.prototype.queue=function(){var r=[].slice.call(arguments);if(this.emit.apply(this,o([],p(r))))return!0;var n=r[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(r.slice(1)),!1},e}(a(3105).EventEmitter);k.exports=i},1792:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var l,y,n=r.call(t),v=[];try{for(;(void 0===e||e-- >0)&&!(l=n.next()).done;)v.push(l.value)}catch(m){y={error:m}}finally{try{l&&!l.done&&(r=n.return)&&r.call(n)}finally{if(y)throw y.error}}return v},o=this&&this.__spreadArray||function(t,e){for(var r=0,n=e.length,l=t.length;r<n;r++,l++)t[l]=e[r];return t},i=function(t){function e(r,n){var l=t.call(this,r,n)||this;return l._handleTrackSignalingEvents(),l.once("disconnected",l._unsubscribeTracks.bind(l)),l}return d(e,t),e.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},e.prototype._addTrack=function(r,n,l){return t.prototype._addTrack.call(this,r,l)?(n._subscribed(r),this.emit("trackSubscribed",r,n),r):null},e.prototype._addTrackPublication=function(r){var n=t.prototype._addTrackPublication.call(this,r);return n?(this.emit("trackPublished",n),n):null},e.prototype._getTrackPublicationEvents=function(){return o(o([],p(t.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},e.prototype._unsubscribeTracks=function(){var r=this;this.tracks.forEach(function(n){if(n.isSubscribed){var l=n.track;n._unsubscribe(),r.emit("trackUnsubscribed",l,n)}})},e.prototype._removeTrack=function(r,n,l){var v=this._tracks.get(l);return v?(t.prototype._removeTrack.call(this,v,l),n._unsubscribe(),this.emit("trackUnsubscribed",v,n),v):null},e.prototype._removeTrackPublication=function(r){this._signaling.clearTrackHint(r.trackSid);var n=t.prototype._removeTrackPublication.call(this,r);return n?(this.emit("trackUnpublished",n),n):null},e}(a(5513));k.exports=i},7970:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var C in P)Object.prototype.hasOwnProperty.call(P,C)&&(h[C]=P[C])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,b,h=c.call(f),C=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)C.push(P.value)}catch(L){b={error:L}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(b)throw b.error}}return C},o=this&&this.__spreadArray||function(f,u){for(var c=0,h=u.length,P=f.length;c<h;c++,P++)f[P]=u[c];return f},s=a(5737),i=a(1792),t=a(6614),e=a(3761).valueToJSON,r=0,n=function(f){function u(c,h,P){var C=f.call(this)||this,b=P.log.createLog("default",C),L=new Map;return Object.defineProperties(C,{_log:{value:b},_clientTrackSwitchOffControl:{value:P.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:P.contentPreferencesMode||"disabled"},_instanceId:{value:++r},_options:{value:P},_participants:{value:L},_signaling:{value:h},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(h.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return h.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:c},name:{enumerable:!0,value:h.name},participants:{enumerable:!0,value:L},sid:{enumerable:!0,value:h.sid},state:{enumerable:!0,get:function(){return h.state}},mediaRegion:{enumerable:!0,value:h.mediaRegion}}),function(f,u){u.on("updated",function(){var h=u.isEnabled;f._log.info("Recording "+(h?"started":"stopped")),f.emit("recording"+(h?"Started":"Stopped"))})}(C,h.recording),function(f,u){var c=f._log;c.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),u.participants.forEach(v.bind(null,f)),c.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),u.on("participantConnected",v.bind(null,f)),u.on("dominantSpeakerChanged",function(){return f.emit("dominantSpeakerChanged",f.dominantSpeaker)}),u.on("stateChanged",function h(P,C){switch(c.info("Transitioned to state:",P),P){case"disconnected":f.participants.forEach(function(b){b._unsubscribeTracks()}),f.emit(P,f,C),f.localParticipant.tracks.forEach(function(b){b.unpublish()}),u.removeListener("stateChanged",h);break;case"reconnecting":setTimeout(function(){return f.emit("reconnecting",C)},0);break;default:setTimeout(function(){return f.emit("reconnected")},0)}})}(C,h),b.info("Created a new Room:",C.name),b.debug("Initial RemoteParticipants:",Array.from(C._participants.values())),C}return d(u,f),u.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},u.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},u.prototype.getStats=function(){var c=this;return this._signaling.getStats().then(function(h){return Array.from(h).map(function(P){var C=p(P,2),L=C[1];return new t(C[0],Object.assign({},L,{localAudioTrackStats:l(c,L.localAudioTrackStats),localVideoTrackStats:l(c,L.localVideoTrackStats)}))})})},u.prototype.toJSON=function(){return e(this)},u}(s);function l(f,u){var c=f.localParticipant._signaling;return u.reduce(function(h,P){var C=c.tracks.get(P.trackId),b=c.getSender(C);return b?[Object.assign({},P,{trackId:b.id})].concat(h):h},[])}function v(f,u){var c=f._log,C=new i(u,{log:c,clientTrackSwitchOffControl:f._clientTrackSwitchOffControl,contentPreferencesMode:f._contentPreferencesMode});c.info("A new RemoteParticipant connected:",C),f._participants.set(C.sid,C),f.emit("participantConnected",C);var b=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(L){var R=p(Array.isArray(L)?L:[L,L],2),w=R[0],g=R[1];function _(){var A=[].slice.call(arguments);A.unshift(g),A.push(C),f.emit.apply(f,o([],p(A)))}return C.on(w,_),[w,_]});C.once("disconnected",function(){var R=f.dominantSpeaker;c.info("RemoteParticipant disconnected:",C),f._participants.delete(C.sid),b.forEach(function(w){C.removeListener(w[0],w[1])}),f.emit("participantDisconnected",C),C===R&&f.emit("dominantSpeakerChanged",f.dominantSpeaker)})}k.exports=n},3185:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(8553),o=a(6996),s=a(1856),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},t=function(e){function r(){return e.call(this,"closed",i)||this}return d(r,e),r.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},r.prototype._connect=function(n,l,v,y,m){n.connect("PA00000000000000000000000000000000","test");var u=Promise.resolve(new o(n,"RM00000000000000000000000000000000",m));return u.cancel=function(){},u},r.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},r.prototype.close=function(){var n=this;return this.bracket("close",function(l){switch(n.state){case"closed":return n;case"open":return n._close(l);default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r.prototype.connect=function(n,l,v,y,m){var f=this;return this.bracket("connect",function u(c){switch(f.state){case"closed":return f._open(c).then(u.bind(null,c));case"open":return f.releaseLockCompletely(c),f._connect(n,l,v,y,m);default:throw new Error('Unexpected Signaling state "'+f.state+'"')}})},r.prototype.createLocalParticipantSignaling=function(){return new p},r.prototype.open=function(){var n=this;return this.bracket("open",function(l){switch(n.state){case"closed":return n._open(l);case"open":return n;default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r}(s);k.exports=t},518:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),t}return d(i,s),i.prototype.addTrack=function(t,e,r){var n=this._createLocalTrackPublicationSignaling(t,e,r);return this._trackSendersToPublications.set(t,n),this._publicationsToTrackSenders.set(n,t),s.prototype.addTrack.call(this,n),this},i.prototype.getPublication=function(t){return this._trackSendersToPublications.get(t)||null},i.prototype.getSender=function(t){return this._publicationsToTrackSenders.get(t)||null},i.prototype.removeTrack=function(t){var e=this._trackSendersToPublications.get(t);return e?(this._trackSendersToPublications.delete(t),this._publicationsToTrackSenders.delete(e),s.prototype.removeTrack.call(this,e)&&e.stop(),e):null},i}(a(8553));k.exports=o},7667:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=function(i){function t(e,r,n){var l=this;return e=e.clone(),(l=i.call(this,r,e.kind,"data"===e.kind||e.track.enabled,n)||this).setTrackTransceiver(e),Object.defineProperties(l,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:e.id}}),l}return d(t,i),Object.defineProperty(t.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),t.prototype.enable=function(e){return this.trackTransceiver.track.enabled=e="boolean"!=typeof e||e,i.prototype.enable.call(this,e)},t.prototype.publishFailed=function(e){return function(i,t){return null===i._sid&&!i._error&&(i._error=t,!0)}(this,e)&&this.emit("updated"),this},t.prototype.setPriority=function(e){return this._updatedPriority!==e&&(this._updatedPriority=e,this.emit("updated")),this},t.prototype.setSid=function(e){return this._error?this:i.prototype.setSid.call(this,e)},t.prototype.stop=function(){this.trackTransceiver.stop()},t}(a(1109));k.exports=o},8553:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(1856),o=a(5674),s={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=function(t){function e(){var r=t.call(this,"connecting",s)||this;return Object.defineProperties(r,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),r}return d(e,t),Object.defineProperty(e.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(r){return this.tracks.set(r.id||r.sid,r),this.emit("trackAdded",r),this},e.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)},e.prototype.removeTrack=function(r){var n=this.tracks.get(r.id||r.sid);return this.tracks.delete(r.id||r.sid),n&&this.emit("trackRemoved",r),n||null},e.prototype.setNetworkQualityLevel=function(r,n){this._networkQualityLevel!==r&&(this._networkQualityLevel=r,this._networkQualityStats=n&&(n.audio||n.video)?new o(n):null,this.emit("networkQualityLevelChanged"))},e.prototype.connect=function(r,n){return("connecting"===this.state||"reconnecting"===this.state)&&(this._sid||(this._sid=r),this._identity||(this._identity=n),this.preempt("connected"),!0)},e.prototype.reconnecting=function(){return("connecting"===this.state||"connected"===this.state)&&(this.preempt("reconnecting"),!0)},e}(p);k.exports=i},8659:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),t}return d(i,s),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(t){return this.isEnabled!==(t="boolean"!=typeof t||t)&&(this._isEnabled=t,this.emit("updated")),this},i}(a(3105).EventEmitter);k.exports=o},8760:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return r.connect(t,e),r}return d(i,s),i}(a(8553));k.exports=o},2261:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n,l,v){var y=s.call(this,e,r,n,l)||this;return Object.defineProperties(y,{_isSwitchedOff:{value:v,writable:!0}}),y.setSid(t),y}return d(i,s),Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(t){return this.error||(this._error=t,this.emit("updated")),this},i.prototype.setPriority=function(t){return this._priority!==t&&(this._priority=t,this.emit("updated")),this},i.prototype.setSwitchedOff=function(t){return this._isSwitchedOff!==t&&(this._isSwitchedOff=t,this.emit("updated")),this},i}(a(1109));k.exports=o},6996:function(k,S,a){"use strict";var c,d=this&&this.__extends||(c=function(h,P){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,b){C.__proto__=b}||function(C,b){for(var L in b)Object.prototype.hasOwnProperty.call(b,L)&&(C[L]=b[L])})(h,P)},function(h,P){if("function"!=typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function C(){this.constructor=h}c(h,P),h.prototype=null===P?Object.create(P):(C.prototype=P.prototype,new C)}),p=a(8659),o=a(1856),s=a(1190),i=a(3761).buildLogLevels,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=a(7061),n=r.MediaConnectionError,l=r.MediaDTLSTransportFailedError,v=r.SignalingConnectionDisconnectedError,y=0,m={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},f=function(c){function h(P,C,b,L){var R=this;L=Object.assign({logLevel:t,RecordingSignaling:p,Timeout:s},L);var w=i(L.logLevel);R=c.call(this,"connected",m)||this;var g=L.RecordingSignaling,_=new L.Timeout(function(){R._disconnect(R._reconnectingError)},L.sessionTimeout,!1);return Object.defineProperties(R,{_instanceId:{value:y++},_log:{value:L.log?L.log.createLog("default",R):new e("default",R,w,L.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:L},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:_},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:P},name:{enumerable:!0,value:b},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new g},sid:{enumerable:!0,value:C}}),R.on("connectionStateChanged",function(){"failed"===R.connectionState&&!["disconnected","failed"].includes(R.iceConnectionState)&&R._disconnect(new l)}),R.on("iceConnectionStateChanged",function(){return u(R)}),R.on("signalingConnectionStateChanged",function(){return u(R)}),setTimeout(function(){return u(R)}),R}return d(h,c),h.prototype._disconnect=function(P){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[P]),!0)},h.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},h.prototype.connectParticipant=function(P){var C=this;return"disconnected"!==P.state&&!this.participants.has(P.sid)&&(this.participants.set(P.sid,P),P.on("stateChanged",function b(L){"disconnected"===L&&(P.removeListener("stateChanged",b),C.participants.delete(P.sid),C.emit("participantDisconnected",P))}),this.emit("participantConnected",P),!0)},h.prototype.disconnect=function(){return this._disconnect()},h.prototype.setDominantSpeaker=function(P){this.dominantSpeakerSid=P,this.emit("dominantSpeakerChanged")},h}(o);function u(c){var h;"disconnected"!==c.state&&"disconnected"!==c.signalingConnectionState?("reconnecting"===c.signalingConnectionState?h=c.signalingConnectionState:"failed"===c.iceConnectionState?(c._mediaConnectionIsReconnecting=!0,h="reconnecting"):"new"===c.iceConnectionState||"checking"===c.iceConnectionState?h=c._mediaConnectionIsReconnecting?"reconnecting":"connected":(c._mediaConnectionIsReconnecting=!1,c._reconnectingError=null,c._sessionTimeout.clear(),h="connected"),h!==c.state&&("reconnecting"===h?(c._reconnectingError="reconnecting"===c.signalingConnectionState?new v:new n,c._sessionTimeout.start(),c.preempt(h,null,[c._reconnectingError])):c.preempt(h))):c._sessionTimeout.clear()}k.exports=f},1109:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){var l=s.call(this)||this,v=null;return Object.defineProperties(l,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return v},set:function(y){null===v&&(v=y)}},kind:{enumerable:!0,value:e},name:{enumerable:!0,value:t}}),l}return d(i,s),Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(t){return this.isEnabled!==(t="boolean"!=typeof t||t)&&(this._isEnabled=t,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(t){return this.trackTransceiver!==(t=t||null)&&(this._trackTransceiver=t,this.emit("updated")),this},i.prototype.setSid=function(t){return null===this.sid&&(this._sid=t,this.emit("updated")),this},i}(a(3105).EventEmitter);k.exports=o},4384:(k,S,a)=>{"use strict";var d=a(617),p=a(5971),o=a(3899),s=a(1328),i=a(7061),t=i.SignalingConnectionDisconnectedError,e=i.SignalingIncomingMessageInvalidError,r=a(3761),n=r.flatMap,l=r.createRoomConnectEventPayload;k.exports=function(y,m,f,u,c,h){h=Object.assign({PeerConnectionManager:p,RoomV2:o,Transport:s},h);var P=c.video[0]&&!0===c.video[0].adaptiveSimulcast,b=h.RoomV2,L=h.Transport,R=h.iceServers,w=h.log,g=new(0,h.PeerConnectionManager)(u,c,h),_=n(f.tracks,function(j){return[j.trackTransceiver]});g.setTrackSenders(_);var I,A=new Error("Canceled"),M=new d(function(j,H,U){var ee=h.bandwidthProfile,D=h.eventObserver,F=h.name,ye=Object.assign({adaptiveSimulcast:P,automaticSubscription:h.automaticSubscription,dominantSpeaker:h.dominantSpeaker,environment:h.environment,eventObserver:D,loggerName:h.loggerName,logLevel:h.logLevel,networkMonitor:h.networkMonitor,networkQuality:h.networkQuality,iceServers:R,onIced:function(ve){return U()?(H(A),Promise.reject(A)):(w.debug("Got ICE servers:",ve),h.iceServers=ve,g.setConfiguration(h),g.createAndOffer().then(function(){if(U())throw H(A),A;w.debug("createAndOffer() succeeded."),g.dequeue("description")}).catch(function(pe){throw w.error("createAndOffer() failed:",pe),H(pe),pe}))},realm:h.realm,renderHints:!!ee&&("disabled"!==h.clientTrackSwitchOffControl||"disabled"!==h.contentPreferencesMode),sdpSemantics:h.sdpSemantics,trackPriority:!!ee,trackSwitchOff:!!ee},ee?{bandwidthProfile:ee}:{});I=new L(F,y,f,g,m,ye);var he=l(h);D.emit("event",he),I.once("connected",function(ve){w.debug("Transport connected:",ve),U()?H(A):ve.participant?(f.setSignalingRegion(ve.options.signaling_region),j(new b(f,ve,I,g,h))):H(new e)}),I.once("stateChanged",function(ve,pe){"disconnected"===ve?(I=null,H(pe||new t)):w.debug("Transport state changed:",ve)})},function(){I&&(I.disconnect(),I=null)});return M.catch(function(){I&&(I.disconnect(),I=null),g.close()}),M}},2222:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"active_speaker",e)||this;return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",function(n){n.on("message",function(l){switch(l.type){case"active_speaker":r._setLoudestParticipantSid(l.participant)}})}),r}return d(i,s),Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(t){this.loudestParticipantSid!==t&&(this._loudestParticipantSid=t,this.emit("updated"))},i}(a(762));k.exports=o},5175:(k,S,a)=>{"use strict";var d=a(7060),p=function(){function o(){Object.defineProperties(this,{_filter:{value:new d({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,t){return i.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return o.prototype.setUfrag=function(s){this._ufrag=s;var i=this._filter.toMap().get(s);return i?i.candidates:[]},o.prototype.update=function(s){s.candidates=s.candidates||[];var i=this._filter.toMap().get(s.ufrag),t=i?i.candidates:[];return this._filter.update(s)&&this._ufrag===s.ufrag?s.candidates.slice(t.length):[]},o}();k.exports=p},6802:(k,S,a)=>{"use strict";var d=a(9917),p=d.ICE_ACTIVITY_CHECK_PERIOD_MS,o=d.ICE_INACTIVITY_THRESHOLD_MS,s=function(){function i(t,e){e=Object.assign({activityCheckPeriodMs:p,inactivityThresholdMs:o},e),Object.defineProperties(this,{_activityCheckPeriodMs:{value:e.activityCheckPeriodMs},_inactivityThresholdMs:{value:e.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:t},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(t){return Array.from(t.values()).find(function(n){return"candidate-pair"===n.type&&n.nominated})||{bytesReceived:0,timestamp:Math.round((new Date).getTime())}},i.prototype._getIceConnectionStats=function(){var t=this;return this._peerConnection.getStats().then(function(e){return t._getActivePairStat(e)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(t){var e=this;t&&null===this._onIceConnectionStateChanged?(this._onIceConnectionStateChanged=function(){"disconnected"===e._peerConnection.iceConnectionState&&t()},this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged)):!t&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged),this._onIceConnectionStateChanged=null)},i.prototype.start=function(t){var e=this;this.stop(),this._timer=setInterval(function(){e._getIceConnectionStats().then(function(r){!r||((!e._lastActivity||e._lastActivity.bytesReceived!==r.bytesReceived)&&(e._lastActivity=r,e._scheduleInactivityCallback(null)),r.timestamp-e._lastActivity.timestamp>=e._inactivityThresholdMs&&("disconnected"===e._peerConnection.iceConnectionState?t():null===e._onIceConnectionStateChanged&&e._scheduleInactivityCallback(t)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),null!==this._timer&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i}();k.exports=s},9003:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(4384),o=a(7701),i=function(t){function e(r,n){var l;return n=Object.assign({createCancelableRoomSignalingPromise:p},n),l=t.call(this)||this,Object.defineProperties(l,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:r}}),l}return d(e,t),e.prototype._connect=function(r,n,l,v,y){return y=Object.assign({},this._options,y),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,r,l,v,y)},e.prototype.createLocalParticipantSignaling=function(r,n){return new o(r,n)},e}(a(3185));k.exports=i},7701:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(518),o=a(3679),s=a(9917).DEFAULT_LOG_LEVEL,i=a(7394),t=a(3761),e=t.buildLogLevels,r=t.isDeepEqual,n=function(l){function v(y,m,f){var u;f=Object.assign({logLevel:s,LocalTrackPublicationV2:o},f),u=l.call(this)||this;var c=e(f.logLevel);return Object.defineProperties(u,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:y},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:f.LocalTrackPublicationV2},_log:{value:f.log?f.log.createLog("default",u):new i("default",u,c,f.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:m},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),u}return d(v,l),v.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},v.prototype.setSignalingRegion=function(y){this._signalingRegion||(this._signalingRegion=y)},v.prototype.setBandwidthProfile=function(y){r(this._bandwidthProfile,y)||(this._bandwidthProfile=JSON.parse(JSON.stringify(y)),this._bandwidthProfileRevision++,this.didUpdate())},v.prototype.getParameters=function(){return this._encodingParameters},v.prototype.setParameters=function(y){return this._encodingParameters.update(y),this},v.prototype.update=function(y){return this._publishedRevision>=y.revision||(this._publishedRevision=y.revision,y.tracks.forEach(function(m){var f=this.tracks.get(m.id);f&&f.update(m)},this)),this},v.prototype._createLocalTrackPublicationSignaling=function(y,m,f){return new this._LocalTrackPublicationV2(y,m,f)},v.prototype.addTrack=function(y,m,f){var u=this;l.prototype.addTrack.call(this,y,m,f);var c=this.getPublication(y),h=c.isEnabled,P=c.updatedPriority,C=function(){(h!==c.isEnabled||P!==c.updatedPriority)&&(u.didUpdate(),h=c.isEnabled,P=c.updatedPriority)};return c.on("updated",C),this._removeListener(c),this._removeListeners.set(c,function(){return c.removeListener("updated",C)}),this.didUpdate(),this},v.prototype._removeListener=function(y){var m=this._removeListeners.get(y);m&&m()},v.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(y){return y.getState()})}},v.prototype.didUpdate=function(){this._revision++,this.emit("updated")},v.prototype.removeTrack=function(y){var m=l.prototype.removeTrack.call(this,y);return m&&(y.removeClone(m.trackTransceiver),this._removeListener(m),this.didUpdate()),m},v.prototype.setNetworkQualityConfiguration=function(y){this.networkQualityConfiguration.update(y)},v.prototype.setPublisherHint=function(y,m){var f=Array.from(this.tracks.values()).find(function(u){return u.sid===y});return f?f.trackTransceiver.setPublisherHint(m):(this._log.warn("track:"+y+" not found"),Promise.resolve("UNKNOWN_TRACK"))},v}(p);k.exports=n},3679:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(7667),o=a(7061).createTwilioError,s=function(i){function t(e,r,n){return i.call(this,e,r,n)||this}return d(t,i),t.prototype.getState=function(){return{enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority}},t.prototype.update=function(e){switch(e.state){case"ready":this.setSid(e.sid);break;case"failed":var r=e.error;this.publishFailed(o(r.code,r.message))}return this},t}(p);k.exports=s},762:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(3105),o=0,s=function(i){function t(e,r,n){var l=i.call(this)||this;return Object.defineProperties(l,{_instanceId:{value:o++},channel:{value:r},_log:{value:n.log.createLog("default",l)},_getReceiver:{value:e},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),l}return d(t,i),Object.defineProperty(t.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},t.prototype.setup=function(e){var r=this;this._teardown(),this._log.info("setting up msp transport for id:",e);var n=this._getReceiver(e).then(function(l){if("data"!==l.kind&&r._log.error("Expected a DataTrackReceiver"),r._receiverPromise===n){try{r._transport=l.toDataTransport(),r.emit("ready",r._transport)}catch(v){r._log.error("Failed to toDataTransport: "+v.message)}l.once("close",function(){return r._teardown()})}});this._receiverPromise=n},t.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},t}(p);k.exports=s},8804:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y},o=a(3105),s=a(127),i=function(e){function r(n,l){var v=e.call(this)||this;return Object.defineProperties(v,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:l}}),l.on("updated",function(){return v.emit("updated")}),v}return d(r,e),Object.defineProperty(r.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),r.prototype.start=function(){var n=this;this.stop();var l=setTimeout(function(){n._timeout===l&&function(e){var v=(e._manager._peerConnections?Array.from(e._manager._peerConnections.values()):[]).map(function(y){return y._peerConnection}).filter(function(y){return"closed"!==y.signalingState}).map(function(y){if(e._factories.has(y))return e._factories.get(y);var m=new s(y);return e._factories.set(y,m),m}).map(function(y){return y.next().catch(function(){return null})});return Promise.all(v).then(function(y){return y.filter(function(m){return m}).map(function(m){return m.summarize()})})}(n).then(function(v){if(n._timeout===l){if(v.length){var y=p(v,1);n._signaling.put(y[0])}n.start()}})},200);this._timeout=l},r.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},r}(o);k.exports=i},1159:function(k,S,a){"use strict";var r,d=this&&this.__extends||(r=function(n,l){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(n,l)},function(n,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function v(){this.constructor=n}r(n,l),n.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}),p=a(762),o=a(8264),s=a(1190),t=function(r){function n(l,v,y){var m=r.call(this,l,"network_quality",y)||this;return Object.defineProperties(m,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new o},_resendTimer:{value:new s(function(){m._resendTimer.setDelay(1.5*m._resendTimer.delay),m._sendNetworkQualityInputs()},5e3,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:v.local,remoteReportLevel:v.remote}}}}),m.on("ready",function(f){f.on("message",function(u){switch(m._log.debug("Incoming: ",u),u.type){case"network_quality":m._handleNetworkQualityMessage(u)}})}),m._sendNetworkQualityInputs(),m}return d(n,r),Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(l){var v=this,y=!1,m=null,f=l?l.local:null;"number"==typeof f?(m=f,this._levels=null):"object"==typeof f&&f&&(this._levels=f,m="number"==typeof f.level?f.level:Math.min(f.audio.send,f.audio.recv,f.video.send,f.video.recv)),null!==m&&this.level!==m&&(this._level=m,y=!0),this._remoteLevels=l&&l.remotes?l.remotes.reduce(function(u,c){return(v._remoteLevels.get(c.sid)||{}).level!==c.level&&(y=!0),u.set(c.sid,c)},new Map):this._remoteLevels,y&&this.emit("updated"),this._resendTimer.setDelay(5e3),this._resendTimer.isSet&&setTimeout(function(){return v._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var l=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(v){l._transport&&l._transport.publish(function(r,n){return Object.assign({type:"network_quality"},r,n)}(v,l._networkQualityReportLevels))}).finally(function(){l._resendTimer.start()})},n.prototype.put=function(l){this._networkQualityInputs.put(l)},n}(p);k.exports=t},4556:function(k,S,a){"use strict";var fe,d=this&&this.__extends||(fe=function(se,G){return(fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,ne){K.__proto__=ne}||function(K,ne){for(var ie in ne)Object.prototype.hasOwnProperty.call(ne,ie)&&(K[ie]=ne[ie])})(se,G)},function(se,G){if("function"!=typeof G&&null!==G)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function K(){this.constructor=se}fe(se,G),se.prototype=null===G?Object.create(G):(K.prototype=G.prototype,new K)}),p=this&&this.__read||function(fe,se){var G="function"==typeof Symbol&&fe[Symbol.iterator];if(!G)return fe;var ne,ce,K=G.call(fe),ie=[];try{for(;(void 0===se||se-- >0)&&!(ne=K.next()).done;)ie.push(ne.value)}catch(Te){ce={error:Te}}finally{try{ne&&!ne.done&&(G=K.return)&&G.call(K)}finally{if(ce)throw ce.error}}return ie},o=this&&this.__spreadArray||function(fe,se){for(var G=0,K=se.length,ne=fe.length;G<K;G++,ne++)fe[ne]=se[G];return fe},s=a(4035),i=a(4135),t=i.RTCIceCandidate,e=i.RTCPeerConnection,r=i.RTCSessionDescription,n=i.getStats,l=a(4911),v=a(9917),y=v.DEFAULT_ICE_GATHERING_TIMEOUT_MS,m=v.DEFAULT_LOG_LEVEL,f=v.DEFAULT_SESSION_TIMEOUT_SEC,u=v.iceRestartBackoffConfig,c=a(3028),h=c.addOrRewriteNewTrackIds,P=c.addOrRewriteTrackIds,C=c.createCodecMapForMediaSection,b=c.disableRtx,L=c.enableDtxForOpus,R=c.filterLocalCodecs,w=c.getMediaSections,g=c.removeSSRCAttributes,_=c.revertSimulcast,A=c.setCodecPreferences,I=c.setSimulcast,M=a(1190),j=a(7061),H=j.MediaClientLocalDescFailedError,U=j.MediaClientRemoteDescFailedError,N=a(3761),J=N.buildLogLevels,ee=N.getPlatform,Z=N.isChromeScreenShareTrack,V=N.oncePerTick,D=N.defer,O=a(5175),T=a(6802),F=a(1144),Q=a(6804),q=a(1856),$=a(7394),X=a(5612),ae=a(556),ue=l.guessBrowser(),de=ee(),ye=/android/.test(de),he="chrome"===ue,ve="firefox"===ue,pe="safari"===ue,we=0,Se={open:["closed","updating"],updating:["closed","open"],closed:[]},ke=function(fe){function se(G,K,ne,ie){var ce=fe.call(this,"open",Se)||this,Te=W(ie=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:Z,iceServers:[],logLevel:m,offerOptions:{},revertSimulcast:_,sessionTimeout:1e3*f,setCodecPreferences:A,setSimulcast:I,Backoff:s,IceConnectionMonitor:T,RTCIceCandidate:t,RTCPeerConnection:e,RTCSessionDescription:r,Timeout:M},ie)),Ce=J(ie.logLevel),Ae=ie.RTCPeerConnection;!0===ie.enableDscp&&(ie.chromeSpecificConstraints=ie.chromeSpecificConstraints||{},ie.chromeSpecificConstraints.optional=ie.chromeSpecificConstraints.optional||[],ie.chromeSpecificConstraints.optional.push({googDscp:!0}));var xe=ie.log?ie.log.createLog("webrtc",ce):new $("webrtc",ce,Ce,ie.loggerName),Pe=new Ae(Te,ie.chromeSpecificConstraints);ie.dummyAudioMediaStreamTrack&&Pe.addTrack(ie.dummyAudioMediaStreamTrack),Object.defineProperties(ce,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:ie.enableDscp},_encodingParameters:{value:K},_isChromeScreenShareTrack:{value:ie.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new ie.Timeout(function(){return ce._handleIceGatheringTimeout()},y,!1)},_iceRestartBackoff:{value:ie.Backoff.exponential(u)},_instanceId:{value:++we},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:xe},_eventObserver:{value:ie.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new ie.IceConnectionMonitor(Pe)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:ie.offerOptions},_onEncodingParametersChanged:{value:V(function(){ce._needsAnswer||Ee(ce)})},_peerConnection:{value:Pe},_preferredAudioCodecs:{value:ne.audio},_preferredVideoCodecs:{value:ne.video},_shouldApplyDtx:{value:ne.audio.every(function(me){return"opus"!==me.codec})||ne.audio.some(function(me){return"opus"===me.codec&&me.dtx})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new ie.Timeout(function(){xe.debug("ICE reconnect timed out"),ce.close()},ie.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new O},_setCodecPreferences:{value:ve&&ye&&ne.video[0]&&"h264"!==ne.video[0].codec.toLowerCase()?function(me){return me}:ie.setCodecPreferences},_setSimulcast:{value:ie.setSimulcast},_revertSimulcast:{value:ie.revertSimulcast},_RTCIceCandidate:{value:ie.RTCIceCandidate},_RTCPeerConnection:{value:ie.RTCPeerConnection},_RTCSessionDescription:{value:ie.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:G}}),K.on("changed",ce._onEncodingParametersChanged),Pe.addEventListener("connectionstatechange",ce._handleConnectionStateChange.bind(ce)),Pe.addEventListener("datachannel",ce._handleDataChannelEvent.bind(ce)),Pe.addEventListener("icecandidate",ce._handleIceCandidateEvent.bind(ce)),Pe.addEventListener("iceconnectionstatechange",ce._handleIceConnectionStateChange.bind(ce)),Pe.addEventListener("icegatheringstatechange",ce._handleIceGatheringStateChange.bind(ce)),Pe.addEventListener("signalingstatechange",ce._handleSignalingStateChange.bind(ce)),Pe.addEventListener("track",ce._handleTrackEvent.bind(ce)),ce._iceRestartBackoff.on("ready",function(){return ce._initiateIceRestart()});var Re=ce;return ce.on("stateChanged",function me(Le){"closed"===Le&&(Re.removeListener("stateChanged",me),Re._dataChannels.forEach(function(je,Me){Re.removeDataTrackSender(Me)}))}),ce}return d(se,fe),se.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},se.prototype.setEffectiveAdaptiveSimulcast=function(G){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",G),this._preferredVideoCodecs.forEach(function(K){"adaptiveSimulcast"in K&&(K.adaptiveSimulcast=G)})},Object.defineProperty(se.prototype,"_shouldApplySimulcast",{get:function(){return!(!he&&!pe)&&this._preferredVideoCodecs.some(function(K){return"vp8"===K.codec.toLowerCase()&&K.simulcast&&!1!==K.adaptiveSimulcast})},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"connectionState",{get:function(){return"failed"===this.iceConnectionState?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&"disconnected"===this._peerConnection.iceConnectionState||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"isApplicationSectionNegotiated",{get:function(){return"closed"===this._peerConnection.signalingState||!!this._peerConnection.localDescription&&w(this._peerConnection.localDescription.sdp,"application").length>0},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var G=this._preferredVideoCodecs.find(function(K){return"adaptiveSimulcast"in K});return G&&!0===G.adaptiveSimulcast},enumerable:!1,configurable:!0}),se.prototype._maybeUpdateEncodings=function(G,K,ne){if(void 0===ne&&(ne=!1),"video"!==G.kind)return!1;var ie=l.guessBrowser();return!!("safari"===ie||"chrome"===ie&&this._isAdaptiveSimulcastEnabled)&&(this._updateEncodings(G,K,ne),!0)},se.prototype._updateEncodings=function(G,K,ne){if(this._isChromeScreenShareTrack(G)){var ie=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];K.forEach(function(me,Le){var je=ie[Le];je?(me.scaleResolutionDownBy=je.scaleResolutionDownBy,ne&&delete me.active):(me.active=!1,delete me.scaleResolutionDownBy)})}else{var ce=G.getSettings(),xe=ce.width*ce.height,Pe=[{pixels:518400,maxActiveLayers:3},{pixels:129600,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}].find(function(me){return xe>=me.pixels}),Re=Math.min(K.length,Pe.maxActiveLayers);K.forEach(function(me,Le){Le<Re?(me.scaleResolutionDownBy=1<<Re-Le-1,ne&&(me.active=!0)):(me.active=!1,delete me.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",K.map(function(me,Le){return"["+Le+": "+me.active+", "+(me.scaleResolutionDownBy||0)+"]"}).join(", "))},se.prototype._addIceCandidate=function(G){var K=this;return Promise.resolve().then(function(){return G=new K._RTCIceCandidate(G),K._peerConnection.addIceCandidate(G)}).catch(function(ne){K._log.warn("Failed to add RTCIceCandidate "+(G?'"'+G.candidate+'"':"null")+": "+ne.message)})},se.prototype._addIceCandidates=function(G){return Promise.all(G.map(this._addIceCandidate,this)).then(function(){})},se.prototype._addOrUpdateTransceiver=function(G){var K=this,ne=function(fe,se){var G={audio:fe._preferredAudioCodecs.map(function(ce){return ce.codec.toLowerCase()}),video:fe._preferredVideoCodecs.map(function(ce){return ce.codec.toLowerCase()})}[se],K=fe._recycledTransceivers[se],ne=G.find(function(ce){return fe._localCodecs.has(ce)});if(!ne)return K.shift();var ie=K.find(function(ce){var Te=fe._remoteCodecMaps.get(ce.mid);return Te&&Te.has(ne)});return ie&&K.splice(K.indexOf(ie),1),ie}(this,G.kind);if(ne&&ne.sender){var ie=ne.sender.track?ne.sender.track.id:null;return ie&&this._log.warn("Reusing transceiver: "+ne.mid+"] "+ie+" => "+G.id),this._replaceTrackPromises.set(ne,ne.sender.replaceTrack(G).then(function(){ne.direction="sendrecv"},function(){}).finally(function(){K._replaceTrackPromises.delete(ne)})),ne}return this._peerConnection.addTransceiver(G)},se.prototype._checkIceBox=function(G){var K=re(G);if(!K)return Promise.resolve();var ne=this._remoteCandidates.setUfrag(K);return this._addIceCandidates(ne)},se.prototype._answer=function(G){var K=this;return Promise.resolve().then(function(){return K._negotiationRole||(K._negotiationRole="answerer"),K._setRemoteDescription(G)}).catch(function(){throw new U}).then(function(){return K._peerConnection.createAnswer()}).then(function(ne){ne=ve?new K._RTCSessionDescription({sdp:b(ne.sdp),type:ne.type}):ae(ne);var ie=g(ne.sdp,["mslabel","label"]);if(K._shouldApplySimulcast){var ce=ie;ie=K._setSimulcast(ce,K._trackIdsToAttributes),ie=K._revertSimulcast(ie,ce,G.sdp)}return ie=ie.replace(/42e015/g,"42e01f"),K._setLocalDescription({type:ne.type,sdp:ie})}).then(function(){return K._checkIceBox(G)}).then(function(){return K._queuedDescription&&K._updateDescription(K._queuedDescription)}).then(function(){return K._queuedDescription=null,K._maybeReoffer(K._peerConnection.localDescription)}).catch(function(ne){var ie=ne instanceof U?ne:new H;throw K._publishMediaWarning({message:"Failed to _answer",code:ie.code,error:ne}),ie})},se.prototype._close=function(){return this._iceConnectionMonitor.stop(),"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0)},se.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},se.prototype._handleDataChannelEvent=function(G){var K=this,ne=G.channel,ie=new F(ne);this._dataTrackReceivers.add(ie),ne.addEventListener("close",function(){K._dataTrackReceivers.delete(ie)}),this.emit("trackAdded",ie)},se.prototype._handleGlare=function(G){var K=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return K._trackIdsToAttributes=new Map(K._appliedTrackIdsToAttributes),K._setLocalDescription({type:"rollback"})}).then(function(){return K._needsAnswer=!1,K._answer(G)}).then(function(ne){return ne?Promise.resolve():K._offer()})},se.prototype._publishMediaWarning=function(G){this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:G.message,code:G.code,context:JSON.stringify({error:G.error.message,sdp:G.sdp})}})},se.prototype._handleIceCandidateEvent=function(G){G.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(G.candidate));var K={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};G.candidate||(K.ice.complete=!0),this._isIceLite&&G.candidate||(K.ice.revision=this._localCandidatesRevision++,this.emit("candidates",K))},se.prototype._handleIceConnectionStateChange=function(){var G=this,K=this._peerConnection.iceConnectionState,ne=["connected","completed"].includes(K),ie=this._log;ie.debug('ICE connection state is "'+K+'"'),ne&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),"failed"===this._lastIceConnectionState||"failed"!==K||this._shouldRestartIce||this._isRestartingIce?["disconnected","failed"].includes(this._lastIceConnectionState)&&ne&&ie.debug("ICE reconnected"):(ie.warn("ICE failed"),this._initiateIceRestartBackoff()),"connected"===K?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){G._iceConnectionMonitor.stop(),!G._shouldRestartIce&&!G._isRestartingIce&&(ie.warn("ICE Connection Monitor detected inactivity"),G._isIceConnectionInactive=!0,G._initiateIceRestartBackoff(),G.emit("iceConnectionStateChanged"),G.emit("connectionStateChanged"))})):["disconnected","completed"].includes(K)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=K,this.emit("iceConnectionStateChanged")},se.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},se.prototype._handleIceGatheringStateChange=function(){var G=this._peerConnection.iceGatheringState,K=this._log;K.debug('ICE gathering state is "'+G+'"');var ne=this._iceGatheringTimeout;"gathering"===G&&!this._didGenerateLocalCandidates&&!ne.isSet&&(K.debug("Starting ICE gathering timeout: "+ne.delay),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},se.prototype._handleSignalingStateChange=function(){"stable"===this._peerConnection.signalingState&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},se.prototype._handleTrackEvent=function(G){var K=this,ne=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new X,this._trackMatcher.update(ne);var ie=G.track,ce=this._trackMatcher.match(G)||ie.id,Te=new Q(ce,ie);this._mediaTrackReceivers.forEach(function(Ce){Ce.track.id===Te.track.id&&K._mediaTrackReceivers.delete(Ce)}),this._mediaTrackReceivers.add(Te),ie.addEventListener("ended",function(){return K._mediaTrackReceivers.delete(Te)}),this.emit("trackAdded",Te)},se.prototype._initiateIceRestart=function(){if("closed"!==this._peerConnection.signalingState){var G=this._log;G.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var K=this._iceReconnectTimeout;K.isSet||(G.debug("Starting ICE reconnect timeout: "+K.delay),this._iceReconnectTimeout.start()),this.offer().catch(function(ce){G.error("offer failed in _initiateIceRestart with: "+ce.message)})}},se.prototype._initiateIceRestartBackoff=function(){"closed"===this._peerConnection.signalingState||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff())},se.prototype._maybeReoffer=function(G){var K=this._shouldOffer;if(G&&G.sdp){var ne=this._peerConnection.getSenders().filter(function(Ae){return Ae.track});K=["audio","video"].reduce(function(Ae,xe){var Pe=w(G.sdp,xe,"(sendrecv|sendonly)"),Re=ne.filter(E.bind(null,xe));return Ae||Pe.length<Re.length},K);var ie=this._dataChannels.size>0,ce=w(G.sdp,"application").length>0;K=K||ie&&!ce}return(K?this._offer():Promise.resolve()).then(function(){return K})},se.prototype._offer=function(){var G=this,K=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,K.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return G._peerConnection.createOffer(K)}).catch(function(ne){var ie=new H;throw G._publishMediaWarning({message:"Failed to create offer",code:ie.code,error:ne}),ie}).then(function(ne){ne=ve?new G._RTCSessionDescription({sdp:b(ne.sdp),type:ne.type}):ae(ne);var ie=g(ne.sdp,["mslabel","label"]);ie=G._peerConnection.remoteDescription?R(ie,G._peerConnection.remoteDescription.sdp):ie;var ce=G._setCodecPreferences(ie,G._preferredAudioCodecs,G._preferredVideoCodecs);return G._shouldOffer=!1,G._negotiationRole||(G._negotiationRole="offerer"),G._shouldApplySimulcast&&(G._localDescriptionWithoutSimulcast={type:"offer",sdp:ce},ce=G._setSimulcast(ce,G._trackIdsToAttributes)),G._setLocalDescription({type:"offer",sdp:ce})})},se.prototype._getMediaTrackSenderId=function(G){var K=Array.from(this._rtpSenders.keys()).find(function(ne){return ne.track.id===G});return K?K.id:G},se.prototype._addOrRewriteLocalTrackIds=function(G){var K=this,ie=this._peerConnection.getTransceivers().filter(function(Re){var me=Re.sender;return!Re.stopped&&me&&me.track}),ce=ie.filter(function(Re){return Re.mid}),Te=new Map(ce.map(function(Re){return[Re.mid,K._getMediaTrackSenderId(Re.sender.track.id)]})),Ce=P(G.sdp,Te),Ae=ie.filter(function(Re){return!Re.mid}),xe=new Map(["audio","video"].map(function(Re){return[Re,Ae.filter(function(me){return me.sender.track.kind===Re}).map(function(me){return K._getMediaTrackSenderId(me.sender.track.id)})]})),Pe=h(Ce,Te,xe);return new this._RTCSessionDescription({sdp:Pe,type:G.type})},se.prototype._rollbackAndApplyOffer=function(G){var K=this;return this._setLocalDescription({type:"rollback"}).then(function(){return K._setLocalDescription(G)})},se.prototype._setLocalDescription=function(G){var K=this;return"rollback"!==G.type&&this._shouldApplyDtx&&(G=new this._RTCSessionDescription({sdp:L(G.sdp),type:G.type})),this._peerConnection.setLocalDescription(G).catch(function(ne){K._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+G.type+'" failed with the error "'+ne.message+'".',ne);var ie=new H,ce={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+G.type+'" failed',code:ie.code,error:ne};throw G.sdp&&(K._log.warn("The SDP was "+G.sdp),ce.sdp=G.sdp),K._publishMediaWarning(ce),ie}).then(function(){"rollback"!==G.type&&(K._localDescription=K._addOrRewriteLocalTrackIds(G),K._shouldApplyDtx&&(K._localDescription=new K._RTCSessionDescription({sdp:L(K._localDescription.sdp,[]),type:K._localDescription.type})),K._localCandidates=[],"offer"===G.type?K._descriptionRevision++:"answer"===G.type&&(K._lastStableDescriptionRevision=K._descriptionRevision,be(K)),K._localUfrag=re(G),K.emit("description",K.getState()))})},se.prototype._setRemoteDescription=function(G){var K=this;return G.sdp&&(G.sdp=this._setCodecPreferences(G.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),G.sdp=this._shouldApplyDtx?L(G.sdp):L(G.sdp,[]),ve&&(G.sdp=function(fe){return fe.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}(G.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(G.sdp))),G=new this._RTCSessionDescription(G),Promise.resolve().then(function(){if("answer"===G.type&&K._localDescriptionWithoutSimulcast){var ne=K._preferredVideoCodecs.find(function(Te){return"adaptiveSimulcast"in Te}),ce=K._revertSimulcast(K._localDescription.sdp,K._localDescriptionWithoutSimulcast.sdp,G.sdp,!!ne&&!1===ne.adaptiveSimulcast);if(K._localDescriptionWithoutSimulcast=null,ce!==K._localDescription.sdp)return K._rollbackAndApplyOffer({type:K._localDescription.type,sdp:ce})}}).then(function(){return K._peerConnection.setRemoteDescription(G)}).then(function(){"answer"===G.type&&(K._isRestartingIce&&(K._log.debug("An ICE restart was in-progress and is now completed"),K._isRestartingIce=!1),be(K))},function(ne){throw K._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+G.type+'" failed with the error "'+ne.message+'".',ne),G.sdp&&K._log.warn("The SDP was "+G.sdp),ne})},se.prototype._updateDescription=function(G){var K=this;switch(G.type){case"answer":case"pranswer":if(G.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=G.revision;break;case"close":return this._close();case"create-offer":return G.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=G,Promise.resolve()):(this._descriptionRevision=G.revision,this._offer());case"offer":return G.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsAnswer&&0===this._lastStableDescriptionRevision?(this._queuedDescription=G,Promise.resolve()):(this._descriptionRevision=G.revision,this._handleGlare(G)):(this._descriptionRevision=G.revision,this._answer(G).then(function(){}))}var ne=G.revision;return Promise.resolve().then(function(){return K._setRemoteDescription(G)}).catch(function(ie){var ce=new U;throw K._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+G.type+'" failed',code:ce.code,error:ie,sdp:G.sdp}),ce}).then(function(){return K._lastStableDescriptionRevision=ne,K._needsAnswer=!1,K._checkIceBox(G)}).then(function(){return K._queuedDescription&&K._updateDescription(K._queuedDescription)}).then(function(){return K._queuedDescription=null,K._maybeReoffer(K._peerConnection.localDescription).then(function(){})})},se.prototype._updateIce=function(G){var K=this._remoteCandidates.update(G);return this._addIceCandidates(K)},se.prototype.addDataTrackSender=function(G){if(!this._dataChannels.has(G))try{var K={ordered:G.ordered};null!==G.maxPacketLifeTime&&(K.maxPacketLifeTime=G.maxPacketLifeTime),null!==G.maxRetransmits&&(K.maxRetransmits=G.maxRetransmits);var ne=this._peerConnection.createDataChannel(G.id,K);G.addDataChannel(ne),this._dataChannels.set(G,ne)}catch(ie){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+G.id+'": '+ie.message)}},se.prototype._handleQueuedPublisherHints=function(){var G=this;"stable"===this._peerConnection.signalingState&&this._mediaTrackSenderToPublisherHints.forEach(function(K,ne){var ie=K.deferred,ce=K.encodings;G._mediaTrackSenderToPublisherHints.delete(ne),G._setPublisherHint(ne,ce).then(function(Te){return ie.resolve(Te)}).catch(function(Te){return ie.reject(Te)})})},se.prototype._setPublisherHint=function(G,K){var ne=this;if(ve)return Promise.resolve("COULD_NOT_APPLY_HINT");this._mediaTrackSenderToPublisherHints.has(G)&&(this._mediaTrackSenderToPublisherHints.get(G).deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(G));var ce=this._rtpSenders.get(G);if(!ce)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if("closed"===this._peerConnection.signalingState)return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if("stable"!==this._peerConnection.signalingState){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var Te=D();return this._mediaTrackSenderToPublisherHints.set(G,{deferred:Te,encodings:K}),Te.promise}var Ce=ce.getParameters();return null!==K&&K.forEach(function(Ae){var xe=Ae.enabled,Pe=Ae.layer_index;Ce.encodings.length>Pe?(ne._log.debug("layer:"+Pe+", active:"+Ce.encodings[Pe].active+" => "+xe),Ce.encodings[Pe].active=xe):ne._log.warn("invalid layer:"+Pe+", active:"+xe)}),this._maybeUpdateEncodings(ce.track,Ce.encodings,null===K),ce.setParameters(Ce).then(function(){return"OK"}).catch(function(Ae){return ne._log.error("Failed to apply publisher hints:",Ae),"COULD_NOT_APPLY_HINT"})},se.prototype.addMediaTrackSender=function(G){var K=this;if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(G)){var ie=this._addOrUpdateTransceiver(G.track).sender;G.addSender(ie,function(ce){return K._setPublisherHint(G,ce)}),this._rtpNewSenders.add(ie),this._rtpSenders.set(G,ie)}},se.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},se.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},se.prototype.getState=function(){if(!this._localDescription)return null;var K={type:this._localDescription.type,revision:"answer"===this._localDescription.type?this._lastStableDescriptionRevision:this._descriptionRevision};return this._localDescription.sdp&&(K.sdp=this._localDescription.sdp),{description:K,id:this.id}},se.prototype.offer=function(){var G=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(K){return G.transition("updating",K),(G._needsAnswer||G._isRestartingIce?Promise.resolve():G._offer()).then(function(){G.tryTransition("open",K)},function(ie){throw G.tryTransition("open",K),ie})})},se.prototype.removeDataTrackSender=function(G){var K=this._dataChannels.get(G);K&&(G.removeDataChannel(K),this._dataChannels.delete(G),K.close())},se.prototype.removeMediaTrackSender=function(G){var K=this._rtpSenders.get(G);K&&("closed"!==this._peerConnection.signalingState&&this._peerConnection.removeTrack(K),G.removeSender(K),this._mediaTrackSenderToPublisherHints.has(G)&&(this._mediaTrackSenderToPublisherHints.get(G).deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(G)),this._rtpNewSenders.delete(K),this._rtpSenders.delete(G))},se.prototype.setConfiguration=function(G){"function"==typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(W(G))},se.prototype.setIceReconnectTimeout=function(G){return this._iceReconnectTimeout.setDelay(G),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},se.prototype.update=function(G){var K=this;return this.bracket("updating",function(ne){if("closed"===K.state)return Promise.resolve();K.transition("updating",ne);var ie=[];return G.ice&&ie.push(K._updateIce(G.ice)),G.description&&ie.push(K._updateDescription(G.description)),Promise.all(ie).then(function(){K.tryTransition("open",ne)},function(ce){throw K.tryTransition("open",ne),ce})})},se.prototype.getStats=function(){var G=this;return n(this._peerConnection).then(function(K){return function(fe,se){return Object.assign(se,{remoteAudioTrackStats:se.remoteAudioTrackStats.map(function(G){return Y(fe,G)}),remoteVideoTrackStats:se.remoteVideoTrackStats.map(function(G){return Y(fe,G)}),localAudioTrackStats:se.localAudioTrackStats.map(function(G){return oe(fe,G)}),localVideoTrackStats:se.localVideoTrackStats.map(function(G){return oe(fe,G)})})}(G,K)})},se}(q);function oe(fe,se){var G=fe._getMediaTrackSenderId(se.trackId);return Object.assign(se,{trackId:G})}function Y(fe,se){var G=o([],p(fe._mediaTrackReceivers)).find(function(ne){return ne.track.id===se.trackId});return Object.assign(se,{trackId:G?G.id:null})}function re(fe){if(fe.sdp){var se=fe.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(se)return se[1]}return null}function W(fe){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},fe)}function E(fe,se){var G=se.track;return G&&G.kind===fe&&"ended"!==G.readyState}function be(fe){(function(fe){fe._recycledTransceivers.audio=[],fe._recycledTransceivers.video=[],fe._peerConnection.getTransceivers().forEach(function(se){(function(fe,se){return!fe.stopped&&!se._replaceTrackPromises.has(fe)&&["inactive","recvonly"].includes(fe.direction)})(se,fe)&&fe._recycledTransceivers[se.receiver.track.kind].push(se)})})(fe),function(fe){var se=fe._peerConnection.localDescription;!se||!se.sdp||w(se.sdp).forEach(function(G){C(G).forEach(function(ne,ie){return fe._localCodecs.add(ie)})})}(fe),function(fe){var se=fe._peerConnection.remoteDescription;!se||!se.sdp||w(se.sdp).forEach(function(G){var K=G.match(/^a=mid:(.+)$/m);if(K&&K[1]){var ne=K[1],ie=C(G);fe._remoteCodecMaps.set(ne,ie)}})}(fe),Ee(fe).then(function(){fe._handleQueuedPublisherHints()})}function Ee(fe){var se=fe._encodingParameters,ne=new Map([["audio",se.maxAudioBitrate],["video",se.maxVideoBitrate]]),ie=[];return fe._peerConnection.getSenders().filter(function(ce){return ce.track}).forEach(function(ce){var Te=ne.get(ce.track.kind),Ce=ce.getParameters();null===Te||0===Te?function(fe){Array.isArray(fe.encodings)&&fe.encodings.forEach(function(se){return delete se.maxBitrate})}(Ce):fe._isChromeScreenShareTrack(ce.track)?fe._log.warn("Not setting maxBitrate for "+ce.track.kind+" Track "+ce.track.id+" because it appears to be screen share track: "+ce.track.label):function(fe,se){ve?fe.encodings=[{maxBitrate:se}]:fe.encodings.forEach(function(G){G.maxBitrate=se})}(Ce,Te),!ve&&fe._enableDscp&&Ce.encodings.length>0&&(Ce.encodings[0].networkPriority="high");var Ae=fe._rtpNewSenders.has(ce);fe._maybeUpdateEncodings(ce.track,Ce.encodings,Ae),fe._rtpNewSenders.delete(ce);var xe=ce.setParameters(Ce).catch(function(Pe){fe._log.warn("Error while setting encodings parameters for "+ce.track.kind+" Track "+ce.track.id+": "+(Pe.message||Pe.name))});ie.push(xe)}),Promise.all(ie)}k.exports=ke},5971:function(k,S,a){"use strict";var w,d=this&&this.__extends||(w=function(g,_){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,I){A.__proto__=I}||function(A,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(A[M]=I[M])})(g,_)},function(g,_){if("function"!=typeof _&&null!==_)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function A(){this.constructor=g}w(g,_),g.prototype=null===_?Object.create(_):(A.prototype=_.prototype,new A)}),p=this&&this.__read||function(w,g){var _="function"==typeof Symbol&&w[Symbol.iterator];if(!_)return w;var I,j,A=_.call(w),M=[];try{for(;(void 0===g||g-- >0)&&!(I=A.next()).done;)M.push(I.value)}catch(H){j={error:H}}finally{try{I&&!I.done&&(_=A.return)&&_.call(A)}finally{if(j)throw j.error}}return M},o=this&&this.__spreadArray||function(w,g){for(var _=0,A=g.length,I=w.length;_<A;_++,I++)w[I]=g[_];return w},s=a(4911).guessBrowser,i=a(4556),t=a(5550),e=a(5468),r=a(3761),n=a(7061).MediaConnectionError,l="firefox"===s(),v=function(w){function g(_,A,I){var M=w.call(this)||this,j=(I=Object.assign({audioContextFactory:l?a(9057):null,PeerConnectionV2:i},I)).audioContextFactory?I.audioContextFactory.getOrCreate(M):null,H=j?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(M,{_audioContextFactory:{value:I.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:r.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:j?new t(y(j)):null},_encodingParameters:{value:_},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:H},_peerConnections:{value:new Map},_preferredCodecs:{value:A},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:I.PeerConnectionV2}}),M}return d(g,w),g.prototype.setEffectiveAdaptiveSimulcast=function(_){this._peerConnections.forEach(function(A){return A.setEffectiveAdaptiveSimulcast(_)}),this._preferredCodecs.video.forEach(function(A){"adaptiveSimulcast"in A&&(A.adaptiveSimulcast=_)})},Object.defineProperty(g.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),g.prototype._closeAbsentPeerConnections=function(_){var A=new Set(_.map(function(I){return I.id}));return this._peerConnections.forEach(function(I){A.has(I.id)||I._close()}),this},g.prototype._getConfiguration=function(){return this._configurationDeferred.promise},g.prototype._getOrCreate=function(_,A){var I=this,M=this,j=this._peerConnections.get(_);if(!j){var H=this._PeerConnectionV2,U=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},A);try{j=new H(_,this._encodingParameters,this._preferredCodecs,U)}catch(N){throw new n}this._peerConnections.set(j.id,j),j.on("candidates",this.queue.bind(this,"candidates")),j.on("description",this.queue.bind(this,"description")),j.on("trackAdded",this.queue.bind(this,"trackAdded")),j.on("stateChanged",function N(J){"closed"===J&&(j.removeListener("stateChanged",N),M._dataTrackSenders.forEach(function(ee){return j.removeDataTrackSender(ee)}),M._mediaTrackSenders.forEach(function(ee){return j.removeMediaTrackSender(ee)}),M._peerConnections.delete(j.id),M._closedPeerConnectionIds.add(j.id),R(M),L(M))}),j.on("connectionStateChanged",function(){return R(I)}),j.on("iceConnectionStateChanged",function(){return L(I)}),this._dataTrackSenders.forEach(j.addDataTrackSender,j),this._mediaTrackSenders.forEach(j.addMediaTrackSender,j),L(this)}return j},g.prototype.close=function(){return this._peerConnections.forEach(function(_){_.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),L(this),this},g.prototype.createAndOffer=function(){var _=this;return this._getConfiguration().then(function(A){var I;do{I=r.makeUUID()}while(_._peerConnections.has(I));return _._getOrCreate(I,A)}).then(function(A){return A.offer()}).then(function(){return _})},g.prototype.getTrackReceivers=function(){return r.flatMap(this._peerConnections,function(_){return _.getTrackReceivers()})},g.prototype.getStates=function(){var _=[];return this._peerConnections.forEach(function(A){var I=A.getState();I&&_.push(I)}),_},g.prototype.setConfiguration=function(_){return this._configuration&&(this._configurationDeferred=r.defer(),this._peerConnections.forEach(function(A){A.setConfiguration(_)})),this._configuration=_,this._configurationDeferred.resolve(_),this},g.prototype.setIceReconnectTimeout=function(_){return null===this._sessionTimeout&&(this._peerConnections.forEach(function(A){A.setIceReconnectTimeout(_)}),this._sessionTimeout=_),this},g.prototype.setTrackSenders=function(_){var A=new Set(_.filter(function(j){return"data"===j.kind})),I=new Set(_.filter(function(j){return j&&("audio"===j.kind||"video"===j.kind)})),M=function(w,g,_){return{data:f(w,g),media:c(w,_)}}(this,A,I);return this._dataTrackSenders=A,this._mediaTrackSenders=I,function(w,g){(g.data.add.size||g.data.remove.size||g.media.add.size||g.media.remove.size)&&w._peerConnections.forEach(function(_){g.data.remove.forEach(_.removeDataTrackSender,_),g.media.remove.forEach(_.removeMediaTrackSender,_),g.data.add.forEach(_.addDataTrackSender,_),g.media.add.forEach(_.addMediaTrackSender,_),(g.media.add.size||g.media.remove.size||g.data.add.size&&!_.isApplicationSectionNegotiated)&&_.offer()})}(this,M),this},g.prototype.update=function(_,A){var I=this;return void 0===A&&(A=!1),A&&this._closeAbsentPeerConnections(_),this._getConfiguration().then(function(M){return Promise.all(_.map(function(j){return I._closedPeerConnectionIds.has(j.id)?null:I._getOrCreate(j.id,M).update(j)}))}).then(function(){return I})},g.prototype.getStats=function(){var _=Array.from(this._peerConnections.values());return Promise.all(_.map(function(A){return A.getStats().then(function(I){return[A.id,I]})})).then(function(A){return new Map(A)})},g}(e);function y(w){return w.createMediaStreamDestination().stream.getAudioTracks()[0]}function f(w,g){return{add:r.difference(g,w._dataTrackSenders),remove:r.difference(w._dataTrackSenders,g)}}function c(w,g){return{add:r.difference(g,w._mediaTrackSenders),remove:r.difference(w._mediaTrackSenders,g)}}var P,h={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3};function b(w){return w.length?(P=P||Object.keys(h).reduce(function(w,g){var _;return Object.assign(w,((_={})[h[g]]=g,_))},{}),w.reduce(function(g,_){return P[Math.max(h[g],h[_])]})):"new"}function L(w){w._lastIceConnectionState=w.iceConnectionState,w._iceConnectionState=b(o([],p(w._peerConnections.values())).map(function(g){return g.iceConnectionState})),w.iceConnectionState!==w._lastIceConnectionState&&w.emit("iceConnectionStateChanged")}function R(w){w._lastConnectionState=w.connectionState,w._connectionState=b(o([],p(w._peerConnections.values())).map(function(g){return g.connectionState})),w.connectionState!==w._lastConnectionState&&w.emit("connectionStateChanged")}k.exports=v},4574:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(762),o=1,s=function(i){function t(e,r){var n=i.call(this,e,"publisher_hints",r)||this;return n.on("ready",function(l){n._log.debug("publisher_hints transport ready:",l),l.on("message",function(v){switch(n._log.debug("Incoming: ",v),v.type){case"publisher_hints":v.publisher&&v.publisher.hints&&v.publisher.id&&n._processPublisherHints(v.publisher.hints,v.publisher.id);break;default:n._log.warn("Unknown message type: ",v.type)}})}),n}return d(t,i),t.prototype.sendTrackReplaced=function(e){if(this._transport){var n={type:"client_reset",track:e.trackSid,id:o++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},t.prototype.sendHintResponse=function(e){if(this._transport){var l={type:"publisher_hints",id:e.id,hints:e.hints};this._log.debug("Outgoing: ",l),this._transport.publish(l)}},t.prototype._processPublisherHints=function(e,r){try{this.emit("updated",e,r)}catch(n){this._log.error("error processing hints:",n)}},t}(p);k.exports=s},5117:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_revision:{value:1,writable:!0}}),t}return d(i,s),i.prototype.update=function(t){return t.revision<this._revision?this:(this._revision=t.revision,this.enable(t.is_recording))},i}(a(8659));k.exports=o},5097:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(8760),o=a(3038),s=function(i){function t(e,r,n,l,v,y){var m=i.call(this,e.sid,e.identity)||this;return y=Object.assign({RemoteTrackPublicationV2:o},y),Object.defineProperties(m,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:y.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:r},updateSubscriberTrackPriority:{value:function(f,u){return n(f,u)}},updateTrackRenderHint:{value:function(f,u){return l(f,u)}},clearTrackHint:{value:function(f){return v(f)}},revision:{enumerable:!0,get:function(){return this._revision}}}),m.update(e)}return d(t,i),t.prototype._getOrCreateTrack=function(e){var r=this._RemoteTrackPublicationV2,n=this.tracks.get(e.sid);return n||(n=new r(e,this._getInitialTrackSwitchOffState(e.sid)),this.addTrack(n)),n},t.prototype.update=function(e){var r=this;if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var n=new Set;switch(e.tracks.forEach(function(l){var v=r._getOrCreateTrack(l);v.update(l),n.add(v)}),this.tracks.forEach(function(l){n.has(l)||r.removeTrack(l)}),e.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity)}return this},t}(p);k.exports=s},3038:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t.sid,t.name,t.kind,t.enabled,t.priority,e)||this}return d(i,s),i.prototype.update=function(t){return this.enable(t.enabled),this.setPriority(t.priority),this},i}(a(2261));k.exports=o},9752:function(k,S,a){"use strict";var r,d=this&&this.__extends||(r=function(n,l){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(n,l)},function(n,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function v(){this.constructor=n}r(n,l),n.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}),p=a(762),o=a(1190),s=a(3761).isDeepEqual,t=1,e=function(r){function n(l,v){var y=r.call(this,l,"render_hints",v)||this;return Object.defineProperties(y,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new o(function(){y._sendAllHints(),y._responseTimer.setDelay(2*y._responseTimer.delay)},2e3,!1)}}),y.on("ready",function(m){m.on("message",function(f){switch(y._log.debug("Incoming: ",f),f.type){case"render_hints":y._processHintResults(f&&f.subscriber&&f.subscriber.hints||[]);break;default:y._log.warn("Unknown message type: ",f.type)}}),y._sendAllHints()}),y}return d(n,r),n.prototype._sendAllHints=function(){var l=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(v){var y=l._trackSidsToRenderHints.get(v);y.renderDimensions&&(y.isDimensionDirty=!0),"enabled"in y&&(y.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(l){var v=this;this._responseTimer.clear(),this._responseTimer.setDelay(2e3),l.forEach(function(y){"OK"!==y.result&&v._log.debug("Server error processing hint:",y)}),this._sendHints()},n.prototype._sendHints=function(){var l=this;if(this._transport&&!this._responseTimer.isSet){var v=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(m){var f=l._trackSidsToRenderHints.get(m);if(f.isEnabledDirty||f.isDimensionDirty){var u={track:m};f.isEnabledDirty&&(u.enabled=f.enabled,f.isEnabledDirty=!1),f.isDimensionDirty&&(u.render_dimensions=f.renderDimensions,f.isDimensionDirty=!1),v.push(u)}}),v.length>0){var y={type:"render_hints",subscriber:{id:t++,hints:v}};this._log.debug("Outgoing: ",y),this._transport.publish(y),this._responseTimer.start()}}},n.prototype.setTrackHint=function(l,v){var y=this._trackSidsToRenderHints.get(l)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in v&&y.enabled!==v.enabled&&(y.enabled=!!v.enabled,y.isEnabledDirty=!0),v.renderDimensions&&!s(v.renderDimensions,y.renderDimensions)&&(y.renderDimensions=v.renderDimensions,y.isDimensionDirty=!0),this._trackSidsToRenderHints.set(l,y),this._sendHints()},n.prototype.clearTrackHint=function(l){this._trackSidsToRenderHints.delete(l)},n}(p);k.exports=e},3899:function(k,S,a){"use strict";var D,d=this&&this.__extends||(D=function(O,T){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,Q){F.__proto__=Q}||function(F,Q){for(var q in Q)Object.prototype.hasOwnProperty.call(Q,q)&&(F[q]=Q[q])})(O,T)},function(O,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function F(){this.constructor=O}D(O,T),O.prototype=null===T?Object.create(T):(F.prototype=T.prototype,new F)}),p=this&&this.__read||function(D,O){var T="function"==typeof Symbol&&D[Symbol.iterator];if(!T)return D;var Q,$,F=T.call(D),q=[];try{for(;(void 0===O||O-- >0)&&!(Q=F.next()).done;)q.push(Q.value)}catch(X){$={error:X}}finally{try{Q&&!Q.done&&(T=F.return)&&T.call(F)}finally{if($)throw $.error}}return q},o=a(2222),s=a(8804),i=a(1159),t=a(5117),e=a(6996),r=a(5097),n=a(6614),l=a(7960),v=a(5084),y=a(9752),m=a(4574),f=a(3761),u=f.constants.DEFAULT_SESSION_TIMEOUT_SEC,c=f.createBandwidthProfilePayload,h=f.defer,P=f.difference,C=f.filterObject,b=f.flatMap,L=f.oncePerTick,R=a(2100),w=a(7061).createTwilioError,_=function(D){function O(T,F,Q,q,$){var X=this;F.options=Object.assign({session_timeout:u},F.options),$=Object.assign({DominantSpeakerSignaling:o,NetworkQualityMonitor:s,NetworkQualitySignaling:i,RecordingSignaling:t,RemoteParticipantV2:r,TrackPrioritySignaling:l,TrackSwitchOffSignaling:v,bandwidthProfile:null,sessionTimeout:1e3*F.options.session_timeout,statsPublishIntervalMs:1e4},$),T.setBandwidthProfile($.bandwidthProfile),q.setIceReconnectTimeout($.sessionTimeout);var ae=function(de){return X._getTrackReceiver(de)},ue=(X=D.call(this,T,F.sid,F.name,$)||this)._log;return Object.defineProperties(X,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:$.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:T.bandwidthProfileRevision,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:T.networkQualityConfiguration},_peerConnectionManager:{value:q},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:$.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new $.DominantSpeakerSignaling(ae,{log:ue})},_networkQualitySignaling:{value:new $.NetworkQualitySignaling(ae,T.networkQualityConfiguration,{log:ue})},_renderHintsSignaling:{value:new y(ae,{log:ue})},_publisherHintsSignaling:{value:new m(ae,{log:ue})},_trackPrioritySignaling:{value:new $.TrackPrioritySignaling(ae,{log:ue})},_trackSwitchOffSignaling:{value:new $.TrackSwitchOffSignaling(ae,{log:ue})},_pendingSwitchOffStates:{value:new Map},_transport:{value:Q},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:F.options.media_region||null}}),X._initTrackSwitchOffSignaling(),X._initDominantSpeakerSignaling(),X._initNetworkQualityMonitorSignaling(),X._initPublisherHintSignaling(),function(D,O){var T=L(function(){D._publishNewLocalParticipantState()}),F=L(function(){var Q=b(O.tracks,function(q){return q.trackTransceiver});D._peerConnectionManager.setTrackSenders(Q)});O.on("trackAdded",F),O.on("trackRemoved",F),O.on("updated",T),D.on("stateChanged",function Q(q){"disconnected"===q&&(O.removeListener("trackAdded",F),O.removeListener("trackRemoved",F),O.removeListener("updated",T),D.removeListener("stateChanged",Q),O.disconnect())}),D.on("signalingConnectionStateChanged",function(){var Q=D.localParticipant,$=Q.identity,X=Q.sid;switch(D.signalingConnectionState){case"connected":Q.connect(X,$);break;case"reconnecting":Q.reconnecting()}})}(X,T),function(D,O){O.on("description",function(F){D._publishPeerConnectionState(F)}),O.dequeue("description"),O.on("candidates",function(F){D._publishPeerConnectionState(F)}),O.dequeue("candidates"),O.on("trackAdded",D._addTrackReceiver.bind(D)),O.dequeue("trackAdded"),O.getTrackReceivers().forEach(D._addTrackReceiver,D),O.on("connectionStateChanged",function(){D.emit("connectionStateChanged")}),O.on("iceConnectionStateChanged",function(){D.emit("iceConnectionStateChanged"),"failed"===D.iceConnectionState&&(null!==D.localParticipant.networkQualityLevel&&D.localParticipant.setNetworkQualityLevel(0),D.participants.forEach(function(T){null!==T.networkQualityLevel&&T.setNetworkQualityLevel(0)}))})}(X,q),function(D,O){O.on("message",D._update.bind(D)),O.on("stateChanged",function T(F,Q){"disconnected"===F&&("disconnected"!==D.state&&D._disconnect(Q),O.removeListener("stateChanged",T)),D.emit("signalingConnectionStateChanged")})}(X,Q),function(D,O,T){var F=new Map,Q=!1,q=setInterval(function(){D.getStats().then(function($){Q=!Q,$.forEach(function(X,ae){var ue=new n(ae,X,!0);O.publishEvent("quality","stats-report","info",{audioTrackStats:ue.remoteAudioTrackStats.map(function(ve,pe){return Z(ve,X.remoteAudioTrackStats[pe],F)}),localAudioTrackStats:ue.localAudioTrackStats.map(function(ve,pe){return ee(ve,X.localAudioTrackStats[pe],F)}),localVideoTrackStats:ue.localVideoTrackStats.map(function(ve,pe){return ee(ve,X.localVideoTrackStats[pe],F)}),peerConnectionId:ue.peerConnectionId,videoTrackStats:ue.remoteVideoTrackStats.map(function(ve,pe){return Z(ve,X.remoteVideoTrackStats[pe],F)})});var de=b(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(ve){return ue[ve].map(function(pe){return pe.trackSid+"+"+pe.ssrc})});if(P(Array.from(F.keys()),de).forEach(function(ve){return F.delete(ve)}),Q){var he=function(D,O){return(D=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:O,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},C(D||{},null))).localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},C(D.localCandidate||{},null)),D.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},C(D.remoteCandidate||{},null)),D}(X.activeIceCandidatePair,ue.peerConnectionId);O.publishEvent("quality","active-ice-candidate-pair","info",he)}})},function(){})},T);D.on("stateChanged",function $(X){"disconnected"===X&&(clearInterval(q),D.removeListener("stateChanged",$))})}(X,Q,$.statsPublishIntervalMs),X._update(F),X._peerConnectionManager.setEffectiveAdaptiveSimulcast(X._publisherHintsSignaling.isSetup),X}return d(O,D),Object.defineProperty(O.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"signalingConnectionState",{get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),O.prototype._deleteTrackReceiverDeferred=function(T){return this._trackReceiverDeferreds.delete(T)},O.prototype._getOrCreateTrackReceiverDeferred=function(T){var F=this._trackReceiverDeferreds.get(T)||h(),q=this._peerConnectionManager.getTrackReceivers().find(function($){return $.id===T&&"ended"!==$.readyState});return q?F.resolve(q):this._trackReceiverDeferreds.set(T,F),F},O.prototype._addTrackReceiver=function(T){return this._getOrCreateTrackReceiverDeferred(T.id).resolve(T),this},O.prototype._disconnect=function(T){var F=D.prototype._disconnect.call(this,T);return F&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(Q){Q.publishFailed(T||new Error("LocalParticipant disconnected"))}),F},O.prototype._getTrackReceiver=function(T){var F=this;return this._getOrCreateTrackReceiverDeferred(T).promise.then(function(Q){return F._deleteTrackReceiverDeferred(T),Q})},O.prototype._getInitialTrackSwitchOffState=function(T){var F=this._pendingSwitchOffStates.get(T)||!1;return this._pendingSwitchOffStates.delete(T),F&&this._log.warn("["+T+"] was initially switched off! "),F},O.prototype._getTrackSidsToTrackSignalings=function(){var T=b(this.participants,function(F){return Array.from(F.tracks)});return new Map(T)},O.prototype._getOrCreateRemoteParticipant=function(T){var F=this,Q=this._RemoteParticipantV2,q=this.participants.get(T.sid),$=this;return q||((q=new Q(T,function(X){return F._getInitialTrackSwitchOffState(X)},function(X,ae){return F._trackPrioritySignaling.sendTrackPriorityUpdate(X,"subscribe",ae)},function(X,ae){return F._renderHintsSignaling.setTrackHint(X,ae)},function(X){return F._renderHintsSignaling.clearTrackHint(X)})).on("stateChanged",function X(ae){"disconnected"===ae&&(q.removeListener("stateChanged",X),$.participants.delete(q.sid),$._disconnectedParticipantRevisions.set(q.sid,q.revision))}),this.connectParticipant(q)),q},O.prototype._getState=function(){return{participant:this.localParticipant.getState()}},O.prototype._maybeAddBandwidthProfile=function(T){var F=this.localParticipant,Q=F.bandwidthProfile,q=F.bandwidthProfileRevision;return Q&&this._lastBandwidthProfileRevision<q?(this._lastBandwidthProfileRevision=q,Object.assign({bandwidth_profile:c(Q)},T)):T},O.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},O.prototype._publishPeerConnectionState=function(T){this._transport.publish(Object.assign({peer_connections:[T]},this._getState()))},O.prototype._update=function(T){var F=this;if(T.subscribed&&T.subscribed.revision>this._subscribedRevision){this._subscribedRevision=T.subscribed.revision,T.subscribed.tracks.forEach(function($){$.id?(F._subscriptionFailures.delete($.sid),F._subscribed.set($.sid,$.id)):$.error&&!F._subscriptionFailures.has($.sid)&&F._subscriptionFailures.set($.sid,$.error)});var Q=new Set(T.subscribed.tracks.filter(function($){return!!$.id}).map(function($){return $.sid}));this._subscribed.forEach(function($,X){Q.has(X)||F._subscribed.delete(X)})}var q=new Set;return(T.participants||[]).forEach(function($){if($.sid!==F.localParticipant.sid){var X=F._disconnectedParticipantRevisions.get($.sid);if(!(X&&$.revision<=X)){X&&F._disconnectedParticipantRevisions.delete($.sid);var ae=F._getOrCreateRemoteParticipant($);ae.update($),q.add(ae)}}}),"synced"===T.type&&this.participants.forEach(function($){q.has($)||$.disconnect()}),function(D){var O=D._getTrackSidsToTrackSignalings();D._subscriptionFailures.forEach(function(T,F){var Q=O.get(F);Q&&(D._subscriptionFailures.delete(F),Q.subscribeFailed(w(T.code,T.message)))}),O.forEach(function(T){var F=D._subscribed.get(T.sid);(!F||T.isSubscribed&&T.trackTransceiver.id!==F)&&T.setTrackTransceiver(null),F&&D._getTrackReceiver(F).then(function(Q){return T.setTrackTransceiver(Q)})})}(this),T.peer_connections&&this._peerConnectionManager.update(T.peer_connections,"synced"===T.type),T.recording&&this.recording.update(T.recording),T.published&&T.published.revision>this._publishedRevision&&(this._publishedRevision=T.published.revision,T.published.tracks.forEach(function($){$.sid&&F._published.set($.id,$.sid)}),this.localParticipant.update(T.published)),T.participant&&this.localParticipant.connect(T.participant.sid,T.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function($){var X=$.channel;!$.isSetup&&T.media_signaling&&T.media_signaling[X]&&T.media_signaling[X].transport&&"data-channel"===T.media_signaling[X].transport.type&&$.setup(T.media_signaling[X].transport.label)}),this},O.prototype._initPublisherHintSignaling=function(){var T=this;this._publisherHintsSignaling.on("updated",function(Q,q){Promise.all(Q.map(function($){return T.localParticipant.setPublisherHint($.track,$.encodings).then(function(X){return{track:$.track,result:X}})})).then(function($){T._publisherHintsSignaling.sendHintResponse({id:q,hints:$})})});var F=function(Q){"video"===Q.kind&&Q.trackTransceiver.on("replaced",function(){T._publisherHintsSignaling.sendTrackReplaced({trackSid:Q.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(Q){return F(Q)}),this.localParticipant.on("trackAdded",function(Q){return F(Q)})},O.prototype._initTrackSwitchOffSignaling=function(){var T=this;this._trackSwitchOffSignaling.on("updated",function(F,Q){try{T._log.debug("received trackSwitch: ",{tracksOn:Q,tracksOff:F});var q=new Map;Q.forEach(function($){return q.set($,!0)}),F.forEach(function($){q.get($)&&T._log.warn($+" is DUPLICATED in both tracksOff and tracksOn list"),q.set($,!1)}),T.participants.forEach(function($){$.tracks.forEach(function(X){var ae=q.get(X.sid);void 0!==ae&&(X.setSwitchedOff(!ae),q.delete(X.sid))})}),q.forEach(function($,X){return T._pendingSwitchOffStates.set(X,!$)})}catch($){T._log.error("error processing track switch off:",$)}})},O.prototype._initDominantSpeakerSignaling=function(){var T=this;this._dominantSpeakerSignaling.on("updated",function(){return T.setDominantSpeaker(T._dominantSpeakerSignaling.loudestParticipantSid)})},O.prototype._initNetworkQualityMonitorSignaling=function(){var T=this;this._networkQualitySignaling.on("ready",function(){var F=new T._NetworkQualityMonitor(T._peerConnectionManager,T._networkQualitySignaling);T._networkQualityMonitor=F,F.on("updated",function(){"failed"!==T.iceConnectionState&&(T.localParticipant.setNetworkQualityLevel(F.level,F.levels),T.participants.forEach(function(Q){var q=F.remoteLevels.get(Q.sid);q&&Q.setNetworkQualityLevel(q.level,q)}))}),F.start()}),this._networkQualitySignaling.on("teardown",function(){return T._teardownNetworkQualityMonitor()})},O.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},O.prototype.getStats=function(){var T=this;return this._peerConnectionManager.getStats().then(function(F){return new Map(Array.from(F).map(function(Q){var q=p(Q,2),X=q[1];return[q[0],Object.assign({},X,{localAudioTrackStats:I(T,X.localAudioTrackStats),localVideoTrackStats:I(T,X.localVideoTrackStats),remoteAudioTrackStats:M(T,X.remoteAudioTrackStats),remoteVideoTrackStats:M(T,X.remoteVideoTrackStats)})]}))})},O}(e);function A(D,O){return O.reduce(function(T,F){var Q=D.get(F.trackId);return Q?[Object.assign({},F,{trackSid:Q})].concat(T):T},[])}function I(D,O){return A(D._published,O)}function M(D,O){return A(new Map(Array.from(D._subscribed.entries()).map(function(F){var Q=p(F,2);return[Q[1],Q[0]]})),O)}function ee(D,O,T){var F=O.framesEncoded,Q=O.packetsSent,q=O.totalEncodeTime,$=O.totalPacketSendDelay,X=Object.assign({},D),ae=D.trackSid+"+"+D.ssrc,ue=T.get(ae)||new Map;if("number"==typeof q&&"number"==typeof F){var de=ue.get("avgEncodeDelay")||new R;de.putSample(1e3*q,F),X.avgEncodeDelay=Math.round(de.get()),ue.set("avgEncodeDelay",de)}if("number"==typeof $&&"number"==typeof Q){var ye=ue.get("avgPacketSendDelay")||new R;ye.putSample(1e3*$,Q),X.avgPacketSendDelay=Math.round(ye.get()),ue.set("avgPacketSendDelay",ye)}return T.set(ae,ue),X}function Z(D,O,T){var F=O.estimatedPlayoutTimestamp,Q=O.framesDecoded,q=O.jitterBufferDelay,$=O.jitterBufferEmittedCount,X=O.totalDecodeTime,ae=Object.assign({},D),ue=D.trackSid+"+"+D.ssrc,de=T.get(ue)||new Map;if("number"==typeof F&&(ae.estimatedPlayoutTimestamp=F),"number"==typeof Q&&"number"==typeof X){var ye=de.get("avgDecodeDelay")||new R;ye.putSample(1e3*X,Q),ae.avgDecodeDelay=Math.round(ye.get()),de.set("avgDecodeDelay",ye)}if("number"==typeof q&&"number"==typeof $){var he=de.get("avgJitterBufferDelay")||new R;he.putSample(1e3*q,$),ae.avgJitterBufferDelay=Math.round(he.get()),de.set("avgJitterBufferDelay",he)}return T.set(ue,de),ae}k.exports=_},7960:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"track_priority",e)||this;return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",function(n){Array.from(r._enqueuedPriorityUpdates.keys()).forEach(function(l){n.publish({type:"track_priority",track:l,subscribe:r._enqueuedPriorityUpdates.get(l)})})}),r}return d(i,s),i.prototype.sendTrackPriorityUpdate=function(t,e,r){if("subscribe"!==e)throw new Error("only subscribe priorities are supported, found: "+e);this._enqueuedPriorityUpdates.set(t,r),this._transport&&this._transport.publish({type:"track_priority",track:t,subscribe:r})},i}(a(762));k.exports=o},5084:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"track_switch_off",e)||this;return r.on("ready",function(n){n.on("message",function(l){switch(l.type){case"track_switch_off":r._setTrackSwitchOffUpdates(l.off||[],l.on||[])}})}),r}return d(i,s),i.prototype._setTrackSwitchOffUpdates=function(t,e){this.emit("updated",t,e)},i}(a(762));k.exports=o},1328:function(k,S,a){"use strict";var j,d=this&&this.__extends||(j=function(H,U){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,J){N.__proto__=J}||function(N,J){for(var ee in J)Object.prototype.hasOwnProperty.call(J,ee)&&(N[ee]=J[ee])})(H,U)},function(H,U){if("function"!=typeof U&&null!==U)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function N(){this.constructor=H}j(H,U),H.prototype=null===U?Object.create(U):(N.prototype=U.prototype,new N)}),p=a(1856),o=a(9616),s=a(4035),i=a(9917).reconnectBackoffConfig,t=a(1190),e=a(9917),r=e.SDK_NAME,n=e.SDK_VERSION,l=e.SDP_FORMAT,v=a(3761),y=v.createBandwidthProfilePayload,m=v.createMediaSignalingPayload,f=v.createSubscribePayload,u=v.getUserAgent,c=v.isNonArrayObject,h=a(7061),P=h.createTwilioError,C=h.RoomCompletedError,b=h.SignalingConnectionError,L=h.SignalingServerBusyError,g={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},_=function(j){function H(U,N,J,ee,Z,V){var D;return V=Object.assign({Backoff:s,TwilioConnection:o,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:u()},V),D=j.call(this,"connecting",g)||this,Object.defineProperties(D,{_accessToken:{value:N},_automaticSubscription:{value:V.automaticSubscription},_bandwidthProfile:{value:V.bandwidthProfile},_dominantSpeaker:{value:V.dominantSpeaker},_adaptiveSimulcast:{value:V.adaptiveSimulcast},_eventObserver:{value:V.eventObserver,writable:!1},_renderHints:{value:V.renderHints},_iceServersStatus:{value:Array.isArray(V.iceServers)?"overrode":"acquire"},_localParticipant:{value:J},_name:{value:U},_networkQuality:{value:c(V.networkQuality)||V.networkQuality},_options:{value:V},_peerConnectionManager:{value:ee},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:V.Backoff.exponential(i)},_session:{value:null,writable:!0},_trackPriority:{value:V.trackPriority},_trackSwitchOff:{value:V.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:V.userAgent},_wsServer:{value:Z}}),function(j){function H(){if("disconnected"!==j.state){j._twilioConnection&&j._twilioConnection.removeListener("message",N);var O=j._options,Q=O.TwilioConnection,q=new Q(j._wsServer,Object.assign({helloBody:"connecting"===j.state&&"acquire"===j._iceServersStatus?j._createIceMessage():j._createConnectOrSyncOrDisconnectMessage()},O));q.once("close",function($){$===Q.CloseReason.LOCAL?U():U(new Error($))}),q.on("message",N),j._twilioConnection=q}}function U(D){if("disconnected"!==j.state){if(!D)return void j.disconnect();var O=j._getReconnectTimer();if(!O){var T=D.message===o.CloseReason.BUSY?new L:new b;return void j.disconnect(T)}"connected"===j.state&&j.preempt("syncing"),O.then(H)}}function N(D){if("disconnected"!==j.state){if("error"===D.type)return void j.disconnect(P(D.code,D.message));switch(j.state){case"connected":switch(D.type){case"connected":case"synced":case"update":return void j.emit("message",D);case"disconnected":return void j.disconnect("completed"===D.status?new C:null);default:return}case"connecting":switch(D.type){case"iced":return void j._options.onIced(D.ice_servers).then(function(){j._sendConnectOrSyncOrDisconnectMessage()});case"connected":return j._setSession(D.session,D.options.session_timeout),j.emit("connected",D),void j.preempt("connected");case"synced":case"update":return void j._updatesReceived.push(D);case"disconnected":return void j.disconnect("completed"===D.status?new C:null);default:return}case"syncing":switch(D.type){case"connected":case"update":return void j._updatesReceived.push(D);case"synced":return j._clearReconnectTimer(),j.emit("message",D),void j.preempt("connected");case"disconnected":return void j.disconnect("completed"===D.status?new C:null);default:return}default:return}}}j.on("stateChanged",function D(O){switch(O){case"connected":var T=j._updatesToSend.splice(0);return T.length&&j.publish(function(j){return j.reduce(function(H,U){return(!H.participant&&U.participant||H.participant&&U.participant&&U.participant.revision>H.participant.revision)&&(H.participant=U.participant),!H.peer_connections&&U.peer_connections?H.peer_connections=A(U.peer_connections):H.peer_connections&&U.peer_connections&&(H.peer_connections=A(H.peer_connections.concat(U.peer_connections))),H},{})}(T)),void j._updatesReceived.splice(0).forEach(function(F){return j.emit("message",F)});case"disconnected":return j._twilioConnection.removeListener("message",N),void j.removeListener("stateChanged",D);case"syncing":default:return}});var J=j._options;"overrode"===j._iceServersStatus?(0,J.onIced)(J.iceServers).then(H):H()}(D),D}return d(H,j),H.prototype._createConnectOrSyncOrDisconnectMessage=function(){if("connected"===this.state)return null;if("disconnected"===this.state)return{session:this._session,type:"disconnect",version:2};var U={connecting:"connect",syncing:"sync"}[this.state],N={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:U,version:2};return"connect"===N.type?(N.ice_servers=this._iceServersStatus,N.publisher={name:r,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(N.bandwidth_profile=y(this._bandwidthProfile)),N.media_signaling=m(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),N.subscribe=f(this._automaticSubscription),N.format=l,N.token=this._accessToken):"sync"===N.type?(N.session=this._session,N.token=this._accessToken):"update"===N.type&&(N.session=this._session),N},H.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:1}},H.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var U=this._createConnectOrSyncOrDisconnectMessage();U&&this._twilioConnection.sendMessage(U)},H.prototype.disconnect=function(U){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[U]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0)},H.prototype.publish=function(U){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:2},U)),!0;case"connecting":case"syncing":return this._updatesToSend.push(U),!0;case"disconnected":default:return!1}},H.prototype.publishEvent=function(U,N,J,ee){this._eventObserver.emit("event",{group:U,name:N,level:J,payload:ee})},H.prototype.sync=function(){return"connected"===this.state&&(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0)},H.prototype._setSession=function(U,N){this._session=U,this._sessionTimeoutMS=1e3*N},H.prototype._getReconnectTimer=function(){var U=this;return 0===this._sessionTimeoutMS?null:(this._sessionTimer||(this._sessionTimer=new t(function(){U._sessionTimer&&(U._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(N){U._reconnectBackoff.once("ready",N),U._reconnectBackoff.backoff()}))},H.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},H}(p);function A(j){return Array.from(j.reduce(function(H,U){var N=H.get(U.id)||U;return(!N.description&&U.description||N.description&&U.description&&U.description.revision>N.description.revision)&&(N.description=U.description),(!N.ice&&U.ice||N.ice&&U.ice&&U.ice.revision>N.ice.revision)&&(N.ice=U.ice),H.set(N.id,N),H},new Map).values())}k.exports=_},1856:function(k,S,a){"use strict";var m,d=this&&this.__extends||(m=function(f,u){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var P in h)Object.prototype.hasOwnProperty.call(h,P)&&(c[P]=h[P])})(f,u)},function(f,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function c(){this.constructor=f}m(f,u),f.prototype=null===u?Object.create(u):(c.prototype=u.prototype,new c)}),p=this&&this.__read||function(m,f){var u="function"==typeof Symbol&&m[Symbol.iterator];if(!u)return m;var h,C,c=u.call(m),P=[];try{for(;(void 0===f||f-- >0)&&!(h=c.next()).done;)P.push(h.value)}catch(b){C={error:b}}finally{try{h&&!h.done&&(u=c.return)&&u.call(c)}finally{if(C)throw C.error}}return P},o=this&&this.__spreadArray||function(m,f){for(var u=0,c=f.length,h=m.length;u<c;u++,h++)m[h]=f[u];return m},s=a(3105).EventEmitter,i=a(3761),t=function(m){function f(u,c){var h=m.call(this)||this,P=null,C=u;return c=function(m){var f=new Map;for(var u in m)f.set(u,new Set(m[u]));return f}(c),Object.defineProperties(h,{_lock:{get:function(){return P},set:function(b){P=b}},_reachableStates:{value:n(c)},_state:{get:function(){return C},set:function(b){C=b}},_states:{value:c},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==P}},state:{enumerable:!0,get:function(){return C}}}),h.on("stateChanged",function(b){h._whenDeferreds.forEach(function(L){L.when(b,L.resolve,L.reject)})}),h}return d(f,m),f.prototype._whenPromise=function(u){var c=this;if("function"!=typeof u)return Promise.reject(new Error("when() executor must be a function"));var h=i.defer();return h.when=u,this._whenDeferreds.add(h),h.promise.then(function(P){return c._whenDeferreds.delete(h),P},function(P){throw c._whenDeferreds.delete(h),P})},f.prototype.bracket=function(u,c){var h,P=this;function C(b){if(P.hasLock(h)&&P.releaseLockCompletely(h),b)throw b}return this.takeLock(u).then(function(L){return c(h=L)}).then(function(L){return C(),L},C)},f.prototype.hasLock=function(u){return this._lock===u},f.prototype.preempt=function(u,c,h){if(!e(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');var P;this.isLocked&&(P=this._lock,this._lock=null);var C=null;c&&(C=this.takeLockSync(c));var b=C?null:this.takeLockSync("preemption");return this.transition(u,C||b,h),P&&P.resolve(),b&&this.releaseLock(b),C},f.prototype.releaseLock=function(u){if(!this.isLocked)throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock");0===u.depth?(this._lock=null,u.resolve()):u.depth--},f.prototype.releaseLockCompletely=function(u){if(!this.isLocked)throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock");u.depth=0,this._lock=null,u.resolve()},f.prototype.takeLock=function(u){var c=this;if("object"==typeof u){var h=u;return new Promise(function(b){b(c.takeLockSync(h))})}var P=u;if(this.isLocked){var C=this.takeLock.bind(this,P);return this._lock.promise.then(C)}return Promise.resolve(this.takeLockSync(P))},f.prototype.takeLockSync=function(u){var c="string"==typeof u?null:u,h=c?c.name:u;if(c&&!this.hasLock(c)||!c&&this.isLocked)throw new Error("Could not take the lock for "+h+" because the lock for "+this._lock.name+" was not released");if(c)return c.depth++,c;var P=function(m){var f=i.defer();return f.name=m,f.depth=0,f}(h);return this._lock=P,P},f.prototype.transition=function(u,c,h){if(h=h||[],this.isLocked){if(!c)throw new Error("You must provide the key in order to transition");if(!this.hasLock(c))throw new Error("Could not transition using the key for "+c.name+" because "+this._lock.name+" has the lock")}else if(c)throw new Error("Key provided for "+c.name+", but the StateMachine was not locked (possibly due to preemption)");if(!e(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');this._state=u,this.emit.apply(this,o([],p(["stateChanged",u].concat(h))))},f.prototype.tryTransition=function(u,c,h){try{this.transition(u,c,h)}catch(P){return!1}return!0},f.prototype.when=function(u){var c=this;return this.state===u?Promise.resolve(this):e(this._reachableStates,this.state,u)?this._whenPromise(function(h,P,C){h===u?P(c):e(c._reachableStates,h,u)||C(y(h,u))}):Promise.reject(y(this.state,u))},f}(s);function e(m,f,u){return m.get(f).has(u)}function n(m){return Array.from(m.keys()).reduce(function(f,u){return f.set(u,l(m,u))},new Map)}function l(m,f,u){return u=u||new Set,m.get(f).forEach(function(c){u.has(c)||(u.add(c),l(m,c,u).forEach(u.add,u))}),u}function y(m,f){return new Error('"'+f+'" cannot be reached from "'+m+'"')}k.exports=t},7642:k=>{"use strict";k.exports=function(a){return(a=a.filter(function(d){return"number"==typeof d})).length<1?void 0:a.reduce(function(d,p){return p+d})/a.length}},1955:k=>{"use strict";var S=function(){function a(d,p,o,s){Object.defineProperties(this,{availableSend:{enumerable:!0,value:o},recv:{enumerable:!0,value:p},rtt:{enumerable:!0,value:s},send:{enumerable:!0,value:d}})}return a.of=function(d,p){var o=(p.timestamp-d.timestamp)/1e3;return new a(o>0?(p.bytesSent-d.bytesSent)/o*8:0,o>0?(p.bytesReceived-d.bytesReceived)/o*8:0,p.availableOutgoingBitrate,p.currentRoundTripTime)},a}();k.exports=S},3979:(k,S,a)=>{"use strict";var d=a(1955),p=function(){function o(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new d(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return o.prototype.next=function(s){var i=this.lastStats;if(this.lastStats=s,i){var t=i.id===s.id?d.of(i,s):new d(0,0);this.lastReport=t}return this.lastReport},o}();k.exports=p},1778:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e,r)||this;return Object.defineProperties(n,{audioLevel:{value:"number"==typeof e.audioInputLevel?e.audioInputLevel:null,enumerable:!0},jitter:{value:"number"==typeof e.jitter?e.jitter:null,enumerable:!0}}),n}return d(i,s),i}(a(1899));k.exports=o},1899:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e)||this;return Object.defineProperties(n,{bytesSent:{value:"number"==typeof e.bytesSent?e.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:"number"==typeof e.packetsSent?e.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:"number"==typeof e.roundTripTime?e.roundTripTime:r?0:null,enumerable:!0}}),n}return d(i,s),i}(a(2313));k.exports=o},8651:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e,r)||this,l=null;"number"==typeof e.frameWidthInput&&"number"==typeof e.frameHeightInput&&(l={},Object.defineProperties(l,{width:{value:e.frameWidthInput,enumerable:!0},height:{value:e.frameHeightInput,enumerable:!0}}));var v=null;return"number"==typeof e.frameWidthSent&&"number"==typeof e.frameHeightSent&&(v={},Object.defineProperties(v,{width:{value:e.frameWidthSent,enumerable:!0},height:{value:e.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:l,enumerable:!0},dimensions:{value:v,enumerable:!0},captureFrameRate:{value:"number"==typeof e.frameRateInput?e.frameRateInput:null,enumerable:!0},frameRate:{value:"number"==typeof e.frameRateSent?e.frameRateSent:null,enumerable:!0}}),n}return d(i,s),i}(a(1899));k.exports=o},7111:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(6015));k.exports=o},5132:k=>{"use strict";k.exports=function(d){var p=d.actual,s=d.available,t=d.level;Object.defineProperties(this,{actual:{value:void 0===p?null:p,enumerable:!0},available:{value:void 0===s?null:s,enumerable:!0},level:{value:void 0===t?null:t,enumerable:!0}})}},8365:k=>{"use strict";k.exports=function(d){var p=d.fractionLost,s=d.level;Object.defineProperties(this,{fractionLost:{value:void 0===p?null:p,enumerable:!0},level:{value:void 0===s?null:s,enumerable:!0}})}},9392:k=>{"use strict";k.exports=function(d){var p=d.jitter,s=d.rtt,t=d.level;Object.defineProperties(this,{jitter:{value:void 0===p?null:p,enumerable:!0},rtt:{value:void 0===s?null:s,enumerable:!0},level:{value:void 0===t?null:t,enumerable:!0}})}},6015:(k,S,a)=>{"use strict";var d=a(8534),p=a(319);k.exports=function(i){var r=i.sendStats,n=void 0===r?null:r,l=i.recvStats,v=void 0===l?null:l;Object.defineProperties(this,{send:{value:i.send,enumerable:!0},recv:{value:i.recv,enumerable:!0},sendStats:{value:n?new d(n):null,enumerable:!0},recvStats:{value:v?new p(v):null,enumerable:!0}})}},319:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(4391));k.exports=o},4391:(k,S,a)=>{"use strict";var d=a(5132),p=a(8365),o=a(9392);k.exports=function(t){var e=t.bandwidth,r=void 0===e?null:e,n=t.fractionLost,l=void 0===n?null:n,v=t.latency,y=void 0===v?null:v;Object.defineProperties(this,{bandwidth:{value:r?new d(r):null,enumerable:!0},fractionLost:{value:l?new p(l):null,enumerable:!0},latency:{value:y?new o(y):null,enumerable:!0}})}},8534:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(4391));k.exports=o},5674:(k,S,a)=>{"use strict";var d=a(7111),p=a(4086);k.exports=function(i){var e=i.audio,r=i.video;Object.defineProperties(this,{level:{value:i.level,enumerable:!0},audio:{value:e?new d(e):null,enumerable:!0},video:{value:r?new p(r):null,enumerable:!0}})}},4086:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(6015));k.exports=o},422:(k,S,a)=>{"use strict";var d=a(9369),p=a(4894),o=function(){function s(i,t,e){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:t},video:{enumerable:!0,value:e}})}return s.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),t=p.summarize(i),e=this.audio.recv.concat(this.video.recv),r=d.summarize(e);return{ice:this.ice,send:t,recv:r,audio:{send:p.summarize(this.audio.send),recv:d.summarize(this.audio.recv)},video:{send:p.summarize(this.video.send),recv:d.summarize(this.video.recv)}}},s}();k.exports=o},127:function(k,S,a){"use strict";var d=this&&this.__read||function(g,_){var A="function"==typeof Symbol&&g[Symbol.iterator];if(!A)return g;var M,H,I=A.call(g),j=[];try{for(;(void 0===_||_-- >0)&&!(M=I.next()).done;)j.push(M.value)}catch(U){H={error:U}}finally{try{M&&!M.done&&(A=I.return)&&A.call(I)}finally{if(H)throw H.error}}return j},p=this&&this.__spreadArray||function(g,_){for(var A=0,I=_.length,M=g.length;A<I;A++,M++)g[M]=_[A];return g},o=this&&this.__values||function(g){var _="function"==typeof Symbol&&Symbol.iterator,A=_&&g[_],I=0;if(A)return A.call(g);if(g&&"number"==typeof g.length)return{next:function(){return g&&I>=g.length&&(g=void 0),{value:g&&g[I++],done:!g}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},s=a(4911).guessBrowser,i=a(3979),t=a(422),e=a(3838),r=a(1208),n=function(){function g(_){Object.defineProperties(this,{pc:{enumerable:!0,value:_},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return g.prototype.next=function(){var _=this;return("firefox"===s()?function(g){var _=g.pc.getTransceivers().filter(function(I){return I.currentDirection&&I.currentDirection.match(/send/)&&I.sender.track}).map(function(I){return I.sender}),A=g.pc.getTransceivers().filter(function(I){return I.currentDirection&&I.currentDirection.match(/recv/)}).map(function(I){return I.receiver});return Promise.all([l(_),l(A),g.pc.getStats()]).then(function(I){var M=d(I,3),j=M[0],H=M[1],U=M[2],N=y(g),J=c(g);j.forEach(function(V,D){return P(g,V,J,D)}),b(N,J);var ee=m(g),Z=h(g);H.forEach(function(V,D){return C(g,V,Z,D)}),b(ee,Z),L(g.ice,U)})}(this):function(g){return g.pc.getStats().then(function(_){var A=y(g),I=c(g);P(g,_,I),b(A,I);var M=m(g),j=h(g);C(g,_,j),b(M,j),L(g.ice,_)})}(this)).then(function(){var I=p([],d(_.audio.send.values())),M=p([],d(_.video.send.values())),j=p([],d(_.audio.recv.values())),H=p([],d(_.video.recv.values())),U=new t(_.ice.lastReport,{send:I.map(function(N){return N.lastReport}).filter(function(N){return N}),recv:j.map(function(N){return N.lastReport}).filter(function(N){return N})},{send:M.map(function(N){return N.lastReport}).filter(function(N){return N}),recv:H.map(function(N){return N.lastReport}).filter(function(N){return N})});return _.lastReport=U,U})},g}();function l(g){return Promise.all(g.map(function(_){var A=_.track.id;return _.getStats().then(function(I){var M,j;try{for(var H=o(I.values()),U=H.next();!U.done;U=H.next()){var N=U.value;"inbound-rtp"===N.type&&(N.id=A+"-"+N.id)}}catch(J){M={error:J}}finally{try{U&&!U.done&&(j=H.return)&&j.call(H)}finally{if(M)throw M.error}}return[A,I]})})).then(function(_){return new Map(_)})}function v(g,_,A,I,M){var j=_[I.mediaType];if(!M){var H=A.get(I.trackId);H&&(M=H.trackIdentifier)}if(j&&M){if(j.has(I.id))return j.get(I.id);var U=new g(M,I);j.set(I.id,U)}return null}function y(g){return{audio:g.audio.send,video:g.video.send}}function m(g){return{audio:g.audio.recv,video:g.video.recv}}function f(g,_,A,I){return v(r,y(g),_,A,I)}function u(g,_,A,I){return v(e,m(g),_,A,I)}function c(g){return{audio:new Set(g.audio.send.keys()),video:new Set(g.video.send.keys())}}function h(g){return{audio:new Set(g.audio.recv.keys()),video:new Set(g.video.recv.keys())}}function P(g,_,A,I){var M,j;try{for(var H=o(_.values()),U=H.next();!U.done;U=H.next()){var N=U.value;if("outbound-rtp"===N.type&&!N.isRemote){if("firefox"!==s()&&!N.trackId)continue;var J=A[N.mediaType];J&&J.delete(N.id);var ee=f(g,_,N,I);if(ee){var Z=_.get(N.remoteId);ee.next(I||ee.trackId,N,Z)}}}}catch(V){M={error:V}}finally{try{U&&!U.done&&(j=H.return)&&j.call(H)}finally{if(M)throw M.error}}}function C(g,_,A,I){var M,j;try{for(var H=o(_.values()),U=H.next();!U.done;U=H.next()){var N=U.value;if("inbound-rtp"===N.type&&!N.isRemote){var J=A[N.mediaType];J&&J.delete(N.id);var ee=u(g,_,N,I);ee&&ee.next(I||ee.trackId,N)}}}catch(Z){M={error:Z}}finally{try{U&&!U.done&&(j=H.return)&&j.call(H)}finally{if(M)throw M.error}}}function b(g,_){var A=function(M){var j=g[M];_[M].forEach(function(U){return j.delete(U)})};for(var I in _)A(I)}function L(g,_){var A,I,M,j,H;try{for(var U=o(_.values()),N=U.next();!N.done;N=U.next())"transport"===(J=N.value).type&&(H=_.get(J.selectedCandidatePairId))}catch(V){A={error:V}}finally{try{N&&!N.done&&(I=U.return)&&I.call(U)}finally{if(A)throw A.error}}if(H)g.next(H);else try{for(var ee=o(_.values()),Z=ee.next();!Z.done;Z=ee.next()){var J;"candidate-pair"===(J=Z.value).type&&J.nominated&&(!("selected"in J)||J.selected)&&g.next(J)}}catch(V){M={error:V}}finally{try{Z&&!Z.done&&(j=ee.return)&&j.call(ee)}finally{if(M)throw M.error}}}k.exports=n},9369:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(7642),o=a(3443),s=a(2697),i=function(t){function e(r,n,l,v,y,m,f){var u=t.call(this,r,n,l)||this;return Object.defineProperties(u,{deltaPacketsLost:{enumerable:!0,value:v},deltaPacketsReceived:{enumerable:!0,value:y},fractionLost:{enumerable:!0,value:m},jitter:{enumerable:!0,value:f},phonyFractionLost:{enumerable:!0,value:y>0?v/y:0}}),u}return d(e,t),e.of=function(r,n,l){if(n.id!==l.id)throw new Error("RTCStats IDs must match");var v=(l.timestamp-n.timestamp)/1e3,m=v>0?(l.bytesReceived-n.bytesReceived)/v*8:0,f=Math.max(l.packetsLost-n.packetsLost,0);return new e(n.id,r,m,f,l.packetsReceived-n.packetsReceived,l.fractionLost,l.jitter)},e.summarize=function(r){var n=r.map(function(m){return m.summarize()});return{bitrate:s(n.map(function(m){return m.bitrate})),fractionLost:p(n.map(function(m){return m.fractionLost})),jitter:p(n.map(function(m){return m.jitter}))}},e.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:"number"==typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},e}(o);k.exports=i},3838:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(9369),s=function(i){function t(e,r){var n=i.call(this,r.id,e,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return d(t,i),t.prototype.next=function(e,r){var n=this.lastStats;this.lastStats=r,this.trackId=e;var l=p.of(e,n,r);return this.lastReport=l,l},t}(a(2835));k.exports=s},457:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this;return Object.defineProperties(r,{audioLevel:{value:"number"==typeof e.audioOutputLevel?e.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"==typeof e.jitter?e.jitter:null,enumerable:!0}}),r}return d(i,s),i}(a(3218));k.exports=o},3218:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this;return Object.defineProperties(r,{bytesReceived:{value:"number"==typeof e.bytesReceived?e.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"==typeof e.packetsReceived?e.packetsReceived:null,enumerable:!0}}),r}return d(i,s),i}(a(2313));k.exports=o},5021:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this,n=null;return"number"==typeof e.frameWidthReceived&&"number"==typeof e.frameHeightReceived&&(n={},Object.defineProperties(n,{width:{value:e.frameWidthReceived,enumerable:!0},height:{value:e.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:n,enumerable:!0},frameRate:{value:"number"==typeof e.frameRateReceived?e.frameRateReceived:null,enumerable:!0}}),r}return d(i,s),i}(a(3218));k.exports=o},3443:k=>{"use strict";k.exports=function(d,p,o){Object.defineProperties(this,{id:{enumerable:!0,value:d},trackId:{enumerable:!0,value:p},bitrate:{enumerable:!0,value:o}})}},2835:k=>{"use strict";k.exports=function(d,p,o){Object.defineProperties(this,{id:{enumerable:!0,value:d,writable:!0},trackId:{enumerable:!0,value:p,writable:!0},lastStats:{enumerable:!0,value:o,writable:!0}})}},4894:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(7642),o=a(3443),s=a(2697),i=function(t){function e(r,n,l,v){var y=t.call(this,r,n,l)||this;return Object.defineProperties(y,{rtt:{enumerable:!0,value:v}}),y}return d(e,t),e.of=function(r,n,l,v){if(n.id!==l.id)throw new Error("RTCStats IDs must match");var y=(l.timestamp-n.timestamp)/1e3;return new e(n.id,r,y>0?(l.bytesSent-n.bytesSent)/y*8:0,v&&"number"==typeof v.roundTripTime?v.roundTripTime/1e3:void 0)},e.summarize=function(r){return{bitrate:s(r.map(function(v){return v.bitrate})),rtt:p(r.map(function(v){return v.rtt}))}},e}(o);k.exports=i},1208:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(2835),o=a(4894),s=function(i){function t(e,r){var n=i.call(this,r.id,e,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return d(t,i),t.prototype.next=function(e,r,n){var l=this.lastStats;this.lastStats=r,this.trackId=e;var v=o.of(e,l,r,n);return this.lastReport=v,v},t}(p);k.exports=s},6614:(k,S,a)=>{"use strict";var d=a(1778),p=a(8651),o=a(457),s=a(5021);k.exports=function(e,r,n){if("string"!=typeof e)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:e,enumerable:!0},localAudioTrackStats:{value:r.localAudioTrackStats.map(function(l){return new d(l.trackId,l,n)}),enumerable:!0},localVideoTrackStats:{value:r.localVideoTrackStats.map(function(l){return new p(l.trackId,l,n)}),enumerable:!0},remoteAudioTrackStats:{value:r.remoteAudioTrackStats.map(function(l){return new o(l.trackId,l)}),enumerable:!0},remoteVideoTrackStats:{value:r.remoteVideoTrackStats.map(function(l){return new s(l.trackId,l)}),enumerable:!0}})}},2697:k=>{"use strict";k.exports=function(a){return a.reduce(function(d,p){return"number"==typeof p?p+d:d},0)}},2313:k=>{"use strict";k.exports=function(d,p){if("string"!=typeof d)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:d,enumerable:!0},trackSid:{value:p.trackSid,enumerable:!0},timestamp:{value:p.timestamp,enumerable:!0},ssrc:{value:p.ssrc,enumerable:!0},packetsLost:{value:"number"==typeof p.packetsLost?p.packetsLost:null,enumerable:!0},codec:{value:"string"==typeof p.codecName?p.codecName:null,enumerable:!0}})}},8699:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return Object.defineProperties(r,{id:{enumerable:!0,value:t},kind:{enumerable:!0,value:e}}),r}return d(i,s),i.prototype.stop=function(){this.emit("stopped")},i}(a(3105).EventEmitter);k.exports=o},9616:function(k,S,a){"use strict";var Z,d=this&&this.__extends||(Z=function(V,D){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,T){O.__proto__=T}||function(O,T){for(var F in T)Object.prototype.hasOwnProperty.call(T,F)&&(O[F]=T[F])})(V,D)},function(V,D){if("function"!=typeof D&&null!==D)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function O(){this.constructor=V}Z(V,D),V.prototype=null===D?Object.create(D):(O.prototype=D.prototype,new O)}),p=this&&this.__read||function(Z,V){var D="function"==typeof Symbol&&Z[Symbol.iterator];if(!D)return Z;var T,Q,O=D.call(Z),F=[];try{for(;(void 0===V||V-- >0)&&!(T=O.next()).done;)F.push(T.value)}catch(q){Q={error:q}}finally{try{T&&!T.done&&(D=O.return)&&D.call(O)}finally{if(Q)throw Q.error}}return F},o=this&&this.__spreadArray||function(Z,V){for(var D=0,O=V.length,T=Z.length;D<O;D++,T++)Z[T]=V[D];return Z},s=a(1856),i=a(3761),t=i.buildLogLevels,e=i.makeUUID,r=a(7394),n=a(4189),l=a(1190),v=0,y={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},m={closed:"close",open:"open",waiting:"waiting"},I=3005,H=global.window||global,U=H.WebSocket?H.WebSocket:a(6890),N={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},J=new Map([[3e3,N.TIMEOUT],[3001,N.TIMEOUT],[3002,N.FAILED],[3003,N.FAILED],[3004,N.TIMEOUT],[3006,N.BUSY],[3007,N.TIMEOUT]]),ee=function(Z){function V(D,O){var T=Z.call(this,"early",y)||this;O=Object.assign({helloBody:null,maxConsecutiveFailedHellos:3,maxConsecutiveMissedHeartbeats:3,requestedHeartbeatTimeout:5e3,openTimeout:15e3,welcomeTimeout:5e3,Log:r,WebSocket:U},O);var F=t(O.logLevel),Q=new O.Log("default",T,F,O.loggerName),q=O.networkMonitor?new n(function(){var X=q.type,ae="Network changed"+(X?" to "+X:"");Q.debug(ae),T._close({code:3004,reason:ae})}):null;Object.defineProperties(T,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:O.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:O.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++v},_log:{value:Q},_messageQueue:{value:[]},_networkMonitor:{value:q},_options:{value:O},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:D},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var $={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return T.on("stateChanged",function(X){for(var ae=[],ue=1;ue<arguments.length;ue++)ae[ue-1]=arguments[ue];X in m&&T.emit.apply(T,o([m[X]],p(ae)));var de={name:X,group:"signaling",level:$[T.state]};if("closed"===X){var ye=p(ae,1),he=ye[0];de.payload={reason:he},de.level=he===N.LOCAL?"info":"error"}T._eventObserver.emit("event",de)}),T._eventObserver.emit("event",{name:T.state,group:"signaling",level:$[T.state]}),T._connect(),T}return d(V,Z),V.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},V.prototype._close=function(D){var O=D.code,T=D.reason;if("closed"!==this.state){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&O!==I&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var F=this._log;1e3===O?(F.debug("Closed"),this.transition("closed",null,[N.LOCAL])):(F.warn("Closed: "+O+" - "+T),O!==I&&this.transition("closed",null,[J.get(O)||N.REMOTE]));var Q=this._ws.readyState,q=this._options.WebSocket;Q!==q.CLOSING&&Q!==q.CLOSED&&this._ws.close(O,T)}},V.prototype._connect=function(){var D=this,O=this._log;if("waiting"===this.state)this.transition("early");else if("early"!==this.state)return void O.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');this._ws=new this._options.WebSocket(this._serverUrl);var T=this._ws;O.debug("Created a new WebSocket:",T),T.addEventListener("close",function(Q){return D._close(Q)});var F=this._options.openTimeout;this._openTimeout=new l(function(){D._close({code:3007,reason:"Failed to open in "+F+" ms"})},F),T.addEventListener("open",function(){O.debug("WebSocket opened:",T),D._openTimeout.clear(),D._startHandshake(),D._networkMonitor&&D._networkMonitor.start()}),T.addEventListener("message",function(Q){O.debug("Incoming: "+Q.data);try{Q=JSON.parse(Q.data)}catch(q){return void D.emit("error",q)}switch(Q.type){case"bad":D._handleBad(Q);break;case"busy":D._handleBusy(Q);break;case"bye":break;case"msg":D._handleMessage(Q);case"heartbeat":D._handleHeartbeat();break;case"welcome":D._handleWelcome(Q);break;default:D._log.debug("Unknown message type: "+Q.type),D.emit("error",new Error("Unknown message type: "+Q.type))}})},V.prototype._handleBad=function(D){var O=D.reason,T=this._log;if(["connecting","open"].includes(this.state))return"connecting"===this.state?(T.warn("Closing: 3002 - "+O),void this._close({code:3002,reason:O})):(T.debug("Error: "+O),void this.emit("error",new Error(O)));T.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.')},V.prototype._handleBusy=function(D){var O=this,T=D.cookie,F=D.keepAlive,Q=D.retryAfter,q=this._log;if(["connecting","waiting"].includes(this.state)){this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var $=Q<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+Q+" ms";if(Q<0)return q.warn("Closing: 3006 - "+$),void this._close({code:3006,reason:$});this._hellosLeft=this._options.maxConsecutiveFailedHellos,this._cookie=T||null,F?(q.warn($),this._busyWaitTimeout=new l(function(){return O._startHandshake()},Q)):(q.warn("Closing: 3005 - "+$),this._close({code:I,reason:$}),this._busyWaitTimeout=new l(function(){return O._connect()},Q)),this.transition("waiting",null,[F,Q])}else q.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.')},V.prototype._handleHeartbeat=function(){"open"===this.state?this._heartbeatTimeout.reset():this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.')},V.prototype._handleHeartbeatTimeout=function(){if("open"===this.state){var D=this._log,O=this._options.maxConsecutiveMissedHeartbeats;D.debug("Consecutive heartbeats missed: "+O);var T="Missed "+O+' "heartbeat" messages';D.warn("Closing: 3001 - "+T),this._close({code:3001,reason:T})}},V.prototype._handleMessage=function(D){"open"===this.state?this.emit("message",D.body):this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.')},V.prototype._handleWelcome=function(D){var O=this,T=D.negotiatedTimeout,F=this._log;if(["connecting","waiting"].includes(this.state)){"waiting"===this.state&&(F.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var q=T*this._options.maxConsecutiveMissedHeartbeats,$=T-200;this._welcomeTimeout.clear(),this._heartbeatTimeout=new l(function(){return O._handleHeartbeatTimeout()},q),this._messageQueue.splice(0).forEach(function(X){return O._send(X)}),this._sendHeartbeatTimeout=new l(function(){return O._sendHeartbeat()},$),this.transition("open")}else F.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.')},V.prototype._handleWelcomeTimeout=function(){if("connecting"===this.state){var D=this._log;if(this._hellosLeft<=0){var O="All handshake attempts failed";return D.warn("Closing: 3000 - "+O),void this._close({code:3e3,reason:O})}D.warn("Handshake attempt "+(this._options.maxConsecutiveFailedHellos-this._hellosLeft)+" failed"),this._startHandshake()}},V.prototype._send=function(D){if(this._ws.readyState===this._options.WebSocket.OPEN){var F=JSON.stringify(D);this._log.debug("Outgoing: "+F);try{this._ws.send(F),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch(q){var Q="Failed to send message";this._log.warn("Closing: 3003 - "+Q),this._close({code:3003,reason:Q})}}},V.prototype._sendHeartbeat=function(){"closed"!==this.state&&this._send({type:"heartbeat"})},V.prototype._sendHello=function(){var D=this._options,O=D.helloBody,T=D.requestedHeartbeatTimeout,F={id:e(),timeout:T,type:"hello",version:2};this._cookie&&(F.cookie=this._cookie),O&&(F.body=O),this._send(F)},V.prototype._sendOrEnqueue=function(D){var O=this;"closed"!==this.state&&("open"===this.state?function(F){return O._send(F)}:function(F){return O._messageQueue.push(F)})(D)},V.prototype._startHandshake=function(){var D=this;["early","waiting"].includes(this.state)&&this.transition("connecting"),"connecting"===this.state&&(this._hellosLeft--,this._sendHello(),this._welcomeTimeout=new l(function(){return D._handleWelcomeTimeout()},this._options.welcomeTimeout))},V.prototype.close=function(){"closed"!==this.state&&(this._sendOrEnqueue({type:"bye"}),this._close({code:1e3,reason:"Normal"}))},V.prototype.sendMessage=function(D){this._sendOrEnqueue({body:D,type:"msg"})},V}(s);ee.CloseReason=N,k.exports=ee},8264:(k,S,a)=>{"use strict";var d=a(3761).defer,p=function(){function o(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return o.prototype.put=function(s){this._hasValue=!0,this._value=s;var i=this._deferreds.shift();return i&&i.resolve(s),this},o.prototype.take=function(){var s=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=d();return this._deferreds.push(i),i.promise.then(function(t){return s._hasValue=!1,t})},o}();k.exports=p},1222:function(k){"use strict";var S=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y};k.exports={isAndroid:function(){return/Android/.test(navigator.userAgent)},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},isMobile:function(){return/Mobi/.test(navigator.userAgent)},isNonChromiumEdge:function(e){return"chrome"===e&&/Edge/.test(navigator.userAgent)&&("undefined"==typeof chrome||void 0===chrome.runtime)},mobileWebKitBrowser:function(e){return"safari"!==e?null:"brave"in navigator?"brave":["edge","edg"].find(function(r){return navigator.userAgent.toLowerCase().includes(r)})||null},rebrandedChromeBrowser:function(e){if("chrome"!==e)return null;if("brave"in navigator)return"brave";var l=function(e){for(var r=[],n=[],l=0;l<e.length;l++)if("("===e[l])r.push(l);else if(")"===e[l]&&r.length>0){var v=r.pop();0===r.length&&n.push(e.substring(v,l+1))}return n}(navigator.userAgent).reduce(function(m,f){return m.replace(f,"")},navigator.userAgent).match(/[^\s]+/g)||[];return S(l.map(function(m){return m.split("/")[0].toLowerCase()})).slice(2).find(function(m){return!["chrome","mobile","safari"].includes(m)})||null}}},617:function(k){"use strict";var S=this&&this.__read||function(p,o){var s="function"==typeof Symbol&&p[Symbol.iterator];if(!s)return p;var t,r,i=s.call(p),e=[];try{for(;(void 0===o||o-- >0)&&!(t=i.next()).done;)e.push(t.value)}catch(n){r={error:n}}finally{try{t&&!t.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}return e},a=this&&this.__spreadArray||function(p,o){for(var s=0,i=o.length,t=p.length;s<i;s++,t++)p[t]=o[s];return p},d=function(){function p(o,s){var i=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:s}}),Object.defineProperty(this,"_promise",{value:new Promise(function(t,e){o(function(r){i._isCancelable=!1,t(r)},function(r){i._isCancelable=!1,e(r)},function(){return i._isCanceled})})})}return p.reject=function(o){return new p(function(i,t){t(o)},function(){})},p.resolve=function(o){return new p(function(i){i(o)},function(){})},p.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},p.prototype.catch=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.catch.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p.prototype.then=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.then.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p.prototype.finally=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.finally.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p}();k.exports=d},9917:(k,S,a)=>{"use strict";var d=a(1730);k.exports.SDK_NAME=d.name+".js",k.exports.SDK_VERSION=d.version,k.exports.SDP_FORMAT="unified",k.exports.DEFAULT_ENVIRONMENT="prod",k.exports.DEFAULT_REALM="us1",k.exports.DEFAULT_REGION="gll",k.exports.DEFAULT_LOG_LEVEL="warn",k.exports.DEFAULT_LOGGER_NAME="twilio-video",k.exports.WS_SERVER=function(o,s){return s="gll"===s?"global":encodeURIComponent(s),"prod"===o?"wss://"+s+".vss.twilio.com/signaling":"wss://"+s+".vss."+o+".twilio.com/signaling"},k.exports.PUBLISH_MAX_ATTEMPTS=5,k.exports.PUBLISH_BACKOFF_JITTER=10,k.exports.PUBLISH_BACKOFF_MS=20,k.exports.typeErrors={ILLEGAL_INVOKE:function(o,s){return new TypeError("Illegal call to "+o+": "+s)},INVALID_TYPE:function(o,s){return new TypeError(o+" must be "+function(o){return["a","e","i","o","u"].includes(o.toLowerCase()[0])?"an":"a"}(s)+" "+s)},INVALID_VALUE:function(o,s){return new RangeError(o+" must be one of "+s.join(", "))},REQUIRED_ARGUMENT:function(o){return new TypeError(o+" must be specified")}},k.exports.DEFAULT_FRAME_RATE=24,k.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,k.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,k.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,k.exports.DEFAULT_NQ_LEVEL_LOCAL=1,k.exports.DEFAULT_NQ_LEVEL_REMOTE=0,k.exports.MAX_NQ_LEVEL=3,k.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,k.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,k.exports.iceRestartBackoffConfig={factor:1.1,initialDelay:1,maxDelay:1e3*k.exports.DEFAULT_SESSION_TIMEOUT_SEC,randomisationFactor:.5},k.exports.reconnectBackoffConfig={factor:1.5,initialDelay:80,randomisationFactor:.5},k.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},k.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},k.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},k.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},k.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}},3305:(k,S,a)=>{"use strict";var d=a(1923);k.exports=function(i){var t=a(9057),e={},r=t.getOrCreate(e),n=3;return function l(){return n--,d(r,i.srcObject,250).then(function(v){return!!v&&(!(n>0)||l())}).catch(function(){return!0})}().finally(function(){t.release(e)})}},4139:k=>{"use strict";var S=null;k.exports=function(t){return S=S||document.createElement("canvas"),new Promise(function(e){var r=3;setTimeout(function n(){return r--,function(t){try{var e=S.getContext("2d");e.drawImage(t,0,0,50,50);var n=e.getImageData(0,0,50,50).data.filter(function(v,y){return(y+1)%4});return 0===Math.max.apply(Math,n)}catch(v){return console.log("Error checking silence: ",v),!1}}(t)?r>0?setTimeout(n,250):e(!0):e(!1)},250)})}},296:k=>{"use strict";var S=function(){function a(d){var p=this;void 0===d&&(d=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){p._emitVisible("visible"===document.visibilityState)}}});for(var o=0;o<d;o++)this._listeners.push([])}return a.prototype.clear=function(){for(var d=this._listeners.length,p=0;p<d;p++)this._listeners[p]=[]},a.prototype._listenerCount=function(){return this._listeners.reduce(function(d,p){return d+p.length},0)},a.prototype._emitVisible=function(d){for(var p=this,o=Promise.resolve(),s=function(t){o=o.then(function(){return p._emitVisiblePhase(t,d)})},i=1;i<=this._listeners.length;i++)s(i);return o},a.prototype._emitVisiblePhase=function(d,p){return Promise.all(this._listeners[d-1].map(function(s){var i=s(p);return i instanceof Promise?i:Promise.resolve(i)}))},a.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},a.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},a.prototype.onVisibilityChange=function(d,p){if("number"!=typeof d||d<=0||d>this._listeners.length)throw new Error("invalid phase: ",d);return this._listeners[d-1].push(p),1===this._listenerCount()&&this._start(),this},a.prototype.offVisibilityChange=function(d,p){if("number"!=typeof d||d<=0||d>this._listeners.length)throw new Error("invalid phase: ",d);var o=this._listeners[d-1],s=o.indexOf(p);return-1!==s&&(o.splice(s,1),0===this._listenerCount()&&this._stop()),this},a}();k.exports=new S(2)},8326:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(3105).EventEmitter,o=["signaling","room","media","quality","video-processor","preflight"],s=["debug","error","info","warning"],i=function(t){function e(r,n,l,v){void 0===v&&(v=null);var y=t.call(this)||this;return y.on("event",function(m){var f=m.name,u=m.group,c=m.level,h=m.payload;if("string"!=typeof f)throw l.error("Unexpected name: ",f),new Error("Unexpected name: ",f);if(!o.includes(u))throw l.error("Unexpected group: ",u),new Error("Unexpected group: ",u);if(!s.includes(c))throw l.error("Unexpected level: ",c),new Error("Unexpected level: ",c);var P=Date.now(),C=P-n,b=Object.assign({elapsedTime:C,level:c},h||{});r.publish(u,f,b);var L=Object.assign({elapsedTime:C,group:u,level:c,name:f,timestamp:P},h?{payload:h}:{});l[{debug:"debug",error:"error",info:"info",warning:"warn"}[c]]("event",L),v&&"signaling"===u&&v.emit("event",L)}),y}return d(e,t),e}(p);k.exports=i},7060:k=>{"use strict";var S=function(){function a(d){d=Object.assign({getKey:function(o){return o},getValue:function(o){return o},isLessThanOrEqualTo:function(o,s){return o<=s}},d),Object.defineProperties(this,{_getKey:{value:d.getKey},_getValue:{value:d.getValue},_isLessThanOrEqualTo:{value:d.isLessThanOrEqualTo},_map:{value:new Map}})}return a.prototype.toMap=function(){return new Map(this._map)},a.prototype.updateAndFilter=function(d){return d.filter(this.update,this)},a.prototype.update=function(d){var p=this._getKey(d),o=this._getValue(d);return!(this._map.has(p)&&this._isLessThanOrEqualTo(o,this._map.get(p))||(this._map.set(p,o),0))},a}();k.exports=S},3761:function(k,S,a){"use strict";var Y,d=this&&this.__extends||(Y=function(te,re){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,E){W.__proto__=E}||function(W,E){for(var x in E)Object.prototype.hasOwnProperty.call(E,x)&&(W[x]=E[x])})(te,re)},function(te,re){if("function"!=typeof re&&null!==re)throw new TypeError("Class extends value "+String(re)+" is not a constructor or null");function W(){this.constructor=te}Y(te,re),te.prototype=null===re?Object.create(re):(W.prototype=re.prototype,new W)}),p=this&&this.__read||function(Y,te){var re="function"==typeof Symbol&&Y[Symbol.iterator];if(!re)return Y;var E,B,W=re.call(Y),x=[];try{for(;(void 0===te||te-- >0)&&!(E=W.next()).done;)x.push(E.value)}catch(z){B={error:z}}finally{try{E&&!E.done&&(re=W.return)&&re.call(W)}finally{if(B)throw B.error}}return x},o=this&&this.__spreadArray||function(Y,te){for(var re=0,W=te.length,E=Y.length;re<W;re++,E++)Y[E]=te[re];return Y},s=a(9917),i=s.typeErrors,t=s.trackPriority,e=a(4911),r=a(3187).sessionSID;function c(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"Unknown"}function w(Y,te,re,W){if(!(W in te)&&!W.match(/^on[a-z]+$/)){var E;try{E=typeof Y[W]}catch(x){}"function"===E&&(te[W]=function(){for(var x,B=[],z=0;z<arguments.length;z++)B[z]=arguments[z];return(x=this[re])[W].apply(x,o([],p(B)))})}}function A(Y){return"object"==typeof Y&&!Array.isArray(Y)}function J(Y){Object.getOwnPropertyNames(Y).forEach(function(te){te.startsWith("_")&&Z(Y,te)})}function Z(Y,te){var re=Object.getOwnPropertyDescriptor(Y,te);re.enumerable=!1,Object.defineProperty(Y,te,re)}function V(Y,te){void 0===te&&(te=[]),te.forEach(function(re){Y.hasOwnProperty(re)&&Z(Y,re)})}function D(Y){return Y.map(Q)}function Q(Y){return Array.isArray(Y)?D(Y):Y instanceof Set?function(Y){return D(o([],p(Y)))}(Y):Y instanceof Map?function(Y){return o([],p(Y.entries())).reduce(function(te,re){var W,E=p(re,2);return Object.assign(((W={})[E[0]]=Q(E[1]),W),te)},{})}(Y):Y&&"object"==typeof Y?function(Y){return Object.entries(Y).reduce(function(te,re){var W,E=p(re,2);return Object.assign(((W={})[E[0]]=Q(E[1]),W),te)},{})}(Y):Y}function X(Y){return ye(Y,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:de},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function ue(Y){return ye(Y,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function de(Y){return ye(Y,[{prop:t.PRIORITY_HIGH,type:"object",transform:ue},{prop:t.PRIORITY_LOW,type:"object",transform:ue},{prop:t.PRIORITY_STANDARD,type:"object",transform:ue}])}function ye(Y,te){return te.reduce(function(re,W){var E,x=W.prop,z=W.payloadProp,ge=W.transform;return typeof Y[x]===W.type?Object.assign(((E={})[void 0===z?x:z]=(void 0===ge?function(be){return be}:ge)(Y[x]),E),re):re},{})}S.constants=s,S.createBandwidthProfilePayload=function(Y){return ye(Y,[{prop:"video",type:"object",transform:X}])},S.createMediaSignalingPayload=function(Y,te,re,W,E,x){var B={transports:[{type:"data-channel"}]};return Object.assign(Y?{active_speaker:B}:{},te?{network_quality:B}:{},x?{render_hints:B}:{},E?{publisher_hints:B}:{},re?{track_priority:B}:{},W?{track_switch_off:B}:{})},S.createRoomConnectEventPayload=function(Y){function te(E){return E?"true":"false"}var re={sessionSID:r,iceServers:(Y.iceServers||[]).length,audioTracks:(Y.tracks||[]).filter(function(E){return"audio"===E.kind}).length,videoTracks:(Y.tracks||[]).filter(function(E){return"video"===E.kind}).length,dataTracks:(Y.tracks||[]).filter(function(E){return"data"===E.kind}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(E){var x=p(E,2),B=x[0],z=x[1];re[z=z||B]=te(!!Y[B])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(E){var x=p(E,2),B=x[0],z=x[1];z=z||B,"number"==typeof Y[B]?re[z]=Y[B]:isNaN(Number(Y[B]))||(re[z]=Number(Y[B]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(E){var x=p(E,2),B=x[0],z=x[1];z=z||B,"string"==typeof Y[B]?re[z]=Y[B]:"number"==typeof Y[B]&&"name"===B&&(re[z]=Y[B].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(E){E in Y&&(re[E]=JSON.stringify(Y[E]))}),"networkQuality"in Y&&(re.networkQualityConfiguration={},A(Y.networkQuality)?["local","remote"].forEach(function(E){"number"==typeof Y.networkQuality[E]&&(re.networkQualityConfiguration[E]=Y.networkQuality[E])}):(re.networkQualityConfiguration.remote=0,re.networkQualityConfiguration.local=Y.networkQuality?1:0)),Y.bandwidthProfile&&Y.bandwidthProfile.video){var W=Y.bandwidthProfile.video||{};re.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(E){"number"==typeof W[E]||"string"==typeof W[E]?re.bandwidthProfileOptions[E]=W[E]:"boolean"==typeof W[E]?re.bandwidthProfileOptions[E]=te(W[E]):"object"==typeof W[E]&&(re.bandwidthProfileOptions[E]=JSON.stringify(W[E]))})}return{group:"room",name:"connect",level:"info",payload:re}},S.createSubscribePayload=function(Y){return{rules:[{type:Y?"include":"exclude",all:!0}],revision:1}},S.asLocalTrack=function(Y,te){if(Y instanceof te.LocalAudioTrack||Y instanceof te.LocalVideoTrack||Y instanceof te.LocalDataTrack)return Y;if(Y instanceof te.MediaStreamTrack)return"audio"===Y.kind?new te.LocalAudioTrack(Y,te):new te.LocalVideoTrack(Y,te);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},S.asLocalTrackPublication=function(Y,te,re,W){return new(0,{audio:W.LocalAudioTrackPublication,video:W.LocalVideoTrackPublication,data:W.LocalDataTrackPublication}[Y.kind])(te,Y,re,W)},S.capitalize=function(Y){return Y[0].toUpperCase()+Y.slice(1)},S.deprecateEvents=function(Y,te,re,W){var E=new Set;te.on("newListener",function x(B){re.has(B)&&!E.has(B)&&(W.deprecated(Y+"#"+B+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(re.get(B)?" Use "+Y+"#"+re.get(B)+" instead.":"")),E.add(B)),E.size>=re.size&&te.removeListener("newListener",x)})},S.difference=function(Y,te){Y=Array.isArray(Y)?new Set(Y):new Set(Y.values()),te=Array.isArray(te)?new Set(te):new Set(te.values());var re=new Set;return Y.forEach(function(W){te.has(W)||re.add(W)}),re},S.filterObject=function(Y,te){return Object.keys(Y).reduce(function(re,W){return Y[W]!==te&&(re[W]=Y[W]),re},{})},S.flatMap=function(Y,te){var re=Y instanceof Map||Y instanceof Set?Array.from(Y.values()):Y;return te=te||function(E){return E},re.reduce(function(W,E){var x=te(E);return W.concat(x)},[])},S.getPlatform=function(){var Y=c(),re=p(Y.match(/\(([^)]+)\)/)||[],2)[1];return p((void 0===re?"unknown":re).split(";").map(function(B){return B.trim()}),1)[0].toLowerCase()},S.getUserAgent=c,S.hidePrivateProperties=J,S.hidePrivateAndCertainPublicPropertiesInClass=function(Y,te){return function(re){function W(){for(var E=[],x=0;x<arguments.length;x++)E[x]=arguments[x];var B=re.apply(this,o([],p(E)))||this;return J(B),V(B,te),B}return d(W,re),W}(Y)},S.isDeepEqual=function _(Y,te){if(Y===te)return!0;if(typeof Y!=typeof te)return!1;if(null===Y)return null===te;if(null===te)return!1;if(Array.isArray(Y))return Array.isArray(te)&&Y.length===te.length&&Y.every(function(E,x){return _(E,te[x])});if("object"==typeof Y){var re=Object.keys(Y).sort(),W=Object.keys(te).sort();return!Array.isArray(te)&&_(re,W)&&re.every(function(E){return _(Y[E],te[E])})}return!1},S.isNonArrayObject=A,S.inRange=function(Y,te,re){return te<=Y&&Y<=re},S.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Y){var te=16*Math.random()|0;return("x"===Y?te:3&te|8).toString(16)})},S.oncePerTick=function(Y){var te=null;function re(){te=null,Y()}return function(){te&&clearTimeout(te),te=setTimeout(re)}},S.promiseFromEvents=function(Y,te,re,W){return new Promise(function(E,x){function B(){var le=[].slice.call(arguments);W&&te.removeListener(W,z),E.apply(void 0,o([],p(le)))}function z(){var le=[].slice.call(arguments);te.removeListener(re,B),x.apply(void 0,o([],p(le)))}te.once(re,B),W&&te.once(W,z),Y()})},S.getOrNull=function(Y,te){return te.split(".").reduce(function(re,W){return re?re[W]:null},Y)},S.defer=function(){var Y={};return Y.promise=new Promise(function(te,re){Y.resolve=te,Y.reject=re}),Y},S.delegateMethods=function(Y,te,re){for(var W in Y)w(Y,te,re,W)},S.proxyProperties=function(Y,te,re){Object.getOwnPropertyNames(Y).forEach(function(W){!function(Y,te,re,W){if(!(W in te)){if(W.match(/^on[a-z]+$/))return Object.defineProperty(te,W,{value:null,writable:!0}),void re.addEventListener(W.slice(2),function(){for(var E=[],x=0;x<arguments.length;x++)E[x]=arguments[x];te.dispatchEvent.apply(te,o([],p(E)))});Object.defineProperty(te,W,{enumerable:!0,get:function(){return re[W]}})}}(0,te,re,W)})},S.legacyPromise=function(Y,te,re){return te?Y.then(function(W){te(W)},function(W){re(W)}):Y},S.buildLogLevels=function(Y){return"string"==typeof Y?{default:Y,media:Y,signaling:Y,webrtc:Y}:Y},S.trackClass=function(Y,te){return(te=te?"Local":"")+(Y.kind||"").replace(/\w{1}/,function(re){return re.toUpperCase()})+"Track"},S.trackPublicationClass=function(Y,te){return(te=te?"Local":"")+(Y.kind||"").replace(/\w{1}/,function(re){return re.toUpperCase()})+"TrackPublication"},S.valueToJSON=Q,S.withJitter=function(Y,te){var re=Math.random();return Y-te+Math.floor(2*te*re+.5)},S.isChromeScreenShareTrack=function(Y){return"chrome"===e.guessBrowser()&&"video"===Y.kind&&"displaySurface"in Y.getSettings()},S.isUserMediaTrack=function(Y){return"string"==typeof Y.getSettings().deviceId},S.waitForSometime=function(Y){return void 0===Y&&(Y=10),new Promise(function(te){return setTimeout(te,Y)})},S.waitForEvent=function(Y,te){return new Promise(function(re){Y.addEventListener(te,function W(E){Y.removeEventListener(te,W),re(E)})})}},3066:function(k,S,a){"use strict";var u,d=this&&this.__extends||(u=function(c,h){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,C){P.__proto__=C}||function(P,C){for(var b in C)Object.prototype.hasOwnProperty.call(C,b)&&(P[b]=C[b])})(c,h)},function(c,h){if("function"!=typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function P(){this.constructor=c}u(c,h),c.prototype=null===h?Object.create(h):(P.prototype=h.prototype,new P)}),p=a(3105).EventEmitter,o=a(3761).getUserAgent,e=global.window||global,r=e.WebSocket?e.WebSocket:a(6890),n=a(3761),l=function(u){function c(h,P,C,b,L,R){var w=u.call(this)||this;return R=Object.assign({gateway:y(b,L)+"/v1/VideoEvents",maxReconnectAttempts:5,reconnectIntervalMs:50,userAgent:o(),WebSocket:r},R),Object.defineProperties(w,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:n.defer()},_reconnectAttemptsLeft:{value:R.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:R.WebSocket}}),w._readyToConnect.promise.then(function(g){var _=g.roomSid,A=g.participantSid,I=w;w.on("disconnected",function M(j){if(I._session=null,j&&I._reconnectAttemptsLeft>0)return I.emit("reconnecting"),void function(u,c,h,P,C,b,L){var R=Date.now()-u._connectTimestamp,w=L.reconnectIntervalMs-R;w>0?setTimeout(function(){v(u,c,h,P,C,b,L)},w):v(u,c,h,P,C,b,L)}(I,h,P,C,_,A,R);I.removeListener("disconnected",M)}),v(w,h,P,C,_,A,R)}).catch(function(){}),w}return d(c,u),c.prototype.connect=function(h,P){this._readyToConnect.resolve({roomSid:h,participantSid:P})},c.prototype._publish=function(h){h.session=this._session,this._ws.send(JSON.stringify(h))},c.prototype.disconnect=function(){if(null===this._ws||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch(h){}return this.emit("disconnected"),!0},c.prototype.publish=function(h,P,C){return(null===this._ws||this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED)&&(("string"==typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:h,name:P,payload:C,timestamp:Date.now(),type:"event",version:1}),!0)},c}(p);function v(u,c,h,P,C,b,L){u._connectTimestamp=Date.now(),u._reconnectAttemptsLeft--,u._ws=new L.WebSocket(L.gateway);var R=u._ws;R.addEventListener("close",function(w){1e3!==w.code?u.emit("disconnected",new Error("WebSocket Error "+w.code+": "+w.reason)):u.emit("disconnected")}),R.addEventListener("message",function(w){!function(u,c,h){switch(c.type){case"connected":u._session=c.session,u._reconnectAttemptsLeft=h.maxReconnectAttempts,u._eventQueue.splice(0).forEach(u._publish,u),u.emit("connected");break;case"error":u._ws.close(),u.emit("disconnected",new Error(c.message))}}(u,JSON.parse(w.data),L)}),R.addEventListener("open",function(){var w={type:"connect",token:c,version:1};w.publisher={name:h,sdkVersion:P,userAgent:L.userAgent,participantSid:b,roomSid:C},R.send(JSON.stringify(w))})}function y(u,c){return"prod"===u?"wss://sdkgw."+c+".twilio.com":"wss://sdkgw."+u+"-"+c+".twilio.com"}k.exports=l},7217:k=>{"use strict";var S=function(){function a(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return a.prototype.connect=function(){},a.prototype.disconnect=function(){return!!this._connected&&(this._connected=!1,!0)},a.prototype.publish=function(){return this._connected},a}();k.exports=S},9388:(k,S,a)=>{"use strict";var d=a(3761).defer,p=function(){function o(){Object.defineProperties(this,{_audio:{value:d(),writable:!0},_video:{value:d(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return o.prototype.resolveDeferred=function(s){"audio"===s?this._audio.resolve():this._video.resolve()},o.prototype.startDeferred=function(s){"audio"===s?this._audio=d():this._video=d()},o.prototype.whenResolved=function(s){return"audio"===s?this._audio.promise:this._video.promise},o}();k.exports=new p},7394:function(k,S,a){"use strict";var r,d=this&&this.__read||function(c,h){var P="function"==typeof Symbol&&c[Symbol.iterator];if(!P)return c;var b,R,C=P.call(c),L=[];try{for(;(void 0===h||h-- >0)&&!(b=C.next()).done;)L.push(b.value)}catch(w){R={error:w}}finally{try{b&&!b.done&&(P=C.return)&&P.call(C)}finally{if(R)throw R.error}}return L},p=this&&this.__spreadArray||function(c,h){for(var P=0,C=h.length,b=c.length;P<C;P++,b++)c[b]=h[P];return c},o=a(6828).getLogger,s=a(9917),i=s.DEFAULT_LOG_LEVEL,t=s.DEFAULT_LOGGER_NAME,e=a(9917).typeErrors,l=function(){function c(h,P,C,b,L){if("string"!=typeof h)throw e.INVALID_TYPE("moduleName","string");if(!P)throw e.REQUIRED_ARGUMENT("component");"object"!=typeof C&&(C={}),L=L||o,u(C),Object.defineProperties(this,{_component:{value:P},_logLevels:{value:C},_warnings:{value:new Set},_loggerName:{get:function(){var w=b&&"string"==typeof b?b:t;return this._logLevelsEqual||(w=w+"-"+h),w}},_logger:{get:function(){var w=L(this._loggerName),g=this._logLevels[h]||i;return w.setDefaultLevel(g="off"===g?"silent":g),w}},_logLevelsEqual:{get:function(){return 1===new Set(Object.values(this._logLevels)).size}},logLevel:{get:function(){return c.getLevelByName(C[h]||i)}},name:{get:P.toString.bind(P)}})}return c.getLevelByName=function(h){return isNaN(h)?(f(h=h.toUpperCase()),c[h]):parseInt(h,10)},c.prototype.createLog=function(h,P){var C=this._loggerName;return this._logLevelsEqual||(C=C.substring(0,C.lastIndexOf("-"))),new c(h,P,this._logLevels,C)},c.prototype.setLevels=function(h){return u(h),Object.assign(this._logLevels,h),this},c.prototype.log=function(h,P){var C=c._levels[h];if(!C)throw e.INVALID_VALUE("logLevel",y);C=C.toLowerCase();var b=[(new Date).toISOString(),C,this.name];return(this._logger[C]||function(){}).apply(void 0,p([],d(b.concat(P)))),this},c.prototype.debug=function(){return this.log(c.DEBUG,[].slice.call(arguments))},c.prototype.deprecated=function(h){var P=function(c){if((r=r||new Map).has(c))return r.get(c);var h=new Set;return r.set(c,h),h}(this._component.constructor);return P.has(h)?this:(P.add(h),this.warn(h))},c.prototype.info=function(){return this.log(c.INFO,[].slice.call(arguments))},c.prototype.warn=function(){return this.log(c.WARN,[].slice.call(arguments))},c.prototype.warnOnce=function(h){return this._warnings.has(h)?this:(this._warnings.add(h),this.warn(h))},c.prototype.error=function(){return this.log(c.ERROR,[].slice.call(arguments))},c.prototype.throw=function(h,P){throw h.clone&&(h=h.clone(P)),this.log(c.ERROR,h),h},c}();Object.defineProperties(l,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var v={},y=[],m=l._levels.map(function(c,h){return v[c]=!0,y.push(h),c});function f(c){if(!(c in v))throw e.INVALID_VALUE("level",m)}function u(c){Object.keys(c).forEach(function(h){f(c[h].toUpperCase())})}k.exports=l},2100:k=>{"use strict";var S=function(){function a(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return a.prototype.get=function(){var d=this._samples;return(d[1].numerator-d[0].numerator)/(d[1].denominator-d[0].denominator||1/0)},a.prototype.putSample=function(d,p){var o=this._samples;o.shift(),o.push({denominator:p,numerator:d})},a}();k.exports=S},4189:k=>{"use strict";var S=function(){function a(d,p){var o=this,s=(p=Object.assign({navigator,window},p)).navigator,i=s.connection||{type:null},t=i.type,e=i.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var v=t!==o.type&&o.isOnline;t=o.type,v&&d()}},_target:{value:i}}:{_events:{value:["online"]},_listener:{value:d},_target:{value:p.window}};Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return"boolean"!=typeof s.onLine||s.onLine}},type:{enumerable:!0,get:function(){return i.type||null}},_listener:e._listener,_events:e._events,_target:e._target})}return a.prototype.start=function(){var d=this;this._events.forEach(function(p){d._target.addEventListener(p,d._listener)})},a.prototype.stop=function(){var d=this;this._events.forEach(function(p){d._target.removeEventListener(p,d._listener)})},a}();k.exports=S},5092:function(k){"use strict";var o,S=this&&this.__extends||(o=function(s,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(s,i)},function(s,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=s}o(s,i),s.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}),a=function(){function o(s){Object.defineProperties(this,{_callback:{value:s}})}return o.prototype.observe=function(){},o.prototype.unobserve=function(){},o.prototype.makeVisible=function(s){var i=this._makeFakeEntry(s,!0);this._callback([i])},o.prototype.makeInvisible=function(s){var i=this._makeFakeEntry(s,!1);this._callback([i])},o.prototype._makeFakeEntry=function(s,i){return{target:s,isIntersecting:i}},o}(),d=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return S(s,o),s}(a),p=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return S(s,o),s.prototype.resize=function(i){var t=this._makeFakeEntry(i,!0);this._callback([t])},s}(a);k.exports={NullIntersectionObserver:d,NullResizeObserver:p,NullObserver:a}},3028:function(k,S,a){"use strict";var d=this&&this.__read||function(M,j){var H="function"==typeof Symbol&&M[Symbol.iterator];if(!H)return M;var N,ee,U=H.call(M),J=[];try{for(;(void 0===j||j-- >0)&&!(N=U.next()).done;)J.push(N.value)}catch(Z){ee={error:Z}}finally{try{N&&!N.done&&(H=U.return)&&H.call(U)}finally{if(ee)throw ee.error}}return J},p=a(3761),o=p.difference,s=p.flatMap,i=a(8726),t={0:"PCMU",8:"PCMA"};function e(M){return Array.from(n(M)).reduce(function(j,H){var U=H[0],N=H[1],J=j.get(N)||[];return j.set(N,J.concat(U))},new Map)}function r(M){return y(M).reduce(function(j,H){var U=v(H);return U?j.set(U,H):j},new Map)}function n(M){return m(M).reduce(function(j,H){var U=new RegExp("a=rtpmap:"+H+" ([^/]+)"),N=M.match(U),J=N?N[1].toLowerCase():t[H]?t[H].toLowerCase():"";return j.set(H,J)},new Map)}function l(M,j){var H=new RegExp("^a=fmtp:"+M+" (.+)$","m"),U=j.match(H);return U&&U[1].split(";").reduce(function(N,J){var ee=d(J.split("="),2),V=ee[1];return N[ee[0]]=isNaN(V)?V:parseInt(V,10),N},{})}function v(M){var j=M.match(/^a=mid:(.+)$/m);return j&&j[1]}function y(M,j,H){return M.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(U){return"m="+U}).filter(function(U){var N=new RegExp("m="+(j||".*"),"gm"),J=new RegExp("a="+(H||".*"),"gm");return N.test(U)&&J.test(U)})}function m(M){var H=M.split("\r\n")[0].match(/([0-9]+)/g);return H?H.slice(1).map(function(U){return parseInt(U,10)}):[]}function u(M,j){var H=j.split("\r\n"),U=H[0],N=H.slice(1);return[U=U.replace(/([0-9]+\s?)+$/,M.join(" "))].concat(N).join("\r\n")}function w(M,j){var H=y(M);return[M.split("\r\nm=")[0]].concat(H.map(function(N){if(!/^m=(audio|video)/.test(N))return N;var J=v(N);if(!J)return N;var ee=j.get(J);if(!ee)return N;var Z=(N.match(/^a=msid:(.+)$/m)||[])[1];if(!Z)return N;var V=d(Z.split(" "),2),D=V[0],O=V[1],T=new RegExp("msid:"+D+(O?" "+O:"")+"$","gm");return N.replace(T,"msid:"+D+" "+ee)})).join("\r\n")}function A(M,j){return"a=fmtp:"+M+" "+Object.entries(j).map(function(U){var N=d(U,2);return N[0]+"="+N[1]}).join(";")}S.addOrRewriteNewTrackIds=function(M,j,H){var U=Array.from(H).reduce(function(N,J){var ee=d(J,2),V=ee[1];return y(M,ee[0],"send(only|recv)").map(v).filter(function(T){return!j.has(T)}).forEach(function(T,F){return N.set(T,V[F])}),N},new Map);return w(M,U)},S.addOrRewriteTrackIds=w,S.createCodecMapForMediaSection=e,S.createPtToCodecName=n,S.disableRtx=function(M){var j=y(M);return[M.split("\r\nm=")[0]].concat(j.map(function(U){if(!/^m=video/.test(U))return U;var J=e(U).get("rtx");if(!J)return U;var ee=new Set(m(U));J.forEach(function(O){return ee.delete(O)});var Z=U.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),V=Z&&Z[1],D=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(V?[new RegExp("^a=ssrc:"+V+" .+$")]:[]);return U=U.split("\r\n").filter(function(O){return D.every(function(T){return!T.test(O)})}).join("\r\n"),u(Array.from(ee),U)})).join("\r\n")},S.enableDtxForOpus=function(M,j){var H=y(M),U=M.split("\r\nm=")[0];return j=j||H.filter(function(N){return/^m=audio/.test(N)}).map(v),[U].concat(H.map(function(N){if(!/^m=audio/.test(N))return N;var ee=e(N).get("opus");if(!ee)return N;var Z=l(ee,N);if(!Z)return N;var V=A(ee,Z),D=new RegExp(V),O=v(N);j.includes(O)?Z.usedtx=1:delete Z.usedtx;var T=A(ee,Z);return N.replace(D,T)})).join("\r\n")},S.filterLocalCodecs=function(M,j){var H=y(M),U=M.split("\r\nm=")[0],N=r(j);return[U].concat(H.map(function(J){return function(M,j,H){if(!/^m=(audio|video)/.test(M))return M;var U=v(M),N=U&&j.get(U);if(!N)return M;var J=n(N),ee=e(M),Z=s(Array.from(J),function(T){var F=d(T,2),Q=F[0],q=F[1];return"rtx"===q||H.includes(q)?[]:function(M,j,H,U,N){var J=H.get(M)||[];if(J.length<=1)return J;var ee=l(j,N);if(!ee)return J;var Z=J.find(function(V){var D=l(V,U);return D&&Object.keys(ee).every(function(O){return ee[O]===D[O]})});return"number"==typeof Z?[Z]:J}(q,Q,ee,M,N)}),V=ee.get("rtx")||[];Z=Z.concat(V.filter(function(T){var F=l(T,M);return F&&Z.includes(F.apt)}));var D=M.split("\r\n").filter(function(T){var F=T.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),Q=F&&F[2];return!F||Q&&Z.includes(parseInt(Q,10))});return u(m(M).filter(function(T){return Z.includes(T)}),D.join("\r\n"))}(J,N,[])})).join("\r\n")},S.getMediaSections=y,S.removeSSRCAttributes=function(M,j){return M.split("\r\n").filter(function(H){return!j.find(function(U){return new RegExp("a=ssrc:.*"+U+":","g").test(H)})}).join("\r\n")},S.revertSimulcast=function(M,j,H,U){void 0===U&&(U=!1);var N=r(H),J=r(j),ee=y(M);return[M.split("\r\nm=")[0]].concat(ee.map(function(V){if(V=V.replace(/\r\n$/,""),!/^m=video/.test(V))return V;var D=V.match(/^a=mid:(.+)$/m),O=D&&D[1];if(!O)return V;var T=N.get(O),F=n(T),Q=m(T),q=Q.length&&"vp8"===F.get(Q[0]);return U||!q?J.get(O).replace(/\r\n$/,""):V})).concat("").join("\r\n")},S.setCodecPreferences=function(M,j,H){var U=y(M);return[M.split("\r\nm=")[0]].concat(U.map(function(J){if(!/^m=(audio|video)/.test(J))return J;var ee=J.match(/^m=(audio|video)/)[1],Z=e(J),D=function(M,j){j=j.map(function(J){return J.codec.toLowerCase()});var H=s(j,function(J){return M.get(J)||[]}),U=o(Array.from(M.keys()),j),N=s(U,function(J){return M.get(J)});return H.concat(N)}(Z,"audio"===ee?j:H),O=u(D,J),T=Z.get("pcma")||[],F=Z.get("pcmu")||[];return("audio"===ee?new Set(T.concat(F)):new Set).has(D[0])?O.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):O})).join("\r\n")},S.setSimulcast=function(M,j){var H=y(M);return[M.split("\r\nm=")[0]].concat(H.map(function(N){if(N=N.replace(/\r\n$/,""),!/^m=video/.test(N))return N;var J=e(N),ee=m(N),Z=new Set(J.get("vp8")||[]);return ee.some(function(D){return Z.has(D)})?i(N,j):N})).concat("").join("\r\n")}},556:(k,S,a)=>{"use strict";var d=a(4135).RTCSessionDescription,p=a(3028),o=p.createPtToCodecName,s=p.getMediaSections;function e(u){var c=o(u);u=function(u,c){return Array.from(c.keys()).reduce(function(h,P){var C=new RegExp("^a=rtpmap:"+P+" rtx.+$","gm");return(h.match(C)||[]).slice("rtx"===c.get(P)?1:0).reduce(function(b,L){var R=new RegExp("\r\n"+L),w=new RegExp("\r\na=fmtp:"+P+" apt=[0-9]+");return b.replace(R,"").replace(w,"")},h)},u)}(u,c);var h=function(u){var c=new Map;return u.forEach(function(h,P){var C=c.get(h)||new Set;return c.set(h,C.add(P))}),c}(c),P=h.get("rtx")||new Set,C=new Set,L=function(u,c){var h=Array.from(u).reduce(function(P,C){var b=C[0],L=C[1],R=P.get(L)||new Set;return P.set(L,R.add(b))},new Map);return Array.from(h).reduce(function(P,C){var b=C[0],L=Array.from(C[1]);return L.length>1?(L.forEach(function(R){c.add(R)}),P):P.set(b,L[0])},new Map)}(function(u,c,h,P){return Array.from(h).reduce(function(C,b){var L=new RegExp("a=fmtp:"+b+" apt=(\\d+)"),R=u.match(L);if(!R)return P.add(b),C;var w=Number.parseInt(R[1]);return c.has(w)?"rtx"===c.get(w)?(P.add(b),C):C.set(b,w):(P.add(b),C)},new Map)}(u,c,P,C),C),R=Array.from(C);return["h264","vp8","vp9"].reduce(function(_,A){var I=h.get(A)||new Set;return Array.from(I).reduce(function(M,j){return L.has(j)?M:M.add(j)},_)},new Set).forEach(function(_){if(R.length){var A=R.shift();u=function(u,c,h){return u.endsWith("\r\n")?u+"a=fmtp:"+c+" apt="+h+"\r\n":u+"\r\na=fmtp:"+c+" apt="+h}(u=y(u,A),A,_)}}),R.forEach(function(_){u=function(u,c){var h=new RegExp("a=rtpmap:"+c+".*\r\n","gm");return u.replace(h,"")}(u=y(u,_),_)}),u}function y(u,c){var h=new RegExp("a=fmtp:"+c+".*\r\n","gm");return u.replace(h,"")}k.exports=function(u){var c={type:u.type};return"rollback"!==u.type&&(c.sdp=function(u){var c=s(u);return[u.split("\r\nm=")[0]].concat(c.map(e)).join("\r\n")}(u.sdp)),new d(c)}},8726:function(k,S,a){"use strict";var d=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,b,h=c.call(f),C=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)C.push(P.value)}catch(L){b={error:L}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(b)throw b.error}}return C},p=a(3761),o=p.difference,s=p.flatMap;function i(){return String(Math.floor(4294967295*Math.random()))}var t=function(){function f(u,c,h){Object.defineProperties(this,{cName:{enumerable:!0,value:h},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:c},trackId:{enumerable:!0,value:u}})}return f.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var u=[i(),i()];u.forEach(function(c){this.primarySSRCs.add(c)},this),this.rtxPairs.size&&u.forEach(function(c){this.rtxPairs.set(i(),c)},this)}},f.prototype.addSSRC=function(u,c,h){c?this.rtxPairs.set(u,c):this.primarySSRCs.add(u),this.isSimulcastEnabled=this.isSimulcastEnabled||h},f.prototype.toSdpLines=function(u){var c=this,h=u?[]:Array.from(this.rtxPairs.entries()).map(function(w){return w.reverse()}),P=Array.from(this.primarySSRCs.values()),C=h.length?s(h):P,b=s(C,function(w){return["a=ssrc:"+w+" cname:"+c.cName,"a=ssrc:"+w+" msid:"+c.streamId+" "+c.trackId]}),L=h.map(function(w){return"a=ssrc-group:FID "+w.join(" ")}),R=["a=ssrc-group:SIM "+P.join(" ")];return L.concat(b).concat(R)},f}();function e(f,u){return(f.match(new RegExp(u,"gm"))||[]).map(function(h){return(h.match(new RegExp(u))||[]).slice(1)})}k.exports=function(f,u){var c=function(f){var u=function(f){return new Set(s(e(f,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(f),c=function(f){return new Map(e(f,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map(function(c){return c.reverse()}))}(f);return function(f){var u=d(s(e(f,"^a=msid:(.+) (.+)$")),2),c=u[0],h=u[1];return s(e(f,"^a=ssrc:(.+) cname:.+$")).map(function(C){return[C,c,h]})}(f).reduce(function(P,C){var b=C[0],L=C[1],R=C[2],w=P.get(R)||new t(R,L,function(f,u,c){return f.match(new RegExp("a=ssrc:"+u+" cname:(.+)"))[1]}(f,b)),g=c.get(b)||null;return w.addSSRC(b,g,u.has(b)),P.set(R,w)},new Map)}(f),h=Array.from(c.keys()),P=Array.from(u.keys()),C=o(h,P),b=o(P,h);s(C,function(M){return c.get(M)}).forEach(function(M){M.addSimulcastSSRCs(),u.set(M.trackId,M)}),P=Array.from(u.keys());var R=o(P,b),w=s(R,function(M){return u.get(M)}),g=!f.match(/a=rtpmap:[0-9]+ rtx/),_=s(w,function(M){return M.toSdpLines(g)}),A=s(new Set(f.split("\r\n").concat(_))),I="a=x-google-flag:conference";return f.match(I)||A.push(I),A.join("\r\n")}},5612:(k,S,a)=>{"use strict";var d=a(3028).getMediaSections,p=function(){function o(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return o.prototype.match=function(s){return this._midsToTrackIds.get(s.transceiver.mid)||null},o.prototype.update=function(s){var i=d(s,"(audio|video)");this._midsToTrackIds=i.reduce(function(t,e){var r=e.match(/^a=mid:(.+)$/m)||[],n=e.match(/^a=msid:.+ (.+)$/m)||[],l=r[1],v=n[1];return l&&v?t.set(l,v):t},this._midsToTrackIds)},o}();k.exports=p},3187:(k,S)=>{var a="1234567890abcdef";function p(o){for(var s="",i=0;i<32;i++)s+=a.charAt(Math.floor(Math.random()*a.length));return""+o+s}S.sessionSID=p("SS"),S.createSID=p},563:(k,S,a)=>{"use strict";var d=a(4911),p=d.guessBrowser,o=d.support,s=a(1222),i=s.isAndroid,t=s.isMobile,e=s.isNonChromiumEdge,r=s.rebrandedChromeBrowser,n=s.mobileWebKitBrowser,l=["crios","edg","edge","electron","headlesschrome"],v=["chrome","firefox"],y=["chrome","safari"],m=[];k.exports=function(){var u=p();if(!u)return!1;var c=r(u),h=n(u),P=i()?v:y;return!!u&&o()&&(!c||l.includes(c))&&!e(u)&&(!h||m.includes(h))&&(!t()||P.includes(u))}},1190:k=>{"use strict";var S=function(){function a(d,p,o){void 0===o&&(o=!0),Object.defineProperties(this,{_delay:{value:p,writable:!0},_fn:{value:d},_timeout:{value:null,writable:!0}}),o&&this.start()}return Object.defineProperty(a.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),a.prototype.setDelay=function(d){this._delay=d},a.prototype.start=function(){var d=this;this.isSet||(this._timeout=setTimeout(function(){var p=d._fn;d.clear(),p()},this._delay))},a.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},a.prototype.reset=function(){this.clear(),this.start()},a}();k.exports=S},7061:function(k,S,a){"use strict";var W,d=this&&this.__extends||(W=function(E,x){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,z){B.__proto__=z}||function(B,z){for(var le in z)Object.prototype.hasOwnProperty.call(z,le)&&(B[le]=z[le])})(E,x)},function(E,x){if("function"!=typeof x&&null!==x)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function B(){this.constructor=E}W(E,x),E.prototype=null===x?Object.create(x):(B.prototype=x.prototype,new B)}),p=a(8208),o={};S.createTwilioError=function(E,x){return x="string"==typeof x&&x?x:"Unknown error",o[E="number"==typeof E?E:0]?new o[E]:new p(E,x)};var s=function(W){function E(){var x=W.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenInvalidError=s,Object.defineProperty(o,20101,{value:s});var i=function(W){function E(){var x=W.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenHeaderInvalidError=i,Object.defineProperty(o,20102,{value:i});var t=function(W){function E(){var x=W.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenIssuerInvalidError=t,Object.defineProperty(o,20103,{value:t});var e=function(W){function E(){var x=W.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenExpiredError=e,Object.defineProperty(o,20104,{value:e});var r=function(W){function E(){var x=W.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenNotYetValidError=r,Object.defineProperty(o,20105,{value:r});var n=function(W){function E(){var x=W.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenGrantsInvalidError=n,Object.defineProperty(o,20106,{value:n});var l=function(W){function E(){var x=W.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.AccessTokenSignatureInvalidError=l,Object.defineProperty(o,20107,{value:l});var v=function(W){function E(){var x=W.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingConnectionError=v,Object.defineProperty(o,53e3,{value:v});var y=function(W){function E(){var x=W.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingConnectionDisconnectedError=y,Object.defineProperty(o,53001,{value:y});var m=function(W){function E(){var x=W.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingConnectionTimeoutError=m,Object.defineProperty(o,53002,{value:m});var f=function(W){function E(){var x=W.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingIncomingMessageInvalidError=f,Object.defineProperty(o,53003,{value:f});var u=function(W){function E(){var x=W.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingOutgoingMessageInvalidError=u,Object.defineProperty(o,53004,{value:u});var c=function(W){function E(){var x=W.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.SignalingServerBusyError=c,Object.defineProperty(o,53006,{value:c});var h=function(W){function E(){var x=W.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomNameInvalidError=h,Object.defineProperty(o,53100,{value:h});var P=function(W){function E(){var x=W.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomNameTooLongError=P,Object.defineProperty(o,53101,{value:P});var C=function(W){function E(){var x=W.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomNameCharsInvalidError=C,Object.defineProperty(o,53102,{value:C});var b=function(W){function E(){var x=W.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomCreateFailedError=b,Object.defineProperty(o,53103,{value:b});var L=function(W){function E(){var x=W.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomConnectFailedError=L,Object.defineProperty(o,53104,{value:L});var R=function(W){function E(){var x=W.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomMaxParticipantsExceededError=R,Object.defineProperty(o,53105,{value:R});var w=function(W){function E(){var x=W.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomNotFoundError=w,Object.defineProperty(o,53106,{value:w});var g=function(W){function E(){var x=W.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomMaxParticipantsOutOfRangeError=g,Object.defineProperty(o,53107,{value:g});var _=function(W){function E(){var x=W.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomTypeInvalidError=_,Object.defineProperty(o,53108,{value:_});var A=function(W){function E(){var x=W.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomTimeoutOutOfRangeError=A,Object.defineProperty(o,53109,{value:A});var I=function(W){function E(){var x=W.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomStatusCallbackMethodInvalidError=I,Object.defineProperty(o,53110,{value:I});var M=function(W){function E(){var x=W.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomStatusCallbackInvalidError=M,Object.defineProperty(o,53111,{value:M});var j=function(W){function E(){var x=W.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomStatusInvalidError=j,Object.defineProperty(o,53112,{value:j});var H=function(W){function E(){var x=W.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomRoomExistsError=H,Object.defineProperty(o,53113,{value:H});var U=function(W){function E(){var x=W.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomInvalidParametersError=U,Object.defineProperty(o,53114,{value:U});var N=function(W){function E(){var x=W.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomMediaRegionInvalidError=N,Object.defineProperty(o,53115,{value:N});var J=function(W){function E(){var x=W.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomMediaRegionUnavailableError=J,Object.defineProperty(o,53116,{value:J});var ee=function(W){function E(){var x=W.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomSubscriptionOperationNotSupportedError=ee,Object.defineProperty(o,53117,{value:ee});var Z=function(W){function E(){var x=W.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomCompletedError=Z,Object.defineProperty(o,53118,{value:Z});var V=function(W){function E(){var x=W.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomAudioOnlyFlagNotSupportedError=V,Object.defineProperty(o,53124,{value:V});var D=function(W){function E(){var x=W.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.RoomTrackKindNotSupportedError=D,Object.defineProperty(o,53125,{value:D});var O=function(W){function E(){var x=W.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantIdentityInvalidError=O,Object.defineProperty(o,53200,{value:O});var T=function(W){function E(){var x=W.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantIdentityTooLongError=T,Object.defineProperty(o,53201,{value:T});var F=function(W){function E(){var x=W.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantIdentityCharsInvalidError=F,Object.defineProperty(o,53202,{value:F});var Q=function(W){function E(){var x=W.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantMaxTracksExceededError=Q,Object.defineProperty(o,53203,{value:Q});var q=function(W){function E(){var x=W.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantNotFoundError=q,Object.defineProperty(o,53204,{value:q});var $=function(W){function E(){var x=W.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ParticipantDuplicateIdentityError=$,Object.defineProperty(o,53205,{value:$});var X=function(W){function E(){var x=W.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackInvalidError=X,Object.defineProperty(o,53300,{value:X});var ae=function(W){function E(){var x=W.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackNameInvalidError=ae,Object.defineProperty(o,53301,{value:ae});var ue=function(W){function E(){var x=W.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackNameTooLongError=ue,Object.defineProperty(o,53302,{value:ue});var de=function(W){function E(){var x=W.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackNameCharsInvalidError=de,Object.defineProperty(o,53303,{value:de});var ye=function(W){function E(){var x=W.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackNameIsDuplicatedError=ye,Object.defineProperty(o,53304,{value:ye});var he=function(W){function E(){var x=W.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.TrackServerTrackCapacityReachedError=he,Object.defineProperty(o,53305,{value:he});var ve=function(W){function E(){var x=W.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaClientLocalDescFailedError=ve,Object.defineProperty(o,53400,{value:ve});var pe=function(W){function E(){var x=W.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaServerLocalDescFailedError=pe,Object.defineProperty(o,53401,{value:pe});var we=function(W){function E(){var x=W.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaClientRemoteDescFailedError=we,Object.defineProperty(o,53402,{value:we});var Se=function(W){function E(){var x=W.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaServerRemoteDescFailedError=Se,Object.defineProperty(o,53403,{value:Se});var ke=function(W){function E(){var x=W.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaNoSupportedCodecError=ke,Object.defineProperty(o,53404,{value:ke});var oe=function(W){function E(){var x=W.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaConnectionError=oe,Object.defineProperty(o,53405,{value:oe});var Y=function(W){function E(){var x=W.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.MediaDTLSTransportFailedError=Y,Object.defineProperty(o,53407,{value:Y});var te=function(W){function E(){var x=W.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ConfigurationAcquireFailedError=te,Object.defineProperty(o,53500,{value:te});var re=function(W){function E(){var x=W.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(x,E.prototype),x}return d(E,W),E}(p);S.ConfigurationAcquireTurnFailedError=re,Object.defineProperty(o,53501,{value:re})},8208:function(k){"use strict";var o,S=this&&this.__extends||(o=function(s,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(s,i)},function(s,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=s}o(s,i),s.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}),a=this&&this.__read||function(o,s){var i="function"==typeof Symbol&&o[Symbol.iterator];if(!i)return o;var e,n,t=i.call(o),r=[];try{for(;(void 0===s||s-- >0)&&!(e=t.next()).done;)r.push(e.value)}catch(l){n={error:l}}finally{try{e&&!e.done&&(i=t.return)&&i.call(t)}finally{if(n)throw n.error}}return r},d=this&&this.__spreadArray||function(o,s){for(var i=0,t=s.length,e=o.length;i<t;i++,e++)o[e]=s[i];return o},p=function(o){function s(i){var t=this,e=[].slice.call(arguments,1);t=o.apply(this,d([],a(e)))||this,Object.setPrototypeOf(t,s.prototype);var r=Error.apply(t,e);return r.name="TwilioError",Object.defineProperty(t,"code",{value:i,enumerable:!0}),Object.getOwnPropertyNames(r).forEach(function(n){Object.defineProperty(this,n,{value:r[n],enumerable:!0})},t),t}return S(s,o),s.prototype.toString=function(){return this.name+" "+this.code+(this.message?": "+this.message:"")},s}(Error);k.exports=p},6901:(k,S,a)=>{"use strict";var p=a(3761).isNonArrayObject,o=a(9917),s=o.typeErrors,i=o.clientTrackSwitchOffControl,t=o.videoContentPreferencesMode,e=o.subscriptionMode,r=o.trackPriority,n=o.trackSwitchOffMode;function y(f,u,c){return void 0===c&&(c=[]),void 0===f?null:null!==f&&p(f)?c.reduce(function(h,P){var C=P.prop,b=P.type,L=P.values;if(h||!(C in f))return h;var R=f[C];return b&&typeof R!==b||"number"===b&&isNaN(R)?s.INVALID_TYPE(u+"."+C,b):Array.isArray(L)&&!L.includes(R)?s.INVALID_VALUE(u+"."+C,L):h},null):s.INVALID_TYPE(u,"object")}S.kG=function(f){var u=y(f,"options.bandwidthProfile");return!f||u||(u=y(f.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(t)},{prop:"dominantSpeakerPriority",values:Object.values(r)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(i)},{prop:"trackSwitchOffMode",values:Object.values(n)}]))?u:f.video?"maxTracks"in f.video&&"clientTrackSwitchOffControl"in f.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in f.video&&"contentPreferencesMode"in f.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):function(f){var u="options.bandwidthProfile.video.renderDimensions",c=y(f,u);return f?c||Object.values(r).reduce(function(h,P){return h||y(f[P],u+"."+P,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):c}(f.video.renderDimensions):null},S.Wv=function(f,u){if(!(f instanceof u.LocalAudioTrack||f instanceof u.LocalDataTrack||f instanceof u.LocalVideoTrack||f instanceof u.MediaStreamTrack))throw s.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}},6828:k=>{var S=function(){},a="undefined",d=typeof window!==a&&typeof window.navigator!==a&&/Trident\/|MSIE /.test(window.navigator.userAgent),p=["trace","debug","info","warn","error"];function o(m,f){var u=m[f];if("function"==typeof u.bind)return u.bind(m);try{return Function.prototype.bind.call(u,m)}catch(c){return function(){return Function.prototype.apply.apply(u,[m,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(m){return"debug"===m&&(m="log"),typeof console!==a&&("trace"===m&&d?s:void 0!==console[m]?o(console,m):void 0!==console.log?o(console,"log"):S)}function t(m,f){for(var u=0;u<p.length;u++){var c=p[u];this[c]=u<m?S:this.methodFactory(c,m,f)}this.log=this.debug}function e(m,f,u){return function(){typeof console!==a&&(t.call(this,f,u),this[m].apply(this,arguments))}}function r(m,f,u){return i(m)||e.apply(this,arguments)}function n(m,f,u){var h,c=this,P="loglevel";function b(){var R;if(typeof window!==a&&P){try{R=window.localStorage[P]}catch(_){}if(typeof R===a)try{var w=window.document.cookie,g=w.indexOf(encodeURIComponent(P)+"=");-1!==g&&(R=/^([^;]+)/.exec(w.slice(g))[1])}catch(_){}return void 0===c.levels[R]&&(R=void 0),R}}"string"==typeof m?P+=":"+m:"symbol"==typeof m&&(P=void 0),c.name=m,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=u||r,c.getLevel=function(){return h},c.setLevel=function(R,w){if("string"==typeof R&&void 0!==c.levels[R.toUpperCase()]&&(R=c.levels[R.toUpperCase()]),!("number"==typeof R&&R>=0&&R<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+R;if(h=R,!1!==w&&function(R){var w=(p[R]||"silent").toUpperCase();if(typeof window!==a&&P){try{return void(window.localStorage[P]=w)}catch(g){}try{window.document.cookie=encodeURIComponent(P)+"="+w+";"}catch(g){}}}(R),t.call(c,R,m),typeof console===a&&R<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(R){b()||c.setLevel(R,!1)},c.enableAll=function(R){c.setLevel(c.levels.TRACE,R)},c.disableAll=function(R){c.setLevel(c.levels.SILENT,R)};var L=b();null==L&&(L=null==f?"WARN":f),c.setLevel(L,!1)}var l=new n,v={};l.getLogger=function(f){if("symbol"!=typeof f&&"string"!=typeof f||""===f)throw new TypeError("You must supply a name when creating a logger.");var u=v[f];return u||(u=v[f]=new n(f,l.getLevel(),l.methodFactory)),u};var y=typeof window!==a?window.log:void 0;l.noConflict=function(){return typeof window!==a&&window.log===l&&(window.log=y),l},l.getLoggers=function(){return v},l.default=l,k.exports=l},9057:k=>{"use strict";var S="undefined"!=typeof AudioContext?AudioContext:"undefined"!=typeof webkitAudioContext?webkitAudioContext:null,a=function(){function d(p){p=Object.assign({AudioContext:S},p),Object.defineProperties(this,{_AudioContext:{value:p.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:d}})}return d.prototype.getOrCreate=function(p){if(!this._holders.has(p)&&(this._holders.add(p),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch(o){}return this._audioContext},d.prototype.release=function(p){this._holders.has(p)&&(this._holders.delete(p),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},d}();k.exports=new a},1923:k=>{"use strict";k.exports=function(d,p,o){o="number"==typeof o?o:250;var s=d.createMediaStreamSource(p),i=d.createAnalyser();i.fftSize=2048,s.connect(i);var t=new Uint8Array(i.fftSize),e=!1;return setTimeout(function(){e=!0},o),function r(){return e?Promise.resolve(!0):(i.getByteTimeDomainData(t),t.some(function(n){return 128!==n&&0!==n})?Promise.resolve(!1):function(d){return d="number"==typeof d?d:0,new Promise(function(p){return setTimeout(p,d)})}().then(r))}().then(function(n){return s.disconnect(),n},function(n){throw s.disconnect(),n})}},8201:(k,S,a)=>{"use strict";var d=a(1923);k.exports=function(o,s,i,t,e){t="number"==typeof t?t:3;var r=0,n=a(9057),l={},v=n.getOrCreate(l);return function y(){return s(i).then(function(m){return(i.audio?d(v,m,e).catch(function(u){return o.warn("Encountered an error while detecting silence",u),!0}):Promise.resolve(!1)).then(function(u){return u?t<=0?(o.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),m):(o.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++r+"."),m.getTracks().forEach(function(c){return c.stop()}),t--,y()):(o.info("Got a non-silent audio MediaStreamTrack; returning it."),m)})})}().then(function(m){return n.release(l),m},function(m){throw n.release(l),m})}},633:(k,S,a)=>{"use strict";var d=a(4911).flatMap,p=a(4911).guessBrowser,o=a(4911).guessBrowserVersion,s=a(1225).getSdpFormat,i=p(),t=o(),e="chrome"===i,r="firefox"===i,n="safari"===i,l=e?t.major:null;function u(g){var _=Array.from(g.values()).find(function(N){return"candidate-pair"===N.type&&N.nominated});if(!_)return null;var A=g.get(_.localCandidateId),I=g.get(_.remoteCandidateId),M=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],j=M.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),H=A?j.reduce(function(N,J){return N[J.key]=typeof A[J.key]===J.type?A[J.key]:"deleted"!==J.key&&null,N},{}):null,U=I?M.reduce(function(N,J){return N[J.key]=typeof I[J.key]===J.type?I[J.key]:null,N},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(N){return"inprogress"===N?"in-progress":N}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(N,J){return N[J.key]=typeof _[J.key]===J.type?J.fixup?J.fixup(_[J.key]):_[J.key]:null,N},{localCandidate:H,remoteCandidate:U})}function c(g){var _=Array.from(g.values()).find(function(J){return"candidate-pair"===J.type&&J.nominated});if(!_)return null;var A=g.get(_.localCandidateId),I=g.get(_.remoteCandidateId),M=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],j=M.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),H={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},U=A?j.reduce(function(J,ee){var Z=ee.ffKeys&&ee.ffKeys.find(function(V){return V in A})||ee.key;return J[ee.key]=typeof A[Z]===ee.type?"candidateType"===Z&&H[A[Z]]||A[Z]:"deleted"!==Z&&null,J},{}):null,N=I?M.reduce(function(J,ee){var Z=ee.ffKeys&&ee.ffKeys.find(function(V){return V in I})||ee.key;return J[ee.key]=typeof I[Z]===ee.type?"candidateType"===Z&&H[I[Z]]||I[Z]:null,J},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(J,ee){return J[ee.key]=typeof _[ee.key]===ee.type?_[ee.key]:null,J},{localCandidate:U,remoteCandidate:N})}function h(g,_,A){var I="local"===A?"getSenders":"getReceivers";return g[I]?g[I]().map(function(j){return j.track}).filter(function(j){return j&&j.kind===_}):d(g["local"===A?"getLocalStreams":"getRemoteStreams"](),function(j){return j["audio"===_?"getAudioTracks":"getVideoTracks"]()})}function C(g,_){return new Promise(function(A,I){l&&l<67?g.getStats(function(M){A([L(M,_)])},null,I):g.getStats(_).then(function(M){A(function(g){var _=null,A=[],I=null,M=null,j=null,H=null,U=null;g.forEach(function(V){switch(V.type){case"inbound-rtp":_=V;break;case"outbound-rtp":A.push(V);break;case"media-source":U=V;break;case"track":j=V;break;case"codec":H=V;break;case"remote-inbound-rtp":I=V;break;case"remote-outbound-rtp":M=V}});var N=j&&j.remoteSource,ee=[],Z=N?M:I;return(N?[_]:A).forEach(function(V){var D={},O=[V,U,j,H,Z&&Z.ssrc===V.ssrc?Z:null];function T(B){var z=O.find(function(le){return le&&void 0!==le[B]})||null;return z?z[B]:null}var F=T("ssrc");"number"==typeof F&&(D.ssrc=String(F));var Q=T("timestamp");D.timestamp=Math.round(Q);var q=T("mimeType");"string"==typeof q&&(q=q.split("/"),D.codecName=q[q.length-1]);var $=T("roundTripTime");"number"==typeof $&&(D.roundTripTime=Math.round(1e3*$));var X=T("jitter");"number"==typeof X&&(D.jitter=Math.round(1e3*X));var ae=T("frameWidth");"number"==typeof ae&&(N?D.frameWidthReceived=ae:(D.frameWidthSent=ae,D.frameWidthInput=j.frameWidth));var ue=T("frameHeight");"number"==typeof ue&&(N?D.frameHeightReceived=ue:(D.frameHeightSent=ue,D.frameHeightInput=j.frameHeight));var de=T("framesPerSecond");"number"==typeof de&&(D[N?"frameRateReceived":"frameRateSent"]=de);var ye=T("bytesReceived");"number"==typeof ye&&(D.bytesReceived=ye);var he=T("bytesSent");"number"==typeof he&&(D.bytesSent=he);var ve=T("packetsLost");"number"==typeof ve&&(D.packetsLost=ve);var pe=T("packetsReceived");"number"==typeof pe&&(D.packetsReceived=pe);var we=T("packetsSent");"number"==typeof we&&(D.packetsSent=we);var Se=T("audioLevel");"number"==typeof Se&&(Se=Math.round(32767*Se),N?D.audioOutputLevel=Se:D.audioInputLevel=Se);var ke=T("totalPacketSendDelay");"number"==typeof ke&&(D.totalPacketSendDelay=ke);var oe=T("totalEncodeTime");"number"==typeof oe&&(D.totalEncodeTime=oe);var Y=T("framesEncoded");"number"==typeof Y&&(D.framesEncoded=Y);var te=T("estimatedPlayoutTimestamp");"number"==typeof te&&(D.estimatedPlayoutTimestamp=te);var re=T("totalDecodeTime");"number"==typeof re&&(D.totalDecodeTime=re);var W=T("framesDecoded");"number"==typeof W&&(D.framesDecoded=W);var E=T("jitterBufferDelay");"number"==typeof E&&(D.jitterBufferDelay=E);var x=T("jitterBufferEmittedCount");"number"==typeof x&&(D.jitterBufferEmittedCount=x),ee.push(D)}),ee}(M))},I)})}function L(g,_){var A=g.result().find(function(M){return"ssrc"===M.type&&M.stat("googTrackId")===_.id}),I={};return A&&(I.timestamp=Math.round(Number(A.timestamp)),I=A.names().reduce(function(M,j){switch(j){case"googCodecName":M.codecName=A.stat(j);break;case"googRtt":M.roundTripTime=Number(A.stat(j));break;case"googJitterReceived":M.jitter=Number(A.stat(j));break;case"googFrameWidthInput":M.frameWidthInput=Number(A.stat(j));break;case"googFrameHeightInput":M.frameHeightInput=Number(A.stat(j));break;case"googFrameWidthSent":M.frameWidthSent=Number(A.stat(j));break;case"googFrameHeightSent":M.frameHeightSent=Number(A.stat(j));break;case"googFrameWidthReceived":M.frameWidthReceived=Number(A.stat(j));break;case"googFrameHeightReceived":M.frameHeightReceived=Number(A.stat(j));break;case"googFrameRateInput":M.frameRateInput=Number(A.stat(j));break;case"googFrameRateSent":M.frameRateSent=Number(A.stat(j));break;case"googFrameRateReceived":M.frameRateReceived=Number(A.stat(j));break;case"ssrc":M[j]=A.stat(j);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":M[j]=Number(A.stat(j))}return M},I)),I}function w(g,_){g=g||new Map;var A=null,I=null;g.forEach(function(pe){if(!pe.isRemote)switch(pe.type){case"inbound-rtp":A=pe,I=g.get(pe.remoteId);break;case"outbound-rtp":I=pe,A=g.get(pe.remoteId)}});var M=_?A:I,j=_?I:A;function H(pe){return M&&void 0!==M[pe]?M[pe]:j&&void 0!==j[pe]?j[pe]:null}var U={},N=H("timestamp");U.timestamp=Math.round(N);var J=H("ssrc");"number"==typeof J&&(U.ssrc=String(J));var ee=H("bytesSent");"number"==typeof ee&&(U.bytesSent=ee);var Z=H("packetsLost");"number"==typeof Z&&(U.packetsLost=Z);var V=H("packetsSent");"number"==typeof V&&(U.packetsSent=V);var D=H("roundTripTime");"number"==typeof D&&(U.roundTripTime=Math.round(1e3*D));var O=H("jitter");"number"==typeof O&&(U.jitter=Math.round(1e3*O));var T=H("framerateMean");"number"==typeof T&&(U.frameRateSent=Math.round(T));var F=H("bytesReceived");"number"==typeof F&&(U.bytesReceived=F);var Q=H("packetsReceived");"number"==typeof Q&&(U.packetsReceived=Q);var q=H("framerateMean");"number"==typeof q&&(U.frameRateReceived=Math.round(q));var $=H("totalPacketSendDelay");"number"==typeof $&&(U.totalPacketSendDelay=$);var X=H("totalEncodeTime");"number"==typeof X&&(U.totalEncodeTime=X);var ae=H("framesEncoded");"number"==typeof ae&&(U.framesEncoded=ae);var ue=H("estimatedPlayoutTimestamp");"number"==typeof ue&&(U.estimatedPlayoutTimestamp=ue);var de=H("totalDecodeTime");"number"==typeof de&&(U.totalDecodeTime=de);var ye=H("framesDecoded");"number"==typeof ye&&(U.framesDecoded=ye);var he=H("jitterBufferDelay");"number"==typeof he&&(U.jitterBufferDelay=he);var ve=H("jitterBufferEmittedCount");return"number"==typeof ve&&(U.jitterBufferEmittedCount=ve),U}k.exports=function(g,_){return g&&"function"==typeof g.getStats?function(g,_){var A=h(g,"audio","local"),I=h(g,"video","local"),M=h(g,"audio"),j=h(g,"video"),H={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},U=d([[A,"localAudioTrackStats",!1],[I,"localVideoTrackStats",!1],[M,"remoteAudioTrackStats",!0],[j,"remoteVideoTrackStats",!0]],function(N){var ee=N[1],Z=N[2];return N[0].map(function(V){return function(g,_,A){return void 0!==(A=A||{}).testForChrome||e?C(g,_):void 0!==A.testForFirefox||r?function(g,_,A){return new Promise(function(I,M){g.getStats(_).then(function(j){I([w(j,A)])},M)})}(g,_,A.isRemote):void 0!==A.testForSafari||n?void 0!==A.testForSafari||"unified"===s()?C(g,_):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(g,V,Object.assign({isRemote:Z},_)).then(function(D){D.forEach(function(O){O.trackId=V.id,H[ee].push(O)})})})});return Promise.all(U).then(function(){return function(g,_){return void 0!==(_=_||{}).testForChrome||e||void 0!==_.testForSafari||n?g.getStats().then(u):void 0!==_.testForFirefox||r?g.getStats().then(c):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(g,_)}).then(function(N){return H.activeIceCandidatePair=N,H})}(g,_):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},2214:k=>{"use strict";k.exports=function(a){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia?(a=a||{audio:!0,video:!0},navigator.mediaDevices.getUserMedia(a)):Promise.reject(new Error("getUserMedia is not supported"))}},4135:(k,S,a)=>{"use strict";var d={};Object.defineProperties(d,{getStats:{enumerable:!0,value:a(633)},getUserMedia:{enumerable:!0,value:a(2214)},MediaStream:{enumerable:!0,value:a(5308)},MediaStreamTrack:{enumerable:!0,value:a(5476)},RTCIceCandidate:{enumerable:!0,value:a(9033)},RTCPeerConnection:{enumerable:!0,value:a(4916)},RTCSessionDescription:{enumerable:!0,value:a(2842)}}),k.exports=d},5308:k=>{"use strict";k.exports="function"==typeof MediaStream?MediaStream:function(){throw new Error("MediaStream is not supported")}},5476:k=>{"use strict";k.exports="function"==typeof MediaStreamTrack?MediaStreamTrack:function(){throw new Error("MediaStreamTrack is not supported")}},9033:k=>{"use strict";k.exports="function"==typeof RTCIceCandidate?RTCIceCandidate:function(){throw new Error("RTCIceCandidate is not supported")}},1107:(k,S,a)=>{"use strict";var d=a(932),p=a(7328),o=a(1732).inherits,s=a(2774),i=a(5308),t=a(7845),e=a(1225),r=a(4911),n=a(4911).isIOSChrome,l="unified"===e.getSdpFormat();function v(b,L){if(!(this instanceof v))return new v(b,L);p.call(this),b=b||{};var R=Object.assign(b.iceTransportPolicy?{iceTransports:b.iceTransportPolicy}:{},b);r.interceptEvent(this,"datachannel"),r.interceptEvent(this,"signalingstatechange");var w=e.getSdpFormat(R.sdpSemantics),g=new RTCPeerConnection(R,L);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new i},_peerConnection:{value:g},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:w},_senders:{value:new Map},_signalingStateLatch:{value:new s},_tracksToSSRCs:{value:new Map,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:g.localDescription}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:g.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":g.signalingState}}});var _=this;g.addEventListener("datachannel",function(I){P(I.channel),_.dispatchEvent(I)}),g.addEventListener("signalingstatechange",function(){"stable"===g.signalingState&&(_._appliedTracksToSSRCs=new Map(_._tracksToSSRCs)),!_._pendingLocalOffer&&!_._pendingRemoteOffer&&_.dispatchEvent.apply(_,arguments)}),g.ontrack=function(){},"function"!=typeof RTCPeerConnection.prototype.addTrack&&g.addStream(this._localStream),r.proxyProperties(RTCPeerConnection.prototype,this,g)}function y(b,L,R){var j,U,_=L?b._pendingLocalOffer:b._pendingRemoteOffer,I=L?"have-local-offer":"have-remote-offer",M=L?"setLocalDescription":"setRemoteDescription";if(!L&&(L?b._pendingRemoteOffer:b._pendingLocalOffer)&&"answer"===R.type)j=function(b,L){return b._peerConnection.setLocalDescription(b._pendingLocalOffer).then(function(){return b._pendingLocalOffer=null,b.setRemoteDescription(L)}).then(function(){b._signalingStateLatch.lower()})}(b,R);else if("offer"===R.type){if(b.signalingState!==I&&"stable"!==b.signalingState)return Promise.reject(new Error("Cannot set "+(L?"local":"remote")+" offer in state "+b.signalingState));!_&&"low"===b._signalingStateLatch.state&&b._signalingStateLatch.raise();var H=b.signalingState;U=u(R),L?b._pendingLocalOffer=U:b._pendingRemoteOffer=U,j=Promise.resolve(),b.signalingState!==H&&j.then(function(){b.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===R.type&&(b.signalingState!==I?j=Promise.reject(new Error("Cannot rollback "+(L?"local":"remote")+" description in "+b.signalingState)):(L?b._pendingLocalOffer=null:b._pendingRemoteOffer=null,b._rolledBackTracksToSSRCs=new Map(b._tracksToSSRCs),b._tracksToSSRCs=new Map(b._appliedTracksToSSRCs),(j=Promise.resolve()).then(function(){b.dispatchEvent(new Event("signalingstatechange"))})));return j||b._peerConnection[M](u(R))}function f(b,L){return!!b.getTransceivers().find(function(R){return R.receiver&&R.receiver.track&&R.receiver.track.kind===L})}function u(b){return b instanceof d&&b._description?b._description:new RTCSessionDescription(b)}function c(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function P(b){return Object.defineProperty(b,"maxRetransmits",{value:65535===b.maxRetransmits?null:b.maxRetransmits}),c()&&Object.defineProperty(b,"maxPacketLifeTime",{value:65535===b.maxRetransmitTime?null:b.maxRetransmitTime}),b}function C(b,L,R){return"unified"===b?e.updateUnifiedPlanTrackIdsToSSRCs(L,R):e.updatePlanBTrackIdsToSSRCs(L,R)}o(v,p),"function"!=typeof RTCPeerConnection.prototype.addTrack?(v.prototype.addTrack=function(){var L=[].slice.call(arguments),R=L[0];if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+R.id+", "+R.kind+"]: RTCPeerConnection is closed");var w=this._senders.get(R);if(w&&w.track)throw new Error("Cannot add MediaStreamTrack ["+R.id+", "+R.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(R),this._peerConnection.addStream(this._localStream),w=new t(R),this._senders.set(R,w),w},v.prototype.removeTrack=function(L){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");var R=L.track;!R||(L=this._senders.get(R))&&L.track&&(L.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(R),this._peerConnection.addStream(this._localStream))},v.prototype.getSenders=function(){return Array.from(this._senders.values())}):v.prototype.removeTrack=function(L){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");try{this._peerConnection.removeTrack(L)}catch(R){}},v.prototype.addIceCandidate=function(L){var w,R=[].slice.call(arguments),g=this;return w="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return g._peerConnection.addIceCandidate(L)}):this._peerConnection.addIceCandidate(L),R.length>1?r.legacyPromise(w,R[1],R[2]):w},v.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},v.prototype.createAnswer=function(){var R,L=[].slice.call(arguments),w=this;return R=this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return w._signalingStateLatch.lower(),w._peerConnection.createAnswer()}).then(function(_){return w._pendingRemoteOffer=null,w._rolledBackTracksToSSRCs.clear(),new d({type:"answer",sdp:C(w._sdpFormat,w._tracksToSSRCs,_.sdp)})},function(_){throw w._pendingRemoteOffer=null,_}):this._peerConnection.createAnswer().then(function(g){return w._rolledBackTracksToSSRCs.clear(),new d({type:"answer",sdp:C(w._sdpFormat,w._tracksToSSRCs,g.sdp)})}),L.length>1?r.legacyPromise(R,L[0],L[1]):R},v.prototype.createOffer=function(){var L=[].slice.call(arguments),R=(L.length>1?L[2]:L[0])||{},w=this;if(n()){if(R.offerToReceiveVideo&&!this._audioTransceiver&&(!l||!f(this,"audio"))){delete R.offerToReceiveAudio;try{this._audioTransceiver=l?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(_){return Promise.reject(_)}}if(R.offerToReceiveVideo&&!this._videoTransceiver&&(!l||!f(this,"video"))){delete R.offerToReceiveVideo;try{this._videoTransceiver=l?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(_){return Promise.reject(_)}}}var g=this._peerConnection.createOffer(R).then(function(_){return w._rolledBackTracksToSSRCs.clear(),new d({type:_.type,sdp:C(w._sdpFormat,w._tracksToSSRCs,_.sdp)})});return L.length>1?r.legacyPromise(g,L[0],L[1]):g},v.prototype.createDataChannel=function(L,R){var b;b=R,b=Object.assign({},b),c()&&"maxPacketLifeTime"in b&&(b.maxRetransmitTime=b.maxPacketLifeTime);var w=this._peerConnection.createDataChannel(L,R=b);return P(w),w},v.prototype.setLocalDescription=function(){var L=[].slice.call(arguments),R=L[0];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var w=y(this,!0,R);return L.length>1?r.legacyPromise(w,L[1],L[2]):w},v.prototype.setRemoteDescription=function(){var L=[].slice.call(arguments),R=L[0];this._rolledBackTracksToSSRCs.clear();var w=y(this,!1,R);return L.length>1?r.legacyPromise(w,L[1],L[2]):w},r.delegateMethods(RTCPeerConnection.prototype,v.prototype,"_peerConnection"),k.exports=v},2294:(k,S,a)=>{"use strict";var d=a(7328),p=a(1512),o=a(1732).inherits,s=a(1225).updateUnifiedPlanTrackIdsToSSRCs,i=a(4911),t="object"==typeof navigator&&navigator.userAgent&&(navigator.userAgent.match(/Firefox\/61/)||navigator.userAgent.match(/Firefox\/62/));function e(v){if(!(this instanceof e))return new e(v);d.call(this),i.interceptEvent(this,"signalingstatechange");var y=new RTCPeerConnection(v);Object.defineProperties(this,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:y},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},localDescription:{enumerable:!0,get:function(){return l(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.signalingState}}});var f,m=this;y.addEventListener("signalingstatechange",function(){if(!m._rollingBack&&m.signalingState!==f){f=m.signalingState;var c=m.dispatchEvent.apply.bind(m.dispatchEvent,m,arguments);m._isClosed?setTimeout(c):c()}}),i.proxyProperties(RTCPeerConnection.prototype,this,y)}function r(v,y,m){var f=y?"setLocalDescription":"setRemoteDescription";return v._rollingBack=!0,v._peerConnection[f](new p({type:"rollback"})).then(m).then(function(c){return v._rollingBack=!1,c},function(c){throw v._rollingBack=!1,c})}function n(v,y,m){if(!v._initiallyNegotiatedDtlsRole&&"offer"!==y.type){var f=y.sdp.match(/a=setup:([a-z]+)/);if(f){var u=f[1];v._initiallyNegotiatedDtlsRole=m?{active:"passive",passive:"active"}[u]:u}}}function l(v,y){return v&&"answer"===v.type&&y?new p({type:v.type,sdp:v.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+y)}):v}o(e,d),Object.defineProperty(e.prototype,"peerIdentity",{enumerable:!0,value:Promise.resolve({idp:"",name:""})}),t&&(e.prototype.addTrack=function(){var y=arguments[0],m=this._peerConnection.addTrack.apply(this._peerConnection,arguments);return m.replaceTrack(y),m}),e.prototype.createAnswer=function(){var m,y=[].slice.call(arguments),f=this;return m=this._peerConnection.createAnswer().then(function(c){return n(f,c),l(c,f._initiallyNegotiatedDtlsRole)}),"function"==typeof y[0]?i.legacyPromise(m,y[0],y[1]):m},e.prototype.createOffer=function(){var f,y=[].slice.call(arguments),m=(y.length>1?y[2]:y[0])||{},u=this;if("have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState){var c="have-local-offer"===this.signalingState;f=r(this,c,function(){return u.createOffer(m)})}else f=u._peerConnection.createOffer(m);return f=f.then(function(h){return new p({type:h.type,sdp:s(u._tracksToSSRCs,h.sdp)})}),y.length>1?i.legacyPromise(f,y[0],y[1]):f},e.prototype.setLocalDescription=function(){var f,y=[].slice.call(arguments),m=y[0];return m&&"answer"===m.type&&"have-local-offer"===this.signalingState&&(f=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),f?y.length>1?i.legacyPromise(f,y[1],y[2]):f:this._peerConnection.setLocalDescription.apply(this._peerConnection,y)},e.prototype.setRemoteDescription=function(){var f,y=[].slice.call(arguments),m=y[0],u=this;return m&&"have-remote-offer"===this.signalingState&&("answer"===m.type?f=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===m.type&&(f=r(this,!1,function(){return u._peerConnection.setRemoteDescription(m)}))),f||(f=this._peerConnection.setRemoteDescription(m)),f=f.then(function(){n(u,m,!0)}),y.length>1?i.legacyPromise(f,y[1],y[2]):f},e.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},i.delegateMethods(RTCPeerConnection.prototype,e.prototype,"_peerConnection"),k.exports=e},4916:(k,S,a)=>{"use strict";if("function"==typeof RTCPeerConnection)switch((0,a(4911).guessBrowser)()){case"chrome":k.exports=a(1107);break;case"firefox":k.exports=a(2294);break;case"safari":k.exports=a(1453);break;default:k.exports=RTCPeerConnection}else k.exports=function(){throw new Error("RTCPeerConnection is not supported")}},1453:(k,S,a)=>{"use strict";var d=a(7328),p=a(1732).inherits,o=a(2774),s=a(1225),i=a(4911),t="unified"===s.getSdpFormat(),e=t?s.updateUnifiedPlanTrackIdsToSSRCs:s.updatePlanBTrackIdsToSSRCs;function r(m){if(!(this instanceof r))return new r(m);d.call(this),i.interceptEvent(this,"datachannel"),i.interceptEvent(this,"iceconnectionstatechange"),i.interceptEvent(this,"signalingstatechange"),i.interceptEvent(this,"track");var f=new RTCPeerConnection(m);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:f},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new o},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription}},iceConnectionState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState}},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState}}});var u=this;f.addEventListener("datachannel",function(h){y(h.channel),u.dispatchEvent(h)}),f.addEventListener("iceconnectionstatechange",function(){u._isClosed||u.dispatchEvent.apply(u,arguments)}),f.addEventListener("signalingstatechange",function(){u._isClosed||("stable"===f.signalingState&&(u._appliedTracksToSSRCs=new Map(u._tracksToSSRCs)),!u._pendingLocalOffer&&!u._pendingRemoteOffer&&u.dispatchEvent.apply(u,arguments))}),f.addEventListener("track",function(h){u._pendingRemoteOffer=null,u.dispatchEvent(h)}),i.proxyProperties(RTCPeerConnection.prototype,this,f)}function n(m,f,u){var w,P=f?m._pendingLocalOffer:m._pendingRemoteOffer,b=f?"have-local-offer":"have-remote-offer",L=f?"setLocalDescription":"setRemoteDescription";if(!f&&(f?m._pendingRemoteOffer:m._pendingLocalOffer)&&"answer"===u.type)return function(m,f){return m._peerConnection.setLocalDescription(m._pendingLocalOffer).then(function(){return m._pendingLocalOffer=null,m.setRemoteDescription(f)}).then(function(){m._signalingStateLatch.lower()})}(m,u);if("offer"===u.type){if(m.signalingState!==b&&"stable"!==m.signalingState)return Promise.reject(new Error("Cannot set "+(f?"local":"remote")+" offer in state "+m.signalingState));!P&&"low"===m._signalingStateLatch.state&&m._signalingStateLatch.raise();var R=m.signalingState;return w=u,f?m._pendingLocalOffer=w:m._pendingRemoteOffer=w,m.signalingState!==R?Promise.resolve().then(function(){m.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}return"rollback"===u.type?m.signalingState!==b?Promise.reject(new Error("Cannot rollback "+(f?"local":"remote")+" description in "+m.signalingState)):(f?m._pendingLocalOffer=null:m._pendingRemoteOffer=null,m._rolledBackTracksToSSRCs=new Map(m._tracksToSSRCs),m._tracksToSSRCs=new Map(m._appliedTracksToSSRCs),Promise.resolve().then(function(){m.dispatchEvent(new Event("signalingstatechange"))})):m._peerConnection[L](u)}function v(m,f){return!!m.getTransceivers().find(function(u){return u.receiver&&u.receiver.track&&u.receiver.track.kind===f})}function y(m){return Object.defineProperties(m,{maxPacketLifeTime:{value:65535===m.maxPacketLifeTime?null:m.maxPacketLifeTime},maxRetransmits:{value:65535===m.maxRetransmits?null:m.maxRetransmits}})}p(r,d),r.prototype.addIceCandidate=function(f){var u=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return u._peerConnection.addIceCandidate(f)}):this._peerConnection.addIceCandidate(f)},r.prototype.createOffer=function(f){f=Object.assign({},f);var u=this;if(f.offerToReceiveVideo&&!this._audioTransceiver&&(!t||!v(this,"audio"))){delete f.offerToReceiveAudio;try{this._audioTransceiver=t?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(c){return Promise.reject(c)}}if(f.offerToReceiveVideo&&!this._videoTransceiver&&(!t||!v(this,"video"))){delete f.offerToReceiveVideo;try{this._videoTransceiver=t?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(c){return Promise.reject(c)}}return this._peerConnection.createOffer(f).then(function(c){return u._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:c.type,sdp:e(u._tracksToSSRCs,c.sdp)})})},r.prototype.createAnswer=function(f){var u=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return u._signalingStateLatch.lower(),u._peerConnection.createAnswer()}).then(function(h){return u._pendingRemoteOffer=null,u._rolledBackTracksToSSRCs.clear(),t?new RTCSessionDescription({type:h.type,sdp:e(u._tracksToSSRCs,h.sdp)}):h},function(h){throw u._pendingRemoteOffer=null,h}):this._peerConnection.createAnswer(f).then(function(h){return u._rolledBackTracksToSSRCs.clear(),t?new RTCSessionDescription({type:h.type,sdp:e(u._tracksToSSRCs,h.sdp)}):h})},r.prototype.createDataChannel=function(f,u){var c=this._peerConnection.createDataChannel(f,u);return y(c),c},r.prototype.removeTrack=function(f){f.replaceTrack(null),this._peerConnection.removeTrack(f)},r.prototype.setLocalDescription=function(f){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),n(this,!0,f)},r.prototype.setRemoteDescription=function(f){return this._rolledBackTracksToSSRCs.clear(),n(this,!1,f)},r.prototype.close=function(){if(!this._isClosed){this._isClosed=!0,this._peerConnection.close();var f=this;setTimeout(function(){f.dispatchEvent(new Event("iceconnectionstatechange")),f.dispatchEvent(new Event("signalingstatechange"))})}},i.delegateMethods(RTCPeerConnection.prototype,r.prototype,"_peerConnection"),k.exports=r},7845:k=>{"use strict";k.exports=function(a){Object.defineProperties(this,{track:{enumerable:!0,value:a,writable:!0}})}},932:k=>{"use strict";k.exports=function S(a){if(!(this instanceof S))return new S(a);var d=a&&"rollback"===a.type?null:new RTCSessionDescription(a);Object.defineProperties(this,{_description:{get:function(){return d}},sdp:{enumerable:!0,value:d?d.sdp:a.sdp},type:{enumerable:!0,value:d?d.type:a.type}})}},1512:k=>{"use strict";k.exports=RTCSessionDescription},2842:(k,S,a)=>{"use strict";if("function"==typeof RTCSessionDescription)switch((0,a(4911).guessBrowser)()){case"chrome":k.exports=a(932);break;case"firefox":k.exports=a(1512);break;default:k.exports=RTCSessionDescription}else k.exports=function(){throw new Error("RTCSessionDescription is not supported")}},7328:(k,S,a)=>{"use strict";var d=a(3105).EventEmitter;function p(){Object.defineProperties(this,{_eventEmitter:{value:new d}})}p.prototype.dispatchEvent=function(s){return this._eventEmitter.emit(s.type,s)},p.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)},p.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)},k.exports=p},4911:(k,S)=>{"use strict";function d(u,c,h,P){if(!(P in c)&&!P.match(/^on[a-z]+$/)){var C=!1;try{var b=Object.getOwnPropertyDescriptor(u,P);C=b&&!!b.get}catch(R){}if(!C){var L;try{L=typeof u[P]}catch(R){}"function"===L&&(c[P]=function(){return this[h][P].apply(this[h],arguments)})}}}function i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:null}function t(u){return void 0===u&&(u=i()),/Chrome|CriOS/.test(u)?"chrome":/Firefox|FxiOS/.test(u)?"firefox":/Safari|iPhone|iPad|iPod/.test(u)?"safari":null}S.defer=function(){var u={};return u.promise=new Promise(function(c,h){u.resolve=c,u.reject=h}),u},S.delegateMethods=function(u,c,h){for(var P in u)d(u,c,h,P)},S.difference=function(u,c){u=Array.isArray(u)?new Set(u):new Set(u.values()),c=Array.isArray(c)?new Set(c):new Set(c.values());var h=new Set;return u.forEach(function(P){c.has(P)||h.add(P)}),h},S.flatMap=function(u,c){return(u instanceof Map||u instanceof Set?Array.from(u.values()):u).reduce(function(P,C){var b=c(C);return P.concat(b)},[])},S.guessBrowser=t,S.guessBrowserVersion=function(u){void 0===u&&(u=i());var c={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[t(u)];if(!c)return null;var h=new RegExp("("+c+")/([^\\s]+)"),P=(u.match(h)||[])[2];if(!P)return null;var C=P.split(".").map(Number);return{major:isNaN(C[0])?null:C[0],minor:isNaN(C[1])?null:C[1]}},S.isIOSChrome=function(u){return void 0===u&&(u=i()),/Mobi/.test(u)&&"chrome"===t()&&/iPad|iPhone|iPod/.test(u)},S.interceptEvent=function(u,c){var h=null;Object.defineProperty(u,"on"+c,{get:function(){return h},set:function(P){h&&this.removeEventListener(c,h),"function"==typeof P?this.addEventListener(c,h=P):h=null}})},S.legacyPromise=function(u,c,h){return c?u.then(function(P){c(P)},function(P){h(P)}):u},S.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var c=16*Math.random()|0;return("x"===u?c:3&c|8).toString(16)})},S.proxyProperties=function(u,c,h){Object.getOwnPropertyNames(u).forEach(function(P){!function(u,c,h,P){if(!(P in c)){if(P.match(/^on[a-z]+$/))return Object.defineProperty(c,P,{value:null,writable:!0}),void h.addEventListener(P.slice(2),function(){c.dispatchEvent.apply(c,arguments)});Object.defineProperty(c,P,{enumerable:!0,get:function(){return h[P]}})}}(0,c,h,P)})},S.support=function(){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"function"==typeof RTCPeerConnection}},2774:(k,S,a)=>{"use strict";var d=a(4911).defer,p={high:new Set(["low"]),low:new Set(["high"])};function o(i){if(!(this instanceof o))return new o(i);var t=i||"low";Object.defineProperties(this,{_state:{set:function(e){if(t!==e){var r=this._whenDeferreds.get(t=e);r.forEach(function(n){n.resolve(this)},this),r.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])},state:{enumerable:!0,get:function(){return this._state}}})}function s(i,t){return new Error('Cannot transition from "'+i+'" to "'+t+'"')}o.prototype.lower=function(){return this.transition("low")},o.prototype.raise=function(){return this.transition("high")},o.prototype.transition=function(t){if(!p[this.state].has(t))throw s(this.state,t);return this._state=t,this},o.prototype.when=function(t){if(this.state===t)return Promise.resolve(this);if(!p[this.state].has(t))return Promise.reject(s(this.state,t));var e=d();return this._whenDeferreds.get(t).add(e),e.promise},k.exports=o},1225:(k,S,a)=>{"use strict";var d=a(4911).flatMap,p=a(4911).guessBrowser,o=null,i=null;function e(g){return g&&function(){if("boolean"==typeof o)return o;if("undefined"==typeof RTCPeerConnection)return o=!1;try{new RTCPeerConnection({sdpSemantics:"foo"}),o=!1}catch(g){o=!0}return o}()?{"plan-b":"planb","unified-plan":"unified"}[g]:function(){if(!i)if("undefined"!=typeof RTCPeerConnection&&"addTransceiver"in RTCPeerConnection.prototype)try{(new RTCPeerConnection).addTransceiver("audio"),i="unified"}catch(g){i="planb"}else i="planb";return i}()}function l(g,_){return(_.match(new RegExp(g,"gm"))||[]).reduce(function(I,M){var j=M.match(new RegExp(g));return j?I.add(j[1]):I},new Set)}function v(g,_){return l(g,_)}function y(g){return v("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",g)}function m(g){return v("^a=msid:.+ +(.+) *$",g)}function f(g,_){return l("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+_+" *$",g)}function u(g,_,A){return _=_||".*",A=A||".*",g.split("\r\nm=").slice(1).map(function(I){return"m="+I}).filter(function(I){var M=new RegExp("m="+_,"gm"),j=new RegExp("a="+A,"gm");return M.test(I)&&j.test(I)})}function c(g){return Array.from(l("^a=ssrc:([0-9]+) +.*$",g))}function h(g,_){var A=u(g),I=new RegExp("^a=msid:[^ ]+ +"+_+" *$","gm"),M=A.filter(function(j){return j.match(I)});return new Set(d(M,c))}function P(g,_,A){return new Map(Array.from(g(A)).map(function(I){return[I,_(A,I)]}))}function C(g){return P(y,f,g)}function b(g){return P(m,h,g)}function L(g,_,A){var I=g(A),M=new Map;I.forEach(function(U,N){if(_.has(N)){var J=Array.from(_.get(N)),ee=Array.from(U);J.forEach(function(Z,V){var D=ee[V];M.set(D,Z);var T="a=ssrc:"+Z+" $1";A=A.replace(new RegExp("^a=ssrc:"+D+" (.*)$","gm"),T)})}else _.set(N,U)});var j="^(a=ssrc-group:[^ ]+ +)(.*)$";return(A.match(new RegExp(j,"gm"))||[]).forEach(function(U){var N=U.match(new RegExp(j));if(N){var J=N[1],Z=N[2].split(" ").map(function(V){return M.get(V)||V}).join(" ");A=A.replace(N[0],J+Z)}}),A}S.getSdpFormat=function(g){return{chrome:e(g),firefox:"unified",safari:"undefined"!=typeof RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}[p()]||null},S.getMediaSections=u,S.getPlanBTrackIds=y,S.getUnifiedPlanTrackIds=m,S.getPlanBSSRCs=f,S.getUnifiedPlanSSRCs=h,S.updatePlanBTrackIdsToSSRCs=function(g,_){return L(C,g,_)},S.updateUnifiedPlanTrackIdsToSSRCs=function(g,_){return L(b,g,_)}},6890:k=>{k.exports=WebSocket},826:k=>{k.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},7775:(k,S,a)=>{"use strict";var d=a(7316),p=a(2197),o=a(3446),s=a(7579);function i(oe){return oe.call.bind(oe)}var t="undefined"!=typeof BigInt,e="undefined"!=typeof Symbol,r=i(Object.prototype.toString),n=i(Number.prototype.valueOf),l=i(String.prototype.valueOf),v=i(Boolean.prototype.valueOf);if(t)var y=i(BigInt.prototype.valueOf);if(e)var m=i(Symbol.prototype.valueOf);function f(oe,Y){if("object"!=typeof oe)return!1;try{return Y(oe),!0}catch(te){return!1}}function M(oe){return"[object Map]"===r(oe)}function H(oe){return"[object Set]"===r(oe)}function N(oe){return"[object WeakMap]"===r(oe)}function ee(oe){return"[object WeakSet]"===r(oe)}function V(oe){return"[object ArrayBuffer]"===r(oe)}function D(oe){return"undefined"!=typeof ArrayBuffer&&(V.working?V(oe):oe instanceof ArrayBuffer)}function O(oe){return"[object DataView]"===r(oe)}function T(oe){return"undefined"!=typeof DataView&&(O.working?O(oe):oe instanceof DataView)}S.isArgumentsObject=d,S.isGeneratorFunction=p,S.isTypedArray=s,S.isPromise=function(oe){return"undefined"!=typeof Promise&&oe instanceof Promise||null!==oe&&"object"==typeof oe&&"function"==typeof oe.then&&"function"==typeof oe.catch},S.isArrayBufferView=function(oe){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(oe):s(oe)||T(oe)},S.isUint8Array=function(oe){return"Uint8Array"===o(oe)},S.isUint8ClampedArray=function(oe){return"Uint8ClampedArray"===o(oe)},S.isUint16Array=function(oe){return"Uint16Array"===o(oe)},S.isUint32Array=function(oe){return"Uint32Array"===o(oe)},S.isInt8Array=function(oe){return"Int8Array"===o(oe)},S.isInt16Array=function(oe){return"Int16Array"===o(oe)},S.isInt32Array=function(oe){return"Int32Array"===o(oe)},S.isFloat32Array=function(oe){return"Float32Array"===o(oe)},S.isFloat64Array=function(oe){return"Float64Array"===o(oe)},S.isBigInt64Array=function(oe){return"BigInt64Array"===o(oe)},S.isBigUint64Array=function(oe){return"BigUint64Array"===o(oe)},M.working="undefined"!=typeof Map&&M(new Map),S.isMap=function(oe){return"undefined"!=typeof Map&&(M.working?M(oe):oe instanceof Map)},H.working="undefined"!=typeof Set&&H(new Set),S.isSet=function(oe){return"undefined"!=typeof Set&&(H.working?H(oe):oe instanceof Set)},N.working="undefined"!=typeof WeakMap&&N(new WeakMap),S.isWeakMap=function(oe){return"undefined"!=typeof WeakMap&&(N.working?N(oe):oe instanceof WeakMap)},ee.working="undefined"!=typeof WeakSet&&ee(new WeakSet),S.isWeakSet=function(oe){return ee(oe)},V.working="undefined"!=typeof ArrayBuffer&&V(new ArrayBuffer),S.isArrayBuffer=D,O.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&O(new DataView(new ArrayBuffer(1),0,1)),S.isDataView=T;var F="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function Q(oe){return"[object SharedArrayBuffer]"===r(oe)}function q(oe){return void 0!==F&&(void 0===Q.working&&(Q.working=Q(new F)),Q.working?Q(oe):oe instanceof F)}function ye(oe){return f(oe,n)}function he(oe){return f(oe,l)}function ve(oe){return f(oe,v)}function pe(oe){return t&&f(oe,y)}function we(oe){return e&&f(oe,m)}S.isSharedArrayBuffer=q,S.isAsyncFunction=function(oe){return"[object AsyncFunction]"===r(oe)},S.isMapIterator=function(oe){return"[object Map Iterator]"===r(oe)},S.isSetIterator=function(oe){return"[object Set Iterator]"===r(oe)},S.isGeneratorObject=function(oe){return"[object Generator]"===r(oe)},S.isWebAssemblyCompiledModule=function(oe){return"[object WebAssembly.Module]"===r(oe)},S.isNumberObject=ye,S.isStringObject=he,S.isBooleanObject=ve,S.isBigIntObject=pe,S.isSymbolObject=we,S.isBoxedPrimitive=function(oe){return ye(oe)||he(oe)||ve(oe)||pe(oe)||we(oe)},S.isAnyArrayBuffer=function(oe){return"undefined"!=typeof Uint8Array&&(D(oe)||q(oe))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(oe){Object.defineProperty(S,oe,{enumerable:!1,value:function(){throw new Error(oe+" is not supported in userland")}})})},1732:(k,S,a)=>{var d=Object.getOwnPropertyDescriptors||function(T){for(var F=Object.keys(T),Q={},q=0;q<F.length;q++)Q[F[q]]=Object.getOwnPropertyDescriptor(T,F[q]);return Q},p=/%[sdj%]/g;S.format=function(O){if(!L(O)){for(var T=[],F=0;F<arguments.length;F++)T.push(t(arguments[F]));return T.join(" ")}F=1;for(var Q=arguments,q=Q.length,$=String(O).replace(p,function(ae){if("%%"===ae)return"%";if(F>=q)return ae;switch(ae){case"%s":return String(Q[F++]);case"%d":return Number(Q[F++]);case"%j":try{return JSON.stringify(Q[F++])}catch(ue){return"[Circular]"}default:return ae}}),X=Q[F];F<q;X=Q[++F])P(X)||!_(X)?$+=" "+X:$+=" "+t(X);return $},S.deprecate=function(O,T){if("undefined"!=typeof process&&!0===process.noDeprecation)return O;if("undefined"==typeof process)return function(){return S.deprecate(O,T).apply(this,arguments)};var F=!1;return function(){if(!F){if(process.throwDeprecation)throw new Error(T);process.traceDeprecation?console.trace(T):console.error(T),F=!0}return O.apply(this,arguments)}};var o={},s=/^$/;if(process.env.NODE_DEBUG){var i=process.env.NODE_DEBUG;i=i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+i+"$","i")}function t(O,T){var F={seen:[],stylize:r};return arguments.length>=3&&(F.depth=arguments[2]),arguments.length>=4&&(F.colors=arguments[3]),h(T)?F.showHidden=T:T&&S._extend(F,T),w(F.showHidden)&&(F.showHidden=!1),w(F.depth)&&(F.depth=2),w(F.colors)&&(F.colors=!1),w(F.customInspect)&&(F.customInspect=!0),F.colors&&(F.stylize=e),l(F,O,F.depth)}function e(O,T){var F=t.styles[T];return F?"\x1b["+t.colors[F][0]+"m"+O+"\x1b["+t.colors[F][1]+"m":O}function r(O,T){return O}function l(O,T,F){if(O.customInspect&&T&&M(T.inspect)&&T.inspect!==S.inspect&&(!T.constructor||T.constructor.prototype!==T)){var Q=T.inspect(F,O);return L(Q)||(Q=l(O,Q,F)),Q}var q=function(O,T){if(w(T))return O.stylize("undefined","undefined");if(L(T)){var F="'"+JSON.stringify(T).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return O.stylize(F,"string")}return b(T)?O.stylize(""+T,"number"):h(T)?O.stylize(""+T,"boolean"):P(T)?O.stylize("null","null"):void 0}(O,T);if(q)return q;var $=Object.keys(T),X=function(O){var T={};return O.forEach(function(F,Q){T[F]=!0}),T}($);if(O.showHidden&&($=Object.getOwnPropertyNames(T)),I(T)&&($.indexOf("message")>=0||$.indexOf("description")>=0))return y(T);if(0===$.length){if(M(T))return O.stylize("[Function"+(T.name?": "+T.name:"")+"]","special");if(g(T))return O.stylize(RegExp.prototype.toString.call(T),"regexp");if(A(T))return O.stylize(Date.prototype.toString.call(T),"date");if(I(T))return y(T)}var ve,ue="",de=!1,ye=["{","}"];return c(T)&&(de=!0,ye=["[","]"]),M(T)&&(ue=" [Function"+(T.name?": "+T.name:"")+"]"),g(T)&&(ue=" "+RegExp.prototype.toString.call(T)),A(T)&&(ue=" "+Date.prototype.toUTCString.call(T)),I(T)&&(ue=" "+y(T)),0!==$.length||de&&0!=T.length?F<0?g(T)?O.stylize(RegExp.prototype.toString.call(T),"regexp"):O.stylize("[Object]","special"):(O.seen.push(T),ve=de?function(O,T,F,Q,q){for(var $=[],X=0,ae=T.length;X<ae;++X)ee(T,String(X))?$.push(f(O,T,F,Q,String(X),!0)):$.push("");return q.forEach(function(ue){ue.match(/^\d+$/)||$.push(f(O,T,F,Q,ue,!0))}),$}(O,T,F,X,$):$.map(function(pe){return f(O,T,F,X,pe,de)}),O.seen.pop(),function(O,T,F){return O.reduce(function($,X){return X.indexOf("\n"),$+X.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?F[0]+(""===T?"":T+"\n ")+" "+O.join(",\n  ")+" "+F[1]:F[0]+T+" "+O.join(", ")+" "+F[1]}(ve,ue,ye)):ye[0]+ue+ye[1]}function y(O){return"["+Error.prototype.toString.call(O)+"]"}function f(O,T,F,Q,q,$){var X,ae,ue;if((ue=Object.getOwnPropertyDescriptor(T,q)||{value:T[q]}).get?ae=O.stylize(ue.set?"[Getter/Setter]":"[Getter]","special"):ue.set&&(ae=O.stylize("[Setter]","special")),ee(Q,q)||(X="["+q+"]"),ae||(O.seen.indexOf(ue.value)<0?(ae=P(F)?l(O,ue.value,null):l(O,ue.value,F-1)).indexOf("\n")>-1&&(ae=$?ae.split("\n").map(function(de){return"  "+de}).join("\n").substr(2):"\n"+ae.split("\n").map(function(de){return"   "+de}).join("\n")):ae=O.stylize("[Circular]","special")),w(X)){if($&&q.match(/^\d+$/))return ae;(X=JSON.stringify(""+q)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(X=X.substr(1,X.length-2),X=O.stylize(X,"name")):(X=X.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),X=O.stylize(X,"string"))}return X+": "+ae}function c(O){return Array.isArray(O)}function h(O){return"boolean"==typeof O}function P(O){return null===O}function b(O){return"number"==typeof O}function L(O){return"string"==typeof O}function w(O){return void 0===O}function g(O){return _(O)&&"[object RegExp]"===H(O)}function _(O){return"object"==typeof O&&null!==O}function A(O){return _(O)&&"[object Date]"===H(O)}function I(O){return _(O)&&("[object Error]"===H(O)||O instanceof Error)}function M(O){return"function"==typeof O}function H(O){return Object.prototype.toString.call(O)}function U(O){return O<10?"0"+O.toString(10):O.toString(10)}S.debuglog=function(O){if(O=O.toUpperCase(),!o[O])if(s.test(O)){var T=process.pid;o[O]=function(){var F=S.format.apply(S,arguments);console.error("%s %d: %s",O,T,F)}}else o[O]=function(){};return o[O]},S.inspect=t,t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},t.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},S.types=a(7775),S.isArray=c,S.isBoolean=h,S.isNull=P,S.isNullOrUndefined=function(O){return null==O},S.isNumber=b,S.isString=L,S.isSymbol=function(O){return"symbol"==typeof O},S.isUndefined=w,S.isRegExp=g,S.types.isRegExp=g,S.isObject=_,S.isDate=A,S.types.isDate=A,S.isError=I,S.types.isNativeError=I,S.isFunction=M,S.isPrimitive=function(O){return null===O||"boolean"==typeof O||"number"==typeof O||"string"==typeof O||"symbol"==typeof O||void 0===O},S.isBuffer=a(826);var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function J(){var O=new Date,T=[U(O.getHours()),U(O.getMinutes()),U(O.getSeconds())].join(":");return[O.getDate(),N[O.getMonth()],T].join(" ")}function ee(O,T){return Object.prototype.hasOwnProperty.call(O,T)}S.log=function(){console.log("%s - %s",J(),S.format.apply(S,arguments))},S.inherits=a(9879),S._extend=function(O,T){if(!T||!_(T))return O;for(var F=Object.keys(T),Q=F.length;Q--;)O[F[Q]]=T[F[Q]];return O};var Z="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function V(O,T){if(!O){var F=new Error("Promise was rejected with a falsy value");F.reason=O,O=F}return T(O)}S.promisify=function(T){if("function"!=typeof T)throw new TypeError('The "original" argument must be of type Function');if(Z&&T[Z]){var F;if("function"!=typeof(F=T[Z]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(F,Z,{value:F,enumerable:!1,writable:!1,configurable:!0}),F}function F(){for(var Q,q,$=new Promise(function(ue,de){Q=ue,q=de}),X=[],ae=0;ae<arguments.length;ae++)X.push(arguments[ae]);X.push(function(ue,de){ue?q(ue):Q(de)});try{T.apply(this,X)}catch(ue){q(ue)}return $}return Object.setPrototypeOf(F,Object.getPrototypeOf(T)),Z&&Object.defineProperty(F,Z,{value:F,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(F,d(T))},S.promisify.custom=Z,S.callbackify=function(O){if("function"!=typeof O)throw new TypeError('The "original" argument must be of type Function');function T(){for(var F=[],Q=0;Q<arguments.length;Q++)F.push(arguments[Q]);var q=F.pop();if("function"!=typeof q)throw new TypeError("The last argument must be of type Function");var $=this,X=function(){return q.apply($,arguments)};O.apply(this,F).then(function(ae){process.nextTick(X.bind(null,null,ae))},function(ae){process.nextTick(V.bind(null,ae,X))})}return Object.setPrototypeOf(T,Object.getPrototypeOf(O)),Object.defineProperties(T,d(O)),T}},3446:(k,S,a)=>{"use strict";var d=a(708),p=a(5127),o=a(9568),s=o("Object.prototype.toString"),i=a(1407)(),t="undefined"==typeof globalThis?global:globalThis,e=p(),r=o("String.prototype.slice"),n={},l=a(7168),v=Object.getPrototypeOf;i&&l&&v&&d(e,function(f){if("function"==typeof t[f]){var u=new t[f];if(Symbol.toStringTag in u){var c=v(u),h=l(c,Symbol.toStringTag);if(!h){var P=v(c);h=l(P,Symbol.toStringTag)}n[f]=h.get}}});var m=a(7579);k.exports=function(u){return!!m(u)&&(i&&Symbol.toStringTag in u?function(u){var c=!1;return d(n,function(h,P){if(!c)try{var C=h.call(u);C===P&&(c=C)}catch(b){}}),c}(u):r(s(u),8,-1))}},7725:(k,S,a)=>{"use strict";a.r(S),a.d(S,{MainModule:()=>W});var d=a(8583),p=a(4889),o=a(7716);function s(E,x,B,z,le,ge,_e){try{var be=E[ge](_e),Ee=be.value}catch(Oe){return void B(Oe)}be.done?x(Ee):Promise.resolve(Ee).then(z,le)}function i(E){return function(){var x=this,B=arguments;return new Promise(function(z,le){var ge=E.apply(x,B);function _e(Ee){s(ge,z,le,_e,be,"next",Ee)}function be(Ee){s(ge,z,le,_e,be,"throw",Ee)}_e(void 0)})}}var t=a(8987),e=a(9765),r=a(4402),n=a(3190),l=a(7393);function v(E){return x=>x.lift(new y(E))}class y{constructor(x){this.value=x}call(x,B){return B.subscribe(new m(x,this.value))}}class m extends l.L{constructor(x,B){super(x),this.value=B}_next(x){this.destination.next(this.value)}}var f=a(9761),u=a(8002);const c=["preview"];function h(E,x){1&E&&(o.TgZ(0,"div"),o._uU(1,"Loading preview... Please wait."),o.qZA())}function P(E,x){if(1&E&&(o.ynx(0),o.TgZ(1,"div",1,2),o.YNc(3,h,2,0,"div",0),o.qZA(),o.BQk()),2&E){const B=x.ngIf;o.xp6(3),o.Q6J("ngIf",B.initializing)}}let C=(()=>{class E{constructor(B){this.renderer=B,this.localTracks=[],this.initializeSubject=new e.xQ;const z=this.initializeSubject.pipe((0,n.w)(le=>(0,r.D)(this.initializeDevice(null==le?void 0:le.kind,null==le?void 0:le.deviceId)).pipe(v(!1),(0,f.O)(!0))),(0,f.O)(!0));this.model$=z.pipe((0,u.U)(le=>({initializing:le})))}get tracks(){return this.localTracks}ngAfterViewInit(){var B=this;return i(function*(){B.previewElement&&B.previewElement.nativeElement&&B.initializeSubject.next()})()}initializePreview(B){this.initializeSubject.next(B)}showPreviewCamera(){var B=this;return i(function*(){return yield B.initializePreview(),B.tracks})()}finalizePreview(){try{this.videoTrack&&this.videoTrack.detach().forEach(B=>B.remove())}catch(B){console.error(B)}}initializeDevice(B,z){var le=this;return i(function*(){le.finalizePreview(),le.localTracks=B&&z?yield le.initializeTracks(B,z):yield le.initializeTracks(),le.videoTrack=le.localTracks.find(_e=>"video"===_e.kind);const ge=le.videoTrack.attach();le.renderer.setStyle(ge,"height","100%"),le.renderer.appendChild(le.previewElement.nativeElement,ge)})()}initializeTracks(B,z){if(B)switch(B){case"audioinput":return(0,t.createLocalTracks)({audio:{deviceId:z},video:!0});case"videoinput":return(0,t.createLocalTracks)({audio:!0,video:{deviceId:z}})}return(0,t.createLocalTracks)({audio:!0,video:!0})}}return E.\u0275fac=function(B){return new(B||E)(o.Y36(o.Qsj))},E.\u0275cmp=o.Xpm({type:E,selectors:[["app-camera"]],viewQuery:function(B,z){if(1&B&&o.Gf(c,5),2&B){let le;o.iGM(le=o.CRH())&&(z.previewElement=le.first)}},decls:2,vars:3,consts:[[4,"ngIf"],["id","preview",2,"height","35vh"],["preview",""]],template:function(B,z){1&B&&(o.YNc(0,P,4,1,"ng-container",0),o.ALo(1,"async")),2&B&&o.Q6J("ngIf",o.lcZ(1,1,z.model$))},directives:[d.O5],pipes:[d.Ov],styles:[""],changeDetection:0}),E})();var b=a(665),L=a(9112),w=a(8307),g=a(2340),_=a(1841);let A=(()=>{class E{constructor(B){this.httpClient=B}get(B){return this.httpClient.get(`${g.N.apiUrl}/api/rooms/${B}`)}getAll(){return this.httpClient.get(`${g.N.apiUrl}/api/rooms`)}create(B){return this.httpClient.post(`${g.N.apiUrl}/api/rooms`,{name:B})}}return E.\u0275fac=function(B){return new(B||E)(o.LFG(_.eN))},E.\u0275prov=o.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();function I(E,x){1&E&&(o.TgZ(0,"span"),o._uU(1,"Create"),o.qZA())}function M(E,x){1&E&&(o.TgZ(0,"span"),o._uU(1,"Creating..."),o.qZA())}const j=function(E){return["/room",E]};function H(E,x){if(1&E&&(o.TgZ(0,"a",8),o.TgZ(1,"span",9),o._uU(2),o.qZA(),o.TgZ(3,"span"),o._uU(4),o.qZA(),o.O4$(),o.TgZ(5,"svg",10),o._UZ(6,"path",11),o.qZA(),o.qZA()),2&E){const B=x.$implicit;o.Q6J("routerLink",o.VKq(4,j,B.name)),o.xp6(2),o.AsE("",B.participantCount||0,"/",B.maxParticipants||0,""),o.xp6(2),o.Oqu(B.name)}}function U(E,x){if(1&E){const B=o.EpF();o.ynx(0),o.TgZ(1,"h2"),o._uU(2,"Join a room"),o.qZA(),o.TgZ(3,"p"),o._uU(4,"Create a room by naming it:"),o.qZA(),o.TgZ(5,"form",1),o.NdJ("ngSubmit",function(){return o.CHM(B),o.oxw().createRoom()}),o.TgZ(6,"div",2),o.TgZ(7,"div",3),o._UZ(8,"input",4),o.qZA(),o.TgZ(9,"button",5),o.YNc(10,I,2,0,"span",0),o.YNc(11,M,2,0,"span",0),o.qZA(),o.qZA(),o.qZA(),o.TgZ(12,"h2"),o._uU(13,"Available rooms"),o.qZA(),o.TgZ(14,"div",6),o.YNc(15,H,7,6,"a",7),o.qZA(),o.BQk()}if(2&E){const B=x.ngIf,z=o.oxw();o.xp6(5),o.Q6J("formGroup",z.form),o.xp6(4),o.Q6J("disabled",B.creatingRoom),o.xp6(1),o.Q6J("ngIf",!B.creatingRoom),o.xp6(1),o.Q6J("ngIf",B.creatingRoom),o.xp6(4),o.Q6J("ngForOf",B.rooms)}}let N=(()=>{class E{constructor(B,z,le){this.roomsService=z,this.router=le,this.createRoomSubject=new e.xQ,this.refreshRoomsSubject=new e.xQ,this.form=B.group({roomName:[null,b.kI.required]});const ge=this.refreshRoomsSubject.pipe(function(E,x){return(0,n.w)(()=>E)}(z.getAll())),_e=this.createRoomSubject.pipe((0,n.w)(be=>this.roomsService.create(be).pipe((0,w.b)(Ee=>this.router.navigate(["/room",Ee.name])),v(!1),(0,f.O)(!0))),(0,f.O)(!1));this.model$=(0,L.aj)([ge,_e]).pipe((0,u.U)(([be,Ee])=>({rooms:be,creatingRoom:Ee})))}createRoom(){!this.form.controls.roomName.value||this.createRoomSubject.next(this.form.controls.roomName.value)}ngAfterViewInit(){this.refreshRoomsSubject.next()}}return E.\u0275fac=function(B){return new(B||E)(o.Y36(b.qu),o.Y36(A),o.Y36(p.F0))},E.\u0275cmp=o.Xpm({type:E,selectors:[["app-rooms"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"d-flex","flex-column"],[1,"form-group"],["formControlName","roomName","type","text",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"card-container"],["class","card",3,"routerLink",4,"ngFor","ngForOf"],[1,"card",3,"routerLink"],[1,"badge","badge-sm","badge-secondary","mr-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",1,"material-icons"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"]],template:function(B,z){1&B&&(o.YNc(0,U,16,5,"ng-container",0),o.ALo(1,"async")),2&B&&o.Q6J("ngIf",o.lcZ(1,1,z.model$))},directives:[d.O5,b._Y,b.JL,b.sg,b.Fj,b.JJ,b.u,d.sg,p.yS],pipes:[d.Ov],styles:[""],changeDetection:0}),E})(),J=(()=>{class E{}return E.\u0275fac=function(B){return new(B||E)},E.\u0275cmp=o.Xpm({type:E,selectors:[["ng-component"]],decls:10,vars:0,consts:[["role","main",1,"content"],[1,"card","highlight-card","card-small"],["id","clouds","xmlns","http://www.w3.org/2000/svg","width","2611.084","height","485.677","viewBox","0 0 2611.084 485.677"],["id","Path_39","data-name","Path 39","d","M2379.709,863.793c10-93-77-171-168-149-52-114-225-105-264,15-75,3-140,59-152,133-30,2.83-66.725,9.829-93.5,26.25-26.771-16.421-63.5-23.42-93.5-26.25-12-74-77-130-152-133-39-120-212-129-264-15-54.084-13.075-106.753,9.173-138.488,48.9-31.734-39.726-84.4-61.974-138.487-48.9-52-114-225-105-264,15a162.027,162.027,0,0,0-103.147,43.044c-30.633-45.365-87.1-72.091-145.206-58.044-52-114-225-105-264,15-75,3-140,59-152,133-53,5-127,23-130,83-2,42,35,72,70,86,49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33,61.112,8.015,113.854-5.72,150.492-29.764a165.62,165.62,0,0,0,110.861-3.236c47,94,178,113,251,33,31.385,4.116,60.563,2.495,86.487-3.311,25.924,5.806,55.1,7.427,86.488,3.311,73,80,204,61,251-33a165.625,165.625,0,0,0,120,0c51,13,108,15,157-5a147.188,147.188,0,0,0,33.5-18.694,147.217,147.217,0,0,0,33.5,18.694c49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33C2446.709,1093.793,2554.709,922.793,2379.709,863.793Z","transform","translate(142.69 -634.312)","fill","#eee"]],template:function(B,z){1&B&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"span"),o._uU(3,"Video preview"),o.qZA(),o.qZA(),o._UZ(4,"app-camera"),o._UZ(5,"app-rooms"),o.O4$(),o.TgZ(6,"svg",2),o.TgZ(7,"title"),o._uU(8,"Gray Clouds Background"),o.qZA(),o._UZ(9,"path",3),o.qZA(),o.qZA())},directives:[C,N],encapsulation:2,changeDetection:0}),E})();const ee=["list"];let Z=(()=>{class E{constructor(B){this.renderer=B,this.participantsChanged=new o.vpe}get participantCount(){return this.participants?this.participants.size:0}get isAlone(){return 0===this.participantCount}clear(){this.participants&&this.participants.clear()}initialize(B){this.participants=B,this.participants&&this.participants.forEach(z=>this.registerParticipantEvents(z))}add(B){this.participants&&B&&(this.participants.set(B.sid,B),this.registerParticipantEvents(B))}remove(B){this.participants&&this.participants.has(B.sid)&&this.participants.delete(B.sid)}loudest(B){this.dominantSpeaker=B}registerParticipantEvents(B){B&&(B.tracks.forEach(z=>this.subscribe(z)),B.on("trackPublished",z=>this.subscribe(z)),B.on("trackUnpublished",z=>{z&&z.track&&this.detachRemoteTrack(z.track)}))}subscribe(B){B&&B.on&&(B.on("subscribed",z=>this.attachRemoteTrack(z)),B.on("unsubscribed",z=>this.detachRemoteTrack(z)))}attachRemoteTrack(B){if(this.isAttachable(B)){const z=B.attach();this.renderer.data.id=B.sid,this.renderer.setStyle(z,"width","95%"),this.renderer.setStyle(z,"margin-left","2.5%"),this.renderer.appendChild(this.listRef.nativeElement,z),this.participantsChanged.emit(!0)}}detachRemoteTrack(B){this.isDetachable(B)&&(B.detach().forEach(z=>z.remove()),this.participantsChanged.emit(!0))}isAttachable(B){return!!B&&(void 0!==B.attach||void 0!==B.attach)}isDetachable(B){return!!B&&(void 0!==B.detach||void 0!==B.detach)}}return E.\u0275fac=function(B){return new(B||E)(o.Y36(o.Qsj))},E.\u0275cmp=o.Xpm({type:E,selectors:[["app-room-grid"]],viewQuery:function(B,z){if(1&B&&o.Gf(ee,5),2&B){let le;o.iGM(le=o.CRH())&&(z.listRef=le.first)}},outputs:{participantsChanged:"participantsChanged"},decls:2,vars:0,consts:[["list",""]],template:function(B,z){1&B&&o._UZ(0,"div",null,0)},styles:[""],changeDetection:0}),E})();var V=a(5435),D=a(8049),O=a(6465),F=a(6102);const $=new class extends F.v{}(class extends O.o{constructor(x,B){super(x,B),this.scheduler=x,this.work=B}schedule(x,B=0){return B>0?super.schedule(x,B):(this.delay=B,this.state=x,this.scheduler.flush(this),this)}execute(x,B){return B>0||this.closed?super.execute(x,B):this._execute(x,B)}requestAsyncId(x,B,z=0){return null!==z&&z>0||null===z&&this.delay>0?super.requestAsyncId(x,B,z):x.flush(this)}});var X=a(5319),ae=a(1593);class ye extends l.L{constructor(x,B,z=0){super(x),this.scheduler=B,this.delay=z}static dispatch(x){const{notification:B,destination:z}=x;B.observe(z),this.unsubscribe()}scheduleMessage(x){this.destination.add(this.scheduler.schedule(ye.dispatch,this.delay,new he(x,this.destination)))}_next(x){this.scheduleMessage(ae.P.createNext(x))}_error(x){this.scheduleMessage(ae.P.createError(x)),this.unsubscribe()}_complete(){this.scheduleMessage(ae.P.createComplete()),this.unsubscribe()}}class he{constructor(x,B){this.notification=x,this.destination=B}}var ve=a(7971),pe=a(8858);class we extends e.xQ{constructor(x=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,z){super(),this.scheduler=z,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=x<1?1:x,this._windowTime=B<1?1:B,B===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(x){if(!this.isStopped){const B=this._events;B.push(x),B.length>this._bufferSize&&B.shift()}super.next(x)}nextTimeWindow(x){this.isStopped||(this._events.push(new Se(this._getNow(),x)),this._trimBufferThenGetEvents()),super.next(x)}_subscribe(x){const B=this._infiniteTimeWindow,z=B?this._events:this._trimBufferThenGetEvents(),le=this.scheduler,ge=z.length;let _e;if(this.closed)throw new ve.N;if(this.isStopped||this.hasError?_e=X.w.EMPTY:(this.observers.push(x),_e=new pe.W(this,x)),le&&x.add(x=new ye(x,le)),B)for(let be=0;be<ge&&!x.closed;be++)x.next(z[be]);else for(let be=0;be<ge&&!x.closed;be++)x.next(z[be].value);return this.hasError?x.error(this.thrownError):this.isStopped&&x.complete(),_e}_getNow(){return(this.scheduler||$).now()}_trimBufferThenGetEvents(){const x=this._getNow(),B=this._bufferSize,z=this._windowTime,le=this._events,ge=le.length;let _e=0;for(;_e<ge&&!(x-le[_e].time<z);)_e++;return ge>B&&(_e=Math.max(_e,ge-B)),_e>0&&le.splice(0,_e),le}}class Se{constructor(x,B){this.time=x,this.value=B}}let ke=(()=>{class E{constructor(B){this.http=B,this.roomBroadcast=new we,this.roomsUpdated$=this.roomBroadcast.asObservable()}getAuthToken(){var B=this;return i(function*(){return(yield B.http.get(`${g.N.apiUrl}/api/auth/token`).toPromise()).token})()}joinOrCreateRoom(B,z){var le=this;return i(function*(){let ge=null;try{const _e=yield le.getAuthToken();ge=yield(0,t.connect)(_e,{name:B,tracks:z,dominantSpeaker:!0})}catch(_e){console.error(`Unable to connect to Room: ${_e.message}`)}finally{ge&&le.roomBroadcast.next(!0)}return ge})()}nudge(){this.roomBroadcast.next(!0)}}return E.\u0275fac=function(B){return new(B||E)(o.LFG(_.eN))},E.\u0275prov=o.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();const Y=[{path:"",component:J},{path:"room/:id",component:(()=>{class E{constructor(B,z,le){this.route=B,this.router=z,this.videoCallService=le}ngAfterViewInit(){this.route.params.pipe((0,u.U)(z=>z.id),(0,V.h)(z=>z)).pipe((0,D.P)()).subscribe(z=>this.onRoomChanged(z))}onLeaveRoom(B){var z=this;return i(function*(){z.activeRoom&&(z.activeRoom.disconnect(),z.activeRoom=null),z.roomGrid.clear(),yield z.router.navigate(["/"])})()}onRoomChanged(B){var z=this;return i(function*(){if(B){z.activeRoom&&z.activeRoom.disconnect();const le=yield z.camera.showPreviewCamera();z.activeRoom=yield z.videoCallService.joinOrCreateRoom(B,le),z.roomGrid.initialize(z.activeRoom.participants),z.registerRoomEvents()}})()}onParticipantsChanged(B){this.videoCallService.nudge()}registerRoomEvents(){this.activeRoom.on("disconnected",B=>B.localParticipant.tracks.forEach(z=>this.detachLocalTrack(z.track))).on("participantConnected",B=>this.roomGrid.add(B)).on("participantDisconnected",B=>this.roomGrid.remove(B)).on("dominantSpeakerChanged",B=>this.roomGrid.loudest(B))}detachLocalTrack(B){this.isDetachable(B)&&B.detach().forEach(z=>z.remove())}isDetachable(B){return!!B&&(void 0!==B.detach||void 0!==B.detach)}}return E.\u0275fac=function(B){return new(B||E)(o.Y36(p.gz),o.Y36(p.F0),o.Y36(ke))},E.\u0275cmp=o.Xpm({type:E,selectors:[["ng-component"]],viewQuery:function(B,z){if(1&B&&(o.Gf(C,5),o.Gf(Z,5)),2&B){let le;o.iGM(le=o.CRH())&&(z.camera=le.first),o.iGM(le=o.CRH())&&(z.roomGrid=le.first)}},decls:11,vars:0,consts:[["role","main",1,"content"],[1,"d-flex","flex-column"],[3,"participantsChanged"],[1,"card-container"],["type","button",1,"btn","btn-danger",3,"click"],["id","clouds","xmlns","http://www.w3.org/2000/svg","width","2611.084","height","485.677","viewBox","0 0 2611.084 485.677"],["id","Path_39","data-name","Path 39","d","M2379.709,863.793c10-93-77-171-168-149-52-114-225-105-264,15-75,3-140,59-152,133-30,2.83-66.725,9.829-93.5,26.25-26.771-16.421-63.5-23.42-93.5-26.25-12-74-77-130-152-133-39-120-212-129-264-15-54.084-13.075-106.753,9.173-138.488,48.9-31.734-39.726-84.4-61.974-138.487-48.9-52-114-225-105-264,15a162.027,162.027,0,0,0-103.147,43.044c-30.633-45.365-87.1-72.091-145.206-58.044-52-114-225-105-264,15-75,3-140,59-152,133-53,5-127,23-130,83-2,42,35,72,70,86,49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33,61.112,8.015,113.854-5.72,150.492-29.764a165.62,165.62,0,0,0,110.861-3.236c47,94,178,113,251,33,31.385,4.116,60.563,2.495,86.487-3.311,25.924,5.806,55.1,7.427,86.488,3.311,73,80,204,61,251-33a165.625,165.625,0,0,0,120,0c51,13,108,15,157-5a147.188,147.188,0,0,0,33.5-18.694,147.217,147.217,0,0,0,33.5,18.694c49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33C2446.709,1093.793,2554.709,922.793,2379.709,863.793Z","transform","translate(142.69 -634.312)","fill","#eee"]],template:function(B,z){1&B&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o._UZ(2,"app-camera"),o.TgZ(3,"app-room-grid",2),o.NdJ("participantsChanged",function(ge){return z.onParticipantsChanged(ge)}),o.qZA(),o.qZA(),o.TgZ(4,"div",3),o.TgZ(5,"button",4),o.NdJ("click",function(){return z.onLeaveRoom(!0)}),o._uU(6,"Leave room"),o.qZA(),o.qZA(),o.O4$(),o.TgZ(7,"svg",5),o.TgZ(8,"title"),o._uU(9,"Gray Clouds Background"),o.qZA(),o._UZ(10,"path",6),o.qZA(),o.qZA())},directives:[C,Z],styles:[""],changeDetection:0}),E})()}];let te=(()=>{class E{}return E.\u0275fac=function(B){return new(B||E)},E.\u0275mod=o.oAB({type:E}),E.\u0275inj=o.cJS({imports:[[p.Bz.forChild(Y)],p.Bz]}),E})();var re=a(8319);let W=(()=>{class E{}return E.\u0275fac=function(B){return new(B||E)},E.\u0275mod=o.oAB({type:E}),E.\u0275inj=o.cJS({imports:[[d.ez,te,b.UX,re.IJ]]}),E})()},5127:k=>{"use strict";var S=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],a="undefined"==typeof globalThis?global:globalThis;k.exports=function(){for(var p=[],o=0;o<S.length;o++)"function"==typeof a[S[o]]&&(p[p.length]=S[o]);return p}},7168:(k,S,a)=>{"use strict";var p=a(8540)("%Object.getOwnPropertyDescriptor%",!0);if(p)try{p([],"length")}catch(o){p=null}k.exports=p},1730:k=>{"use strict";k.exports=JSON.parse('{"name":"twilio-video","title":"Twilio Video","description":"Twilio Video JavaScript Library","version":"2.21.1","homepage":"https://twilio.com","author":"Mark Andrus Roberts <mroberts@twilio.com>","contributors":["Ryan Rowland <rrowland@twilio.com>","Manjesh Malavalli <mmalavalli@twilio.com>","Makarand Patwardhan <mpatwardhan@twilio.com>"],"keywords":["twilio","webrtc","library","javascript","video","rooms"],"repository":{"type":"git","url":"https://github.com/twilio/twilio-video.js.git"},"devDependencies":{"@babel/core":"^7.14.2","@babel/preset-env":"^7.14.2","@babel/preset-typescript":"^7.13.0","@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","@typescript-eslint/eslint-plugin":"^4.13.0","@typescript-eslint/parser":"^4.0.0","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1","browserify":"^17.0.0","cheerio":"^0.22.0","cors":"^2.8.5","electron":"^9.1.0","envify":"^4.0.0","eslint":"^6.2.1","eslint-config-standard":"^14.0.0","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","express":"^4.16.2","glob":"^7.1.7","ink-docstrap":"^1.3.2","inquirer":"^7.0.0","is-docker":"^2.0.0","jsdoc":"^3.5.5","jsdoc-babel":"^0.5.0","json-loader":"^0.5.7","karma":"^5.0.2","karma-browserify":"^8.0.0","karma-chrome-launcher":"^2.0.0","karma-edgium-launcher":"^4.0.0-0","karma-electron":"^6.1.0","karma-firefox-launcher":"^1.3.0","karma-htmlfile-reporter":"^0.3.8","karma-junit-reporter":"^1.2.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-spec-reporter":"0.0.32","karma-typescript":"^5.5.1","karma-typescript-es6-transform":"^5.5.1","mocha":"^3.2.0","mock-require":"^3.0.3","ncp":"^2.0.0","node-http-server":"^8.1.2","npm-run-all":"^4.0.2","nyc":"^15.1.0","requirejs":"^2.3.3","rimraf":"^2.6.1","simple-git":"^1.126.0","sinon":"^4.0.1","ts-node":"4.0.1","tslint":"5.8.0","twilio":"^3.49.0","twilio-release-tool":"^1.0.2","typescript":"4.2.2","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0","watchify":"^3.11.1","webrtc-adapter":"^7.7.1"},"engines":{"node":">=0.12"},"license":"BSD-3-Clause","main":"./es5/index.js","types":"./tsdef/index.d.ts","scripts":{"lint:js":"eslint ./lib ./test/*.js ./docker/**/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/** ","lint:ts":"eslint ./tsdef/*.ts ./lib/**/*.ts","lint":"npm-run-all lint:js lint:ts","printVersion":"node --version && npm --version","test:unit":"npm-run-all printVersion build:es5 && nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov --reporter=text mocha -r ts-node/register ./test/unit/*","test:serversiderender":"mocha ./test/serversiderender/index.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:integration":"npm run build:es5 && node ./scripts/karma.js karma/integration.conf.js","test:umd:install":"npm install puppeteer@5.5.0","test:umd":"mocha ./test/umd/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules package-lock.json && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:install":"npm install chromedriver && npm install selenium-webdriver && npm install geckodriver && npm install puppeteer","test:framework":"npm-run-all test:framework:install test:framework:no-framework test:framework:react","test":"npm-run-all test:unit test:integration","build:es5":"rimraf ./es5 && tsc tsdef/twilio-video-tests.ts --noEmit --lib es2018,dom && tsc ","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":"uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments \\"/^! twilio-video.js/\\" -b beautify=false,ascii_only=true","build":"npm-run-all clean lint docs test:unit test:integration build:es5 build:js build:min.js test:umd","build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js","docs":"node ./scripts/docs.js ./dist/docs","watch":"tsc -w","clean":"rimraf ./coverage ./es5 ./dist"},"dependencies":{"backoff":"^2.5.0","events":"^3.3.0","util":"^0.12.4","ws":"^7.4.6","xmlhttprequest":"^1.8.0"},"browser":{"ws":"./src/ws.js","xmlhttprequest":"./src/xmlhttprequest.js"},"_resolved":"https://registry.npmjs.org/twilio-video/-/twilio-video-2.21.1.tgz","_integrity":"sha512-odVq6tBF2OGwtOncvGuQjyuv6fAIkIWVzZZxlYnFkbUen6eq3A9fCtNuKLb+GnXFwXLzzRHByi3yJzQgkWbJow==","_from":"twilio-video@2.21.1"}')}}]);