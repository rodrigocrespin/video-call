(self.webpackChunkvideo_call_client=self.webpackChunkvideo_call_client||[]).push([[725],{4035:(k,S,a)=>{var d=a(3781),p=a(7732),o=a(4082),s=a(2040);k.exports.Backoff=d,k.exports.FunctionCall=s,k.exports.FibonacciStrategy=o,k.exports.ExponentialStrategy=p,k.exports.fibonacci=function(i){return new d(new o(i))},k.exports.exponential=function(i){return new d(new p(i))},k.exports.call=function(i,t,e){var r=Array.prototype.slice.call(arguments);return i=r[0],t=r.slice(1,r.length-1),new s(i,t,e=r[r.length-1])}},3781:(k,S,a)=>{var d=a(3105),p=a(3726);function s(i){d.EventEmitter.call(this),this.backoffStrategy_=i,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}a(1732).inherits(s,d.EventEmitter),s.prototype.failAfter=function(i){p.checkArgument(i>0,"Expected a maximum number of retry greater than 0 but got %s.",i),this.maxNumberOfRetry_=i},s.prototype.backoff=function(i){p.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",i),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,i))},s.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},s.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},k.exports=s},2040:(k,S,a)=>{var d=a(3105),p=a(3726),o=a(1732),s=a(3781),i=a(4082);function t(e,r,n){d.EventEmitter.call(this),p.checkIsFunction(e,"Expected fn to be a function."),p.checkIsArray(r,"Expected args to be an array."),p.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=r,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=t.DEFAULT_RETRY_PREDICATE_,this.state_=t.State_.PENDING}o.inherits(t,d.EventEmitter),t.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},t.DEFAULT_RETRY_PREDICATE_=function(e){return!0},t.prototype.isPending=function(){return this.state_==t.State_.PENDING},t.prototype.isRunning=function(){return this.state_==t.State_.RUNNING},t.prototype.isCompleted=function(){return this.state_==t.State_.COMPLETED},t.prototype.isAborted=function(){return this.state_==t.State_.ABORTED},t.prototype.setStrategy=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},t.prototype.retryIf=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},t.prototype.getLastResult=function(){return this.lastResult_.concat()},t.prototype.getNumRetries=function(){return this.numRetries_},t.prototype.failAfter=function(e){return p.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},t.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=t.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},t.prototype.start=function(e){p.checkState(!this.isAborted(),"FunctionCall is aborted."),p.checkState(this.isPending(),"FunctionCall already started.");var r=this.strategy_||new i;this.backoff_=e?e(r):new s(r),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=t.State_.RUNNING,this.doCall_(!1)},t.prototype.doCall_=function(e){e&&this.numRetries_++;var r=["call"].concat(this.arguments_);d.EventEmitter.prototype.emit.apply(this,r);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},t.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},t.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,d.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var r=e[0];r&&this.retryPredicate_(r)?this.backoff_.backoff(r):(this.state_=t.State_.COMPLETED,this.doCallback_())}},t.prototype.handleBackoff_=function(e,r,n){this.emit("backoff",e,r,n)},k.exports=t},7732:(k,S,a)=>{var d=a(1732),p=a(3726),o=a(1975);function s(i){o.call(this,i),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=s.DEFAULT_FACTOR,i&&void 0!==i.factor&&(p.checkArgument(i.factor>1,"Exponential factor should be greater than 1 but got %s.",i.factor),this.factor_=i.factor)}d.inherits(s,o),s.DEFAULT_FACTOR=2,s.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},s.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},k.exports=s},4082:(k,S,a)=>{var d=a(1732),p=a(1975);function o(s){p.call(this,s),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}d.inherits(o,p),o.prototype.next_=function(){var s=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=s,s},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},k.exports=o},1975:(k,S,a)=>{function o(i){return null!=i}function s(i){if(o((i=i||{}).initialDelay)&&i.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(o(i.maxDelay)&&i.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=i.initialDelay||100,this.maxDelay_=i.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(o(i.randomisationFactor)&&(i.randomisationFactor<0||i.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=i.randomisationFactor||0}a(3105),a(1732),s.prototype.getMaxDelay=function(){return this.maxDelay_},s.prototype.getInitialDelay=function(){return this.initialDelay_},s.prototype.next=function(){var i=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(i*t)},s.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},s.prototype.reset=function(){this.reset_()},s.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},k.exports=s},9568:(k,S,a)=>{"use strict";var d=a(8540),p=a(44),o=p(d("String.prototype.indexOf"));k.exports=function(i,t){var e=d(i,!!t);return"function"==typeof e&&o(i,".prototype.")>-1?p(e):e}},44:(k,S,a)=>{"use strict";var d=a(5396),p=a(8540),o=p("%Function.prototype.apply%"),s=p("%Function.prototype.call%"),i=p("%Reflect.apply%",!0)||d.call(s,o),t=p("%Object.getOwnPropertyDescriptor%",!0),e=p("%Object.defineProperty%",!0),r=p("%Math.max%");if(e)try{e({},"a",{value:1})}catch(l){e=null}k.exports=function(v){var y=i(d,s,arguments);if(t&&e){var m=t(y,"length");m.configurable&&e(y,"length",{value:1+r(0,v.length-(arguments.length-1))})}return y};var n=function(){return i(d,o,arguments)};e?e(k.exports,"apply",{value:n}):k.exports.apply=n},3105:k=>{"use strict";var d,S="object"==typeof Reflect?Reflect:null,a=S&&"function"==typeof S.apply?S.apply:function(w,R,C){return Function.prototype.apply.call(w,R,C)};d=S&&"function"==typeof S.ownKeys?S.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var o=Number.isNaN||function(w){return w!=w};function s(){s.init.call(this)}k.exports=s,k.exports.once=function(O,w){return new Promise(function(R,C){function T(_){O.removeListener(w,g),C(_)}function g(){"function"==typeof O.removeListener&&O.removeListener("error",T),R([].slice.call(arguments))}P(O,w,g,{once:!0}),"error"!==w&&function(O,w,R){"function"==typeof O.on&&P(O,"error",w,{once:!0})}(O,T)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var i=10;function t(O){if("function"!=typeof O)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}function e(O){return void 0===O._maxListeners?s.defaultMaxListeners:O._maxListeners}function r(O,w,R,C){var T,g,_;if(t(R),void 0===(g=O._events)?(g=O._events=Object.create(null),O._eventsCount=0):(void 0!==g.newListener&&(O.emit("newListener",w,R.listener?R.listener:R),g=O._events),_=g[w]),void 0===_)_=g[w]=R,++O._eventsCount;else if("function"==typeof _?_=g[w]=C?[R,_]:[_,R]:C?_.unshift(R):_.push(R),(T=e(O))>0&&_.length>T&&!_.warned){_.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=O,L.type=w,L.count=_.length,function(O){console&&console.warn&&console.warn(O)}(L)}return O}function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(O,w,R){var C={fired:!1,wrapFn:void 0,target:O,type:w,listener:R},T=n.bind(C);return T.listener=R,C.wrapFn=T,T}function v(O,w,R){var C=O._events;if(void 0===C)return[];var T=C[w];return void 0===T?[]:"function"==typeof T?R?[T.listener||T]:[T]:R?function(O){for(var w=new Array(O.length),R=0;R<w.length;++R)w[R]=O[R].listener||O[R];return w}(T):m(T,T.length)}function y(O){var w=this._events;if(void 0!==w){var R=w[O];if("function"==typeof R)return 1;if(void 0!==R)return R.length}return 0}function m(O,w){for(var R=new Array(w),C=0;C<w;++C)R[C]=O[C];return R}function P(O,w,R,C){if("function"==typeof O.on)C.once?O.once(w,R):O.on(w,R);else{if("function"!=typeof O.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O);O.addEventListener(w,function T(g){C.once&&O.removeEventListener(w,T),R(g)})}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(O){if("number"!=typeof O||O<0||o(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");i=O}}),s.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(w){if("number"!=typeof w||w<0||o(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},s.prototype.getMaxListeners=function(){return e(this)},s.prototype.emit=function(w){for(var R=[],C=1;C<arguments.length;C++)R.push(arguments[C]);var T="error"===w,g=this._events;if(void 0!==g)T=T&&void 0===g.error;else if(!T)return!1;if(T){var _;if(R.length>0&&(_=R[0]),_ instanceof Error)throw _;var L=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw L.context=_,L}var I=g[w];if(void 0===I)return!1;if("function"==typeof I)a(I,this,R);else{var M=I.length,A=m(I,M);for(C=0;C<M;++C)a(A[C],this,R)}return!0},s.prototype.on=s.prototype.addListener=function(w,R){return r(this,w,R,!1)},s.prototype.prependListener=function(w,R){return r(this,w,R,!0)},s.prototype.once=function(w,R){return t(R),this.on(w,l(this,w,R)),this},s.prototype.prependOnceListener=function(w,R){return t(R),this.prependListener(w,l(this,w,R)),this},s.prototype.off=s.prototype.removeListener=function(w,R){var C,T,g,_,L;if(t(R),void 0===(T=this._events))return this;if(void 0===(C=T[w]))return this;if(C===R||C.listener===R)0==--this._eventsCount?this._events=Object.create(null):(delete T[w],T.removeListener&&this.emit("removeListener",w,C.listener||R));else if("function"!=typeof C){for(g=-1,_=C.length-1;_>=0;_--)if(C[_]===R||C[_].listener===R){L=C[_].listener,g=_;break}if(g<0)return this;0===g?C.shift():function(O,w){for(;w+1<O.length;w++)O[w]=O[w+1];O.pop()}(C,g),1===C.length&&(T[w]=C[0]),void 0!==T.removeListener&&this.emit("removeListener",w,L||R)}return this},s.prototype.removeAllListeners=function(w){var R,C,T;if(void 0===(C=this._events))return this;if(void 0===C.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==C[w]&&(0==--this._eventsCount?this._events=Object.create(null):delete C[w]),this;if(0===arguments.length){var _,g=Object.keys(C);for(T=0;T<g.length;++T)"removeListener"!==(_=g[T])&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(R=C[w]))this.removeListener(w,R);else if(void 0!==R)for(T=R.length-1;T>=0;T--)this.removeListener(w,R[T]);return this},s.prototype.listeners=function(w){return v(this,w,!0)},s.prototype.rawListeners=function(w){return v(this,w,!1)},s.listenerCount=function(O,w){return"function"==typeof O.listenerCount?O.listenerCount(w):y.call(O,w)},s.prototype.listenerCount=y,s.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}},708:k=>{var S=Object.prototype.hasOwnProperty,a=Object.prototype.toString;k.exports=function(p,o,s){if("[object Function]"!==a.call(o))throw new TypeError("iterator must be a function");var i=p.length;if(i===+i)for(var t=0;t<i;t++)o.call(s,p[t],t,p);else for(var e in p)S.call(p,e)&&o.call(s,p[e],e,p)}},1609:k=>{"use strict";var S="Function.prototype.bind called on incompatible ",a=Array.prototype.slice,d=Object.prototype.toString,p="[object Function]";k.exports=function(s){var i=this;if("function"!=typeof i||d.call(i)!==p)throw new TypeError(S+i);for(var e,t=a.call(arguments,1),r=function(){if(this instanceof e){var m=i.apply(this,t.concat(a.call(arguments)));return Object(m)===m?m:this}return i.apply(s,t.concat(a.call(arguments)))},n=Math.max(0,i.length-t.length),l=[],v=0;v<n;v++)l.push("$"+v);if(e=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(r),i.prototype){var y=function(){};y.prototype=i.prototype,e.prototype=new y,y.prototype=null}return e}},5396:(k,S,a)=>{"use strict";var d=a(1609);k.exports=Function.prototype.bind||d},8540:(k,S,a)=>{"use strict";var d,p=SyntaxError,o=Function,s=TypeError,i=function(L){try{return o('"use strict"; return ('+L+").constructor;")()}catch(I){}},t=Object.getOwnPropertyDescriptor;if(t)try{t({},"")}catch(L){t=null}var e=function(){throw new s},r=t?function(){try{return e}catch(L){try{return t(arguments,"callee").get}catch(I){return e}}}():e,n=a(9326)(),l=Object.getPrototypeOf||function(L){return L.__proto__},v={},y="undefined"==typeof Uint8Array?d:l(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?d:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?d:ArrayBuffer,"%ArrayIteratorPrototype%":n?l([][Symbol.iterator]()):d,"%AsyncFromSyncIteratorPrototype%":d,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?d:Atomics,"%BigInt%":"undefined"==typeof BigInt?d:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?d:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?d:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?d:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?d:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?d:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?d:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?d:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":n?l(l([][Symbol.iterator]())):d,"%JSON%":"object"==typeof JSON?JSON:d,"%Map%":"undefined"==typeof Map?d:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&n?l((new Map)[Symbol.iterator]()):d,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?d:Promise,"%Proxy%":"undefined"==typeof Proxy?d:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?d:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?d:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&n?l((new Set)[Symbol.iterator]()):d,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?d:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":n?l(""[Symbol.iterator]()):d,"%Symbol%":n?Symbol:d,"%SyntaxError%":p,"%ThrowTypeError%":r,"%TypedArray%":y,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?d:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?d:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?d:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?d:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?d:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?d:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?d:WeakSet},f=function L(I){var M;if("%AsyncFunction%"===I)M=i("async function () {}");else if("%GeneratorFunction%"===I)M=i("function* () {}");else if("%AsyncGeneratorFunction%"===I)M=i("async function* () {}");else if("%AsyncGenerator%"===I){var A=L("%AsyncGeneratorFunction%");A&&(M=A.prototype)}else if("%AsyncIteratorPrototype%"===I){var H=L("%AsyncGenerator%");H&&(M=l(H.prototype))}return m[I]=M,M},u={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},c=a(5396),h=a(7709),P=c.call(Function.call,Array.prototype.concat),O=c.call(Function.apply,Array.prototype.splice),w=c.call(Function.call,String.prototype.replace),R=c.call(Function.call,String.prototype.slice),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,g=function(I){var M=R(I,0,1),A=R(I,-1);if("%"===M&&"%"!==A)throw new p("invalid intrinsic syntax, expected closing `%`");if("%"===A&&"%"!==M)throw new p("invalid intrinsic syntax, expected opening `%`");var H=[];return w(I,C,function(U,F,Z,ee){H[H.length]=Z?w(ee,T,"$1"):F||U}),H},_=function(I,M){var H,A=I;if(h(u,A)&&(A="%"+(H=u[A])[0]+"%"),h(m,A)){var U=m[A];if(U===v&&(U=f(A)),void 0===U&&!M)throw new s("intrinsic "+I+" exists, but is not available. Please file an issue!");return{alias:H,name:A,value:U}}throw new p("intrinsic "+I+" does not exist!")};k.exports=function(I,M){if("string"!=typeof I||0===I.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof M)throw new s('"allowMissing" argument must be a boolean');var A=g(I),H=A.length>0?A[0]:"",U=_("%"+H+"%",M),F=U.name,Z=U.value,ee=!1,J=U.alias;J&&(H=J[0],O(A,P([0,1],J)));for(var V=1,D=!0;V<A.length;V+=1){var E=A[V],b=R(E,0,1),B=R(E,-1);if(('"'===b||"'"===b||"`"===b||'"'===B||"'"===B||"`"===B)&&b!==B)throw new p("property names with quotes must have matching quotes");if(("constructor"===E||!D)&&(ee=!0),h(m,F="%"+(H+="."+E)+"%"))Z=m[F];else if(null!=Z){if(!(E in Z)){if(!M)throw new s("base intrinsic for "+I+" exists, but the property is not available.");return}if(t&&V+1>=A.length){var Q=t(Z,E);Z=(D=!!Q)&&"get"in Q&&!("originalValue"in Q.get)?Q.get:Z[E]}else D=h(Z,E),Z=Z[E];D&&!ee&&(m[F]=Z)}}return Z}},9326:(k,S,a)=>{"use strict";var d="undefined"!=typeof Symbol&&Symbol,p=a(9045);k.exports=function(){return"function"==typeof d&&"function"==typeof Symbol&&"symbol"==typeof d("foo")&&"symbol"==typeof Symbol("bar")&&p()}},9045:k=>{"use strict";k.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var a={},d=Symbol("test"),p=Object(d);if("string"==typeof d||"[object Symbol]"!==Object.prototype.toString.call(d)||"[object Symbol]"!==Object.prototype.toString.call(p))return!1;for(d in a[d]=42,a)return!1;if("function"==typeof Object.keys&&0!==Object.keys(a).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(a).length)return!1;var s=Object.getOwnPropertySymbols(a);if(1!==s.length||s[0]!==d||!Object.prototype.propertyIsEnumerable.call(a,d))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(a,d);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},1407:(k,S,a)=>{"use strict";var d=a(9045);k.exports=function(){return d()&&!!Symbol.toStringTag}},7709:(k,S,a)=>{"use strict";var d=a(5396);k.exports=d.call(Function.call,Object.prototype.hasOwnProperty)},9879:k=>{k.exports="function"==typeof Object.create?function(a,d){d&&(a.super_=d,a.prototype=Object.create(d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:function(a,d){if(d){a.super_=d;var p=function(){};p.prototype=d.prototype,a.prototype=new p,a.prototype.constructor=a}}},7316:(k,S,a)=>{"use strict";var d=a(1407)(),o=a(9568)("Object.prototype.toString"),s=function(r){return!(d&&r&&"object"==typeof r&&Symbol.toStringTag in r)&&"[object Arguments]"===o(r)},i=function(r){return!!s(r)||null!==r&&"object"==typeof r&&"number"==typeof r.length&&r.length>=0&&"[object Array]"!==o(r)&&"[object Function]"===o(r.callee)},t=function(){return s(arguments)}();s.isLegacyArguments=i,k.exports=t?s:i},2197:(k,S,a)=>{"use strict";var e,d=Object.prototype.toString,p=Function.prototype.toString,o=/^\s*(?:function)?\*/,s=a(1407)(),i=Object.getPrototypeOf;k.exports=function(n){if("function"!=typeof n)return!1;if(o.test(p.call(n)))return!0;if(!s)return"[object GeneratorFunction]"===d.call(n);if(!i)return!1;if(void 0===e){var v=function(){if(!s)return!1;try{return Function("return function*() {}")()}catch(r){}}();e=!!v&&i(v)}return i(n)===e}},7579:(k,S,a)=>{"use strict";var d=a(708),p=a(5127),o=a(9568),s=o("Object.prototype.toString"),i=a(1407)(),t="undefined"==typeof globalThis?global:globalThis,e=p(),r=o("Array.prototype.indexOf",!0)||function(u,c){for(var h=0;h<u.length;h+=1)if(u[h]===c)return h;return-1},n=o("String.prototype.slice"),l={},v=a(7168),y=Object.getPrototypeOf;i&&v&&y&&d(e,function(f){var u=new t[f];if(Symbol.toStringTag in u){var c=y(u),h=v(c,Symbol.toStringTag);if(!h){var P=y(c);h=v(P,Symbol.toStringTag)}l[f]=h.get}}),k.exports=function(u){if(!u||"object"!=typeof u)return!1;if(!i||!(Symbol.toStringTag in u)){var c=n(s(u),8,-1);return r(e,c)>-1}return!!v&&function(u){var c=!1;return d(l,function(h,P){if(!c)try{c=h.call(u)===P}catch(O){}}),c}(u)}},3726:(k,S,a)=>{k.exports=a(1637)},1637:(k,S,a)=>{var d=a(1732),p=k.exports=a(2628);function o(r,n,l,v){var m=new r(d.format.apply(this,[l=l||""].concat(v)));throw Error.captureStackTrace(m,n),m}function s(r,n,l){o(p.IllegalArgumentError,r,n,l)}function i(r,n,l){o(p.IllegalStateError,r,n,l)}function t(r){var n=typeof r;if("object"==n){if(!r)return"null";if(r instanceof Array)return"array"}return n}function e(r){return function(n,l){var v=t(n);if(v==r)return n;s(arguments.callee,l||'Expected "'+r+'" but got "'+v+'".',Array.prototype.slice.call(arguments,2))}}k.exports.checkArgument=function(r,n){r||s(arguments.callee,n,Array.prototype.slice.call(arguments,2))},k.exports.checkState=function(r,n){r||i(arguments.callee,n,Array.prototype.slice.call(arguments,2))},k.exports.checkIsDef=function(r,n){if(void 0!==r)return r;s(arguments.callee,n||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},k.exports.checkIsDefAndNotNull=function(r,n){if(null!=r)return r;s(arguments.callee,n||'Expected value to be defined and not null but got "'+t(r)+'".',Array.prototype.slice.call(arguments,2))},k.exports.checkIsString=e("string"),k.exports.checkIsArray=e("array"),k.exports.checkIsNumber=e("number"),k.exports.checkIsBoolean=e("boolean"),k.exports.checkIsFunction=e("function"),k.exports.checkIsObject=e("object")},2628:(k,S,a)=>{var d=a(1732);function p(s){Error.call(this,s),this.message=s}function o(s){Error.call(this,s),this.message=s}d.inherits(p,Error),p.prototype.name="IllegalArgumentError",d.inherits(o,Error),o.prototype.name="IllegalStateError",k.exports.IllegalStateError=o,k.exports.IllegalArgumentError=p},4209:(k,S,a)=>{"use strict";var d=a(617);k.exports=function(o,s,i,t){var e,r=new Error("Canceled");return new d(function(l,v,y){var m;o(function(u){return y()?d.reject(r):(m=s(u),i(m).then(function(h){if(y())throw r;return e=h()}))}).then(function(u){if(y())throw u.disconnect(),r;l(t(m,u))}).catch(function(u){v(u)})},function(){e&&e.cancel()})}},3232:(k,S,a)=>{"use strict";var d=a(4135).MediaStreamTrack,p=a(4911),o=p.guessBrowser,s=p.guessBrowserVersion,i=a(4209),t=a(5085),e=a(3472),r=a(3066),n=a(7217),l=a(1865),v=l.LocalAudioTrack,y=l.LocalDataTrack,m=l.LocalVideoTrack,f=a(6062),u=a(7970),c=a(9003),h=a(3761),P=h.asLocalTrack,O=h.buildLogLevels,w=h.filterObject,R=h.isNonArrayObject,C=a(9917),T=C.DEFAULT_ENVIRONMENT,g=C.DEFAULT_LOG_LEVEL,_=C.DEFAULT_LOGGER_NAME,L=C.DEFAULT_REALM,I=C.DEFAULT_REGION,M=C.WS_SERVER,A=C.SDK_NAME,H=C.SDK_VERSION,U=C.typeErrors,F=a(617),Z=a(8326),ee=a(7394),J=a(6901).kG,V="safari"===o()&&s(),D=0,E=!1,b=!1;if(V){var B=V.major;b=B<12||12===B&&V.minor<1}var q=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),K=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function $(Y,N,re){re.forEach(function(fe){var Se=fe.didWarn,_e=fe.name,Te=fe.newName,Pe=fe.shouldDelete;_e in Y&&void 0!==Y[_e]&&(Te&&Pe&&(Y[Te]=Y[_e]),Pe&&delete Y[_e],!Se&&!["error","off"].includes(N.level)&&(N.warn('The ConnectOptions "'+_e+'" is '+(Te?'deprecated and scheduled for removal. Please use "'+Te+'" instead.':"no longer applicable and will be ignored.")),fe.didWarn=!0))})}function te(Y,N,re,fe,Se,_e){var Te=Y.createLocalParticipantSignaling(re,fe);return N.debug("Creating a new LocalParticipant:",Te),new Se.LocalParticipant(Te,_e,Se)}function ne(Y,N,re){var fe=new u(N,re,Y),Se=Y.log;return Se.debug("Creating a new Room:",fe),re.on("stateChanged",function _e(Te){"disconnected"===Te&&(Se.info("Disconnected from Room:",fe.toString()),re.removeListener("stateChanged",_e))}),fe}function W(Y,N,re,fe,Se,_e){return N.log.debug("Creating a new RoomSignaling"),re.connect(_e._signaling,Y,fe,Se,N)}function j(Y,N){var re=Y.log;return Y.shouldStopLocalTracks=!Y.tracks,Y.shouldStopLocalTracks?re.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(re.info("Getting LocalTracks"),re.debug("Options:",Y)),Y.createLocalTracks(Y).then(function(Se){var _e=N(Se);return _e.catch(function(){Y.shouldStopLocalTracks&&(re.info("The automatically acquired LocalTracks will now be stopped"),Se.forEach(function(Pe){Pe.stop()}))}),_e})}function x(Y){var N="string"==typeof Y?{codec:Y}:Y;switch(N.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},N);case"vp8":return Object.assign({simulcast:!1},N);default:return N}}k.exports=function(Y,N){if(void 0===N&&(N={}),!R(N))return F.reject(U.INVALID_TYPE("options","object"));var Pe,re=N.Log||ee,fe=N.loggerName||_,Se=N.logLevel||g,_e=O(Se),Te="[connect #"+ ++D+"]";try{Pe=new re("default",Te,_e,fe)}catch(ge){return F.reject(ge)}$(N,Pe,q);var Ie="auto"===N.preferredVideoCodecs;if(Ie&&(N.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),N.maxVideoBitrate&&Ie)return Pe.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),F.reject(U.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));var de={};"string"==typeof(N=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:T,eventListener:null,insights:!0,LocalAudioTrack:v,LocalDataTrack:y,LocalParticipant:e,LocalVideoTrack:m,Log:re,MediaStreamTrack:d,loggerName:fe,logLevel:Se,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:L,region:I,signaling:c},w(N))).wsServerInsights&&(de.gateway=N.wsServerInsights);var G=new(N.insights?r:n)(Y,A,H,N.environment,N.realm,de),z=M(N.environment,N.region),ie=new Z(G,Date.now(),Pe,N.eventListener);if((N=Object.assign({eventObserver:ie,wsServer:z},N)).log=Pe,b&&!E&&"error"!==Pe.logLevel&&"off"!==Pe.logLevel&&(E=!0,Pe.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),"string"!=typeof Y)return F.reject(U.INVALID_TYPE("token","string"));var oe=Object.assign({},N);if(delete oe.name,"tracks"in N){if(!Array.isArray(N.tracks))return F.reject(U.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{N.tracks=N.tracks.map(function(ge){return P(ge,oe)})}catch(ge){return F.reject(ge)}}var ue=J(N.bandwidthProfile);if(ue)return F.reject(ue);N.clientTrackSwitchOffControl="disabled",N.contentPreferencesMode="disabled",N.bandwidthProfile&&(N.clientTrackSwitchOffControl="auto",N.contentPreferencesMode="auto",N.bandwidthProfile.video&&($(N.bandwidthProfile.video,Pe,K),N.clientTrackSwitchOffControl="maxTracks"in N.bandwidthProfile.video?"disabled":"manual"===N.bandwidthProfile.video.clientTrackSwitchOffControl?"manual":"auto",N.contentPreferencesMode="renderDimensions"in N.bandwidthProfile.video?"disabled":"manual"===N.bandwidthProfile.video.contentPreferencesMode?"manual":"auto"));var Ce=new(0,N.signaling)(N.wsServer,N);Pe.info("Connecting to a Room"),Pe.debug("Options:",N);var Ae=new t({maxAudioBitrate:N.maxAudioBitrate,maxVideoBitrate:N.maxVideoBitrate},Ie),xe={audio:N.preferredAudioCodecs.map(x),video:N.preferredVideoCodecs.map(x)},Oe=new f(R(N.networkQuality)?N.networkQuality:{}),Re=i(j.bind(null,N),te.bind(null,Ce,Pe,Ae,Oe,N),W.bind(null,Y,N,Ce,Ae,xe),ne.bind(null,N));return Re.then(function(ge){return G.connect(ge.sid,ge.localParticipant.sid),Pe.info("Connected to Room:",ge.toString()),Pe.info("Room name:",ge.name),Pe.debug("Room:",ge),ge.once("disconnected",function(){return G.disconnect()}),ge},function(ge){G.disconnect(),Re._isCanceled?Pe.info("Attempt to connect to a Room was canceled"):Pe.info("Error while connecting to a Room:",ge)}),Re}},9292:(k,S,a)=>{"use strict";var d=a(9917),p=d.DEFAULT_LOG_LEVEL,o=d.DEFAULT_LOGGER_NAME;function s(e,r){r=Object.assign({loggerName:o,logLevel:p},r);var n={};n.loggerName=r.loggerName,n.logLevel=r.logLevel,delete r.loggerName,delete r.logLevel;var l=r.createLocalTracks;return delete r.createLocalTracks,n[e]=!(Object.keys(r).length>0)||r,l(n).then(function(v){return v[0]})}k.exports={audio:function(e){return s("audio",e)},video:function(e){return s("video",e)}}},8953:function(k,S,a){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(T){for(var g,_=1,L=arguments.length;_<L;_++)for(var I in g=arguments[_])Object.prototype.hasOwnProperty.call(g,I)&&(T[I]=g[I]);return T}).apply(this,arguments)},p=this&&this.__awaiter||function(T,g,_,L){return new(_||(_=Promise))(function(M,A){function H(Z){try{F(L.next(Z))}catch(ee){A(ee)}}function U(Z){try{F(L.throw(Z))}catch(ee){A(ee)}}function F(Z){Z.done?M(Z.value):function(M){return M instanceof _?M:new _(function(A){A(M)})}(Z.value).then(H,U)}F((L=L.apply(T,g||[])).next())})},o=this&&this.__generator||function(T,g){var L,I,M,A,_={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return A={next:H(0),throw:H(1),return:H(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function H(F){return function(Z){return function(F){if(L)throw new TypeError("Generator is already executing.");for(;_;)try{if(L=1,I&&(M=2&F[0]?I.return:F[0]?I.throw||((M=I.return)&&M.call(I),0):I.next)&&!(M=M.call(I,F[1])).done)return M;switch(I=0,M&&(F=[2&F[0],M.value]),F[0]){case 0:case 1:M=F;break;case 4:return _.label++,{value:F[1],done:!1};case 5:_.label++,I=F[1],F=[0];continue;case 7:F=_.ops.pop(),_.trys.pop();continue;default:if(!(M=(M=_.trys).length>0&&M[M.length-1])&&(6===F[0]||2===F[0])){_=0;continue}if(3===F[0]&&(!M||F[1]>M[0]&&F[1]<M[3])){_.label=F[1];break}if(6===F[0]&&_.label<M[1]){_.label=M[1],M=F;break}if(M&&_.label<M[2]){_.label=M[2],_.ops.push(F);break}M[2]&&_.ops.pop(),_.trys.pop();continue}F=g.call(T,_)}catch(Z){F=[6,Z],I=0}finally{L=M=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([F,Z])}}},s=this&&this.__read||function(T,g){var _="function"==typeof Symbol&&T[Symbol.iterator];if(!_)return T;var I,A,L=_.call(T),M=[];try{for(;(void 0===g||g-- >0)&&!(I=L.next()).done;)M.push(I.value)}catch(H){A={error:H}}finally{try{I&&!I.done&&(_=L.return)&&_.call(L)}finally{if(A)throw A.error}}return M},i=this&&this.__spreadArray||function(T,g){for(var _=0,L=g.length,I=T.length;_<L;_++,I++)T[I]=g[_];return T};Object.defineProperty(S,"__esModule",{value:!0}),S.createLocalTracks=void 0;var t=a(3761),e=t.asLocalTrack,r=t.buildLogLevels,n=a(4135),l=n.getUserMedia,v=n.MediaStreamTrack,y=a(1865),m=y.LocalAudioTrack,f=y.LocalDataTrack,u=y.LocalVideoTrack,c=a(7394),h=a(9917),P=h.DEFAULT_LOG_LEVEL,O=h.DEFAULT_LOGGER_NAME,w=a(8201),R=0;S.createLocalTracks=function(T){return p(this,void 0,void 0,function(){var g,_,L,I,M,A,H,U,F,Z,ee,J;return o(this,function(V){switch(V.label){case 0:if(_=d({audio:g=!(T&&("audio"in T||"video"in T)),getUserMedia:l,loggerName:O,logLevel:P,LocalAudioTrack:m,LocalDataTrack:f,LocalVideoTrack:u,MediaStreamTrack:v,Log:c,video:g},T),L="[createLocalTracks #"+ ++R+"]",I=r(_.logLevel),M=new _.Log("default",L,I,_.loggerName),delete(A=Object.assign({log:M},_)).name,!1===_.audio&&!1===_.video)return M.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(_.tracks)return M.info("Adding user-provided LocalTracks"),M.debug("LocalTracks:",_.tracks),[2,_.tracks];(H={audio:"object"==typeof _.audio&&_.audio.name?{name:_.audio.name}:{},video:"object"==typeof _.video&&_.video.name?{name:_.video.name}:{}}).audio.isCreatedByCreateLocalTracks=!0,H.video.isCreatedByCreateLocalTracks=!0,"object"==typeof _.audio&&"boolean"==typeof _.audio.workaroundWebKitBug1208516&&(H.audio.workaroundWebKitBug1208516=_.audio.workaroundWebKitBug1208516),"object"==typeof _.video&&"boolean"==typeof _.video.workaroundWebKitBug1208516&&(H.video.workaroundWebKitBug1208516=_.video.workaroundWebKitBug1208516),"object"==typeof _.audio&&delete _.audio.name,"object"==typeof _.video&&delete _.video.name,U={audio:_.audio,video:_.video},F="object"==typeof _.audio&&_.audio.workaroundWebKitBug180748,V.label=1;case 1:return V.trys.push([1,3,,4]),[4,F?w(M,_.getUserMedia,U):_.getUserMedia(U)];case 2:return Z=V.sent(),ee=i(i([],s(Z.getAudioTracks())),s(Z.getVideoTracks())),M.info("Call to getUserMedia successful; got MediaStreamTracks:",ee),[2,ee.map(function(D){return e(D,d(d({},H[D.kind]),A))})];case 3:throw J=V.sent(),M.warn("Call to getUserMedia failed:",J),J;case 4:return[2]}})})}},1144:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(747),o=a(2630),s=function(i){function t(e){var r=i.call(this,e.label,e.maxPacketLifeTime,e.maxRetransmits,e.ordered)||this;return Object.defineProperties(r,{_dataChannel:{value:e}}),e.binaryType="arraybuffer",e.addEventListener("message",function(n){r.emit("message",n.data)}),e.addEventListener("close",function(){r.emit("close")}),r}return d(t,i),t.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},t.prototype.toDataTransport=function(){return new o(this._dataChannel)},t}(p);k.exports=s},920:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(747),o=a(3761).makeUUID,s=function(i){function t(e,r,n){var l=i.call(this,o(),e,r,n)||this;return Object.defineProperties(l,{_clones:{value:new Set},_dataChannels:{value:new Set}}),l}return d(t,i),t.prototype._addClone=function(e){this._clones.add(e)},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.addDataChannel=function(e){return this._dataChannels.add(e),this},t.prototype.clone=function(){var e=this,r=new t(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(r),r.once("stopped",function(){return e.removeClone(r)}),r},t.prototype.removeDataChannel=function(e){return this._dataChannels.delete(e),this},t.prototype.send=function(e){return this._dataChannels.forEach(function(r){try{r.send(e)}catch(n){}}),this._clones.forEach(function(r){try{r.send(e)}catch(n){}}),this},t.prototype.stop=function(){this._dataChannels.forEach(function(e){return e.close()}),this._clones.forEach(function(e){return e.stop()}),i.prototype.stop.call(this)},t}(p);k.exports=s},747:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){var l=s.call(this,t,"data")||this;return Object.defineProperties(l,{maxPacketLifeTime:{enumerable:!0,value:e},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:n}}),l}return d(i,s),i}(a(8699));k.exports=o},2630:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){var e=s.call(this)||this;return Object.defineProperties(e,{_dataChannel:{value:t},_messageQueue:{value:[]}}),t.addEventListener("open",function(){e._messageQueue.splice(0).forEach(function(r){return e._publish(r)})}),t.addEventListener("message",function(r){var n=r.data;try{var l=JSON.parse(n);e.emit("message",l)}catch(v){}}),e.publish({type:"ready"}),e}return d(i,s),i.prototype._publish=function(t){var e=JSON.stringify(t);try{this._dataChannel.send(e)}catch(r){}},i.prototype.publish=function(t){var e=this._dataChannel;return"closing"!==e.readyState&&"closed"!==e.readyState&&("connecting"===e.readyState?(this._messageQueue.push(t),!0):(this._publish(t),!0))},i}(a(3105).EventEmitter);k.exports=o},5085:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return t=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},t),Object.defineProperties(r,{maxAudioBitrate:{value:t.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:t.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:e}}),r}return d(i,s),i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(t){var e=this;t=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},t),["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,l){return e[l]!==t[l]&&(e[l]=t[l],n=!0),n},!1)&&this.emit("changed")},i}(a(3105).EventEmitter);k.exports=o},5737:(k,S,a)=>{"use strict";var d=a(3105).EventEmitter,p=a(3761).hidePrivateAndCertainPublicPropertiesInClass;k.exports=p(d,["domain"])},8987:function(k,S,a){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(f){for(var u,c=1,h=arguments.length;c<h;c++)for(var P in u=arguments[c])Object.prototype.hasOwnProperty.call(u,P)&&(f[P]=u[P]);return f}).apply(this,arguments)};Object.defineProperty(S,"__esModule",{value:!0});var p=a(8953),o=a(712),s={connect:a(3232),createLocalAudioTrack:a(9292).audio,createLocalVideoTrack:a(9292).video,isSupported:a(563)(),version:a(1730).version,Logger:a(6828),LocalAudioTrack:a(1865).LocalAudioTrack,LocalDataTrack:a(1865).LocalDataTrack,LocalVideoTrack:a(1865).LocalVideoTrack};k.exports={connect:function(f,u){var c=d({createLocalTracks:p.createLocalTracks},u);return s.connect(f,c)},createLocalAudioTrack:function(f){var u=d({createLocalTracks:p.createLocalTracks},f);return s.createLocalAudioTrack(u)},createLocalVideoTrack:function(f){var u=d({createLocalTracks:p.createLocalTracks},f);return s.createLocalVideoTrack(u)},createLocalTracks:p.createLocalTracks,runPreflight:o.runPreflight,isSupported:s.isSupported,version:s.version,Logger:s.Logger,LocalAudioTrack:s.LocalAudioTrack,LocalVideoTrack:s.LocalVideoTrack,LocalDataTrack:s.LocalDataTrack}},3472:function(k,S,a){"use strict";var R,d=this&&this.__extends||(R=function(C,T){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var L in _)Object.prototype.hasOwnProperty.call(_,L)&&(g[L]=_[L])})(C,T)},function(C,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function g(){this.constructor=C}R(C,T),C.prototype=null===T?Object.create(T):(g.prototype=T.prototype,new g)}),p=a(4135).MediaStreamTrack,o=a(3761),s=o.asLocalTrack,i=o.asLocalTrackPublication,t=o.trackClass,e=a(9917),r=e.typeErrors,n=e.trackPriority,l=a(6901).Wv,v=a(1865),y=v.LocalAudioTrack,m=v.LocalDataTrack,f=v.LocalVideoTrack,u=a(4167),c=a(7969),h=a(6156),O=function(R){function C(T,g,_){var L=this,I=(_=Object.assign({LocalAudioTrack:y,LocalVideoTrack:f,LocalDataTrack:m,MediaStreamTrack:p,LocalAudioTrackPublication:u,LocalVideoTrackPublication:h,LocalDataTrackPublication:c,shouldStopLocalTracks:!1,tracks:g},_)).shouldStopLocalTracks?new Set(g.filter(function(M){return"data"!==M.kind})):new Set;return L=R.call(this,T,_)||this,Object.defineProperties(L,{_eventObserver:{value:_.eventObserver},_LocalAudioTrack:{value:_.LocalAudioTrack},_LocalDataTrack:{value:_.LocalDataTrack},_LocalVideoTrack:{value:_.LocalVideoTrack},_MediaStreamTrack:{value:_.MediaStreamTrack},_LocalAudioTrackPublication:{value:_.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:_.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:_.LocalVideoTrackPublication},_tracksToStop:{value:I},signalingRegion:{enumerable:!0,get:function(){return T.signalingRegion}}}),L._handleTrackSignalingEvents(),L}return d(C,R),C.prototype._addTrack=function(T,g,_){var L=R.prototype._addTrack.call(this,T,g);return L&&"disconnected"!==this.state&&this._addLocalTrack(T,_),L},C.prototype._addLocalTrack=function(T,g){this._signaling.addTrack(T._trackSender,T.name,g),this._log.info("Added a new "+t(T,!0)+":",T.id),this._log.debug(t(T,!0)+":",T)},C.prototype._removeTrack=function(T,g){var _=R.prototype._removeTrack.call(this,T,g);return _&&"disconnected"!==this.state&&(this._signaling.removeTrack(T._trackSender),this._log.info("Removed a "+t(T,!0)+":",T.id),this._log.debug(t(T,!0)+":",T)),_},C.prototype._getTrackEvents=function(){return R.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},C.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},C.prototype._handleTrackSignalingEvents=function(){var T=this,g=this._log;if("disconnected"!==this.state){var _=this._signaling;this.on("trackDisabled",L),this.on("trackEnabled",I),this.on("trackStopped",M),this._tracks.forEach(function(H){T._addLocalTrack(H,n.PRIORITY_STANDARD),T._getOrCreateLocalTrackPublication(H).catch(function(U){g.warn("Failed to get or create LocalTrackPublication for "+H+":",U)})});var A=this;_.on("stateChanged",function H(U){g.debug("Transitioned to state:",U),"disconnected"===U?(g.debug("Removing LocalTrack event listeners"),_.removeListener("stateChanged",H),A.removeListener("trackDisabled",L),A.removeListener("trackEnabled",I),A.removeListener("trackStopped",M),A._tracks.forEach(function(F){var Z=M(F);Z&&F._trackSender.removeClone(Z._trackTransceiver)}),g.info("LocalParticipant disconnected. Stopping "+A._tracksToStop.size+" automatically-acquired LocalTracks"),A._tracksToStop.forEach(function(F){F.stop()})):"connected"===U&&(g.info("reconnected"),setTimeout(function(){return A.emit("reconnected")},0))})}function L(H){var U=_.getPublication(H._trackSender);U&&(U.disable(),g.debug("Disabled the "+t(H,!0)+":",H.id))}function I(H){var U=_.getPublication(H._trackSender);U&&(U.enable(),g.debug("Enabled the "+t(H,!0)+":",H.id))}function M(H){var U=_.getPublication(H._trackSender);return U&&U.stop(),U}},C.prototype._getOrCreateLocalTrackPublication=function(T){var g=w(this.tracks,T);if(g)return Promise.resolve(g);var _=this._log,L=this,I=this._signaling.getPublication(T._trackSender);if(!I)return Promise.reject(new Error("Unexpected error: The "+T+" cannot be published"));function M(A){L.unpublishTrack(A.track)}return new Promise(function(A,H){I.on("updated",function U(){var F=I.error;if(F)return I.removeListener("updated",U),_.warn("Failed to publish the "+t(T,!0)+": "+F.message),L._removeTrack(T,T.id),setTimeout(function(){L.emit("trackPublicationFailed",F,T)}),void H(F);if(!L._tracks.has(T.id))return I.removeListener("updated",U),void H(new Error("The "+T+" was unpublished"));if(I.sid){I.removeListener("updated",U);var ee={log:_,LocalAudioTrackPublication:L._LocalAudioTrackPublication,LocalDataTrackPublication:L._LocalDataTrackPublication,LocalVideoTrackPublication:L._LocalVideoTrackPublication};(g=w(L.tracks,T))||(g=i(T,I,M,ee),L._addTrackPublication(g));var J=L._signaling.state;("connected"===J||"connecting"===J)&&(T._processorEventObserver&&T._processorEventObserver.on("event",function(V){L._eventObserver.emit("event",{name:V.name,payload:V.data,group:"video-processor",level:"info"})}),T.processedTrack&&(T._captureFrames(),T._setSenderMediaStreamTrack(!0))),"connected"===J&&setTimeout(function(){L.emit("trackPublished",g)}),A(g)}})})},C.prototype.publishTrack=function(T,g){var L,_=w(this.tracks,T);if(_)return Promise.resolve(_);g=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},g);try{L=s(T,g)}catch(A){return Promise.reject(A)}var I=Object.values(n);if(!I.includes(g.priority))return Promise.reject(r.INVALID_VALUE("LocalTrackPublishOptions.priority",I));var M=this._addTrack(L,L.id,g.priority)||this._tracks.get(L.id);return this._getOrCreateLocalTrackPublication(M)},C.prototype.publishTracks=function(T){if(!Array.isArray(T))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(T.map(this.publishTrack,this))},C.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},C.prototype.setNetworkQualityConfiguration=function(T){if("object"!=typeof T||null===T)throw r.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(g){if(g in T&&("number"!=typeof T[g]||isNaN(T[g])))throw r.INVALID_TYPE("networkQualityConfiguration."+g,"number")}),this._signaling.setNetworkQualityConfiguration(T),this},C.prototype.setParameters=function(T){if(void 0!==T&&"object"!=typeof T)throw r.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(T){if(this._signaling.getParameters().adaptiveSimulcast&&T.maxVideoBitrate)throw r.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(g){if(void 0!==T[g]&&"number"!=typeof T[g]&&null!==T[g])throw r.INVALID_TYPE("encodingParameters."+g,"number, null or undefined")})}else null===T&&(T={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(T),this},C.prototype.unpublishTrack=function(T){l(T,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var g=this._tracks.get(T.id);if(!g)return null;if(this._signaling.getPublication(g._trackSender).publishFailed(new Error("The "+g+" was unpublished")),!(g=this._removeTrack(g,g.id)))return null;var L=w(this.tracks,g);return L&&this._removeTrackPublication(L),L},C.prototype.unpublishTracks=function(T){var g=this;if(!Array.isArray(T))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return T.reduce(function(_,L){var I=g.unpublishTrack(L);return I?_.concat(I):_},[])},C}(a(5513));function w(R,C){return Array.from(R.values()).find(function(T){return T.track===C||T.track.mediaStreamTrack===C})||null}k.exports=O},13:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype._start=function(){s.prototype._start.call(this),this._dummyEl&&(this._dummyEl.srcObject=null,this._dummyEl=null)},i.prototype.attach=function(){return s.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return s.prototype.detach.apply(this,arguments)},i}(a(3014));k.exports=o},1865:(k,S,a)=>{"use strict";k.exports={LocalAudioTrack:a(7121),LocalVideoTrack:a(9646),LocalDataTrack:a(7913)}},7121:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(7292);function o(s,i){var t=new p(s,i);return Object.setPrototypeOf(t,o.prototype),t}d(o,p),k.exports=o},7913:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(1317);function o(s){var i=new p(s);return Object.setPrototypeOf(i,o.prototype),i}d(o,p),k.exports=o},9646:(k,S,a)=>{"use strict";var d=a(1732).inherits,p=a(149);function o(s,i){var t=new p(s,i);return Object.setPrototypeOf(t,o.prototype),t}d(o,p),k.exports=o},5142:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(5737),o=a(3761),s=o.buildLogLevels,i=o.valueToJSON,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=0,n=function(l){function v(y,m,f){var u;f=Object.assign({name:y,log:null,logLevel:t},f),u=l.call(this)||this;var c=String(f.name),h=s(f.logLevel),P=f.log?f.log.createLog("media",u):new e("media",u,h,f.loggerName);return Object.defineProperties(u,{_instanceId:{value:++r},_log:{value:P},kind:{enumerable:!0,value:m},name:{enumerable:!0,value:c}}),u}return d(v,l),v.prototype.toJSON=function(){return i(this)},v}(p);k.exports=n},7292:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(13),i=function(t){function e(r,n){return t.call(this,r,n)||this}return d(e,t),e.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},e.prototype.attach=function(r){return(r=t.prototype.attach.call(this,r)).muted=!0,r},e.prototype._end=function(){return t.prototype._end.apply(this,arguments)},e.prototype.disable=function(){return t.prototype.disable.apply(this,arguments)},e.prototype.enable=function(){return t.prototype.enable.apply(this,arguments)},e.prototype.restart=function(){return t.prototype.restart.apply(this,arguments)},e.prototype.stop=function(){return t.prototype.stop.apply(this,arguments)},e}(a(6217)(p));k.exports=i},4167:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},1317:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(5142),o=a(920),s=function(i){function t(e){var r,l=new(0,(e=Object.assign({DataTrackSender:o,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},e)).DataTrackSender)(e.maxPacketLifeTime,e.maxRetransmits,e.ordered);return r=i.call(this,l.id,"data",e)||this,Object.defineProperties(r,{_trackSender:{value:l},id:{enumerable:!0,value:l.id},maxPacketLifeTime:{enumerable:!0,value:e.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:e.maxRetransmits},ordered:{enumerable:!0,value:e.ordered},reliable:{enumerable:!0,value:null===e.maxPacketLifeTime&&null===e.maxRetransmits}}),r}return d(t,i),t.prototype.send=function(e){this._trackSender.send(e)},t}(p);k.exports=s},7969:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},6217:function(k,S,a){"use strict";var R,d=this&&this.__extends||(R=function(C,T){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var L in _)Object.prototype.hasOwnProperty.call(_,L)&&(g[L]=_[L])})(C,T)},function(C,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function g(){this.constructor=C}R(C,T),C.prototype=null===T?Object.create(T):(g.prototype=T.prototype,new g)}),p=a(4135).getUserMedia,o=a(4911),s=o.guessBrowser,i=o.isIOSChrome,t=a(3761),e=t.capitalize,r=t.defer,n=t.isUserMediaTrack,l=t.waitForSometime,v=t.waitForEvent,y=a(9917).typeErrors.ILLEGAL_INVOKE,m=a(3305),f=a(4139),u=a(296),c=a(9388),h=a(8201),P=a(5550);function w(R){var C=R._log,T=R.kind,g={audio:m,video:f}[T],_=R._dummyEl,L=R.mediaStreamTrack,I=null;function H(){return Promise.race([v(L,"unmute"),l(50)]).then(function(){return D=R.mediaStreamTrack.muted,E=R.isStopped&&!!R._workaroundWebKitBug1208516Cleanup,Promise.resolve().then(function(){return"visible"===document.visibilityState&&!I&&(D||E||_.play().then(function(){return g(_)}).then(function(J){return J?C.warn("Silence detected"):C.info("Non-silence detected"),J}).catch(function(J){C.warn("Failed to detect silence:",J)}).finally(function(){_.pause()}))});var D,E}).then(function(J){return J&&!I&&(I=r(),R._restart().finally(function(){_=R._dummyEl,Z(),L=R.mediaStreamTrack,F(),I.resolve(),I=null}).catch(function(D){C.error("failed to restart track: ",D)})),(I&&I.promise||Promise.resolve()).finally(function(){return c.resolveDeferred(T)})}).catch(function(J){C.error("error in maybeRestart: "+J.message)})}function U(){var J=R._log,V=R.kind;J.info("Muted"),J.debug("LocalMediaTrack:",R),c.startDeferred(V)}function F(){L.addEventListener("ended",H),L.addEventListener("mute",U),L.addEventListener("unmute",H)}function Z(){L.removeEventListener("ended",H),L.removeEventListener("mute",U),L.removeEventListener("unmute",H)}var ee=function(J){return!!J&&H()};return u.onVisibilityChange(1,ee),F(),function(){u.offVisibilityChange(1,ee),Z()}}k.exports=function(R){return function(C){function T(g,_){var L=this,I=("safari"===s()||i())&&n(g)&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState;_=Object.assign({getUserMedia:p,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:I,gUMSilentTrackWorkaround:h},_);var M=new P(g),A=M.kind;return L=C.call(this,M,_)||this,Object.defineProperties(L,{_constraints:{value:"object"==typeof _[A]?_[A]:{},writable:!0},_getUserMedia:{value:_.getUserMedia},_gUMSilentTrackWorkaround:{value:_.gUMSilentTrackWorkaround},_workaroundWebKitBug1208516:{value:_.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:_.isCreatedByCreateLocalTracks},_trackSender:{value:M},id:{enumerable:!0,value:M.id},isEnabled:{enumerable:!0,get:function(){return M.enabled}},isStopped:{enumerable:!0,get:function(){return"ended"===M.readyState}}}),L._workaroundWebKitBug1208516&&(L._workaroundWebKitBug1208516Cleanup=w(L)),L}return d(T,C),T.prototype._end=function(){this._didCallEnd||(C.prototype._end.call(this),this._didCallEnd=!0,this.emit("stopped",this))},T.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),C.prototype._initialize.call(this)},T.prototype._reacquireTrack=function(g){var _,L=this,I=L._getUserMedia,M=L._gUMSilentTrackWorkaround,A=L._log,H=L.mediaStreamTrack.kind;A.info("Re-acquiring the MediaStreamTrack"),A.debug("Constraints:",g);var U=Object.assign({audio:!1,video:!1},((_={})[H]=g,_));return(this._workaroundWebKitBug1208516Cleanup?M(A,I,U):I(U)).then(function(Z){return Z.getTracks()[0]})},T.prototype._restart=function(g){var _=this,L=this._log;return g=g||this._constraints,this._stop(),this._reacquireTrack(g).catch(function(I){throw L.error("Failed to re-acquire the MediaStreamTrack:",{error:I,constraints:g}),I}).then(function(I){return L.info("Re-acquired the MediaStreamTrack"),L.debug("MediaStreamTrack:",I),_._constraints=Object.assign({},g),_._setMediaStreamTrack(I)})},T.prototype._setMediaStreamTrack=function(g){var _=this;return g.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){_._unprocessedTrack=g}):this._trackSender.setMediaStreamTrack(g).catch(function(L){_._log.warn("setMediaStreamTrack failed:",{error:L,mediaStreamTrack:g})})).then(function(){_._initialize(),_._getAllAttachedElements().forEach(function(L){return _._attach(L)})})},T.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},T.prototype.enable=function(g){return(g="boolean"!=typeof g||g)!==this.mediaStreamTrack.enabled&&(this._log.info((g?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=g,this.emit(g?"enabled":"disabled",this)),this},T.prototype.disable=function(){return this.enable(!1)},T.prototype.restart=function(g){var _=this,L=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(y("restart","can only be called on a Local"+e(L)+"Track that is created using createLocalTracks or createLocal"+e(L)+"Track."));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var I=this._restart(g);return this._workaroundWebKitBug1208516&&(I=I.finally(function(){_._workaroundWebKitBug1208516Cleanup=w(_)})),I},T.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},T}(R)}},5181:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(1102),o=a(9917),s=o.typeErrors,i=o.trackPriority,t=function(e){function r(n,l,v,y){var m=e.call(this,l.name,n.sid,y)||this;return Object.defineProperties(m,{_reemitTrackEvent:{value:function(){return m.emit(m.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:n},_unpublish:{value:v},isTrackEnabled:{enumerable:!0,get:function(){return"data"===this.track.kind||this.track.isEnabled}},kind:{enumerable:!0,value:l.kind},priority:{enumerable:!0,get:function(){return n.updatedPriority}},track:{enumerable:!0,value:l}}),l.on("disabled",m._reemitTrackEvent),l.on("enabled",m._reemitTrackEvent),m}return d(r,e),r.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},r.prototype.setPriority=function(n){var l=Object.values(i);if(!l.includes(n))throw s.INVALID_VALUE("priority",l);return this._signaling.setPriority(n),this},r.prototype.unpublish=function(){return this.track.removeListener("disabled",this._reemitTrackEvent),this.track.removeListener("enabled",this._reemitTrackEvent),this._unpublish(this),this},r}(p);k.exports=t},149:function(k,S,a){"use strict";var y,d=this&&this.__extends||(y=function(m,f){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(u[h]=c[h])})(m,f)},function(m,f){if("function"!=typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function u(){this.constructor=m}y(m,f),m.prototype=null===f?Object.create(f):(u.prototype=f.prototype,new u)}),p=a(4911),o=p.guessBrowser,s=p.isIOSChrome,i=a(4139),t=a(6217),e=a(1676),r=a(3761).isUserMediaTrack,l=function(y){function m(f,u){var c=this;return u=Object.assign({workaroundSilentLocalVideo:("safari"===o()||s())&&r(f)&&"undefined"!=typeof document&&"function"==typeof document.createElement},u),c=y.call(this,f,u)||this,Object.defineProperties(c,{_workaroundSilentLocalVideo:{value:u.workaroundSilentLocalVideo?v:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),c._workaroundSilentLocalVideo&&(c._workaroundSilentLocalVideoCleanup=c._workaroundSilentLocalVideo(c,document)),c}return d(m,y),m.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},m.prototype._checkIfCanCaptureFrames=function(){return y.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},m.prototype._end=function(){return y.prototype._end.apply(this,arguments)},m.prototype._setSenderMediaStreamTrack=function(f){var u=this,c=this.mediaStreamTrack,h=f?this.processedTrack:c;return this._trackSender.setMediaStreamTrack(h).catch(function(P){return u._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:P,mediaStreamTrack:h})}).then(function(){u._unprocessedTrack=f?c:null})},m.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var f=y.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),f):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},m.prototype.removeProcessor=function(){var f=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var u=y.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return f._updateElementsMediaStreamTrack()}),u},m.prototype.disable=function(){var f=y.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),f},m.prototype.enable=function(f){void 0===f&&(f=!0);var u=y.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=f,f&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),u},m.prototype.restart=function(){var f=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var u=y.prototype.restart.apply(this,arguments);return this.processor&&u.then(function(){f._restartProcessor()}),this._workaroundSilentLocalVideo&&u.finally(function(){f._workaroundSilentLocalVideoCleanup=f._workaroundSilentLocalVideo(f,document)}),u},m.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),y.prototype.stop.apply(this,arguments)},m}(t(e));function v(y,m){var f=y._log,u=y._dummyEl,c=y.mediaStreamTrack;function h(){!y.isEnabled||(f.info("Unmuted, checking silence"),u.play().then(function(){return i(u,m)}).then(function(P){if(P)return f.warn("Silence detected, restarting"),y._stop(),y._restart();f.info("Non-silent frames detected, so no need to restart")}).catch(function(P){f.warn("Failed to detect silence and restart:",P)}).finally(function(){(u=y._dummyEl).paused||u.pause(),c.removeEventListener("unmute",h),(c=y.mediaStreamTrack).addEventListener("unmute",h)}))}return c.addEventListener("unmute",h),function(){c.removeEventListener("unmute",h)}}k.exports=l},6156:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){return s.call(this,t,e,r,n)||this}return d(i,s),i.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(5181));k.exports=o},3014:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var O in P)Object.prototype.hasOwnProperty.call(P,O)&&(h[O]=P[O])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=a(4911),o=p.guessBrowser,s=p.isIOSChrome,i=a(4135).MediaStream,t=a(3761),e=t.waitForEvent,r=t.waitForSometime,n=a(9388),v=function(f){function u(c,h){var P=this;h=Object.assign({playPausedElementsIfNotBackgrounded:("safari"===o()||s())&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},h),P=f.call(this,c.id,c.kind,h)||this;var O=!1;return h=Object.assign({MediaStream:i},h),Object.defineProperties(P,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return O},set:function(w){O=w}},_playPausedElementsIfNotBackgrounded:{value:h.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:h.workaroundWebKitBug212780||h.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:h.MediaStream},isStarted:{enumerable:!0,get:function(){return O}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||c.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),P._initialize(),P}return d(u,f),u.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},u.prototype._initialize=function(){var c=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack.addEventListener("ended",function h(){c._end(),c.mediaStreamTrack.removeEventListener("ended",h)}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},u.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},u.prototype.attach=function(c){var h=this;return"string"==typeof c?c=this._selectElement(c):c||(c=this._createElement()),this._log.debug("Attempting to attach to element:",c),c=this._attach(c),this._shouldShimAttachedElements&&!this._elShims.has(c)&&this._elShims.set(c,function(f,u){void 0===u&&(u=null);var c=f.pause,h=f.play,P=!1;f.pause=function(){return P=!0,c.call(f)},f.play=function(){return P=!1,h.call(f)};var O=u?function(){P||u()}:null;return O&&f.addEventListener("pause",O),{pausedIntentionally:function(){return P},unShim:function(){f.pause=c,f.play=h,O&&f.removeEventListener("pause",O)}}}(c,this._playPausedElementsIfNotBackgrounded?function(){return function(f,u){var c=f.tagName.toLowerCase();u.warn("Unintentionally paused:",f),Promise.race([e(document,"visibilitychange"),r(1e3)]).then(function(){"visible"===document.visibilityState&&n.whenResolved("audio").then(function(){return u.info("Playing unintentionally paused <"+c+"> element"),u.debug("Element:",f),f.play()}).then(function(){u.info("Successfully played unintentionally paused <"+c+"> element"),u.debug("Element:",f)}).catch(function(h){u.warn("Error while playing unintentionally paused <"+c+"> element:",{error:h,el:f})})})}(c,h._log)}:null)),c},u.prototype._attach=function(c,h){void 0===h&&(h=this.processedTrack||this.mediaStreamTrack);var P=c.srcObject;return P instanceof this._MediaStream||(P=new this._MediaStream),P["audio"===h.kind?"getAudioTracks":"getVideoTracks"]().forEach(function(w){P.removeTrack(w)}),P.addTrack(h),c.srcObject=P,c.autoplay=!0,c.playsInline=!0,this._attachments.has(c)||this._attachments.add(c),c},u.prototype._selectElement=function(c){var h=document.querySelector(c);if(!h)throw new Error("Selector matched no element: "+c);return h},u.prototype._updateElementsMediaStreamTrack=function(){var c=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(h){return c._attach(h)})},u.prototype._createElement=function(){return"undefined"!=typeof document?document.createElement(this.kind):null},u.prototype.detach=function(c){var h;return h="string"==typeof c?[this._selectElement(c)]:c?[c]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",h),this._detachElements(h),c?h[0]:h},u.prototype._detachElements=function(c){return c.map(this._detachElement.bind(this))},u.prototype._detachElement=function(c){if(!this._attachments.has(c))return c;var h=c.srcObject;return h instanceof this._MediaStream&&h.removeTrack(this.processedTrack||this.mediaStreamTrack),this._attachments.delete(c),this._shouldShimAttachedElements&&this._elShims.has(c)&&(this._elShims.get(c).unShim(),this._elShims.delete(c)),c},u.prototype._getAllAttachedElements=function(){var c=[];return this._attachments.forEach(function(h){c.push(h)}),c},u}(a(5142));k.exports=v},6804:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i}(a(6583));k.exports=o},698:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(13),i=function(t){function e(r,n,l,v,y,m,f){return t.call(this,r,n,l,v,y,m,f)||this}return d(e,t),e.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},e.prototype.setPriority=function(r){return t.prototype.setPriority.call(this,r)},e}(a(1204)(p));k.exports=i},6292:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},2096:function(k,S,a){"use strict";var n,d=this&&this.__extends||(n=function(l,v){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,m){y.__proto__=m}||function(y,m){for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(y[f]=m[f])})(l,v)},function(l,v){if("function"!=typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function y(){this.constructor=l}n(l,v),l.prototype=null===v?Object.create(v):(y.prototype=v.prototype,new y)}),p=this&&this.__read||function(n,l){var v="function"==typeof Symbol&&n[Symbol.iterator];if(!v)return n;var m,u,y=v.call(n),f=[];try{for(;(void 0===l||l-- >0)&&!(m=y.next()).done;)f.push(m.value)}catch(c){u={error:c}}finally{try{m&&!m.done&&(v=y.return)&&v.call(y)}finally{if(u)throw u.error}}return f},o=this&&this.__spreadArray||function(n,l){for(var v=0,y=l.length,m=n.length;v<y;v++,m++)n[m]=l[v];return n},s=a(5142),i=a(9917),t=i.typeErrors,e=i.trackPriority,r=function(n){function l(v,y,m){var f=n.call(this,y.id,"data",m)||this;return Object.defineProperties(f,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:y.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:y.maxRetransmits},ordered:{enumerable:!0,value:y.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:null===y.maxPacketLifeTime&&null===y.maxRetransmits},sid:{enumerable:!0,value:v}}),y.on("message",function(u){f.emit("message",u,f)}),f}return d(l,n),l.prototype.setPriority=function(v){var y=o([null],p(Object.values(e)));if(!y.includes(v))throw t.INVALID_VALUE("priority",y);return this._priority=v,this},l.prototype._setEnabled=function(){},l.prototype._setSwitchedOff=function(v){this._isSwitchedOff!==v&&(this._isSwitchedOff=v,this.emit(v?"switchedOff":"switchedOn",this))},l}(s);k.exports=r},2046:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},1204:function(k,S,a){"use strict";var m,d=this&&this.__extends||(m=function(f,u){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var P in h)Object.prototype.hasOwnProperty.call(h,P)&&(c[P]=h[P])})(f,u)},function(f,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function c(){this.constructor=f}m(f,u),f.prototype=null===u?Object.create(u):(c.prototype=u.prototype,new c)}),p=this&&this.__read||function(m,f){var u="function"==typeof Symbol&&m[Symbol.iterator];if(!u)return m;var h,O,c=u.call(m),P=[];try{for(;(void 0===f||f-- >0)&&!(h=c.next()).done;)P.push(h.value)}catch(w){O={error:w}}finally{try{h&&!h.done&&(u=c.return)&&u.call(c)}finally{if(O)throw O.error}}return P},o=this&&this.__spreadArray||function(m,f){for(var u=0,c=f.length,h=m.length;u<c;u++,h++)m[h]=f[u];return m},s=a(9917),i=s.typeErrors,t=s.trackPriority,e=a(4911),r=e.guessBrowser,n=e.isIOSChrome,l=a(296);k.exports=function(m){return function(f){function u(c,h,P,O,w,R,C){var T=this;return C=Object.assign({workaroundWebKitBug212780:("safari"===r()||n())&&"object"==typeof document&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},C),T=f.call(this,h,C)||this,Object.defineProperties(T,{_isEnabled:{value:P,writable:!0},_isSwitchedOff:{value:O,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:w},_setRenderHint:{value:function(g){T._log.debug("updating render hint:",g),R(g)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:c},_workaroundWebKitBug212780:{value:C.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),T}return d(u,f),u.prototype.setPriority=function(c){var h=o([null],p(Object.values(t)));if(!h.includes(c))throw i.INVALID_VALUE("priority",h);return this._priority!==c&&(this._priority=c,this._setPriority(c)),this},u.prototype._setEnabled=function(c){this._isEnabled!==c&&(this._isEnabled=c,this.emit(this._isEnabled?"enabled":"disabled",this))},u.prototype._setSwitchedOff=function(c){this._isSwitchedOff!==c&&(this._isSwitchedOff=c,this.emit(c?"switchedOff":"switchedOn",this))},u.prototype.attach=function(c){var h=f.prototype.attach.call(this,c);return!0!==this.mediaStreamTrack.enabled&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||function(m){var f=m._log,u=m.kind;function c(h){!h||m._attachments.forEach(function(P){var O=m._elShims.get(P);P.paused&&O&&!O.pausedIntentionally()&&(f.info("Playing inadvertently paused <"+u+"> element"),f.debug("Element:",P),f.debug("RemoteMediaTrack:",m),P.play().then(function(){f.info("Successfully played inadvertently paused <"+u+"> element"),f.debug("Element:",P),f.debug("RemoteMediaTrack:",m)}).catch(function(R){f.warn("Error while playing inadvertently paused <"+u+"> element:",{err:R,el:P,remoteMediaTrack:m})}))})}return l.onVisibilityChange(2,c),function(){l.offVisibilityChange(2,c)}}(this)),h},u.prototype.detach=function(c){var h=f.prototype.detach.call(this,c);return 0===this._attachments.size&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),h},u}(m)}},4610:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t.name,t.sid,e)||this;Object.defineProperties(r,{_signaling:{value:t},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return t.isEnabled}},kind:{enumerable:!0,value:t.kind},publishPriority:{enumerable:!0,get:function(){return t.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=t.error,l=t.isEnabled,v=t.isSwitchedOff,y=t.priority;return t.on("updated",function(){if(n!==t.error)return n=t.error,void r.emit("subscriptionFailed",t.error);l!==t.isEnabled&&(l=t.isEnabled,r.track&&r.track._setEnabled(t.isEnabled),r.emit(t.isEnabled?"trackEnabled":"trackDisabled")),v!==t.isSwitchedOff&&(r._log.debug(r.trackSid+": "+(v?"OFF":"ON")+" => "+(t.isSwitchedOff?"OFF":"ON")),v=t.isSwitchedOff,r.track?(r.track._setSwitchedOff(t.isSwitchedOff),r.emit(v?"trackSwitchedOff":"trackSwitchedOn",r.track)):v&&r._log.warn("Track was not subscribed when switched Off.")),y!==t.priority&&r.emit("publishPriorityChanged",y=t.priority)}),r}return d(i,s),i.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i.prototype._subscribed=function(t){!this._track&&t&&(this._track=t,this.emit("subscribed",t))},i.prototype._unsubscribe=function(){if(this._track){var t=this._track;this._track=null,this.emit("unsubscribed",t)}},i}(a(1102));k.exports=o},9984:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var O in P)Object.prototype.hasOwnProperty.call(P,O)&&(h[O]=P[O])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,w,h=c.call(f),O=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)O.push(P.value)}catch(R){w={error:R}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(w)throw w.error}}return O},o=a(1204),s=a(1676),i=a(296),t=a(5092).NullObserver,e=a(1190),l=function(f){function u(c,h,P,O,w,R,C){var T=this;return C=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},C),C=Object.assign({IntersectionObserver:"undefined"==typeof IntersectionObserver||"auto"!==C.clientTrackSwitchOffControl?t:IntersectionObserver,ResizeObserver:"undefined"==typeof ResizeObserver||"auto"!==C.contentPreferencesMode?t:ResizeObserver},C),T=f.call(this,c,h,P,O,w,R,C)||this,Object.defineProperties(T,{_enableDocumentVisibilityTurnOff:{value:!0===C.enableDocumentVisibilityTurnOff&&"auto"===C.clientTrackSwitchOffControl},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:C.clientTrackSwitchOffControl},_contentPreferencesMode:{value:C.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new e(function(){T._setRenderHint({enabled:!1})},50,!1)},_resizeObserver:{value:new C.ResizeObserver(function(g){g.find(function(L){return!T._invisibleElements.has(L.target)})&&m(T)})},_intersectionObserver:{value:new C.IntersectionObserver(function(g){var _=!1;g.forEach(function(L){!T._invisibleElements.has(L.target)!==L.isIntersecting&&(L.isIntersecting?(T._log.debug("intersectionObserver detected: Off => On"),T._invisibleElements.delete(L.target)):(T._log.debug("intersectionObserver detected: On => Off"),T._invisibleElements.add(L.target)),_=!0)}),_&&(y(T),m(T))},{threshold:.25})}}),T}return d(u,f),u.prototype._start=function(c){var h=f.prototype._start.call(this,c);return y(this),h},u.prototype.switchOn=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},u.prototype.switchOff=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},u.prototype.setContentPreferences=function(c){if("manual"!==this._contentPreferencesMode)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return c.renderDimensions&&this._setRenderHint({renderDimensions:c.renderDimensions}),this},u.prototype._unObservePip=function(c){var h=this._elToPipCallbacks.get(c);h&&(c.removeEventListener("enterpictureinpicture",h.onEnterPip),c.removeEventListener("leavepictureinpicture",h.onLeavePip),this._elToPipCallbacks.delete(c))},u.prototype._observePip=function(c){var h=this;if(!this._elToPipCallbacks.get(c)){var O=function(C){return h._onEnterPip(C,c)},w=function(C){return h._onLeavePip(C,c)};c.addEventListener("enterpictureinpicture",O),c.addEventListener("leavepictureinpicture",w),this._elToPipCallbacks.set(c,{onEnterPip:O,onLeavePip:w,onResizePip:function(C){return h._onResizePip(C,c)}})}},u.prototype._onEnterPip=function(c,h){this._log.debug("onEnterPip");var P=c.pictureInPictureWindow;this._elToPipWindows.set(h,P);var O=this._elToPipCallbacks.get(h).onResizePip;P.addEventListener("resize",O),y(this)},u.prototype._onLeavePip=function(c,h){this._log.debug("onLeavePip"),this._elToPipWindows.delete(h);var P=this._elToPipCallbacks.get(h).onResizePip;c.pictureInPictureWindow.removeEventListener("resize",P),y(this)},u.prototype._onResizePip=function(){m(this)},u.prototype.attach=function(c){var h=f.prototype.attach.call(this,c);return"auto"===this._clientTrackSwitchOffControl&&this._invisibleElements.add(h),this._intersectionObserver.observe(h),this._resizeObserver.observe(h),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||function(f){function u(){y(f)}return i.onVisibilityChange(1,u),function(){i.offVisibilityChange(1,u)}}(this)),this._observePip(h),h},u.prototype.detach=function(c){var h=this,P=f.prototype.detach.call(this,c);return(Array.isArray(P)?P:[P]).forEach(function(w){h._intersectionObserver.unobserve(w),h._resizeObserver.unobserve(w),h._invisibleElements.delete(w),h._unObservePip(w)}),0===this._attachments.size&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),y(this),m(this),P},u.prototype.addProcessor=function(){return f.prototype.addProcessor.apply(this,arguments)},u.prototype.removeProcessor=function(){return f.prototype.removeProcessor.apply(this,arguments)},u.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},u.prototype.setPriority=function(c){return f.prototype.setPriority.call(this,c)},u}(o(s));function y(f){if("auto"===f._clientTrackSwitchOffControl){var u=f._getAllAttachedElements().filter(function(P){return!f._invisibleElements.has(P)});!0==(f._getAllAttachedElements().filter(function(P){return f._elToPipWindows.has(P)}).length>0||"visible"===document.visibilityState&&u.length>0)?(f._turnOffTimer.clear(),f._setRenderHint({enabled:!0})):f._turnOffTimer.isSet||f._turnOffTimer.start()}}function m(f){if("auto"===f._contentPreferencesMode){var u=f._getAllAttachedElements().filter(function(T){return!f._invisibleElements.has(T)}),c=f._getAllAttachedElements().map(function(T){var g=f._elToPipWindows.get(T);return g?{clientHeight:g.height,clientWidth:g.width}:{clientHeight:0,clientWidth:0}}),h=u.concat(c);if(h.length>0){var O=p(h.sort(function(T,g){return g.clientHeight+g.clientWidth-T.clientHeight-T.clientWidth-1}),1)[0];f._setRenderHint({renderDimensions:{height:O.clientHeight,width:O.clientWidth}})}}}k.exports=l},9780:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t,e)||this}return d(i,s),i.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(a(4610));k.exports=o},5550:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=this&&this.__read||function(i,t){var e="function"==typeof Symbol&&i[Symbol.iterator];if(!e)return i;var n,v,r=e.call(i),l=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)l.push(n.value)}catch(y){v={error:y}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(v)throw v.error}}return l},s=function(i){function t(e){var r=i.call(this,e.id,e)||this;return Object.defineProperties(r,{_clones:{value:new Set},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{get:function(){return!!this._clones.size}}}),r}return d(t,i),t.prototype.clone=function(){var e=new t(this.track.clone());return this._clones.add(e),e},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.setMediaStreamTrack=function(e){var r=this,n=Array.from(this._clones),l=Array.from(this._senders);return Promise.all(n.map(function(v){return v.setMediaStreamTrack(e.clone())}).concat(l.map(function(v){return r._replaceTrack(v,e)}))).finally(function(){r._track=e})},t.prototype.addSender=function(e,r){return this._senders.add(e),r&&this._senderToPublisherHintCallbacks.set(e,r),this},t.prototype.removeSender=function(e){return this._senders.delete(e),this._senderToPublisherHintCallbacks.delete(e),this},t.prototype.setPublisherHint=function(e){var n=p(Array.from(this._senderToPublisherHintCallbacks.values()),1)[0];return n?n(e):Promise.resolve("COULD_NOT_APPLY_HINT")},t.prototype._replaceTrack=function(e,r){var n=this;return e.replaceTrack(r).then(function(l){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),l})},t}(a(6583));k.exports=s},1102:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(5737),o=a(3761),s=o.buildLogLevels,i=o.valueToJSON,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=0,n=function(l){function v(y,m,f){var u=l.call(this)||this;f=Object.assign({logLevel:t},f);var c=s(f.logLevel);return Object.defineProperties(u,{_instanceId:{value:r++},_log:{value:f.log?f.log.createLog("default",u):new e("default",u,c,f.loggerName)},trackName:{enumerable:!0,value:y},trackSid:{enumerable:!0,value:m}}),u}return d(v,l),v.prototype.toJSON=function(){return i(this)},v.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},v}(p);k.exports=n},6583:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e.kind)||this;return Object.defineProperties(r,{_track:{value:e,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return d(i,s),i.prototype.stop=function(){this.track.stop(),s.prototype.stop.call(this)},i}(a(8699));k.exports=o},6679:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(3105).EventEmitter,o=a(9917).DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,s=function(i){function t(e){var r=i.call(this)||this;return Object.defineProperties(r,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:e},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),r.on("add",function(n){r._lastStatsSaveTime=Date.now(),r._lastStatsPublishTime=Date.now(),r._processorInfo=n,r._stats=[],r._reemitEvent("add",r._getEventData())}),r.on("remove",function(){var n=r._getEventData();r._lastStatsSaveTime=null,r._lastStatsPublishTime=null,r._processorInfo=null,r._stats=null,r._reemitEvent("remove",n)}),r.on("start",function(){r._reemitEvent("start",r._getEventData())}),r.on("stop",function(n){r._reemitEvent("stop",Object.assign({message:n},r._getEventData()))}),r.on("stats",function(){return r._maybeEmitStats()}),r}return d(t,i),t.prototype._getEventData=function(){if(!this._processorInfo)return{};var e=this._processorInfo,r=e.processor,m={captureHeight:e.captureHeight,captureWidth:e.captureWidth,inputFrameRate:e.inputFrameRate,isRemoteVideoTrack:e.isRemoteVideoTrack};return m.name=r._name||"VideoProcessor",["assetsPath","blurFilterRadius","fitType","isSimdEnabled","maskBlurRadius","version"].forEach(function(f){var u=r["_"+f];void 0!==u&&(m[f]=u)}),Object.keys(m).forEach(function(f){var u=m[f];"boolean"==typeof u&&(m[f]=u?"true":"false")}),m},t.prototype._maybeEmitStats=function(){if(this._stats&&this._processorInfo){var e=this._processorInfo.processor._benchmark;if(e){var r=Date.now();if(!(r-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:e.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(y){n[y]=e.getAverageDelay(y)}),this._lastStatsSaveTime=r,this._stats.push(n),!(r-this._lastStatsPublishTime<o)){this._lastStatsPublishTime=r;var v=this._stats.splice(0).reduce(function(y,m,f){return Object.keys(n).forEach(function(u){y[u]||(y[u]=0),y[u]=(y[u]*f+m[u])/(f+1)}),y},{});Object.keys(v).forEach(function(y){v[y]=parseFloat(v[y].toFixed(2))}),this._reemitEvent("stats",Object.assign({},v,this._getEventData()))}}}}},t.prototype._reemitEvent=function(e,r){this._log.debug("VideoProcessor:"+e,r),this.emit("event",{name:e,data:r})},t}(p);k.exports=s},1676:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(3014),o=a(6679),s=a(9917).DEFAULT_FRAME_RATE,i=function(e){function r(n,l){var v=e.call(this,n,l)||this;return Object.defineProperties(v,{_captureTimeoutId:{value:null,writable:!0},_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),v._processorEventObserver=new(l.VideoProcessorEventObserver||o)(v._log),v}return d(r,e),r.prototype._checkIfCanCaptureFrames=function(n){void 0===n&&(n=!1);var l=!0,v="",y=this.mediaStreamTrack;return y.enabled||(l=!1,v="MediaStreamTrack is disabled"),"ended"===y.readyState&&(l=!1,v="MediaStreamTrack is ended"),this.processor||(l=!1,v="VideoProcessor not detected."),!this._attachments.size&&!n&&(l=!1,v="VideoTrack is not publishing and there is no attached element."),v&&this._log.debug(v),{canCaptureFrames:l,message:v}},r.prototype._captureFrames=function(){var n=this;if(this._isCapturing)this._log.debug("Ignoring captureFrames call. Capture is already in progress");else{if(!this._checkIfCanCaptureFrames().canCaptureFrames)return this._isCapturing=!1,void this._log.debug("Cannot capture frames. Ignoring captureFrames call.");this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var v,l=Date.now();this._dummyEl.play().then(function(){var y=function(f){clearTimeout(n._captureTimeoutId);var u=n.mediaStreamTrack.getSettings().frameRate,P=Math.floor(1e3/(void 0===u?s:u))-v;(P<0||"number"!=typeof v)&&(P=0),n._captureTimeoutId=setTimeout(f,P)},m=function(){var f=n._checkIfCanCaptureFrames();if(!f.canCaptureFrames)return n._isCapturing=!1,n._processorEventObserver.emit("stop",f.message),void n._log.debug("Cannot capture frames. Stopping capturing frames.");l=Date.now();var u=n.mediaStreamTrack.getSettings(),c=u.width,h=void 0===c?0:c,P=u.height,O=void 0===P?0:P;n._inputFrame.width!==h&&(n._inputFrame.width=h,n._inputFrame.height=O,n._outputFrame&&(n._outputFrame.width=h,n._outputFrame.height=O)),n._inputFrame.getContext("2d").drawImage(n._dummyEl,0,0,h,O);var w=null;try{w=n.processor.processFrame(n._inputFrame,n._outputFrame)}catch(R){n._log.debug("Exception detected after calling processFrame.",R)}(w instanceof Promise?w:Promise.resolve(w)).then(function(){n._outputFrame&&(n.processedTrack.requestFrame(),n._processorEventObserver.emit("stats"))}).finally(function(){v=Date.now()-l,y(m)})};y(m)}).catch(function(y){return n._log.error("Video element cannot be played",{error:y,track:n})})}},r.prototype._initialize=function(){var n=this;e.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){t(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight)},this._dummyEl.onresize=function(){t(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight,n.isStarted&&(n._log.debug("Dimensions changed:",n.dimensions),n.emit(r.DIMENSIONS_CHANGED,n)))})},r.prototype._restartProcessor=function(){var n=this.processor;n&&(this.removeProcessor(n),this.addProcessor(n))},r.prototype._start=function(n){return this.dimensions.width=n.videoWidth,this.dimensions.height=n.videoHeight,this._log.debug("Dimensions:",this.dimensions),e.prototype._start.call(this,n)},r.prototype.addProcessor=function(n){var l=this;if("function"!=typeof OffscreenCanvas)return this._log.warn("Adding a VideoProcessor is not supported in this browser.");if(!n||"function"!=typeof n.processFrame)throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",n),this._unmuteHandler||(this._unmuteHandler=function(){l._log.debug("mediaStreamTrack unmuted"),l.processedTrack.muted&&(l._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),l._restartProcessor())},this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler));var v=this.mediaStreamTrack.getSettings(),y=v.width,m=void 0===y?0:y,f=v.height,u=void 0===f?0:f,c=v.frameRate,h=void 0===c?s:c;return this._inputFrame=new OffscreenCanvas(m,u),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=m,this._outputFrame.height=u,this.processedTrack=this._outputFrame.captureStream(0).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=n,this._processorEventObserver.emit("add",{processor:n,captureHeight:u,captureWidth:m,inputFrameRate:h,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack")}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},r.prototype.attach=function(){var n=e.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),n},r.prototype.detach=function(){return e.prototype.detach.apply(this,arguments)},r.prototype.removeProcessor=function(n){if(!n)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(n!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",n),clearTimeout(this._captureTimeoutId),this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame.getContext("2d").clearRect(0,0,this._inputFrame.width,this._inputFrame.height),this._outputFrame.getContext("2d").clearRect(0,0,this._outputFrame.width,this._outputFrame.height),this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},r}(p);function t(e,r){return e.dimensions.width!==r.videoWidth||e.dimensions.height!==r.videoHeight}i.DIMENSIONS_CHANGED="dimensionsChanged",k.exports=i},6062:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=this&&this.__read||function(l,v){var y="function"==typeof Symbol&&l[Symbol.iterator];if(!y)return l;var f,c,m=y.call(l),u=[];try{for(;(void 0===v||v-- >0)&&!(f=m.next()).done;)u.push(f.value)}catch(h){c={error:h}}finally{try{f&&!f.done&&(y=m.return)&&y.call(m)}finally{if(c)throw c.error}}return u},o=a(3105).EventEmitter,s=a(9917),i=s.DEFAULT_NQ_LEVEL_LOCAL,t=s.DEFAULT_NQ_LEVEL_REMOTE,e=s.MAX_NQ_LEVEL,r=a(3761).inRange,n=function(l){function v(y){var m=l.call(this)||this;return y=Object.assign({local:i,remote:t},y),Object.defineProperties(m,{local:{value:r(y.local,i,e)?y.local:i,writable:!0},remote:{value:r(y.remote,t,e)?y.remote:t,writable:!0}}),m}return d(v,l),v.prototype.update=function(y){var m=this;y=Object.assign({local:this.local,remote:this.remote},y),[["local",i,3],["remote",t,3]].forEach(function(f){var u=p(f,3),c=u[0],h=u[1];m[c]="number"==typeof y[c]&&r(y[c],h,u[2])?y[c]:h})},v}(o);k.exports=n},5513:function(k,S,a){"use strict";var P,d=this&&this.__extends||(P=function(O,w){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,C){R.__proto__=C}||function(R,C){for(var T in C)Object.prototype.hasOwnProperty.call(C,T)&&(R[T]=C[T])})(O,w)},function(O,w){if("function"!=typeof w&&null!==w)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function R(){this.constructor=O}P(O,w),O.prototype=null===w?Object.create(w):(R.prototype=w.prototype,new R)}),p=this&&this.__read||function(P,O){var w="function"==typeof Symbol&&P[Symbol.iterator];if(!w)return P;var C,g,R=w.call(P),T=[];try{for(;(void 0===O||O-- >0)&&!(C=R.next()).done;)T.push(C.value)}catch(_){g={error:_}}finally{try{C&&!C.done&&(w=R.return)&&w.call(R)}finally{if(g)throw g.error}}return T},o=this&&this.__spreadArray||function(P,O){for(var w=0,R=O.length,C=P.length;w<R;w++,C++)P[C]=O[w];return P},s=a(5737),i=a(698),t=a(6292),e=a(2096),r=a(2046),n=a(9984),l=a(9780),v=a(3761),y=0,m=function(P){function O(w,R){var C=P.call(this)||this,T=function(P){var O=P.map(function(T){return[T.id,T]}),w=O.filter(function(T){return"audio"===T[1].kind}),R=O.filter(function(T){return"video"===T[1].kind});return{audioTracks:w,dataTracks:O.filter(function(T){return"data"===T[1].kind}),tracks:O,videoTracks:R}}((R=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:t,RemoteDataTrack:e,RemoteDataTrackPublication:r,RemoteVideoTrack:n,RemoteVideoTrackPublication:l,tracks:[]},R)).tracks),g=R.log.createLog("default",C),_=new Map(T.audioTracks),L=new Map(T.dataTracks),I=new Map(T.tracks),M=new Map(T.videoTracks);return Object.defineProperties(C,{_RemoteAudioTrack:{value:R.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:R.RemoteAudioTrackPublication},_RemoteDataTrack:{value:R.RemoteDataTrack},_RemoteDataTrackPublication:{value:R.RemoteDataTrackPublication},_RemoteVideoTrack:{value:R.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:R.RemoteVideoTrackPublication},_audioTracks:{value:_},_dataTracks:{value:L},_instanceId:{value:++y},_clientTrackSwitchOffControl:{value:R.clientTrackSwitchOffControl},_contentPreferencesMode:{value:R.contentPreferencesMode},_log:{value:g},_signaling:{value:w},_tracks:{value:I},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:M},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return w.identity}},networkQualityLevel:{enumerable:!0,get:function(){return w.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return w.networkQualityStats}},sid:{enumerable:!0,get:function(){return w.sid}},state:{enumerable:!0,get:function(){return w.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map}}),C._tracks.forEach(c.bind(null,C)),w.on("networkQualityLevelChanged",function(){return C.emit("networkQualityLevelChanged",C.networkQualityLevel,C.networkQualityStats&&(C.networkQualityStats.audio||C.networkQualityStats.video)?C.networkQualityStats:null)}),function(P,O){var w=P._log;"disconnected"!==P.state&&O.on("stateChanged",function R(C){w.debug("Transitioned to state:",C),P.emit(C,P),"disconnected"===C&&(w.debug("Removing Track event reemitters"),O.removeListener("stateChanged",R),P._tracks.forEach(function(T){var g=P._trackEventReemitters.get(T.id);T&&g&&g.forEach(function(_,L){T.removeListener(L,_)})}),O.tracks.forEach(function(T){var g=P._tracks.get(T.id),_=P._trackEventReemitters.get(T.id);g&&_&&_.forEach(function(L,I){g.removeListener(I,L)})}),P._trackEventReemitters.clear(),P.tracks.forEach(function(T){P._trackPublicationEventReemitters.get(T.trackSid).forEach(function(g,_){T.removeListener(_,g)})}),P._trackPublicationEventReemitters.clear())})}(C,w),g.info("Created a new Participant"+(C.identity?": "+C.identity:"")),C}return d(O,P),O.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},O.prototype._getTrackPublicationEvents=function(){return[]},O.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},O.prototype._addTrack=function(w,R){var C=this._log;return this._tracks.has(R)?null:(this._tracks.set(R,w),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[w.kind].set(R,w),c(this,w,R),C.info("Added a new "+v.trackClass(w)+":",R),C.debug(v.trackClass(w)+":",w),w)},O.prototype._addTrackPublication=function(w){var R=this._log;return this.tracks.has(w.trackSid)?null:(this.tracks.set(w.trackSid,w),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[w.kind].set(w.trackSid,w),function(P,O){var w=new Map;"disconnected"!==P.state&&(P._getTrackPublicationEvents().forEach(function(R){var C=p(R,2),T=C[0],g=C[1];w.set(T,function(){for(var _=[],L=0;L<arguments.length;L++)_[L]=arguments[L];P.emit.apply(P,o(o([g],p(_)),[O]))}),O.on(T,w.get(T))}),P._trackPublicationEventReemitters.set(O.trackSid,w))}(this,w),R.info("Added a new "+v.trackPublicationClass(w)+":",w.trackSid),R.debug(v.trackPublicationClass(w)+":",w),w)},O.prototype._handleTrackSignalingEvents=function(){var w=this,R=w._log,C=w._clientTrackSwitchOffControl,T=w._contentPreferencesMode,g=this;if("disconnected"!==this.state){var _=this._RemoteAudioTrack,L=this._RemoteAudioTrackPublication,I=this._RemoteVideoTrack,M=this._RemoteVideoTrackPublication,A=this._RemoteDataTrack,H=this._RemoteDataTrackPublication,U=this._signaling;U.on("trackAdded",F),U.on("trackRemoved",Z),U.tracks.forEach(F),U.on("stateChanged",function V(D){"disconnected"===D?(R.debug("Removing event listeners"),U.removeListener("stateChanged",V),U.removeListener("trackAdded",F),U.removeListener("trackRemoved",Z)):"connected"===D&&(R.info("reconnected"),setTimeout(function(){return g.emit("reconnected")},0))})}function F(V){var E=new(0,{audio:L,data:H,video:M}[V.kind])(V,{log:R});g._addTrackPublication(E);var b=V.isSubscribed;b&&ee(V),g._trackSignalingUpdatedEventCallbacks.set(V.sid,function(){if(b!==V.isSubscribed){if(b=V.isSubscribed)return void ee(V);!function(V){var D=p(Array.from(g._tracks.entries()).find(function(Q){return p(Q,2)[1].sid===V.sid}),2),E=D[0],b=D[1],B=g.tracks.get(V.sid);b&&g._removeTrack(b,B,E)}(V)}}),V.on("updated",g._trackSignalingUpdatedEventCallbacks.get(V.sid))}function Z(V){V.isSubscribed&&V.setTrackTransceiver(null);var D=g._trackSignalingUpdatedEventCallbacks.get(V.sid);D&&(V.removeListener("updated",D),g._trackSignalingUpdatedEventCallbacks.delete(V.sid));var E=g.tracks.get(V.sid);E&&g._removeTrackPublication(E)}function ee(V){var D=V.isEnabled,E=V.name,b=V.kind,B=V.sid,Q=V.trackTransceiver,q=V.isSwitchedOff,K={audio:_,video:I,data:A}[b],X=g.tracks.get(B);if(K&&b===Q.kind){var se={log:R,name:E,clientTrackSwitchOffControl:C,contentPreferencesMode:T},me="data"===b?new K(B,Q,se):new K(B,Q,D,q,function(pe){return U.updateSubscriberTrackPriority(B,pe)},function(pe){V.isSubscribed&&U.updateTrackRenderHint(B,pe)},se);g._addTrack(me,X,Q.id)}}},O.prototype._removeTrack=function(w,R){if(!this._tracks.has(R))return null;this._tracks.delete(R),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[w.kind].delete(R),(this._trackEventReemitters.get(R)||new Map).forEach(function(_,L){w.removeListener(L,_)});var g=this._log;return g.info("Removed a "+v.trackClass(w)+":",R),g.debug(v.trackClass(w)+":",w),w},O.prototype._removeTrackPublication=function(w){if(!(w=this.tracks.get(w.trackSid)))return null;this.tracks.delete(w.trackSid),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[w.kind].delete(w.trackSid),(this._trackPublicationEventReemitters.get(w.trackSid)||new Map).forEach(function(g,_){w.removeListener(_,g)});var T=this._log;return T.info("Removed a "+v.trackPublicationClass(w)+":",w.trackSid),T.debug(v.trackPublicationClass(w)+":",w),w},O.prototype.toJSON=function(){return v.valueToJSON(this)},O}(s);function c(P,O,w){var R=new Map;"disconnected"!==P.state&&(P._getTrackEvents().forEach(function(C){var T=C[0],g=C[1];R.set(T,function(){var _=[g].concat([].slice.call(arguments));return P.emit.apply(P,o([],p(_)))}),O.on(T,R.get(T))}),P._trackEventReemitters.set(w,R))}k.exports=m},8267:function(k,S){"use strict";var a=this&&this.__awaiter||function(e,r,n,l){return new(n||(n=Promise))(function(y,m){function f(h){try{c(l.next(h))}catch(P){m(P)}}function u(h){try{c(l.throw(h))}catch(P){m(P)}}function c(h){h.done?y(h.value):function(y){return y instanceof n?y:new n(function(m){m(y)})}(h.value).then(f,u)}c((l=l.apply(e,r||[])).next())})},d=this&&this.__generator||function(e,r){var l,v,y,m,n={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return m={next:f(0),throw:f(1),return:f(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m;function f(c){return function(h){return function(c){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,v&&(y=2&c[0]?v.return:c[0]?v.throw||((y=v.return)&&y.call(v),0):v.next)&&!(y=y.call(v,c[1])).done)return y;switch(v=0,y&&(c=[2&c[0],y.value]),c[0]){case 0:case 1:y=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,v=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(!(y=(y=n.trys).length>0&&y[y.length-1])&&(6===c[0]||2===c[0])){n=0;continue}if(3===c[0]&&(!y||c[1]>y[0]&&c[1]<y[3])){n.label=c[1];break}if(6===c[0]&&n.label<y[1]){n.label=y[1],y=c;break}if(y&&n.label<y[2]){n.label=y[2],n.ops.push(c);break}y[2]&&n.ops.pop(),n.trys.pop();continue}c=r.call(e,n)}catch(h){c=[6,h],v=0}finally{l=y=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,h])}}},p=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y};function o(e,r,n,l){var v=[];return e.forEach(function(y){(0===l.length||l.includes(y.type))&&(0===n.length||n.includes(y.kind))&&"number"==typeof y[r]&&v.push(y[r])}),v}function i(e){return[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}].reduce(function(n,l){var v=[l.key];l.altKeys&&(v=v.concat(l.altKeys));var y=v.find(function(m){return m in e});return y&&typeof e[y]===l.type&&(n[l.key]=e[y]),n},{})}Object.defineProperty(S,"__esModule",{value:!0}),S.getCombinedConnectionStats=void 0,S.getCombinedConnectionStats=function(e){var r=e.publisher,n=e.subscriber;return a(this,void 0,void 0,function(){var l,v,y,m,f,u,c,h,P,O,w,R,C,T,g;return d(this,function(_){switch(_.label){case 0:return[4,Promise.all([r,n].map(function(L){return L.getStats()}))];case 1:return l=p.apply(void 0,[_.sent(),2]),v=l[0],m=o(y=l[1],"timestamp",["audio"],["inbound-rtp"]),f=m.length>0?m[0]:0,u=o(y,"jitter",["audio"],["inbound-rtp"]).reduce(function(L,I){return Math.max(L,I)},0),c=o(y,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(L,I){return L+I},0),h=o(y,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(L,I){return L+I},0),P=o(v,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(L,I){return Math.max(L,I)},0),O=o(y,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(L,I){return Math.max(L,I)},0),w=1e3*(O||P),R=o(v,"bytesSent",[],["candidate-pair"]).reduce(function(L,I){return L+I},0),C=o(y,"bytesReceived",[],["candidate-pair"]).reduce(function(L,I){return L+I},0),T=function(e){var r=null,n=[];e.forEach(function(f){"transport"===f.type&&f.selectedCandidatePairId?r=f.selectedCandidatePairId:"candidate-pair"===f.type&&n.push(f)});var l=n.find(function(f){return f.selected||r&&f.id===r});if(!l)return null;var v=l,y=e.get(v.localCandidateId),m=e.get(v.remoteCandidateId);return y&&m?{localCandidate:i(y),remoteCandidate:i(m)}:null}(y),g=[],y.forEach(function(L){("local-candidate"===L.type||"remote-candidate"===L.type)&&g.push(i(L))}),[2,{timestamp:f,jitter:u,packets:c,packetsLost:h,roundTripTime:w,bytesSent:R,bytesReceived:C,selectedIceCandidatePairStats:T,iceCandidateStats:g}]}})})}},8259:(k,S,a)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getTurnCredentials=void 0;var d=a(9616),p=a(9917).ICE_VERSION,o=a(7061),s=o.createTwilioError,i=o.SignalingConnectionError,t=a(3105);S.getTurnCredentials=function(r,n){return new Promise(function(l,v){var y=new t.EventEmitter,f=new d(n,{networkMonitor:null,eventObserver:y,helloBody:{edge:"roaming",preflight:!0,token:r,type:"ice",version:p}}),u=!1;f.once("close",function(){u||(u=!0,v(new i))}),f.on("message",function(c){var h=c.code,P=c.message,w=c.type;("iced"===w||"error"===w)&&!u&&(u=!0,"iced"===w?l(c.ice_servers):v(s(h,P)),f.close())})})}},2316:function(k,S){"use strict";var a=this&&this.__read||function(o,s){var i="function"==typeof Symbol&&o[Symbol.iterator];if(!i)return o;var e,n,t=i.call(o),r=[];try{for(;(void 0===s||s-- >0)&&!(e=t.next()).done;)r.push(e.value)}catch(l){n={error:l}}finally{try{e&&!e.done&&(i=t.return)&&i.call(t)}finally{if(n)throw n.error}}return r},d=this&&this.__spreadArray||function(o,s){for(var i=0,t=s.length,e=o.length;i<t;i++,e++)o[e]=s[i];return o};Object.defineProperty(S,"__esModule",{value:!0}),S.makeStat=void 0,S.makeStat=function(o){return o&&o.length?{min:Math.min.apply(Math,d([],a(o))),max:Math.max.apply(Math,d([],a(o))),average:o.reduce(function(e,r){return e+r},0)/o.length}:null}},608:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.mosToScore=S.calculateMOS=void 0;var a=94.768;S.calculateMOS=function(o,s,i){var t=o+2*s+10,e=0;switch(!0){case t<160:e=a-t/40;break;case t<1e3:e=a-(t-120)/10}switch(!0){case i<=e/2.5:e=Math.max(e-2.5*i,6.52);break;default:e=0}return 1+.035*e+7e-6*e*(e-60)*(100-e)},S.mosToScore=function(o){return o?o>4.2?5:o>4?4:o>3.6?3:o>3?2:1:0}},712:function(k,S,a){"use strict";var ee,d=this&&this.__extends||(ee=function(J,V){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,E){D.__proto__=E}||function(D,E){for(var b in E)Object.prototype.hasOwnProperty.call(E,b)&&(D[b]=E[b])})(J,V)},function(J,V){if("function"!=typeof V&&null!==V)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");function D(){this.constructor=J}ee(J,V),J.prototype=null===V?Object.create(V):(D.prototype=V.prototype,new D)}),p=this&&this.__assign||function(){return(p=Object.assign||function(ee){for(var J,V=1,D=arguments.length;V<D;V++)for(var E in J=arguments[V])Object.prototype.hasOwnProperty.call(J,E)&&(ee[E]=J[E]);return ee}).apply(this,arguments)},o=this&&this.__awaiter||function(ee,J,V,D){return new(V||(V=Promise))(function(b,B){function Q(X){try{K(D.next(X))}catch(se){B(se)}}function q(X){try{K(D.throw(X))}catch(se){B(se)}}function K(X){X.done?b(X.value):function(b){return b instanceof V?b:new V(function(B){B(b)})}(X.value).then(Q,q)}K((D=D.apply(ee,J||[])).next())})},s=this&&this.__generator||function(ee,J){var D,E,b,B,V={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return B={next:Q(0),throw:Q(1),return:Q(2)},"function"==typeof Symbol&&(B[Symbol.iterator]=function(){return this}),B;function Q(K){return function(X){return function(K){if(D)throw new TypeError("Generator is already executing.");for(;V;)try{if(D=1,E&&(b=2&K[0]?E.return:K[0]?E.throw||((b=E.return)&&b.call(E),0):E.next)&&!(b=b.call(E,K[1])).done)return b;switch(E=0,b&&(K=[2&K[0],b.value]),K[0]){case 0:case 1:b=K;break;case 4:return V.label++,{value:K[1],done:!1};case 5:V.label++,E=K[1],K=[0];continue;case 7:K=V.ops.pop(),V.trys.pop();continue;default:if(!(b=(b=V.trys).length>0&&b[b.length-1])&&(6===K[0]||2===K[0])){V=0;continue}if(3===K[0]&&(!b||K[1]>b[0]&&K[1]<b[3])){V.label=K[1];break}if(6===K[0]&&V.label<b[1]){V.label=b[1],b=K;break}if(b&&V.label<b[2]){V.label=b[2],V.ops.push(K);break}b[2]&&V.ops.pop(),V.trys.pop();continue}K=J.call(ee,V)}catch(X){K=[6,X],E=0}finally{D=b=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}([K,X])}}};Object.defineProperty(S,"__esModule",{value:!0}),S.runPreflight=S.PreflightTest=void 0;var i=a(9917),t=a(1960),e=a(608),r=a(8267),n=a(8259),l=a(2316),v=a(9860),y=a(9806),m=a(3761),f=a(9917).WS_SERVER,u=a(7394),c=a(5737),h=a(2100),P=a(8326),O=a(3066),w=a(3187),R=w.createSID,C=w.sessionSID,T=a(7061),g=T.SignalingConnectionTimeoutError,_=T.MediaConnectionError;function A(ee){return null!=ee}var H=0,U=function(ee){function J(V,D){var E=ee.call(this)||this;E._testTiming=new t.Timer,E._dtlsTiming=new t.Timer,E._iceTiming=new t.Timer,E._peerConnectionTiming=new t.Timer,E._mediaTiming=new t.Timer,E._connectTiming=new t.Timer,E._sentBytesMovingAverage=new h,E._packetLossMovingAverage=new h,E._progressEvents=[],E._receivedBytesMovingAverage=new h;var B=D.environment,Q=void 0===B?"prod":B,q=D.region,X=D.duration,se=void 0===X?1e4:X,le=D.wsServer||f(Q,void 0===q?"gll":q);return E._log=new u("default",E,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),E._testDuration=se,E._instanceId=H++,E._testTiming.start(),E._runPreflightTest(V,Q,le),E}return d(J,ee),J.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},J.prototype.stop=function(){this._stopped=!0},J.prototype._generatePreflightReport=function(V){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:l.makeStat(null==V?void 0:V.jitter),rtt:l.makeStat(null==V?void 0:V.rtt),packetLoss:l.makeStat(null==V?void 0:V.packetLoss)},selectedIceCandidatePairStats:V?V.selectedIceCandidatePairStats:null,iceCandidateStats:V?V.iceCandidateStats:[],progressEvents:this._progressEvents,mos:l.makeStat(null==V?void 0:V.mos)}},J.prototype._executePreflightStep=function(V,D,E){return o(this,void 0,void 0,function(){var b,B,Q,q;return s(this,function(X){switch(X.label){case 0:if(this._log.debug("Executing step: ",V),b=this._testDuration+1e4,this._stopped)throw new Error("stopped");B=Promise.resolve().then(D),Q=null,q=new Promise(function(se,le){Q=setTimeout(function(){le(E||new Error(V+" timeout."))},b)}),X.label=1;case 1:return X.trys.push([1,,3,4]),[4,Promise.race([q,B])];case 2:return[2,X.sent()];case 3:return null!==Q&&clearTimeout(Q),[7];case 4:return[2]}})})},J.prototype._collectNetworkTimings=function(V){var D=this;return new Promise(function(E){var b;V.addEventListener("iceconnectionstatechange",function(){"checking"===V.iceConnectionState&&D._iceTiming.start(),"connected"===V.iceConnectionState&&(D._iceTiming.stop(),D._updateProgress("iceConnected"),(!b||b&&"connected"===b.state)&&E())}),V.addEventListener("connectionstatechange",function(){"connecting"===V.connectionState&&D._peerConnectionTiming.start(),"connected"===V.connectionState&&(D._peerConnectionTiming.stop(),D._updateProgress("peerConnectionConnected"))});var Q=V.getSenders().map(function(q){return q.transport}).find(A);void 0!==Q&&(b=Q).addEventListener("statechange",function(){"connecting"===b.state&&D._dtlsTiming.start(),"connected"===b.state&&(D._dtlsTiming.stop(),D._updateProgress("dtlsConnected"),"connected"===V.iceConnectionState&&E())})})},J.prototype._setupInsights=function(V){var E=V.environment,B=V.realm,K=new O(V.token,i.SDK_NAME,i.SDK_VERSION,void 0===E?i.DEFAULT_ENVIRONMENT:E,void 0===B?i.DEFAULT_REALM:B,{});K.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var X=new P(K,Date.now(),this._log),se=void 0;return{reportToInsights:function(le){var he,me,pe=le.report,ye=pe.stats.jitter||se,ve=pe.stats.rtt||se,ke=pe.stats.packetLoss||se,be=pe.mos||se,Ee=new Map;pe.iceCandidateStats.forEach(function(te){if(te.candidateType&&te.protocol){var ne=Ee.get(te.candidateType)||[];ne.indexOf(te.protocol)<0&&ne.push(te.protocol),Ee.set(te.candidateType,ne)}});var ae=JSON.stringify(Object.fromEntries(Ee)),$={name:"report",group:"preflight",level:pe.error?"error":"info",payload:{sessionSID:C,preflightSID:R("PF"),progressEvents:JSON.stringify(pe.progressEvents),testTiming:pe.testTiming,dtlsTiming:pe.networkTiming.dtls,iceTiming:pe.networkTiming.ice,peerConnectionTiming:pe.networkTiming.peerConnection,connectTiming:pe.networkTiming.connect,mediaTiming:pe.networkTiming.media,selectedLocalCandidate:null===(he=pe.selectedIceCandidatePairStats)||void 0===he?void 0:he.localCandidate,selectedRemoteCandidate:null===(me=pe.selectedIceCandidatePairStats)||void 0===me?void 0:me.remoteCandidate,iceCandidateStats:ae,jitterStats:ye,rttStats:ve,packetLossStats:ke,mosStats:be,error:pe.error}};X.emit("event",$),setTimeout(function(){return K.disconnect()},2e3)}}},J.prototype._runPreflightTest=function(V,D,E){return o(this,void 0,void 0,function(){var b,B,Q,q,K,X,se,le,he,me,pe,ye,ve=this;return s(this,function(ke){switch(ke.label){case 0:b=[],B=[],Q=this._setupInsights({token:V,environment:D}).reportToInsights,ke.label=1;case 1:return ke.trys.push([1,8,9,10]),q=[],[4,this._executePreflightStep("Acquire media",function(){return[v.syntheticAudio(),y.syntheticVideo({width:640,height:480})]})];case 2:return b=ke.sent(),this._updateProgress("mediaAcquired"),this.emit("debug",{localTracks:b}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return n.getTurnCredentials(V,E)},new g)];case 3:return K=ke.sent(),this._connectTiming.stop(),this._updateProgress("connected"),X=new RTCPeerConnection({iceServers:K,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),se=new RTCPeerConnection({iceServers:K,bundlePolicy:"max-bundle"}),B.push(X),B.push(se),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return o(ve,void 0,void 0,function(){var be,Ee,ae,$;return s(this,function(te){switch(te.label){case 0:return X.addEventListener("icecandidate",function(ne){return ne.candidate&&se.addIceCandidate(ne.candidate)}),se.addEventListener("icecandidate",function(ne){return ne.candidate&&X.addIceCandidate(ne.candidate)}),b.forEach(function(ne){return X.addTrack(ne)}),be=new Promise(function(ne){var W=[];se.addEventListener("track",function(j){W.push(j.track),W.length===b.length&&ne(W)})}),[4,X.createOffer()];case 1:return Ee=te.sent(),[4,X.setLocalDescription(ae=Ee)];case 2:return te.sent(),[4,se.setRemoteDescription(ae)];case 3:return te.sent(),[4,se.createAnswer()];case 4:return $=te.sent(),[4,se.setLocalDescription($)];case 5:return te.sent(),[4,X.setRemoteDescription($)];case 6:return te.sent(),[4,this._collectNetworkTimings(X)];case 7:return te.sent(),[2,be]}})})},new _)];case 4:return le=ke.sent(),this.emit("debug",{remoteTracks:le}),le.forEach(function(be){be.addEventListener("ended",function(){return ve._log.warn(be.kind+":ended")}),be.addEventListener("mute",function(){return ve._log.warn(be.kind+":muted")}),be.addEventListener("unmute",function(){return ve._log.warn(be.kind+":unmuted")})}),this._updateProgress("mediaSubscribed"),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(be){var Ee=document.createElement("video");Ee.autoplay=!0,Ee.playsInline=!0,Ee.muted=!0,Ee.srcObject=new MediaStream(le),q.push(Ee),ve.emit("debugElement",Ee),Ee.oncanplay=be})},new _)];case 5:return ke.sent(),this._mediaTiming.stop(),this._updateProgress("mediaStarted"),[4,this._executePreflightStep("Collect stats for duration",function(){return ve._collectRTCStatsForDuration(ve._testDuration,{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]},X,se)})];case 6:return he=ke.sent(),[4,this._executePreflightStep("Generate report",function(){return ve._generatePreflightReport(he)})];case 7:return me=ke.sent(),Q({report:me}),this.emit("completed",me),[3,10];case 8:return pe=ke.sent(),ye=this._generatePreflightReport(),Q({report:p(p({},ye),{error:null==pe?void 0:pe.toString()})}),this.emit("failed",pe,ye),[3,10];case 9:return B.forEach(function(be){return be.close()}),b.forEach(function(be){return be.stop()}),[7];case 10:return[2]}})})},J.prototype._collectRTCStats=function(V,D,E){return o(this,void 0,void 0,function(){var b,B,Q,q,K,X,se,le,he,me,pe,ye,ve,ke;return s(this,function(be){switch(be.label){case 0:return[4,r.getCombinedConnectionStats({publisher:D,subscriber:E})];case 1:return b=be.sent(),B=b.timestamp,Q=b.bytesSent,q=b.bytesReceived,K=b.packets,X=b.packetsLost,se=b.roundTripTime,he=b.selectedIceCandidatePairStats,me=b.iceCandidateStats,pe=V.jitter.length>0,V.jitter.push(le=b.jitter),V.rtt.push(se),this._sentBytesMovingAverage.putSample(Q,B),this._receivedBytesMovingAverage.putSample(q,B),this._packetLossMovingAverage.putSample(X,K),pe&&(V.outgoingBitrate.push(1e3*this._sentBytesMovingAverage.get()*8),V.incomingBitrate.push(1e3*this._receivedBytesMovingAverage.get()*8),ye=this._packetLossMovingAverage.get(),ve=Math.min(100,100*ye),V.packetLoss.push(ve),ke=e.calculateMOS(se,le,ye),V.mos.push(ke)),V.selectedIceCandidatePairStats||(V.selectedIceCandidatePairStats=he),0===V.iceCandidateStats.length&&(V.iceCandidateStats=me),[2]}})})},J.prototype._collectRTCStatsForDuration=function(V,D,E,b){return o(this,void 0,void 0,function(){var B,Q,q;return s(this,function(K){switch(K.label){case 0:return B=Date.now(),Q=Math.min(1e3,V),[4,m.waitForSometime(Q)];case 1:return K.sent(),[4,this._collectRTCStats(D,E,b)];case 2:return K.sent(),(q=V-(Date.now()-B))>0?[4,this._collectRTCStatsForDuration(q,D,E,b)]:[3,4];case 3:D=K.sent(),K.label=4;case 4:return[2,D]}})})},J.prototype._updateProgress=function(V){var D=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:D,name:V}),this.emit("progress",V)},J}(c);S.PreflightTest=U,S.runPreflight=function(ee,J){return void 0===J&&(J={}),new U(ee,J)}},9860:(k,S,a)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.syntheticAudio=void 0,S.syntheticAudio=function(){var p=a(9057),o={},s=p.getOrCreate(o),i=s.createOscillator(),t=i.connect(s.createMediaStreamDestination());i.start();var e=t.stream.getAudioTracks()[0],r=e.stop;return e.stop=function(){r.call(e),p.release(o)},e}},9806:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.syntheticVideo=void 0,S.syntheticVideo=function(d){var p=void 0===d?{}:d,o=p.width,s=void 0===o?640:o,i=p.height,t=void 0===i?480:i,e=Object.assign(document.createElement("canvas"),{width:s,height:t}),r=e.getContext("2d");r.fillStyle="green",r.fillRect(0,0,e.width,e.height);var n=!1;requestAnimationFrame(function m(){if(!n){var f=Math.round(255*Math.random()),u=Math.round(255*Math.random()),c=Math.round(255*Math.random()),h=Math.round(255*Math.random());r.fillStyle="rgba("+f+", "+u+", "+c+", "+h+")",r.fillRect(Math.random()*s,Math.random()*t,50,50),requestAnimationFrame(m)}});var v=e.captureStream(30).getTracks()[0],y=v.stop;return v.stop=function(){n=!0,y.call(v)},v}},1960:(k,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Timer=void 0;var a=function(){function d(){this._end=void 0,this.start()}return d.prototype.start=function(){return this._start=Date.now(),this},d.prototype.stop=function(){return this._end=Date.now(),this},d.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:void 0===this._end?void 0:this._end-this._start}},d}();S.Timer=a},5468:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var l,y,n=r.call(t),v=[];try{for(;(void 0===e||e-- >0)&&!(l=n.next()).done;)v.push(l.value)}catch(m){y={error:m}}finally{try{l&&!l.done&&(r=n.return)&&r.call(n)}finally{if(y)throw y.error}}return v},o=this&&this.__spreadArray||function(t,e){for(var r=0,n=e.length,l=t.length;r<n;r++,l++)t[l]=e[r];return t},i=function(t){function e(){var r=t.call(this)||this;return Object.defineProperties(r,{_queuedEvents:{value:new Map}}),r}return d(e,t),e.prototype.dequeue=function(r){var n=this,l=!0;if(!r)return this._queuedEvents.forEach(function(y,m){l=this.dequeue(m)&&l},this),l;var v=this._queuedEvents.get(r)||[];return this._queuedEvents.delete(r),v.reduce(function(y,m){return n.emit.apply(n,o([],p([r].concat(m))))&&y},l)},e.prototype.queue=function(){var r=[].slice.call(arguments);if(this.emit.apply(this,o([],p(r))))return!0;var n=r[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(r.slice(1)),!1},e}(a(3105).EventEmitter);k.exports=i},1792:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var l,y,n=r.call(t),v=[];try{for(;(void 0===e||e-- >0)&&!(l=n.next()).done;)v.push(l.value)}catch(m){y={error:m}}finally{try{l&&!l.done&&(r=n.return)&&r.call(n)}finally{if(y)throw y.error}}return v},o=this&&this.__spreadArray||function(t,e){for(var r=0,n=e.length,l=t.length;r<n;r++,l++)t[l]=e[r];return t},i=function(t){function e(r,n){var l=t.call(this,r,n)||this;return l._handleTrackSignalingEvents(),l.once("disconnected",l._unsubscribeTracks.bind(l)),l}return d(e,t),e.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},e.prototype._addTrack=function(r,n,l){return t.prototype._addTrack.call(this,r,l)?(n._subscribed(r),this.emit("trackSubscribed",r,n),r):null},e.prototype._addTrackPublication=function(r){var n=t.prototype._addTrackPublication.call(this,r);return n?(this.emit("trackPublished",n),n):null},e.prototype._getTrackPublicationEvents=function(){return o(o([],p(t.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},e.prototype._unsubscribeTracks=function(){var r=this;this.tracks.forEach(function(n){if(n.isSubscribed){var l=n.track;n._unsubscribe(),r.emit("trackUnsubscribed",l,n)}})},e.prototype._removeTrack=function(r,n,l){var v=this._tracks.get(l);return v?(t.prototype._removeTrack.call(this,v,l),n._unsubscribe(),this.emit("trackUnsubscribed",v,n),v):null},e.prototype._removeTrackPublication=function(r){this._signaling.clearTrackHint(r.trackSid);var n=t.prototype._removeTrackPublication.call(this,r);return n?(this.emit("trackUnpublished",n),n):null},e}(a(5513));k.exports=i},7970:function(k,S,a){"use strict";var f,d=this&&this.__extends||(f=function(u,c){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,P){h.__proto__=P}||function(h,P){for(var O in P)Object.prototype.hasOwnProperty.call(P,O)&&(h[O]=P[O])})(u,c)},function(u,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=u}f(u,c),u.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}),p=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,w,h=c.call(f),O=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)O.push(P.value)}catch(R){w={error:R}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(w)throw w.error}}return O},o=this&&this.__spreadArray||function(f,u){for(var c=0,h=u.length,P=f.length;c<h;c++,P++)f[P]=u[c];return f},s=a(5737),i=a(1792),t=a(6614),e=a(3761).valueToJSON,r=0,n=function(f){function u(c,h,P){var O=f.call(this)||this,w=P.log.createLog("default",O),R=new Map;return Object.defineProperties(O,{_log:{value:w},_clientTrackSwitchOffControl:{value:P.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:P.contentPreferencesMode||"disabled"},_instanceId:{value:++r},_options:{value:P},_participants:{value:R},_signaling:{value:h},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(h.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return h.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:c},name:{enumerable:!0,value:h.name},participants:{enumerable:!0,value:R},sid:{enumerable:!0,value:h.sid},state:{enumerable:!0,get:function(){return h.state}},mediaRegion:{enumerable:!0,value:h.mediaRegion}}),function(f,u){u.on("updated",function(){var h=u.isEnabled;f._log.info("Recording "+(h?"started":"stopped")),f.emit("recording"+(h?"Started":"Stopped"))})}(O,h.recording),function(f,u){var c=f._log;c.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),u.participants.forEach(v.bind(null,f)),c.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),u.on("participantConnected",v.bind(null,f)),u.on("dominantSpeakerChanged",function(){return f.emit("dominantSpeakerChanged",f.dominantSpeaker)}),u.on("stateChanged",function h(P,O){switch(c.info("Transitioned to state:",P),P){case"disconnected":f.participants.forEach(function(w){w._unsubscribeTracks()}),f.emit(P,f,O),f.localParticipant.tracks.forEach(function(w){w.unpublish()}),u.removeListener("stateChanged",h);break;case"reconnecting":setTimeout(function(){return f.emit("reconnecting",O)},0);break;default:setTimeout(function(){return f.emit("reconnected")},0)}})}(O,h),w.info("Created a new Room:",O.name),w.debug("Initial RemoteParticipants:",Array.from(O._participants.values())),O}return d(u,f),u.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},u.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},u.prototype.getStats=function(){var c=this;return this._signaling.getStats().then(function(h){return Array.from(h).map(function(P){var O=p(P,2),R=O[1];return new t(O[0],Object.assign({},R,{localAudioTrackStats:l(c,R.localAudioTrackStats),localVideoTrackStats:l(c,R.localVideoTrackStats)}))})})},u.prototype.toJSON=function(){return e(this)},u}(s);function l(f,u){var c=f.localParticipant._signaling;return u.reduce(function(h,P){var O=c.tracks.get(P.trackId),w=c.getSender(O);return w?[Object.assign({},P,{trackId:w.id})].concat(h):h},[])}function v(f,u){var c=f._log,O=new i(u,{log:c,clientTrackSwitchOffControl:f._clientTrackSwitchOffControl,contentPreferencesMode:f._contentPreferencesMode});c.info("A new RemoteParticipant connected:",O),f._participants.set(O.sid,O),f.emit("participantConnected",O);var w=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(R){var C=p(Array.isArray(R)?R:[R,R],2),T=C[0],g=C[1];function _(){var L=[].slice.call(arguments);L.unshift(g),L.push(O),f.emit.apply(f,o([],p(L)))}return O.on(T,_),[T,_]});O.once("disconnected",function(){var C=f.dominantSpeaker;c.info("RemoteParticipant disconnected:",O),f._participants.delete(O.sid),w.forEach(function(T){O.removeListener(T[0],T[1])}),f.emit("participantDisconnected",O),O===C&&f.emit("dominantSpeakerChanged",f.dominantSpeaker)})}k.exports=n},3185:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=a(8553),o=a(6996),s=a(1856),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},t=function(e){function r(){return e.call(this,"closed",i)||this}return d(r,e),r.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},r.prototype._connect=function(n,l,v,y,m){n.connect("PA00000000000000000000000000000000","test");var u=Promise.resolve(new o(n,"RM00000000000000000000000000000000",m));return u.cancel=function(){},u},r.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},r.prototype.close=function(){var n=this;return this.bracket("close",function(l){switch(n.state){case"closed":return n;case"open":return n._close(l);default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r.prototype.connect=function(n,l,v,y,m){var f=this;return this.bracket("connect",function u(c){switch(f.state){case"closed":return f._open(c).then(u.bind(null,c));case"open":return f.releaseLockCompletely(c),f._connect(n,l,v,y,m);default:throw new Error('Unexpected Signaling state "'+f.state+'"')}})},r.prototype.createLocalParticipantSignaling=function(){return new p},r.prototype.open=function(){var n=this;return this.bracket("open",function(l){switch(n.state){case"closed":return n._open(l);case"open":return n;default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},r}(s);k.exports=t},518:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),t}return d(i,s),i.prototype.addTrack=function(t,e,r){var n=this._createLocalTrackPublicationSignaling(t,e,r);return this._trackSendersToPublications.set(t,n),this._publicationsToTrackSenders.set(n,t),s.prototype.addTrack.call(this,n),this},i.prototype.getPublication=function(t){return this._trackSendersToPublications.get(t)||null},i.prototype.getSender=function(t){return this._publicationsToTrackSenders.get(t)||null},i.prototype.removeTrack=function(t){var e=this._trackSendersToPublications.get(t);return e?(this._trackSendersToPublications.delete(t),this._publicationsToTrackSenders.delete(e),s.prototype.removeTrack.call(this,e)&&e.stop(),e):null},i}(a(8553));k.exports=o},7667:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=function(i){function t(e,r,n){var l=this;return e=e.clone(),(l=i.call(this,r,e.kind,"data"===e.kind||e.track.enabled,n)||this).setTrackTransceiver(e),Object.defineProperties(l,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:e.id}}),l}return d(t,i),Object.defineProperty(t.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),t.prototype.enable=function(e){return this.trackTransceiver.track.enabled=e="boolean"!=typeof e||e,i.prototype.enable.call(this,e)},t.prototype.publishFailed=function(e){return function(i,t){return null===i._sid&&!i._error&&(i._error=t,!0)}(this,e)&&this.emit("updated"),this},t.prototype.setPriority=function(e){return this._updatedPriority!==e&&(this._updatedPriority=e,this.emit("updated")),this},t.prototype.setSid=function(e){return this._error?this:i.prototype.setSid.call(this,e)},t.prototype.stop=function(){this.trackTransceiver.stop()},t}(a(1109));k.exports=o},8553:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(1856),o=a(5674),s={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=function(t){function e(){var r=t.call(this,"connecting",s)||this;return Object.defineProperties(r,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),r}return d(e,t),Object.defineProperty(e.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(r){return this.tracks.set(r.id||r.sid,r),this.emit("trackAdded",r),this},e.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)},e.prototype.removeTrack=function(r){var n=this.tracks.get(r.id||r.sid);return this.tracks.delete(r.id||r.sid),n&&this.emit("trackRemoved",r),n||null},e.prototype.setNetworkQualityLevel=function(r,n){this._networkQualityLevel!==r&&(this._networkQualityLevel=r,this._networkQualityStats=n&&(n.audio||n.video)?new o(n):null,this.emit("networkQualityLevelChanged"))},e.prototype.connect=function(r,n){return("connecting"===this.state||"reconnecting"===this.state)&&(this._sid||(this._sid=r),this._identity||(this._identity=n),this.preempt("connected"),!0)},e.prototype.reconnecting=function(){return("connecting"===this.state||"connected"===this.state)&&(this.preempt("reconnecting"),!0)},e}(p);k.exports=i},8659:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),t}return d(i,s),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(t){return this.isEnabled!==(t="boolean"!=typeof t||t)&&(this._isEnabled=t,this.emit("updated")),this},i}(a(3105).EventEmitter);k.exports=o},8760:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return r.connect(t,e),r}return d(i,s),i}(a(8553));k.exports=o},2261:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n,l,v){var y=s.call(this,e,r,n,l)||this;return Object.defineProperties(y,{_isSwitchedOff:{value:v,writable:!0}}),y.setSid(t),y}return d(i,s),Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(t){return this.error||(this._error=t,this.emit("updated")),this},i.prototype.setPriority=function(t){return this._priority!==t&&(this._priority=t,this.emit("updated")),this},i.prototype.setSwitchedOff=function(t){return this._isSwitchedOff!==t&&(this._isSwitchedOff=t,this.emit("updated")),this},i}(a(1109));k.exports=o},6996:function(k,S,a){"use strict";var c,d=this&&this.__extends||(c=function(h,P){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,w){O.__proto__=w}||function(O,w){for(var R in w)Object.prototype.hasOwnProperty.call(w,R)&&(O[R]=w[R])})(h,P)},function(h,P){if("function"!=typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function O(){this.constructor=h}c(h,P),h.prototype=null===P?Object.create(P):(O.prototype=P.prototype,new O)}),p=a(8659),o=a(1856),s=a(1190),i=a(3761).buildLogLevels,t=a(9917).DEFAULT_LOG_LEVEL,e=a(7394),r=a(7061),n=r.MediaConnectionError,l=r.MediaDTLSTransportFailedError,v=r.SignalingConnectionDisconnectedError,y=0,m={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},f=function(c){function h(P,O,w,R){var C=this;R=Object.assign({logLevel:t,RecordingSignaling:p,Timeout:s},R);var T=i(R.logLevel);C=c.call(this,"connected",m)||this;var g=R.RecordingSignaling,_=new R.Timeout(function(){C._disconnect(C._reconnectingError)},R.sessionTimeout,!1);return Object.defineProperties(C,{_instanceId:{value:y++},_log:{value:R.log?R.log.createLog("default",C):new e("default",C,T,R.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:R},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:_},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:P},name:{enumerable:!0,value:w},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new g},sid:{enumerable:!0,value:O}}),C.on("connectionStateChanged",function(){"failed"===C.connectionState&&!["disconnected","failed"].includes(C.iceConnectionState)&&C._disconnect(new l)}),C.on("iceConnectionStateChanged",function(){return u(C)}),C.on("signalingConnectionStateChanged",function(){return u(C)}),setTimeout(function(){return u(C)}),C}return d(h,c),h.prototype._disconnect=function(P){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[P]),!0)},h.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},h.prototype.connectParticipant=function(P){var O=this;return"disconnected"!==P.state&&!this.participants.has(P.sid)&&(this.participants.set(P.sid,P),P.on("stateChanged",function w(R){"disconnected"===R&&(P.removeListener("stateChanged",w),O.participants.delete(P.sid),O.emit("participantDisconnected",P))}),this.emit("participantConnected",P),!0)},h.prototype.disconnect=function(){return this._disconnect()},h.prototype.setDominantSpeaker=function(P){this.dominantSpeakerSid=P,this.emit("dominantSpeakerChanged")},h}(o);function u(c){var h;"disconnected"!==c.state&&"disconnected"!==c.signalingConnectionState?("reconnecting"===c.signalingConnectionState?h=c.signalingConnectionState:"failed"===c.iceConnectionState?(c._mediaConnectionIsReconnecting=!0,h="reconnecting"):"new"===c.iceConnectionState||"checking"===c.iceConnectionState?h=c._mediaConnectionIsReconnecting?"reconnecting":"connected":(c._mediaConnectionIsReconnecting=!1,c._reconnectingError=null,c._sessionTimeout.clear(),h="connected"),h!==c.state&&("reconnecting"===h?(c._reconnectingError="reconnecting"===c.signalingConnectionState?new v:new n,c._sessionTimeout.start(),c.preempt(h,null,[c._reconnectingError])):c.preempt(h))):c._sessionTimeout.clear()}k.exports=f},1109:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r,n){var l=s.call(this)||this,v=null;return Object.defineProperties(l,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return v},set:function(y){null===v&&(v=y)}},kind:{enumerable:!0,value:e},name:{enumerable:!0,value:t}}),l}return d(i,s),Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(t){return this.isEnabled!==(t="boolean"!=typeof t||t)&&(this._isEnabled=t,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(t){return this.trackTransceiver!==(t=t||null)&&(this._trackTransceiver=t,this.emit("updated")),this},i.prototype.setSid=function(t){return null===this.sid&&(this._sid=t,this.emit("updated")),this},i}(a(3105).EventEmitter);k.exports=o},4384:(k,S,a)=>{"use strict";var d=a(617),p=a(5971),o=a(3899),s=a(1328),i=a(7061),t=i.SignalingConnectionDisconnectedError,e=i.SignalingIncomingMessageInvalidError,r=a(3761),n=r.flatMap,l=r.createRoomConnectEventPayload;k.exports=function(y,m,f,u,c,h){h=Object.assign({PeerConnectionManager:p,RoomV2:o,Transport:s},h);var P=c.video[0]&&!0===c.video[0].adaptiveSimulcast,w=h.RoomV2,R=h.Transport,C=h.iceServers,T=h.log,g=new(0,h.PeerConnectionManager)(u,c,h),_=n(f.tracks,function(A){return[A.trackTransceiver]});g.setTrackSenders(_);var I,L=new Error("Canceled"),M=new d(function(A,H,U){var ee=h.bandwidthProfile,D=h.eventObserver,B=h.name,me=Object.assign({adaptiveSimulcast:P,automaticSubscription:h.automaticSubscription,dominantSpeaker:h.dominantSpeaker,environment:h.environment,eventObserver:D,loggerName:h.loggerName,logLevel:h.logLevel,networkMonitor:h.networkMonitor,networkQuality:h.networkQuality,iceServers:C,onIced:function(ye){return U()?(H(L),Promise.reject(L)):(T.debug("Got ICE servers:",ye),h.iceServers=ye,g.setConfiguration(h),g.createAndOffer().then(function(){if(U())throw H(L),L;T.debug("createAndOffer() succeeded."),g.dequeue("description")}).catch(function(ve){throw T.error("createAndOffer() failed:",ve),H(ve),ve}))},realm:h.realm,renderHints:!!ee&&("disabled"!==h.clientTrackSwitchOffControl||"disabled"!==h.contentPreferencesMode),sdpSemantics:h.sdpSemantics,trackPriority:!!ee,trackSwitchOff:!!ee},ee?{bandwidthProfile:ee}:{});I=new R(B,y,f,g,m,me);var pe=l(h);D.emit("event",pe),I.once("connected",function(ye){T.debug("Transport connected:",ye),U()?H(L):ye.participant?(f.setSignalingRegion(ye.options.signaling_region),A(new w(f,ye,I,g,h))):H(new e)}),I.once("stateChanged",function(ye,ve){"disconnected"===ye?(I=null,H(ve||new t)):T.debug("Transport state changed:",ye)})},function(){I&&(I.disconnect(),I=null)});return M.catch(function(){I&&(I.disconnect(),I=null),g.close()}),M}},2222:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"active_speaker",e)||this;return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",function(n){n.on("message",function(l){switch(l.type){case"active_speaker":r._setLoudestParticipantSid(l.participant)}})}),r}return d(i,s),Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(t){this.loudestParticipantSid!==t&&(this._loudestParticipantSid=t,this.emit("updated"))},i}(a(762));k.exports=o},5175:(k,S,a)=>{"use strict";var d=a(7060),p=function(){function o(){Object.defineProperties(this,{_filter:{value:new d({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,t){return i.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return o.prototype.setUfrag=function(s){this._ufrag=s;var i=this._filter.toMap().get(s);return i?i.candidates:[]},o.prototype.update=function(s){s.candidates=s.candidates||[];var i=this._filter.toMap().get(s.ufrag),t=i?i.candidates:[];return this._filter.update(s)&&this._ufrag===s.ufrag?s.candidates.slice(t.length):[]},o}();k.exports=p},6802:(k,S,a)=>{"use strict";var d=a(9917),p=d.ICE_ACTIVITY_CHECK_PERIOD_MS,o=d.ICE_INACTIVITY_THRESHOLD_MS,s=function(){function i(t,e){e=Object.assign({activityCheckPeriodMs:p,inactivityThresholdMs:o},e),Object.defineProperties(this,{_activityCheckPeriodMs:{value:e.activityCheckPeriodMs},_inactivityThresholdMs:{value:e.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:t},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(t){return Array.from(t.values()).find(function(n){return"candidate-pair"===n.type&&n.nominated})||{bytesReceived:0,timestamp:Math.round((new Date).getTime())}},i.prototype._getIceConnectionStats=function(){var t=this;return this._peerConnection.getStats().then(function(e){return t._getActivePairStat(e)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(t){var e=this;t&&null===this._onIceConnectionStateChanged?(this._onIceConnectionStateChanged=function(){"disconnected"===e._peerConnection.iceConnectionState&&t()},this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged)):!t&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged),this._onIceConnectionStateChanged=null)},i.prototype.start=function(t){var e=this;this.stop(),this._timer=setInterval(function(){e._getIceConnectionStats().then(function(r){!r||((!e._lastActivity||e._lastActivity.bytesReceived!==r.bytesReceived)&&(e._lastActivity=r,e._scheduleInactivityCallback(null)),r.timestamp-e._lastActivity.timestamp>=e._inactivityThresholdMs&&("disconnected"===e._peerConnection.iceConnectionState?t():null===e._onIceConnectionStateChanged&&e._scheduleInactivityCallback(t)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),null!==this._timer&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i}();k.exports=s},9003:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(4384),o=a(7701),i=function(t){function e(r,n){var l;return n=Object.assign({createCancelableRoomSignalingPromise:p},n),l=t.call(this)||this,Object.defineProperties(l,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:r}}),l}return d(e,t),e.prototype._connect=function(r,n,l,v,y){return y=Object.assign({},this._options,y),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,r,l,v,y)},e.prototype.createLocalParticipantSignaling=function(r,n){return new o(r,n)},e}(a(3185));k.exports=i},7701:function(k,S,a){"use strict";var l,d=this&&this.__extends||(l=function(v,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,f){m.__proto__=f}||function(m,f){for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(m[u]=f[u])})(v,y)},function(v,y){if("function"!=typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function m(){this.constructor=v}l(v,y),v.prototype=null===y?Object.create(y):(m.prototype=y.prototype,new m)}),p=a(518),o=a(3679),s=a(9917).DEFAULT_LOG_LEVEL,i=a(7394),t=a(3761),e=t.buildLogLevels,r=t.isDeepEqual,n=function(l){function v(y,m,f){var u;f=Object.assign({logLevel:s,LocalTrackPublicationV2:o},f),u=l.call(this)||this;var c=e(f.logLevel);return Object.defineProperties(u,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:y},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:f.LocalTrackPublicationV2},_log:{value:f.log?f.log.createLog("default",u):new i("default",u,c,f.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:m},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),u}return d(v,l),v.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},v.prototype.setSignalingRegion=function(y){this._signalingRegion||(this._signalingRegion=y)},v.prototype.setBandwidthProfile=function(y){r(this._bandwidthProfile,y)||(this._bandwidthProfile=JSON.parse(JSON.stringify(y)),this._bandwidthProfileRevision++,this.didUpdate())},v.prototype.getParameters=function(){return this._encodingParameters},v.prototype.setParameters=function(y){return this._encodingParameters.update(y),this},v.prototype.update=function(y){return this._publishedRevision>=y.revision||(this._publishedRevision=y.revision,y.tracks.forEach(function(m){var f=this.tracks.get(m.id);f&&f.update(m)},this)),this},v.prototype._createLocalTrackPublicationSignaling=function(y,m,f){return new this._LocalTrackPublicationV2(y,m,f)},v.prototype.addTrack=function(y,m,f){var u=this;l.prototype.addTrack.call(this,y,m,f);var c=this.getPublication(y),h=c.isEnabled,P=c.updatedPriority,O=function(){(h!==c.isEnabled||P!==c.updatedPriority)&&(u.didUpdate(),h=c.isEnabled,P=c.updatedPriority)};return c.on("updated",O),this._removeListener(c),this._removeListeners.set(c,function(){return c.removeListener("updated",O)}),this.didUpdate(),this},v.prototype._removeListener=function(y){var m=this._removeListeners.get(y);m&&m()},v.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(y){return y.getState()})}},v.prototype.didUpdate=function(){this._revision++,this.emit("updated")},v.prototype.removeTrack=function(y){var m=l.prototype.removeTrack.call(this,y);return m&&(y.removeClone(m.trackTransceiver),this._removeListener(m),this.didUpdate()),m},v.prototype.setNetworkQualityConfiguration=function(y){this.networkQualityConfiguration.update(y)},v.prototype.setPublisherHint=function(y,m){var f=Array.from(this.tracks.values()).find(function(u){return u.sid===y});return f?f.trackTransceiver.setPublisherHint(m):(this._log.warn("track:"+y+" not found"),Promise.resolve("UNKNOWN_TRACK"))},v}(p);k.exports=n},3679:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(7667),o=a(7061).createTwilioError,s=function(i){function t(e,r,n){return i.call(this,e,r,n)||this}return d(t,i),t.prototype.getState=function(){return{enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority}},t.prototype.update=function(e){switch(e.state){case"ready":this.setSid(e.sid);break;case"failed":var r=e.error;this.publishFailed(o(r.code,r.message))}return this},t}(p);k.exports=s},762:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(3105),o=0,s=function(i){function t(e,r,n){var l=i.call(this)||this;return Object.defineProperties(l,{_instanceId:{value:o++},channel:{value:r},_log:{value:n.log.createLog("default",l)},_getReceiver:{value:e},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),l}return d(t,i),Object.defineProperty(t.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},t.prototype.setup=function(e){var r=this;this._teardown(),this._log.info("setting up msp transport for id:",e);var n=this._getReceiver(e).then(function(l){if("data"!==l.kind&&r._log.error("Expected a DataTrackReceiver"),r._receiverPromise===n){try{r._transport=l.toDataTransport(),r.emit("ready",r._transport)}catch(v){r._log.error("Failed to toDataTransport: "+v.message)}l.once("close",function(){return r._teardown()})}});this._receiverPromise=n},t.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},t}(p);k.exports=s},8804:function(k,S,a){"use strict";var e,d=this&&this.__extends||(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,v){l.__proto__=v}||function(l,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(l[y]=v[y])})(r,n)},function(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function l(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}),p=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y},o=a(3105),s=a(127),i=function(e){function r(n,l){var v=e.call(this)||this;return Object.defineProperties(v,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:l}}),l.on("updated",function(){return v.emit("updated")}),v}return d(r,e),Object.defineProperty(r.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),r.prototype.start=function(){var n=this;this.stop();var l=setTimeout(function(){n._timeout===l&&function(e){var v=(e._manager._peerConnections?Array.from(e._manager._peerConnections.values()):[]).map(function(y){return y._peerConnection}).filter(function(y){return"closed"!==y.signalingState}).map(function(y){if(e._factories.has(y))return e._factories.get(y);var m=new s(y);return e._factories.set(y,m),m}).map(function(y){return y.next().catch(function(){return null})});return Promise.all(v).then(function(y){return y.filter(function(m){return m}).map(function(m){return m.summarize()})})}(n).then(function(v){if(n._timeout===l){if(v.length){var y=p(v,1);n._signaling.put(y[0])}n.start()}})},200);this._timeout=l},r.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},r}(o);k.exports=i},1159:function(k,S,a){"use strict";var r,d=this&&this.__extends||(r=function(n,l){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(n,l)},function(n,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function v(){this.constructor=n}r(n,l),n.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}),p=a(762),o=a(8264),s=a(1190),t=function(r){function n(l,v,y){var m=r.call(this,l,"network_quality",y)||this;return Object.defineProperties(m,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new o},_resendTimer:{value:new s(function(){m._resendTimer.setDelay(1.5*m._resendTimer.delay),m._sendNetworkQualityInputs()},5e3,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:v.local,remoteReportLevel:v.remote}}}}),m.on("ready",function(f){f.on("message",function(u){switch(m._log.debug("Incoming: ",u),u.type){case"network_quality":m._handleNetworkQualityMessage(u)}})}),m._sendNetworkQualityInputs(),m}return d(n,r),Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(l){var v=this,y=!1,m=null,f=l?l.local:null;"number"==typeof f?(m=f,this._levels=null):"object"==typeof f&&f&&(this._levels=f,m="number"==typeof f.level?f.level:Math.min(f.audio.send,f.audio.recv,f.video.send,f.video.recv)),null!==m&&this.level!==m&&(this._level=m,y=!0),this._remoteLevels=l&&l.remotes?l.remotes.reduce(function(u,c){return(v._remoteLevels.get(c.sid)||{}).level!==c.level&&(y=!0),u.set(c.sid,c)},new Map):this._remoteLevels,y&&this.emit("updated"),this._resendTimer.setDelay(5e3),this._resendTimer.isSet&&setTimeout(function(){return v._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var l=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(v){l._transport&&l._transport.publish(function(r,n){return Object.assign({type:"network_quality"},r,n)}(v,l._networkQualityReportLevels))}).finally(function(){l._resendTimer.start()})},n.prototype.put=function(l){this._networkQualityInputs.put(l)},n}(p);k.exports=t},4556:function(k,S,a){"use strict";var de,d=this&&this.__extends||(de=function(ce,G){return(de=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,ie){z.__proto__=ie}||function(z,ie){for(var oe in ie)Object.prototype.hasOwnProperty.call(ie,oe)&&(z[oe]=ie[oe])})(ce,G)},function(ce,G){if("function"!=typeof G&&null!==G)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function z(){this.constructor=ce}de(ce,G),ce.prototype=null===G?Object.create(G):(z.prototype=G.prototype,new z)}),p=this&&this.__read||function(de,ce){var G="function"==typeof Symbol&&de[Symbol.iterator];if(!G)return de;var ie,ue,z=G.call(de),oe=[];try{for(;(void 0===ce||ce-- >0)&&!(ie=z.next()).done;)oe.push(ie.value)}catch(we){ue={error:we}}finally{try{ie&&!ie.done&&(G=z.return)&&G.call(z)}finally{if(ue)throw ue.error}}return oe},o=this&&this.__spreadArray||function(de,ce){for(var G=0,z=ce.length,ie=de.length;G<z;G++,ie++)de[ie]=ce[G];return de},s=a(4035),i=a(4135),t=i.RTCIceCandidate,e=i.RTCPeerConnection,r=i.RTCSessionDescription,n=i.getStats,l=a(4911),v=a(9917),y=v.DEFAULT_ICE_GATHERING_TIMEOUT_MS,m=v.DEFAULT_LOG_LEVEL,f=v.DEFAULT_SESSION_TIMEOUT_SEC,u=v.iceRestartBackoffConfig,c=a(3028),h=c.addOrRewriteNewTrackIds,P=c.addOrRewriteTrackIds,O=c.createCodecMapForMediaSection,w=c.disableRtx,R=c.enableDtxForOpus,C=c.filterLocalCodecs,T=c.getMediaSections,g=c.removeSSRCAttributes,_=c.revertSimulcast,L=c.setCodecPreferences,I=c.setSimulcast,M=a(1190),A=a(7061),H=A.MediaClientLocalDescFailedError,U=A.MediaClientRemoteDescFailedError,F=a(3761),Z=F.buildLogLevels,ee=F.getPlatform,J=F.isChromeScreenShareTrack,V=F.oncePerTick,D=F.defer,E=a(5175),b=a(6802),B=a(1144),Q=a(6804),q=a(1856),K=a(7394),X=a(5612),se=a(556),le=l.guessBrowser(),he=ee(),me=/android/.test(he),pe="chrome"===le,ye="firefox"===le,ve="safari"===le,ke=0,be={open:["closed","updating"],updating:["closed","open"],closed:[]},Ee=function(de){function ce(G,z,ie,oe){var ue=de.call(this,"open",be)||this,we=W(oe=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:J,iceServers:[],logLevel:m,offerOptions:{},revertSimulcast:_,sessionTimeout:1e3*f,setCodecPreferences:L,setSimulcast:I,Backoff:s,IceConnectionMonitor:b,RTCIceCandidate:t,RTCPeerConnection:e,RTCSessionDescription:r,Timeout:M},oe)),Ce=Z(oe.logLevel),Ae=oe.RTCPeerConnection;!0===oe.enableDscp&&(oe.chromeSpecificConstraints=oe.chromeSpecificConstraints||{},oe.chromeSpecificConstraints.optional=oe.chromeSpecificConstraints.optional||[],oe.chromeSpecificConstraints.optional.push({googDscp:!0}));var xe=oe.log?oe.log.createLog("webrtc",ue):new K("webrtc",ue,Ce,oe.loggerName),Oe=new Ae(we,oe.chromeSpecificConstraints);oe.dummyAudioMediaStreamTrack&&Oe.addTrack(oe.dummyAudioMediaStreamTrack),Object.defineProperties(ue,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:oe.enableDscp},_encodingParameters:{value:z},_isChromeScreenShareTrack:{value:oe.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new oe.Timeout(function(){return ue._handleIceGatheringTimeout()},y,!1)},_iceRestartBackoff:{value:oe.Backoff.exponential(u)},_instanceId:{value:++ke},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:xe},_eventObserver:{value:oe.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new oe.IceConnectionMonitor(Oe)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:oe.offerOptions},_onEncodingParametersChanged:{value:V(function(){ue._needsAnswer||Te(ue)})},_peerConnection:{value:Oe},_preferredAudioCodecs:{value:ie.audio},_preferredVideoCodecs:{value:ie.video},_shouldApplyDtx:{value:ie.audio.every(function(ge){return"opus"!==ge.codec})||ie.audio.some(function(ge){return"opus"===ge.codec&&ge.dtx})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new oe.Timeout(function(){xe.debug("ICE reconnect timed out"),ue.close()},oe.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new E},_setCodecPreferences:{value:ye&&me&&ie.video[0]&&"h264"!==ie.video[0].codec.toLowerCase()?function(ge){return ge}:oe.setCodecPreferences},_setSimulcast:{value:oe.setSimulcast},_revertSimulcast:{value:oe.revertSimulcast},_RTCIceCandidate:{value:oe.RTCIceCandidate},_RTCPeerConnection:{value:oe.RTCPeerConnection},_RTCSessionDescription:{value:oe.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:G}}),z.on("changed",ue._onEncodingParametersChanged),Oe.addEventListener("connectionstatechange",ue._handleConnectionStateChange.bind(ue)),Oe.addEventListener("datachannel",ue._handleDataChannelEvent.bind(ue)),Oe.addEventListener("icecandidate",ue._handleIceCandidateEvent.bind(ue)),Oe.addEventListener("iceconnectionstatechange",ue._handleIceConnectionStateChange.bind(ue)),Oe.addEventListener("icegatheringstatechange",ue._handleIceGatheringStateChange.bind(ue)),Oe.addEventListener("signalingstatechange",ue._handleSignalingStateChange.bind(ue)),Oe.addEventListener("track",ue._handleTrackEvent.bind(ue)),ue._iceRestartBackoff.on("ready",function(){return ue._initiateIceRestart()});var Re=ue;return ue.on("stateChanged",function ge(Le){"closed"===Le&&(Re.removeListener("stateChanged",ge),Re._dataChannels.forEach(function(je,Me){Re.removeDataTrackSender(Me)}))}),ue}return d(ce,de),ce.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},ce.prototype.setEffectiveAdaptiveSimulcast=function(G){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",G),this._preferredVideoCodecs.forEach(function(z){"adaptiveSimulcast"in z&&(z.adaptiveSimulcast=G)})},Object.defineProperty(ce.prototype,"_shouldApplySimulcast",{get:function(){return!(!pe&&!ve)&&this._preferredVideoCodecs.some(function(z){return"vp8"===z.codec.toLowerCase()&&z.simulcast&&!1!==z.adaptiveSimulcast})},enumerable:!1,configurable:!0}),Object.defineProperty(ce.prototype,"connectionState",{get:function(){return"failed"===this.iceConnectionState?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(ce.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&"disconnected"===this._peerConnection.iceConnectionState||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(ce.prototype,"isApplicationSectionNegotiated",{get:function(){return"closed"===this._peerConnection.signalingState||!!this._peerConnection.localDescription&&T(this._peerConnection.localDescription.sdp,"application").length>0},enumerable:!1,configurable:!0}),Object.defineProperty(ce.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var G=this._preferredVideoCodecs.find(function(z){return"adaptiveSimulcast"in z});return G&&!0===G.adaptiveSimulcast},enumerable:!1,configurable:!0}),ce.prototype._maybeUpdateEncodings=function(G,z,ie){if(void 0===ie&&(ie=!1),"video"!==G.kind)return!1;var oe=l.guessBrowser();return!!("safari"===oe||"chrome"===oe&&this._isAdaptiveSimulcastEnabled)&&(this._updateEncodings(G,z,ie),!0)},ce.prototype._updateEncodings=function(G,z,ie){if(this._isChromeScreenShareTrack(G)){var oe=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];z.forEach(function(ge,Le){var je=oe[Le];je?(ge.scaleResolutionDownBy=je.scaleResolutionDownBy,ie&&delete ge.active):(ge.active=!1,delete ge.scaleResolutionDownBy)})}else{var ue=G.getSettings(),xe=ue.width*ue.height,Oe=[{pixels:518400,maxActiveLayers:3},{pixels:129600,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}].find(function(ge){return xe>=ge.pixels}),Re=Math.min(z.length,Oe.maxActiveLayers);z.forEach(function(ge,Le){Le<Re?(ge.scaleResolutionDownBy=1<<Re-Le-1,ie&&(ge.active=!0)):(ge.active=!1,delete ge.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",z.map(function(ge,Le){return"["+Le+": "+ge.active+", "+(ge.scaleResolutionDownBy||0)+"]"}).join(", "))},ce.prototype._addIceCandidate=function(G){var z=this;return Promise.resolve().then(function(){return G=new z._RTCIceCandidate(G),z._peerConnection.addIceCandidate(G)}).catch(function(ie){z._log.warn("Failed to add RTCIceCandidate "+(G?'"'+G.candidate+'"':"null")+": "+ie.message)})},ce.prototype._addIceCandidates=function(G){return Promise.all(G.map(this._addIceCandidate,this)).then(function(){})},ce.prototype._addOrUpdateTransceiver=function(G){var z=this,ie=function(de,ce){var G={audio:de._preferredAudioCodecs.map(function(ue){return ue.codec.toLowerCase()}),video:de._preferredVideoCodecs.map(function(ue){return ue.codec.toLowerCase()})}[ce],z=de._recycledTransceivers[ce],ie=G.find(function(ue){return de._localCodecs.has(ue)});if(!ie)return z.shift();var oe=z.find(function(ue){var we=de._remoteCodecMaps.get(ue.mid);return we&&we.has(ie)});return oe&&z.splice(z.indexOf(oe),1),oe}(this,G.kind);if(ie&&ie.sender){var oe=ie.sender.track?ie.sender.track.id:null;return oe&&this._log.warn("Reusing transceiver: "+ie.mid+"] "+oe+" => "+G.id),this._replaceTrackPromises.set(ie,ie.sender.replaceTrack(G).then(function(){ie.direction="sendrecv"},function(){}).finally(function(){z._replaceTrackPromises.delete(ie)})),ie}return this._peerConnection.addTransceiver(G)},ce.prototype._checkIceBox=function(G){var z=ne(G);if(!z)return Promise.resolve();var ie=this._remoteCandidates.setUfrag(z);return this._addIceCandidates(ie)},ce.prototype._answer=function(G){var z=this;return Promise.resolve().then(function(){return z._negotiationRole||(z._negotiationRole="answerer"),z._setRemoteDescription(G)}).catch(function(){throw new U}).then(function(){return z._peerConnection.createAnswer()}).then(function(ie){ie=ye?new z._RTCSessionDescription({sdp:w(ie.sdp),type:ie.type}):se(ie);var oe=g(ie.sdp,["mslabel","label"]);if(z._shouldApplySimulcast){var ue=oe;oe=z._setSimulcast(ue,z._trackIdsToAttributes),oe=z._revertSimulcast(oe,ue,G.sdp)}return oe=oe.replace(/42e015/g,"42e01f"),z._setLocalDescription({type:ie.type,sdp:oe})}).then(function(){return z._checkIceBox(G)}).then(function(){return z._queuedDescription&&z._updateDescription(z._queuedDescription)}).then(function(){return z._queuedDescription=null,z._maybeReoffer(z._peerConnection.localDescription)}).catch(function(ie){var oe=ie instanceof U?ie:new H;throw z._publishMediaWarning({message:"Failed to _answer",code:oe.code,error:ie}),oe})},ce.prototype._close=function(){return this._iceConnectionMonitor.stop(),"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0)},ce.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},ce.prototype._handleDataChannelEvent=function(G){var z=this,ie=G.channel,oe=new B(ie);this._dataTrackReceivers.add(oe),ie.addEventListener("close",function(){z._dataTrackReceivers.delete(oe)}),this.emit("trackAdded",oe)},ce.prototype._handleGlare=function(G){var z=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return z._trackIdsToAttributes=new Map(z._appliedTrackIdsToAttributes),z._setLocalDescription({type:"rollback"})}).then(function(){return z._needsAnswer=!1,z._answer(G)}).then(function(ie){return ie?Promise.resolve():z._offer()})},ce.prototype._publishMediaWarning=function(G){this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:G.message,code:G.code,context:JSON.stringify({error:G.error.message,sdp:G.sdp})}})},ce.prototype._handleIceCandidateEvent=function(G){G.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(G.candidate));var z={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};G.candidate||(z.ice.complete=!0),this._isIceLite&&G.candidate||(z.ice.revision=this._localCandidatesRevision++,this.emit("candidates",z))},ce.prototype._handleIceConnectionStateChange=function(){var G=this,z=this._peerConnection.iceConnectionState,ie=["connected","completed"].includes(z),oe=this._log;oe.debug('ICE connection state is "'+z+'"'),ie&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),"failed"===this._lastIceConnectionState||"failed"!==z||this._shouldRestartIce||this._isRestartingIce?["disconnected","failed"].includes(this._lastIceConnectionState)&&ie&&oe.debug("ICE reconnected"):(oe.warn("ICE failed"),this._initiateIceRestartBackoff()),"connected"===z?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){G._iceConnectionMonitor.stop(),!G._shouldRestartIce&&!G._isRestartingIce&&(oe.warn("ICE Connection Monitor detected inactivity"),G._isIceConnectionInactive=!0,G._initiateIceRestartBackoff(),G.emit("iceConnectionStateChanged"),G.emit("connectionStateChanged"))})):["disconnected","completed"].includes(z)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=z,this.emit("iceConnectionStateChanged")},ce.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},ce.prototype._handleIceGatheringStateChange=function(){var G=this._peerConnection.iceGatheringState,z=this._log;z.debug('ICE gathering state is "'+G+'"');var ie=this._iceGatheringTimeout;"gathering"===G&&!this._didGenerateLocalCandidates&&!ie.isSet&&(z.debug("Starting ICE gathering timeout: "+ie.delay),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},ce.prototype._handleSignalingStateChange=function(){"stable"===this._peerConnection.signalingState&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},ce.prototype._handleTrackEvent=function(G){var z=this,ie=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new X,this._trackMatcher.update(ie);var oe=G.track,ue=this._trackMatcher.match(G)||oe.id,we=new Q(ue,oe);this._mediaTrackReceivers.forEach(function(Ce){Ce.track.id===we.track.id&&z._mediaTrackReceivers.delete(Ce)}),this._mediaTrackReceivers.add(we),oe.addEventListener("ended",function(){return z._mediaTrackReceivers.delete(we)}),this.emit("trackAdded",we)},ce.prototype._initiateIceRestart=function(){if("closed"!==this._peerConnection.signalingState){var G=this._log;G.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var z=this._iceReconnectTimeout;z.isSet||(G.debug("Starting ICE reconnect timeout: "+z.delay),this._iceReconnectTimeout.start()),this.offer().catch(function(ue){G.error("offer failed in _initiateIceRestart with: "+ue.message)})}},ce.prototype._initiateIceRestartBackoff=function(){"closed"===this._peerConnection.signalingState||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff())},ce.prototype._maybeReoffer=function(G){var z=this._shouldOffer;if(G&&G.sdp){var ie=this._peerConnection.getSenders().filter(function(Ae){return Ae.track});z=["audio","video"].reduce(function(Ae,xe){var Oe=T(G.sdp,xe,"(sendrecv|sendonly)"),Re=ie.filter(j.bind(null,xe));return Ae||Oe.length<Re.length},z);var oe=this._dataChannels.size>0,ue=T(G.sdp,"application").length>0;z=z||oe&&!ue}return(z?this._offer():Promise.resolve()).then(function(){return z})},ce.prototype._offer=function(){var G=this,z=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,z.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return G._peerConnection.createOffer(z)}).catch(function(ie){var oe=new H;throw G._publishMediaWarning({message:"Failed to create offer",code:oe.code,error:ie}),oe}).then(function(ie){ie=ye?new G._RTCSessionDescription({sdp:w(ie.sdp),type:ie.type}):se(ie);var oe=g(ie.sdp,["mslabel","label"]);oe=G._peerConnection.remoteDescription?C(oe,G._peerConnection.remoteDescription.sdp):oe;var ue=G._setCodecPreferences(oe,G._preferredAudioCodecs,G._preferredVideoCodecs);return G._shouldOffer=!1,G._negotiationRole||(G._negotiationRole="offerer"),G._shouldApplySimulcast&&(G._localDescriptionWithoutSimulcast={type:"offer",sdp:ue},ue=G._setSimulcast(ue,G._trackIdsToAttributes)),G._setLocalDescription({type:"offer",sdp:ue})})},ce.prototype._getMediaTrackSenderId=function(G){var z=Array.from(this._rtpSenders.keys()).find(function(ie){return ie.track.id===G});return z?z.id:G},ce.prototype._addOrRewriteLocalTrackIds=function(G){var z=this,oe=this._peerConnection.getTransceivers().filter(function(Re){var ge=Re.sender;return!Re.stopped&&ge&&ge.track}),ue=oe.filter(function(Re){return Re.mid}),we=new Map(ue.map(function(Re){return[Re.mid,z._getMediaTrackSenderId(Re.sender.track.id)]})),Ce=P(G.sdp,we),Ae=oe.filter(function(Re){return!Re.mid}),xe=new Map(["audio","video"].map(function(Re){return[Re,Ae.filter(function(ge){return ge.sender.track.kind===Re}).map(function(ge){return z._getMediaTrackSenderId(ge.sender.track.id)})]})),Oe=h(Ce,we,xe);return new this._RTCSessionDescription({sdp:Oe,type:G.type})},ce.prototype._rollbackAndApplyOffer=function(G){var z=this;return this._setLocalDescription({type:"rollback"}).then(function(){return z._setLocalDescription(G)})},ce.prototype._setLocalDescription=function(G){var z=this;return"rollback"!==G.type&&this._shouldApplyDtx&&(G=new this._RTCSessionDescription({sdp:R(G.sdp),type:G.type})),this._peerConnection.setLocalDescription(G).catch(function(ie){z._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+G.type+'" failed with the error "'+ie.message+'".',ie);var oe=new H,ue={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+G.type+'" failed',code:oe.code,error:ie};throw G.sdp&&(z._log.warn("The SDP was "+G.sdp),ue.sdp=G.sdp),z._publishMediaWarning(ue),oe}).then(function(){"rollback"!==G.type&&(z._localDescription=z._addOrRewriteLocalTrackIds(G),z._shouldApplyDtx&&(z._localDescription=new z._RTCSessionDescription({sdp:R(z._localDescription.sdp,[]),type:z._localDescription.type})),z._localCandidates=[],"offer"===G.type?z._descriptionRevision++:"answer"===G.type&&(z._lastStableDescriptionRevision=z._descriptionRevision,_e(z)),z._localUfrag=ne(G),z.emit("description",z.getState()))})},ce.prototype._setRemoteDescription=function(G){var z=this;return G.sdp&&(G.sdp=this._setCodecPreferences(G.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),G.sdp=this._shouldApplyDtx?R(G.sdp):R(G.sdp,[]),ye&&(G.sdp=function(de){return de.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}(G.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(G.sdp))),G=new this._RTCSessionDescription(G),Promise.resolve().then(function(){if("answer"===G.type&&z._localDescriptionWithoutSimulcast){var ie=z._preferredVideoCodecs.find(function(we){return"adaptiveSimulcast"in we}),ue=z._revertSimulcast(z._localDescription.sdp,z._localDescriptionWithoutSimulcast.sdp,G.sdp,!!ie&&!1===ie.adaptiveSimulcast);if(z._localDescriptionWithoutSimulcast=null,ue!==z._localDescription.sdp)return z._rollbackAndApplyOffer({type:z._localDescription.type,sdp:ue})}}).then(function(){return z._peerConnection.setRemoteDescription(G)}).then(function(){"answer"===G.type&&(z._isRestartingIce&&(z._log.debug("An ICE restart was in-progress and is now completed"),z._isRestartingIce=!1),_e(z))},function(ie){throw z._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+G.type+'" failed with the error "'+ie.message+'".',ie),G.sdp&&z._log.warn("The SDP was "+G.sdp),ie})},ce.prototype._updateDescription=function(G){var z=this;switch(G.type){case"answer":case"pranswer":if(G.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=G.revision;break;case"close":return this._close();case"create-offer":return G.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=G,Promise.resolve()):(this._descriptionRevision=G.revision,this._offer());case"offer":return G.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsAnswer&&0===this._lastStableDescriptionRevision?(this._queuedDescription=G,Promise.resolve()):(this._descriptionRevision=G.revision,this._handleGlare(G)):(this._descriptionRevision=G.revision,this._answer(G).then(function(){}))}var ie=G.revision;return Promise.resolve().then(function(){return z._setRemoteDescription(G)}).catch(function(oe){var ue=new U;throw z._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+G.type+'" failed',code:ue.code,error:oe,sdp:G.sdp}),ue}).then(function(){return z._lastStableDescriptionRevision=ie,z._needsAnswer=!1,z._checkIceBox(G)}).then(function(){return z._queuedDescription&&z._updateDescription(z._queuedDescription)}).then(function(){return z._queuedDescription=null,z._maybeReoffer(z._peerConnection.localDescription).then(function(){})})},ce.prototype._updateIce=function(G){var z=this._remoteCandidates.update(G);return this._addIceCandidates(z)},ce.prototype.addDataTrackSender=function(G){if(!this._dataChannels.has(G))try{var z={ordered:G.ordered};null!==G.maxPacketLifeTime&&(z.maxPacketLifeTime=G.maxPacketLifeTime),null!==G.maxRetransmits&&(z.maxRetransmits=G.maxRetransmits);var ie=this._peerConnection.createDataChannel(G.id,z);G.addDataChannel(ie),this._dataChannels.set(G,ie)}catch(oe){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+G.id+'": '+oe.message)}},ce.prototype._handleQueuedPublisherHints=function(){var G=this;"stable"===this._peerConnection.signalingState&&this._mediaTrackSenderToPublisherHints.forEach(function(z,ie){var oe=z.deferred,ue=z.encodings;G._mediaTrackSenderToPublisherHints.delete(ie),G._setPublisherHint(ie,ue).then(function(we){return oe.resolve(we)}).catch(function(we){return oe.reject(we)})})},ce.prototype._setPublisherHint=function(G,z){var ie=this;if(ye)return Promise.resolve("COULD_NOT_APPLY_HINT");this._mediaTrackSenderToPublisherHints.has(G)&&(this._mediaTrackSenderToPublisherHints.get(G).deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(G));var ue=this._rtpSenders.get(G);if(!ue)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if("closed"===this._peerConnection.signalingState)return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if("stable"!==this._peerConnection.signalingState){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var we=D();return this._mediaTrackSenderToPublisherHints.set(G,{deferred:we,encodings:z}),we.promise}var Ce=ue.getParameters();return null!==z&&z.forEach(function(Ae){var xe=Ae.enabled,Oe=Ae.layer_index;Ce.encodings.length>Oe?(ie._log.debug("layer:"+Oe+", active:"+Ce.encodings[Oe].active+" => "+xe),Ce.encodings[Oe].active=xe):ie._log.warn("invalid layer:"+Oe+", active:"+xe)}),this._maybeUpdateEncodings(ue.track,Ce.encodings,null===z),ue.setParameters(Ce).then(function(){return"OK"}).catch(function(Ae){return ie._log.error("Failed to apply publisher hints:",Ae),"COULD_NOT_APPLY_HINT"})},ce.prototype.addMediaTrackSender=function(G){var z=this;if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(G)){var oe=this._addOrUpdateTransceiver(G.track).sender;G.addSender(oe,function(ue){return z._setPublisherHint(G,ue)}),this._rtpNewSenders.add(oe),this._rtpSenders.set(G,oe)}},ce.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},ce.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},ce.prototype.getState=function(){if(!this._localDescription)return null;var z={type:this._localDescription.type,revision:"answer"===this._localDescription.type?this._lastStableDescriptionRevision:this._descriptionRevision};return this._localDescription.sdp&&(z.sdp=this._localDescription.sdp),{description:z,id:this.id}},ce.prototype.offer=function(){var G=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(z){return G.transition("updating",z),(G._needsAnswer||G._isRestartingIce?Promise.resolve():G._offer()).then(function(){G.tryTransition("open",z)},function(oe){throw G.tryTransition("open",z),oe})})},ce.prototype.removeDataTrackSender=function(G){var z=this._dataChannels.get(G);z&&(G.removeDataChannel(z),this._dataChannels.delete(G),z.close())},ce.prototype.removeMediaTrackSender=function(G){var z=this._rtpSenders.get(G);z&&("closed"!==this._peerConnection.signalingState&&this._peerConnection.removeTrack(z),G.removeSender(z),this._mediaTrackSenderToPublisherHints.has(G)&&(this._mediaTrackSenderToPublisherHints.get(G).deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(G)),this._rtpNewSenders.delete(z),this._rtpSenders.delete(G))},ce.prototype.setConfiguration=function(G){"function"==typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(W(G))},ce.prototype.setIceReconnectTimeout=function(G){return this._iceReconnectTimeout.setDelay(G),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},ce.prototype.update=function(G){var z=this;return this.bracket("updating",function(ie){if("closed"===z.state)return Promise.resolve();z.transition("updating",ie);var oe=[];return G.ice&&oe.push(z._updateIce(G.ice)),G.description&&oe.push(z._updateDescription(G.description)),Promise.all(oe).then(function(){z.tryTransition("open",ie)},function(ue){throw z.tryTransition("open",ie),ue})})},ce.prototype.getStats=function(){var G=this;return n(this._peerConnection).then(function(z){return function(de,ce){return Object.assign(ce,{remoteAudioTrackStats:ce.remoteAudioTrackStats.map(function(G){return $(de,G)}),remoteVideoTrackStats:ce.remoteVideoTrackStats.map(function(G){return $(de,G)}),localAudioTrackStats:ce.localAudioTrackStats.map(function(G){return ae(de,G)}),localVideoTrackStats:ce.localVideoTrackStats.map(function(G){return ae(de,G)})})}(G,z)})},ce}(q);function ae(de,ce){var G=de._getMediaTrackSenderId(ce.trackId);return Object.assign(ce,{trackId:G})}function $(de,ce){var G=o([],p(de._mediaTrackReceivers)).find(function(ie){return ie.track.id===ce.trackId});return Object.assign(ce,{trackId:G?G.id:null})}function ne(de){if(de.sdp){var ce=de.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(ce)return ce[1]}return null}function W(de){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},de)}function j(de,ce){var G=ce.track;return G&&G.kind===de&&"ended"!==G.readyState}function _e(de){(function(de){de._recycledTransceivers.audio=[],de._recycledTransceivers.video=[],de._peerConnection.getTransceivers().forEach(function(ce){(function(de,ce){return!de.stopped&&!ce._replaceTrackPromises.has(de)&&["inactive","recvonly"].includes(de.direction)})(ce,de)&&de._recycledTransceivers[ce.receiver.track.kind].push(ce)})})(de),function(de){var ce=de._peerConnection.localDescription;!ce||!ce.sdp||T(ce.sdp).forEach(function(G){O(G).forEach(function(ie,oe){return de._localCodecs.add(oe)})})}(de),function(de){var ce=de._peerConnection.remoteDescription;!ce||!ce.sdp||T(ce.sdp).forEach(function(G){var z=G.match(/^a=mid:(.+)$/m);if(z&&z[1]){var ie=z[1],oe=O(G);de._remoteCodecMaps.set(ie,oe)}})}(de),Te(de).then(function(){de._handleQueuedPublisherHints()})}function Te(de){var ce=de._encodingParameters,ie=new Map([["audio",ce.maxAudioBitrate],["video",ce.maxVideoBitrate]]),oe=[];return de._peerConnection.getSenders().filter(function(ue){return ue.track}).forEach(function(ue){var we=ie.get(ue.track.kind),Ce=ue.getParameters();null===we||0===we?function(de){Array.isArray(de.encodings)&&de.encodings.forEach(function(ce){return delete ce.maxBitrate})}(Ce):de._isChromeScreenShareTrack(ue.track)?de._log.warn("Not setting maxBitrate for "+ue.track.kind+" Track "+ue.track.id+" because it appears to be screen share track: "+ue.track.label):function(de,ce){ye?de.encodings=[{maxBitrate:ce}]:de.encodings.forEach(function(G){G.maxBitrate=ce})}(Ce,we),!ye&&de._enableDscp&&Ce.encodings.length>0&&(Ce.encodings[0].networkPriority="high");var Ae=de._rtpNewSenders.has(ue);de._maybeUpdateEncodings(ue.track,Ce.encodings,Ae),de._rtpNewSenders.delete(ue);var xe=ue.setParameters(Ce).catch(function(Oe){de._log.warn("Error while setting encodings parameters for "+ue.track.kind+" Track "+ue.track.id+": "+(Oe.message||Oe.name))});oe.push(xe)}),Promise.all(oe)}k.exports=Ee},5971:function(k,S,a){"use strict";var T,d=this&&this.__extends||(T=function(g,_){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,I){L.__proto__=I}||function(L,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(L[M]=I[M])})(g,_)},function(g,_){if("function"!=typeof _&&null!==_)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function L(){this.constructor=g}T(g,_),g.prototype=null===_?Object.create(_):(L.prototype=_.prototype,new L)}),p=this&&this.__read||function(T,g){var _="function"==typeof Symbol&&T[Symbol.iterator];if(!_)return T;var I,A,L=_.call(T),M=[];try{for(;(void 0===g||g-- >0)&&!(I=L.next()).done;)M.push(I.value)}catch(H){A={error:H}}finally{try{I&&!I.done&&(_=L.return)&&_.call(L)}finally{if(A)throw A.error}}return M},o=this&&this.__spreadArray||function(T,g){for(var _=0,L=g.length,I=T.length;_<L;_++,I++)T[I]=g[_];return T},s=a(4911).guessBrowser,i=a(4556),t=a(5550),e=a(5468),r=a(3761),n=a(7061).MediaConnectionError,l="firefox"===s(),v=function(T){function g(_,L,I){var M=T.call(this)||this,A=(I=Object.assign({audioContextFactory:l?a(9057):null,PeerConnectionV2:i},I)).audioContextFactory?I.audioContextFactory.getOrCreate(M):null,H=A?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(M,{_audioContextFactory:{value:I.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:r.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:A?new t(y(A)):null},_encodingParameters:{value:_},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:H},_peerConnections:{value:new Map},_preferredCodecs:{value:L},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:I.PeerConnectionV2}}),M}return d(g,T),g.prototype.setEffectiveAdaptiveSimulcast=function(_){this._peerConnections.forEach(function(L){return L.setEffectiveAdaptiveSimulcast(_)}),this._preferredCodecs.video.forEach(function(L){"adaptiveSimulcast"in L&&(L.adaptiveSimulcast=_)})},Object.defineProperty(g.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),g.prototype._closeAbsentPeerConnections=function(_){var L=new Set(_.map(function(I){return I.id}));return this._peerConnections.forEach(function(I){L.has(I.id)||I._close()}),this},g.prototype._getConfiguration=function(){return this._configurationDeferred.promise},g.prototype._getOrCreate=function(_,L){var I=this,M=this,A=this._peerConnections.get(_);if(!A){var H=this._PeerConnectionV2,U=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},L);try{A=new H(_,this._encodingParameters,this._preferredCodecs,U)}catch(F){throw new n}this._peerConnections.set(A.id,A),A.on("candidates",this.queue.bind(this,"candidates")),A.on("description",this.queue.bind(this,"description")),A.on("trackAdded",this.queue.bind(this,"trackAdded")),A.on("stateChanged",function F(Z){"closed"===Z&&(A.removeListener("stateChanged",F),M._dataTrackSenders.forEach(function(ee){return A.removeDataTrackSender(ee)}),M._mediaTrackSenders.forEach(function(ee){return A.removeMediaTrackSender(ee)}),M._peerConnections.delete(A.id),M._closedPeerConnectionIds.add(A.id),C(M),R(M))}),A.on("connectionStateChanged",function(){return C(I)}),A.on("iceConnectionStateChanged",function(){return R(I)}),this._dataTrackSenders.forEach(A.addDataTrackSender,A),this._mediaTrackSenders.forEach(A.addMediaTrackSender,A),R(this)}return A},g.prototype.close=function(){return this._peerConnections.forEach(function(_){_.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),R(this),this},g.prototype.createAndOffer=function(){var _=this;return this._getConfiguration().then(function(L){var I;do{I=r.makeUUID()}while(_._peerConnections.has(I));return _._getOrCreate(I,L)}).then(function(L){return L.offer()}).then(function(){return _})},g.prototype.getTrackReceivers=function(){return r.flatMap(this._peerConnections,function(_){return _.getTrackReceivers()})},g.prototype.getStates=function(){var _=[];return this._peerConnections.forEach(function(L){var I=L.getState();I&&_.push(I)}),_},g.prototype.setConfiguration=function(_){return this._configuration&&(this._configurationDeferred=r.defer(),this._peerConnections.forEach(function(L){L.setConfiguration(_)})),this._configuration=_,this._configurationDeferred.resolve(_),this},g.prototype.setIceReconnectTimeout=function(_){return null===this._sessionTimeout&&(this._peerConnections.forEach(function(L){L.setIceReconnectTimeout(_)}),this._sessionTimeout=_),this},g.prototype.setTrackSenders=function(_){var L=new Set(_.filter(function(A){return"data"===A.kind})),I=new Set(_.filter(function(A){return A&&("audio"===A.kind||"video"===A.kind)})),M=function(T,g,_){return{data:f(T,g),media:c(T,_)}}(this,L,I);return this._dataTrackSenders=L,this._mediaTrackSenders=I,function(T,g){(g.data.add.size||g.data.remove.size||g.media.add.size||g.media.remove.size)&&T._peerConnections.forEach(function(_){g.data.remove.forEach(_.removeDataTrackSender,_),g.media.remove.forEach(_.removeMediaTrackSender,_),g.data.add.forEach(_.addDataTrackSender,_),g.media.add.forEach(_.addMediaTrackSender,_),(g.media.add.size||g.media.remove.size||g.data.add.size&&!_.isApplicationSectionNegotiated)&&_.offer()})}(this,M),this},g.prototype.update=function(_,L){var I=this;return void 0===L&&(L=!1),L&&this._closeAbsentPeerConnections(_),this._getConfiguration().then(function(M){return Promise.all(_.map(function(A){return I._closedPeerConnectionIds.has(A.id)?null:I._getOrCreate(A.id,M).update(A)}))}).then(function(){return I})},g.prototype.getStats=function(){var _=Array.from(this._peerConnections.values());return Promise.all(_.map(function(L){return L.getStats().then(function(I){return[L.id,I]})})).then(function(L){return new Map(L)})},g}(e);function y(T){return T.createMediaStreamDestination().stream.getAudioTracks()[0]}function f(T,g){return{add:r.difference(g,T._dataTrackSenders),remove:r.difference(T._dataTrackSenders,g)}}function c(T,g){return{add:r.difference(g,T._mediaTrackSenders),remove:r.difference(T._mediaTrackSenders,g)}}var P,h={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3};function w(T){return T.length?(P=P||Object.keys(h).reduce(function(T,g){var _;return Object.assign(T,((_={})[h[g]]=g,_))},{}),T.reduce(function(g,_){return P[Math.max(h[g],h[_])]})):"new"}function R(T){T._lastIceConnectionState=T.iceConnectionState,T._iceConnectionState=w(o([],p(T._peerConnections.values())).map(function(g){return g.iceConnectionState})),T.iceConnectionState!==T._lastIceConnectionState&&T.emit("iceConnectionStateChanged")}function C(T){T._lastConnectionState=T.connectionState,T._connectionState=w(o([],p(T._peerConnections.values())).map(function(g){return g.connectionState})),T.connectionState!==T._lastConnectionState&&T.emit("connectionStateChanged")}k.exports=v},4574:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(762),o=1,s=function(i){function t(e,r){var n=i.call(this,e,"publisher_hints",r)||this;return n.on("ready",function(l){n._log.debug("publisher_hints transport ready:",l),l.on("message",function(v){switch(n._log.debug("Incoming: ",v),v.type){case"publisher_hints":v.publisher&&v.publisher.hints&&v.publisher.id&&n._processPublisherHints(v.publisher.hints,v.publisher.id);break;default:n._log.warn("Unknown message type: ",v.type)}})}),n}return d(t,i),t.prototype.sendTrackReplaced=function(e){if(this._transport){var n={type:"client_reset",track:e.trackSid,id:o++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},t.prototype.sendHintResponse=function(e){if(this._transport){var l={type:"publisher_hints",id:e.id,hints:e.hints};this._log.debug("Outgoing: ",l),this._transport.publish(l)}},t.prototype._processPublisherHints=function(e,r){try{this.emit("updated",e,r)}catch(n){this._log.error("error processing hints:",n)}},t}(p);k.exports=s},5117:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(){var t=s.call(this)||this;return Object.defineProperties(t,{_revision:{value:1,writable:!0}}),t}return d(i,s),i.prototype.update=function(t){return t.revision<this._revision?this:(this._revision=t.revision,this.enable(t.is_recording))},i}(a(8659));k.exports=o},5097:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(8760),o=a(3038),s=function(i){function t(e,r,n,l,v,y){var m=i.call(this,e.sid,e.identity)||this;return y=Object.assign({RemoteTrackPublicationV2:o},y),Object.defineProperties(m,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:y.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:r},updateSubscriberTrackPriority:{value:function(f,u){return n(f,u)}},updateTrackRenderHint:{value:function(f,u){return l(f,u)}},clearTrackHint:{value:function(f){return v(f)}},revision:{enumerable:!0,get:function(){return this._revision}}}),m.update(e)}return d(t,i),t.prototype._getOrCreateTrack=function(e){var r=this._RemoteTrackPublicationV2,n=this.tracks.get(e.sid);return n||(n=new r(e,this._getInitialTrackSwitchOffState(e.sid)),this.addTrack(n)),n},t.prototype.update=function(e){var r=this;if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var n=new Set;switch(e.tracks.forEach(function(l){var v=r._getOrCreateTrack(l);v.update(l),n.add(v)}),this.tracks.forEach(function(l){n.has(l)||r.removeTrack(l)}),e.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity)}return this},t}(p);k.exports=s},3038:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){return s.call(this,t.sid,t.name,t.kind,t.enabled,t.priority,e)||this}return d(i,s),i.prototype.update=function(t){return this.enable(t.enabled),this.setPriority(t.priority),this},i}(a(2261));k.exports=o},9752:function(k,S,a){"use strict";var r,d=this&&this.__extends||(r=function(n,l){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(n,l)},function(n,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function v(){this.constructor=n}r(n,l),n.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}),p=a(762),o=a(1190),s=a(3761).isDeepEqual,t=1,e=function(r){function n(l,v){var y=r.call(this,l,"render_hints",v)||this;return Object.defineProperties(y,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new o(function(){y._sendAllHints(),y._responseTimer.setDelay(2*y._responseTimer.delay)},2e3,!1)}}),y.on("ready",function(m){m.on("message",function(f){switch(y._log.debug("Incoming: ",f),f.type){case"render_hints":y._processHintResults(f&&f.subscriber&&f.subscriber.hints||[]);break;default:y._log.warn("Unknown message type: ",f.type)}}),y._sendAllHints()}),y}return d(n,r),n.prototype._sendAllHints=function(){var l=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(v){var y=l._trackSidsToRenderHints.get(v);y.renderDimensions&&(y.isDimensionDirty=!0),"enabled"in y&&(y.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(l){var v=this;this._responseTimer.clear(),this._responseTimer.setDelay(2e3),l.forEach(function(y){"OK"!==y.result&&v._log.debug("Server error processing hint:",y)}),this._sendHints()},n.prototype._sendHints=function(){var l=this;if(this._transport&&!this._responseTimer.isSet){var v=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(m){var f=l._trackSidsToRenderHints.get(m);if(f.isEnabledDirty||f.isDimensionDirty){var u={track:m};f.isEnabledDirty&&(u.enabled=f.enabled,f.isEnabledDirty=!1),f.isDimensionDirty&&(u.render_dimensions=f.renderDimensions,f.isDimensionDirty=!1),v.push(u)}}),v.length>0){var y={type:"render_hints",subscriber:{id:t++,hints:v}};this._log.debug("Outgoing: ",y),this._transport.publish(y),this._responseTimer.start()}}},n.prototype.setTrackHint=function(l,v){var y=this._trackSidsToRenderHints.get(l)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in v&&y.enabled!==v.enabled&&(y.enabled=!!v.enabled,y.isEnabledDirty=!0),v.renderDimensions&&!s(v.renderDimensions,y.renderDimensions)&&(y.renderDimensions=v.renderDimensions,y.isDimensionDirty=!0),this._trackSidsToRenderHints.set(l,y),this._sendHints()},n.prototype.clearTrackHint=function(l){this._trackSidsToRenderHints.delete(l)},n}(p);k.exports=e},3899:function(k,S,a){"use strict";var D,d=this&&this.__extends||(D=function(E,b){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,Q){B.__proto__=Q}||function(B,Q){for(var q in Q)Object.prototype.hasOwnProperty.call(Q,q)&&(B[q]=Q[q])})(E,b)},function(E,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function B(){this.constructor=E}D(E,b),E.prototype=null===b?Object.create(b):(B.prototype=b.prototype,new B)}),p=this&&this.__read||function(D,E){var b="function"==typeof Symbol&&D[Symbol.iterator];if(!b)return D;var Q,K,B=b.call(D),q=[];try{for(;(void 0===E||E-- >0)&&!(Q=B.next()).done;)q.push(Q.value)}catch(X){K={error:X}}finally{try{Q&&!Q.done&&(b=B.return)&&b.call(B)}finally{if(K)throw K.error}}return q},o=a(2222),s=a(8804),i=a(1159),t=a(5117),e=a(6996),r=a(5097),n=a(6614),l=a(7960),v=a(5084),y=a(9752),m=a(4574),f=a(3761),u=f.constants.DEFAULT_SESSION_TIMEOUT_SEC,c=f.createBandwidthProfilePayload,h=f.defer,P=f.difference,O=f.filterObject,w=f.flatMap,R=f.oncePerTick,C=a(2100),T=a(7061).createTwilioError,_=function(D){function E(b,B,Q,q,K){var X=this;B.options=Object.assign({session_timeout:u},B.options),K=Object.assign({DominantSpeakerSignaling:o,NetworkQualityMonitor:s,NetworkQualitySignaling:i,RecordingSignaling:t,RemoteParticipantV2:r,TrackPrioritySignaling:l,TrackSwitchOffSignaling:v,bandwidthProfile:null,sessionTimeout:1e3*B.options.session_timeout,statsPublishIntervalMs:1e4},K),b.setBandwidthProfile(K.bandwidthProfile),q.setIceReconnectTimeout(K.sessionTimeout);var se=function(he){return X._getTrackReceiver(he)},le=(X=D.call(this,b,B.sid,B.name,K)||this)._log;return Object.defineProperties(X,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:K.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:b.bandwidthProfileRevision,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:b.networkQualityConfiguration},_peerConnectionManager:{value:q},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:K.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new K.DominantSpeakerSignaling(se,{log:le})},_networkQualitySignaling:{value:new K.NetworkQualitySignaling(se,b.networkQualityConfiguration,{log:le})},_renderHintsSignaling:{value:new y(se,{log:le})},_publisherHintsSignaling:{value:new m(se,{log:le})},_trackPrioritySignaling:{value:new K.TrackPrioritySignaling(se,{log:le})},_trackSwitchOffSignaling:{value:new K.TrackSwitchOffSignaling(se,{log:le})},_pendingSwitchOffStates:{value:new Map},_transport:{value:Q},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:B.options.media_region||null}}),X._initTrackSwitchOffSignaling(),X._initDominantSpeakerSignaling(),X._initNetworkQualityMonitorSignaling(),X._initPublisherHintSignaling(),function(D,E){var b=R(function(){D._publishNewLocalParticipantState()}),B=R(function(){var Q=w(E.tracks,function(q){return q.trackTransceiver});D._peerConnectionManager.setTrackSenders(Q)});E.on("trackAdded",B),E.on("trackRemoved",B),E.on("updated",b),D.on("stateChanged",function Q(q){"disconnected"===q&&(E.removeListener("trackAdded",B),E.removeListener("trackRemoved",B),E.removeListener("updated",b),D.removeListener("stateChanged",Q),E.disconnect())}),D.on("signalingConnectionStateChanged",function(){var Q=D.localParticipant,K=Q.identity,X=Q.sid;switch(D.signalingConnectionState){case"connected":Q.connect(X,K);break;case"reconnecting":Q.reconnecting()}})}(X,b),function(D,E){E.on("description",function(B){D._publishPeerConnectionState(B)}),E.dequeue("description"),E.on("candidates",function(B){D._publishPeerConnectionState(B)}),E.dequeue("candidates"),E.on("trackAdded",D._addTrackReceiver.bind(D)),E.dequeue("trackAdded"),E.getTrackReceivers().forEach(D._addTrackReceiver,D),E.on("connectionStateChanged",function(){D.emit("connectionStateChanged")}),E.on("iceConnectionStateChanged",function(){D.emit("iceConnectionStateChanged"),"failed"===D.iceConnectionState&&(null!==D.localParticipant.networkQualityLevel&&D.localParticipant.setNetworkQualityLevel(0),D.participants.forEach(function(b){null!==b.networkQualityLevel&&b.setNetworkQualityLevel(0)}))})}(X,q),function(D,E){E.on("message",D._update.bind(D)),E.on("stateChanged",function b(B,Q){"disconnected"===B&&("disconnected"!==D.state&&D._disconnect(Q),E.removeListener("stateChanged",b)),D.emit("signalingConnectionStateChanged")})}(X,Q),function(D,E,b){var B=new Map,Q=!1,q=setInterval(function(){D.getStats().then(function(K){Q=!Q,K.forEach(function(X,se){var le=new n(se,X,!0);E.publishEvent("quality","stats-report","info",{audioTrackStats:le.remoteAudioTrackStats.map(function(ye,ve){return J(ye,X.remoteAudioTrackStats[ve],B)}),localAudioTrackStats:le.localAudioTrackStats.map(function(ye,ve){return ee(ye,X.localAudioTrackStats[ve],B)}),localVideoTrackStats:le.localVideoTrackStats.map(function(ye,ve){return ee(ye,X.localVideoTrackStats[ve],B)}),peerConnectionId:le.peerConnectionId,videoTrackStats:le.remoteVideoTrackStats.map(function(ye,ve){return J(ye,X.remoteVideoTrackStats[ve],B)})});var he=w(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(ye){return le[ye].map(function(ve){return ve.trackSid+"+"+ve.ssrc})});if(P(Array.from(B.keys()),he).forEach(function(ye){return B.delete(ye)}),Q){var pe=function(D,E){return(D=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:E,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},O(D||{},null))).localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},O(D.localCandidate||{},null)),D.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},O(D.remoteCandidate||{},null)),D}(X.activeIceCandidatePair,le.peerConnectionId);E.publishEvent("quality","active-ice-candidate-pair","info",pe)}})},function(){})},b);D.on("stateChanged",function K(X){"disconnected"===X&&(clearInterval(q),D.removeListener("stateChanged",K))})}(X,Q,K.statsPublishIntervalMs),X._update(B),X._peerConnectionManager.setEffectiveAdaptiveSimulcast(X._publisherHintsSignaling.isSetup),X}return d(E,D),Object.defineProperty(E.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"signalingConnectionState",{get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),E.prototype._deleteTrackReceiverDeferred=function(b){return this._trackReceiverDeferreds.delete(b)},E.prototype._getOrCreateTrackReceiverDeferred=function(b){var B=this._trackReceiverDeferreds.get(b)||h(),q=this._peerConnectionManager.getTrackReceivers().find(function(K){return K.id===b&&"ended"!==K.readyState});return q?B.resolve(q):this._trackReceiverDeferreds.set(b,B),B},E.prototype._addTrackReceiver=function(b){return this._getOrCreateTrackReceiverDeferred(b.id).resolve(b),this},E.prototype._disconnect=function(b){var B=D.prototype._disconnect.call(this,b);return B&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(Q){Q.publishFailed(b||new Error("LocalParticipant disconnected"))}),B},E.prototype._getTrackReceiver=function(b){var B=this;return this._getOrCreateTrackReceiverDeferred(b).promise.then(function(Q){return B._deleteTrackReceiverDeferred(b),Q})},E.prototype._getInitialTrackSwitchOffState=function(b){var B=this._pendingSwitchOffStates.get(b)||!1;return this._pendingSwitchOffStates.delete(b),B&&this._log.warn("["+b+"] was initially switched off! "),B},E.prototype._getTrackSidsToTrackSignalings=function(){var b=w(this.participants,function(B){return Array.from(B.tracks)});return new Map(b)},E.prototype._getOrCreateRemoteParticipant=function(b){var B=this,Q=this._RemoteParticipantV2,q=this.participants.get(b.sid),K=this;return q||((q=new Q(b,function(X){return B._getInitialTrackSwitchOffState(X)},function(X,se){return B._trackPrioritySignaling.sendTrackPriorityUpdate(X,"subscribe",se)},function(X,se){return B._renderHintsSignaling.setTrackHint(X,se)},function(X){return B._renderHintsSignaling.clearTrackHint(X)})).on("stateChanged",function X(se){"disconnected"===se&&(q.removeListener("stateChanged",X),K.participants.delete(q.sid),K._disconnectedParticipantRevisions.set(q.sid,q.revision))}),this.connectParticipant(q)),q},E.prototype._getState=function(){return{participant:this.localParticipant.getState()}},E.prototype._maybeAddBandwidthProfile=function(b){var B=this.localParticipant,Q=B.bandwidthProfile,q=B.bandwidthProfileRevision;return Q&&this._lastBandwidthProfileRevision<q?(this._lastBandwidthProfileRevision=q,Object.assign({bandwidth_profile:c(Q)},b)):b},E.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},E.prototype._publishPeerConnectionState=function(b){this._transport.publish(Object.assign({peer_connections:[b]},this._getState()))},E.prototype._update=function(b){var B=this;if(b.subscribed&&b.subscribed.revision>this._subscribedRevision){this._subscribedRevision=b.subscribed.revision,b.subscribed.tracks.forEach(function(K){K.id?(B._subscriptionFailures.delete(K.sid),B._subscribed.set(K.sid,K.id)):K.error&&!B._subscriptionFailures.has(K.sid)&&B._subscriptionFailures.set(K.sid,K.error)});var Q=new Set(b.subscribed.tracks.filter(function(K){return!!K.id}).map(function(K){return K.sid}));this._subscribed.forEach(function(K,X){Q.has(X)||B._subscribed.delete(X)})}var q=new Set;return(b.participants||[]).forEach(function(K){if(K.sid!==B.localParticipant.sid){var X=B._disconnectedParticipantRevisions.get(K.sid);if(!(X&&K.revision<=X)){X&&B._disconnectedParticipantRevisions.delete(K.sid);var se=B._getOrCreateRemoteParticipant(K);se.update(K),q.add(se)}}}),"synced"===b.type&&this.participants.forEach(function(K){q.has(K)||K.disconnect()}),function(D){var E=D._getTrackSidsToTrackSignalings();D._subscriptionFailures.forEach(function(b,B){var Q=E.get(B);Q&&(D._subscriptionFailures.delete(B),Q.subscribeFailed(T(b.code,b.message)))}),E.forEach(function(b){var B=D._subscribed.get(b.sid);(!B||b.isSubscribed&&b.trackTransceiver.id!==B)&&b.setTrackTransceiver(null),B&&D._getTrackReceiver(B).then(function(Q){return b.setTrackTransceiver(Q)})})}(this),b.peer_connections&&this._peerConnectionManager.update(b.peer_connections,"synced"===b.type),b.recording&&this.recording.update(b.recording),b.published&&b.published.revision>this._publishedRevision&&(this._publishedRevision=b.published.revision,b.published.tracks.forEach(function(K){K.sid&&B._published.set(K.id,K.sid)}),this.localParticipant.update(b.published)),b.participant&&this.localParticipant.connect(b.participant.sid,b.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function(K){var X=K.channel;!K.isSetup&&b.media_signaling&&b.media_signaling[X]&&b.media_signaling[X].transport&&"data-channel"===b.media_signaling[X].transport.type&&K.setup(b.media_signaling[X].transport.label)}),this},E.prototype._initPublisherHintSignaling=function(){var b=this;this._publisherHintsSignaling.on("updated",function(Q,q){Promise.all(Q.map(function(K){return b.localParticipant.setPublisherHint(K.track,K.encodings).then(function(X){return{track:K.track,result:X}})})).then(function(K){b._publisherHintsSignaling.sendHintResponse({id:q,hints:K})})});var B=function(Q){"video"===Q.kind&&Q.trackTransceiver.on("replaced",function(){b._publisherHintsSignaling.sendTrackReplaced({trackSid:Q.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(Q){return B(Q)}),this.localParticipant.on("trackAdded",function(Q){return B(Q)})},E.prototype._initTrackSwitchOffSignaling=function(){var b=this;this._trackSwitchOffSignaling.on("updated",function(B,Q){try{b._log.debug("received trackSwitch: ",{tracksOn:Q,tracksOff:B});var q=new Map;Q.forEach(function(K){return q.set(K,!0)}),B.forEach(function(K){q.get(K)&&b._log.warn(K+" is DUPLICATED in both tracksOff and tracksOn list"),q.set(K,!1)}),b.participants.forEach(function(K){K.tracks.forEach(function(X){var se=q.get(X.sid);void 0!==se&&(X.setSwitchedOff(!se),q.delete(X.sid))})}),q.forEach(function(K,X){return b._pendingSwitchOffStates.set(X,!K)})}catch(K){b._log.error("error processing track switch off:",K)}})},E.prototype._initDominantSpeakerSignaling=function(){var b=this;this._dominantSpeakerSignaling.on("updated",function(){return b.setDominantSpeaker(b._dominantSpeakerSignaling.loudestParticipantSid)})},E.prototype._initNetworkQualityMonitorSignaling=function(){var b=this;this._networkQualitySignaling.on("ready",function(){var B=new b._NetworkQualityMonitor(b._peerConnectionManager,b._networkQualitySignaling);b._networkQualityMonitor=B,B.on("updated",function(){"failed"!==b.iceConnectionState&&(b.localParticipant.setNetworkQualityLevel(B.level,B.levels),b.participants.forEach(function(Q){var q=B.remoteLevels.get(Q.sid);q&&Q.setNetworkQualityLevel(q.level,q)}))}),B.start()}),this._networkQualitySignaling.on("teardown",function(){return b._teardownNetworkQualityMonitor()})},E.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},E.prototype.getStats=function(){var b=this;return this._peerConnectionManager.getStats().then(function(B){return new Map(Array.from(B).map(function(Q){var q=p(Q,2),X=q[1];return[q[0],Object.assign({},X,{localAudioTrackStats:I(b,X.localAudioTrackStats),localVideoTrackStats:I(b,X.localVideoTrackStats),remoteAudioTrackStats:M(b,X.remoteAudioTrackStats),remoteVideoTrackStats:M(b,X.remoteVideoTrackStats)})]}))})},E}(e);function L(D,E){return E.reduce(function(b,B){var Q=D.get(B.trackId);return Q?[Object.assign({},B,{trackSid:Q})].concat(b):b},[])}function I(D,E){return L(D._published,E)}function M(D,E){return L(new Map(Array.from(D._subscribed.entries()).map(function(B){var Q=p(B,2);return[Q[1],Q[0]]})),E)}function ee(D,E,b){var B=E.framesEncoded,Q=E.packetsSent,q=E.totalEncodeTime,K=E.totalPacketSendDelay,X=Object.assign({},D),se=D.trackSid+"+"+D.ssrc,le=b.get(se)||new Map;if("number"==typeof q&&"number"==typeof B){var he=le.get("avgEncodeDelay")||new C;he.putSample(1e3*q,B),X.avgEncodeDelay=Math.round(he.get()),le.set("avgEncodeDelay",he)}if("number"==typeof K&&"number"==typeof Q){var me=le.get("avgPacketSendDelay")||new C;me.putSample(1e3*K,Q),X.avgPacketSendDelay=Math.round(me.get()),le.set("avgPacketSendDelay",me)}return b.set(se,le),X}function J(D,E,b){var B=E.estimatedPlayoutTimestamp,Q=E.framesDecoded,q=E.jitterBufferDelay,K=E.jitterBufferEmittedCount,X=E.totalDecodeTime,se=Object.assign({},D),le=D.trackSid+"+"+D.ssrc,he=b.get(le)||new Map;if("number"==typeof B&&(se.estimatedPlayoutTimestamp=B),"number"==typeof Q&&"number"==typeof X){var me=he.get("avgDecodeDelay")||new C;me.putSample(1e3*X,Q),se.avgDecodeDelay=Math.round(me.get()),he.set("avgDecodeDelay",me)}if("number"==typeof q&&"number"==typeof K){var pe=he.get("avgJitterBufferDelay")||new C;pe.putSample(1e3*q,K),se.avgJitterBufferDelay=Math.round(pe.get()),he.set("avgJitterBufferDelay",pe)}return b.set(le,he),se}k.exports=_},7960:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"track_priority",e)||this;return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",function(n){Array.from(r._enqueuedPriorityUpdates.keys()).forEach(function(l){n.publish({type:"track_priority",track:l,subscribe:r._enqueuedPriorityUpdates.get(l)})})}),r}return d(i,s),i.prototype.sendTrackPriorityUpdate=function(t,e,r){if("subscribe"!==e)throw new Error("only subscribe priorities are supported, found: "+e);this._enqueuedPriorityUpdates.set(t,r),this._transport&&this._transport.publish({type:"track_priority",track:t,subscribe:r})},i}(a(762));k.exports=o},5084:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,"track_switch_off",e)||this;return r.on("ready",function(n){n.on("message",function(l){switch(l.type){case"track_switch_off":r._setTrackSwitchOffUpdates(l.off||[],l.on||[])}})}),r}return d(i,s),i.prototype._setTrackSwitchOffUpdates=function(t,e){this.emit("updated",t,e)},i}(a(762));k.exports=o},1328:function(k,S,a){"use strict";var A,d=this&&this.__extends||(A=function(H,U){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,Z){F.__proto__=Z}||function(F,Z){for(var ee in Z)Object.prototype.hasOwnProperty.call(Z,ee)&&(F[ee]=Z[ee])})(H,U)},function(H,U){if("function"!=typeof U&&null!==U)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function F(){this.constructor=H}A(H,U),H.prototype=null===U?Object.create(U):(F.prototype=U.prototype,new F)}),p=a(1856),o=a(9616),s=a(4035),i=a(9917).reconnectBackoffConfig,t=a(1190),e=a(9917),r=e.SDK_NAME,n=e.SDK_VERSION,l=e.SDP_FORMAT,v=a(3761),y=v.createBandwidthProfilePayload,m=v.createMediaSignalingPayload,f=v.createSubscribePayload,u=v.getUserAgent,c=v.isNonArrayObject,h=a(7061),P=h.createTwilioError,O=h.RoomCompletedError,w=h.SignalingConnectionError,R=h.SignalingServerBusyError,g={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},_=function(A){function H(U,F,Z,ee,J,V){var D;return V=Object.assign({Backoff:s,TwilioConnection:o,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:u()},V),D=A.call(this,"connecting",g)||this,Object.defineProperties(D,{_accessToken:{value:F},_automaticSubscription:{value:V.automaticSubscription},_bandwidthProfile:{value:V.bandwidthProfile},_dominantSpeaker:{value:V.dominantSpeaker},_adaptiveSimulcast:{value:V.adaptiveSimulcast},_eventObserver:{value:V.eventObserver,writable:!1},_renderHints:{value:V.renderHints},_iceServersStatus:{value:Array.isArray(V.iceServers)?"overrode":"acquire"},_localParticipant:{value:Z},_name:{value:U},_networkQuality:{value:c(V.networkQuality)||V.networkQuality},_options:{value:V},_peerConnectionManager:{value:ee},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:V.Backoff.exponential(i)},_session:{value:null,writable:!0},_trackPriority:{value:V.trackPriority},_trackSwitchOff:{value:V.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:V.userAgent},_wsServer:{value:J}}),function(A){function H(){if("disconnected"!==A.state){A._twilioConnection&&A._twilioConnection.removeListener("message",F);var E=A._options,Q=E.TwilioConnection,q=new Q(A._wsServer,Object.assign({helloBody:"connecting"===A.state&&"acquire"===A._iceServersStatus?A._createIceMessage():A._createConnectOrSyncOrDisconnectMessage()},E));q.once("close",function(K){K===Q.CloseReason.LOCAL?U():U(new Error(K))}),q.on("message",F),A._twilioConnection=q}}function U(D){if("disconnected"!==A.state){if(!D)return void A.disconnect();var E=A._getReconnectTimer();if(!E){var b=D.message===o.CloseReason.BUSY?new R:new w;return void A.disconnect(b)}"connected"===A.state&&A.preempt("syncing"),E.then(H)}}function F(D){if("disconnected"!==A.state){if("error"===D.type)return void A.disconnect(P(D.code,D.message));switch(A.state){case"connected":switch(D.type){case"connected":case"synced":case"update":return void A.emit("message",D);case"disconnected":return void A.disconnect("completed"===D.status?new O:null);default:return}case"connecting":switch(D.type){case"iced":return void A._options.onIced(D.ice_servers).then(function(){A._sendConnectOrSyncOrDisconnectMessage()});case"connected":return A._setSession(D.session,D.options.session_timeout),A.emit("connected",D),void A.preempt("connected");case"synced":case"update":return void A._updatesReceived.push(D);case"disconnected":return void A.disconnect("completed"===D.status?new O:null);default:return}case"syncing":switch(D.type){case"connected":case"update":return void A._updatesReceived.push(D);case"synced":return A._clearReconnectTimer(),A.emit("message",D),void A.preempt("connected");case"disconnected":return void A.disconnect("completed"===D.status?new O:null);default:return}default:return}}}A.on("stateChanged",function D(E){switch(E){case"connected":var b=A._updatesToSend.splice(0);return b.length&&A.publish(function(A){return A.reduce(function(H,U){return(!H.participant&&U.participant||H.participant&&U.participant&&U.participant.revision>H.participant.revision)&&(H.participant=U.participant),!H.peer_connections&&U.peer_connections?H.peer_connections=L(U.peer_connections):H.peer_connections&&U.peer_connections&&(H.peer_connections=L(H.peer_connections.concat(U.peer_connections))),H},{})}(b)),void A._updatesReceived.splice(0).forEach(function(B){return A.emit("message",B)});case"disconnected":return A._twilioConnection.removeListener("message",F),void A.removeListener("stateChanged",D);case"syncing":default:return}});var Z=A._options;"overrode"===A._iceServersStatus?(0,Z.onIced)(Z.iceServers).then(H):H()}(D),D}return d(H,A),H.prototype._createConnectOrSyncOrDisconnectMessage=function(){if("connected"===this.state)return null;if("disconnected"===this.state)return{session:this._session,type:"disconnect",version:2};var U={connecting:"connect",syncing:"sync"}[this.state],F={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:U,version:2};return"connect"===F.type?(F.ice_servers=this._iceServersStatus,F.publisher={name:r,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(F.bandwidth_profile=y(this._bandwidthProfile)),F.media_signaling=m(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),F.subscribe=f(this._automaticSubscription),F.format=l,F.token=this._accessToken):"sync"===F.type?(F.session=this._session,F.token=this._accessToken):"update"===F.type&&(F.session=this._session),F},H.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:1}},H.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var U=this._createConnectOrSyncOrDisconnectMessage();U&&this._twilioConnection.sendMessage(U)},H.prototype.disconnect=function(U){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[U]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0)},H.prototype.publish=function(U){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:2},U)),!0;case"connecting":case"syncing":return this._updatesToSend.push(U),!0;case"disconnected":default:return!1}},H.prototype.publishEvent=function(U,F,Z,ee){this._eventObserver.emit("event",{group:U,name:F,level:Z,payload:ee})},H.prototype.sync=function(){return"connected"===this.state&&(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0)},H.prototype._setSession=function(U,F){this._session=U,this._sessionTimeoutMS=1e3*F},H.prototype._getReconnectTimer=function(){var U=this;return 0===this._sessionTimeoutMS?null:(this._sessionTimer||(this._sessionTimer=new t(function(){U._sessionTimer&&(U._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(F){U._reconnectBackoff.once("ready",F),U._reconnectBackoff.backoff()}))},H.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},H}(p);function L(A){return Array.from(A.reduce(function(H,U){var F=H.get(U.id)||U;return(!F.description&&U.description||F.description&&U.description&&U.description.revision>F.description.revision)&&(F.description=U.description),(!F.ice&&U.ice||F.ice&&U.ice&&U.ice.revision>F.ice.revision)&&(F.ice=U.ice),H.set(F.id,F),H},new Map).values())}k.exports=_},1856:function(k,S,a){"use strict";var m,d=this&&this.__extends||(m=function(f,u){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var P in h)Object.prototype.hasOwnProperty.call(h,P)&&(c[P]=h[P])})(f,u)},function(f,u){if("function"!=typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function c(){this.constructor=f}m(f,u),f.prototype=null===u?Object.create(u):(c.prototype=u.prototype,new c)}),p=this&&this.__read||function(m,f){var u="function"==typeof Symbol&&m[Symbol.iterator];if(!u)return m;var h,O,c=u.call(m),P=[];try{for(;(void 0===f||f-- >0)&&!(h=c.next()).done;)P.push(h.value)}catch(w){O={error:w}}finally{try{h&&!h.done&&(u=c.return)&&u.call(c)}finally{if(O)throw O.error}}return P},o=this&&this.__spreadArray||function(m,f){for(var u=0,c=f.length,h=m.length;u<c;u++,h++)m[h]=f[u];return m},s=a(3105).EventEmitter,i=a(3761),t=function(m){function f(u,c){var h=m.call(this)||this,P=null,O=u;return c=function(m){var f=new Map;for(var u in m)f.set(u,new Set(m[u]));return f}(c),Object.defineProperties(h,{_lock:{get:function(){return P},set:function(w){P=w}},_reachableStates:{value:n(c)},_state:{get:function(){return O},set:function(w){O=w}},_states:{value:c},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==P}},state:{enumerable:!0,get:function(){return O}}}),h.on("stateChanged",function(w){h._whenDeferreds.forEach(function(R){R.when(w,R.resolve,R.reject)})}),h}return d(f,m),f.prototype._whenPromise=function(u){var c=this;if("function"!=typeof u)return Promise.reject(new Error("when() executor must be a function"));var h=i.defer();return h.when=u,this._whenDeferreds.add(h),h.promise.then(function(P){return c._whenDeferreds.delete(h),P},function(P){throw c._whenDeferreds.delete(h),P})},f.prototype.bracket=function(u,c){var h,P=this;function O(w){if(P.hasLock(h)&&P.releaseLockCompletely(h),w)throw w}return this.takeLock(u).then(function(R){return c(h=R)}).then(function(R){return O(),R},O)},f.prototype.hasLock=function(u){return this._lock===u},f.prototype.preempt=function(u,c,h){if(!e(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');var P;this.isLocked&&(P=this._lock,this._lock=null);var O=null;c&&(O=this.takeLockSync(c));var w=O?null:this.takeLockSync("preemption");return this.transition(u,O||w,h),P&&P.resolve(),w&&this.releaseLock(w),O},f.prototype.releaseLock=function(u){if(!this.isLocked)throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock");0===u.depth?(this._lock=null,u.resolve()):u.depth--},f.prototype.releaseLockCompletely=function(u){if(!this.isLocked)throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock");u.depth=0,this._lock=null,u.resolve()},f.prototype.takeLock=function(u){var c=this;if("object"==typeof u){var h=u;return new Promise(function(w){w(c.takeLockSync(h))})}var P=u;if(this.isLocked){var O=this.takeLock.bind(this,P);return this._lock.promise.then(O)}return Promise.resolve(this.takeLockSync(P))},f.prototype.takeLockSync=function(u){var c="string"==typeof u?null:u,h=c?c.name:u;if(c&&!this.hasLock(c)||!c&&this.isLocked)throw new Error("Could not take the lock for "+h+" because the lock for "+this._lock.name+" was not released");if(c)return c.depth++,c;var P=function(m){var f=i.defer();return f.name=m,f.depth=0,f}(h);return this._lock=P,P},f.prototype.transition=function(u,c,h){if(h=h||[],this.isLocked){if(!c)throw new Error("You must provide the key in order to transition");if(!this.hasLock(c))throw new Error("Could not transition using the key for "+c.name+" because "+this._lock.name+" has the lock")}else if(c)throw new Error("Key provided for "+c.name+", but the StateMachine was not locked (possibly due to preemption)");if(!e(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');this._state=u,this.emit.apply(this,o([],p(["stateChanged",u].concat(h))))},f.prototype.tryTransition=function(u,c,h){try{this.transition(u,c,h)}catch(P){return!1}return!0},f.prototype.when=function(u){var c=this;return this.state===u?Promise.resolve(this):e(this._reachableStates,this.state,u)?this._whenPromise(function(h,P,O){h===u?P(c):e(c._reachableStates,h,u)||O(y(h,u))}):Promise.reject(y(this.state,u))},f}(s);function e(m,f,u){return m.get(f).has(u)}function n(m){return Array.from(m.keys()).reduce(function(f,u){return f.set(u,l(m,u))},new Map)}function l(m,f,u){return u=u||new Set,m.get(f).forEach(function(c){u.has(c)||(u.add(c),l(m,c,u).forEach(u.add,u))}),u}function y(m,f){return new Error('"'+f+'" cannot be reached from "'+m+'"')}k.exports=t},7642:k=>{"use strict";k.exports=function(a){return(a=a.filter(function(d){return"number"==typeof d})).length<1?void 0:a.reduce(function(d,p){return p+d})/a.length}},1955:k=>{"use strict";var S=function(){function a(d,p,o,s){Object.defineProperties(this,{availableSend:{enumerable:!0,value:o},recv:{enumerable:!0,value:p},rtt:{enumerable:!0,value:s},send:{enumerable:!0,value:d}})}return a.of=function(d,p){var o=(p.timestamp-d.timestamp)/1e3;return new a(o>0?(p.bytesSent-d.bytesSent)/o*8:0,o>0?(p.bytesReceived-d.bytesReceived)/o*8:0,p.availableOutgoingBitrate,p.currentRoundTripTime)},a}();k.exports=S},3979:(k,S,a)=>{"use strict";var d=a(1955),p=function(){function o(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new d(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return o.prototype.next=function(s){var i=this.lastStats;if(this.lastStats=s,i){var t=i.id===s.id?d.of(i,s):new d(0,0);this.lastReport=t}return this.lastReport},o}();k.exports=p},1778:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e,r)||this;return Object.defineProperties(n,{audioLevel:{value:"number"==typeof e.audioInputLevel?e.audioInputLevel:null,enumerable:!0},jitter:{value:"number"==typeof e.jitter?e.jitter:null,enumerable:!0}}),n}return d(i,s),i}(a(1899));k.exports=o},1899:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e)||this;return Object.defineProperties(n,{bytesSent:{value:"number"==typeof e.bytesSent?e.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:"number"==typeof e.packetsSent?e.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:"number"==typeof e.roundTripTime?e.roundTripTime:r?0:null,enumerable:!0}}),n}return d(i,s),i}(a(2313));k.exports=o},8651:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e,r){var n=s.call(this,t,e,r)||this,l=null;"number"==typeof e.frameWidthInput&&"number"==typeof e.frameHeightInput&&(l={},Object.defineProperties(l,{width:{value:e.frameWidthInput,enumerable:!0},height:{value:e.frameHeightInput,enumerable:!0}}));var v=null;return"number"==typeof e.frameWidthSent&&"number"==typeof e.frameHeightSent&&(v={},Object.defineProperties(v,{width:{value:e.frameWidthSent,enumerable:!0},height:{value:e.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:l,enumerable:!0},dimensions:{value:v,enumerable:!0},captureFrameRate:{value:"number"==typeof e.frameRateInput?e.frameRateInput:null,enumerable:!0},frameRate:{value:"number"==typeof e.frameRateSent?e.frameRateSent:null,enumerable:!0}}),n}return d(i,s),i}(a(1899));k.exports=o},7111:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(6015));k.exports=o},5132:k=>{"use strict";k.exports=function(d){var p=d.actual,s=d.available,t=d.level;Object.defineProperties(this,{actual:{value:void 0===p?null:p,enumerable:!0},available:{value:void 0===s?null:s,enumerable:!0},level:{value:void 0===t?null:t,enumerable:!0}})}},8365:k=>{"use strict";k.exports=function(d){var p=d.fractionLost,s=d.level;Object.defineProperties(this,{fractionLost:{value:void 0===p?null:p,enumerable:!0},level:{value:void 0===s?null:s,enumerable:!0}})}},9392:k=>{"use strict";k.exports=function(d){var p=d.jitter,s=d.rtt,t=d.level;Object.defineProperties(this,{jitter:{value:void 0===p?null:p,enumerable:!0},rtt:{value:void 0===s?null:s,enumerable:!0},level:{value:void 0===t?null:t,enumerable:!0}})}},6015:(k,S,a)=>{"use strict";var d=a(8534),p=a(319);k.exports=function(i){var r=i.sendStats,n=void 0===r?null:r,l=i.recvStats,v=void 0===l?null:l;Object.defineProperties(this,{send:{value:i.send,enumerable:!0},recv:{value:i.recv,enumerable:!0},sendStats:{value:n?new d(n):null,enumerable:!0},recvStats:{value:v?new p(v):null,enumerable:!0}})}},319:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(4391));k.exports=o},4391:(k,S,a)=>{"use strict";var d=a(5132),p=a(8365),o=a(9392);k.exports=function(t){var e=t.bandwidth,r=void 0===e?null:e,n=t.fractionLost,l=void 0===n?null:n,v=t.latency,y=void 0===v?null:v;Object.defineProperties(this,{bandwidth:{value:r?new d(r):null,enumerable:!0},fractionLost:{value:l?new p(l):null,enumerable:!0},latency:{value:y?new o(y):null,enumerable:!0}})}},8534:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(4391));k.exports=o},5674:(k,S,a)=>{"use strict";var d=a(7111),p=a(4086);k.exports=function(i){var e=i.audio,r=i.video;Object.defineProperties(this,{level:{value:i.level,enumerable:!0},audio:{value:e?new d(e):null,enumerable:!0},video:{value:r?new p(r):null,enumerable:!0}})}},4086:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t){return s.call(this,t)||this}return d(i,s),i}(a(6015));k.exports=o},422:(k,S,a)=>{"use strict";var d=a(9369),p=a(4894),o=function(){function s(i,t,e){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:t},video:{enumerable:!0,value:e}})}return s.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),t=p.summarize(i),e=this.audio.recv.concat(this.video.recv),r=d.summarize(e);return{ice:this.ice,send:t,recv:r,audio:{send:p.summarize(this.audio.send),recv:d.summarize(this.audio.recv)},video:{send:p.summarize(this.video.send),recv:d.summarize(this.video.recv)}}},s}();k.exports=o},127:function(k,S,a){"use strict";var d=this&&this.__read||function(g,_){var L="function"==typeof Symbol&&g[Symbol.iterator];if(!L)return g;var M,H,I=L.call(g),A=[];try{for(;(void 0===_||_-- >0)&&!(M=I.next()).done;)A.push(M.value)}catch(U){H={error:U}}finally{try{M&&!M.done&&(L=I.return)&&L.call(I)}finally{if(H)throw H.error}}return A},p=this&&this.__spreadArray||function(g,_){for(var L=0,I=_.length,M=g.length;L<I;L++,M++)g[M]=_[L];return g},o=this&&this.__values||function(g){var _="function"==typeof Symbol&&Symbol.iterator,L=_&&g[_],I=0;if(L)return L.call(g);if(g&&"number"==typeof g.length)return{next:function(){return g&&I>=g.length&&(g=void 0),{value:g&&g[I++],done:!g}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},s=a(4911).guessBrowser,i=a(3979),t=a(422),e=a(3838),r=a(1208),n=function(){function g(_){Object.defineProperties(this,{pc:{enumerable:!0,value:_},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return g.prototype.next=function(){var _=this;return("firefox"===s()?function(g){var _=g.pc.getTransceivers().filter(function(I){return I.currentDirection&&I.currentDirection.match(/send/)&&I.sender.track}).map(function(I){return I.sender}),L=g.pc.getTransceivers().filter(function(I){return I.currentDirection&&I.currentDirection.match(/recv/)}).map(function(I){return I.receiver});return Promise.all([l(_),l(L),g.pc.getStats()]).then(function(I){var M=d(I,3),A=M[0],H=M[1],U=M[2],F=y(g),Z=c(g);A.forEach(function(V,D){return P(g,V,Z,D)}),w(F,Z);var ee=m(g),J=h(g);H.forEach(function(V,D){return O(g,V,J,D)}),w(ee,J),R(g.ice,U)})}(this):function(g){return g.pc.getStats().then(function(_){var L=y(g),I=c(g);P(g,_,I),w(L,I);var M=m(g),A=h(g);O(g,_,A),w(M,A),R(g.ice,_)})}(this)).then(function(){var I=p([],d(_.audio.send.values())),M=p([],d(_.video.send.values())),A=p([],d(_.audio.recv.values())),H=p([],d(_.video.recv.values())),U=new t(_.ice.lastReport,{send:I.map(function(F){return F.lastReport}).filter(function(F){return F}),recv:A.map(function(F){return F.lastReport}).filter(function(F){return F})},{send:M.map(function(F){return F.lastReport}).filter(function(F){return F}),recv:H.map(function(F){return F.lastReport}).filter(function(F){return F})});return _.lastReport=U,U})},g}();function l(g){return Promise.all(g.map(function(_){var L=_.track.id;return _.getStats().then(function(I){var M,A;try{for(var H=o(I.values()),U=H.next();!U.done;U=H.next()){var F=U.value;"inbound-rtp"===F.type&&(F.id=L+"-"+F.id)}}catch(Z){M={error:Z}}finally{try{U&&!U.done&&(A=H.return)&&A.call(H)}finally{if(M)throw M.error}}return[L,I]})})).then(function(_){return new Map(_)})}function v(g,_,L,I,M){var A=_[I.mediaType];if(!M){var H=L.get(I.trackId);H&&(M=H.trackIdentifier)}if(A&&M){if(A.has(I.id))return A.get(I.id);var U=new g(M,I);A.set(I.id,U)}return null}function y(g){return{audio:g.audio.send,video:g.video.send}}function m(g){return{audio:g.audio.recv,video:g.video.recv}}function f(g,_,L,I){return v(r,y(g),_,L,I)}function u(g,_,L,I){return v(e,m(g),_,L,I)}function c(g){return{audio:new Set(g.audio.send.keys()),video:new Set(g.video.send.keys())}}function h(g){return{audio:new Set(g.audio.recv.keys()),video:new Set(g.video.recv.keys())}}function P(g,_,L,I){var M,A;try{for(var H=o(_.values()),U=H.next();!U.done;U=H.next()){var F=U.value;if("outbound-rtp"===F.type&&!F.isRemote){if("firefox"!==s()&&!F.trackId)continue;var Z=L[F.mediaType];Z&&Z.delete(F.id);var ee=f(g,_,F,I);if(ee){var J=_.get(F.remoteId);ee.next(I||ee.trackId,F,J)}}}}catch(V){M={error:V}}finally{try{U&&!U.done&&(A=H.return)&&A.call(H)}finally{if(M)throw M.error}}}function O(g,_,L,I){var M,A;try{for(var H=o(_.values()),U=H.next();!U.done;U=H.next()){var F=U.value;if("inbound-rtp"===F.type&&!F.isRemote){var Z=L[F.mediaType];Z&&Z.delete(F.id);var ee=u(g,_,F,I);ee&&ee.next(I||ee.trackId,F)}}}catch(J){M={error:J}}finally{try{U&&!U.done&&(A=H.return)&&A.call(H)}finally{if(M)throw M.error}}}function w(g,_){var L=function(M){var A=g[M];_[M].forEach(function(U){return A.delete(U)})};for(var I in _)L(I)}function R(g,_){var L,I,M,A,H;try{for(var U=o(_.values()),F=U.next();!F.done;F=U.next())"transport"===(Z=F.value).type&&(H=_.get(Z.selectedCandidatePairId))}catch(V){L={error:V}}finally{try{F&&!F.done&&(I=U.return)&&I.call(U)}finally{if(L)throw L.error}}if(H)g.next(H);else try{for(var ee=o(_.values()),J=ee.next();!J.done;J=ee.next()){var Z;"candidate-pair"===(Z=J.value).type&&Z.nominated&&(!("selected"in Z)||Z.selected)&&g.next(Z)}}catch(V){M={error:V}}finally{try{J&&!J.done&&(A=ee.return)&&A.call(ee)}finally{if(M)throw M.error}}}k.exports=n},9369:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(7642),o=a(3443),s=a(2697),i=function(t){function e(r,n,l,v,y,m,f){var u=t.call(this,r,n,l)||this;return Object.defineProperties(u,{deltaPacketsLost:{enumerable:!0,value:v},deltaPacketsReceived:{enumerable:!0,value:y},fractionLost:{enumerable:!0,value:m},jitter:{enumerable:!0,value:f},phonyFractionLost:{enumerable:!0,value:y>0?v/y:0}}),u}return d(e,t),e.of=function(r,n,l){if(n.id!==l.id)throw new Error("RTCStats IDs must match");var v=(l.timestamp-n.timestamp)/1e3,m=v>0?(l.bytesReceived-n.bytesReceived)/v*8:0,f=Math.max(l.packetsLost-n.packetsLost,0);return new e(n.id,r,m,f,l.packetsReceived-n.packetsReceived,l.fractionLost,l.jitter)},e.summarize=function(r){var n=r.map(function(m){return m.summarize()});return{bitrate:s(n.map(function(m){return m.bitrate})),fractionLost:p(n.map(function(m){return m.fractionLost})),jitter:p(n.map(function(m){return m.jitter}))}},e.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:"number"==typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},e}(o);k.exports=i},3838:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(9369),s=function(i){function t(e,r){var n=i.call(this,r.id,e,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return d(t,i),t.prototype.next=function(e,r){var n=this.lastStats;this.lastStats=r,this.trackId=e;var l=p.of(e,n,r);return this.lastReport=l,l},t}(a(2835));k.exports=s},457:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this;return Object.defineProperties(r,{audioLevel:{value:"number"==typeof e.audioOutputLevel?e.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"==typeof e.jitter?e.jitter:null,enumerable:!0}}),r}return d(i,s),i}(a(3218));k.exports=o},3218:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this;return Object.defineProperties(r,{bytesReceived:{value:"number"==typeof e.bytesReceived?e.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"==typeof e.packetsReceived?e.packetsReceived:null,enumerable:!0}}),r}return d(i,s),i}(a(2313));k.exports=o},5021:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this,t,e)||this,n=null;return"number"==typeof e.frameWidthReceived&&"number"==typeof e.frameHeightReceived&&(n={},Object.defineProperties(n,{width:{value:e.frameWidthReceived,enumerable:!0},height:{value:e.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:n,enumerable:!0},frameRate:{value:"number"==typeof e.frameRateReceived?e.frameRateReceived:null,enumerable:!0}}),r}return d(i,s),i}(a(3218));k.exports=o},3443:k=>{"use strict";k.exports=function(d,p,o){Object.defineProperties(this,{id:{enumerable:!0,value:d},trackId:{enumerable:!0,value:p},bitrate:{enumerable:!0,value:o}})}},2835:k=>{"use strict";k.exports=function(d,p,o){Object.defineProperties(this,{id:{enumerable:!0,value:d,writable:!0},trackId:{enumerable:!0,value:p,writable:!0},lastStats:{enumerable:!0,value:o,writable:!0}})}},4894:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(7642),o=a(3443),s=a(2697),i=function(t){function e(r,n,l,v){var y=t.call(this,r,n,l)||this;return Object.defineProperties(y,{rtt:{enumerable:!0,value:v}}),y}return d(e,t),e.of=function(r,n,l,v){if(n.id!==l.id)throw new Error("RTCStats IDs must match");var y=(l.timestamp-n.timestamp)/1e3;return new e(n.id,r,y>0?(l.bytesSent-n.bytesSent)/y*8:0,v&&"number"==typeof v.roundTripTime?v.roundTripTime/1e3:void 0)},e.summarize=function(r){return{bitrate:s(r.map(function(v){return v.bitrate})),rtt:p(r.map(function(v){return v.rtt}))}},e}(o);k.exports=i},1208:function(k,S,a){"use strict";var i,d=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=n[l])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),p=a(2835),o=a(4894),s=function(i){function t(e,r){var n=i.call(this,r.id,e,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return d(t,i),t.prototype.next=function(e,r,n){var l=this.lastStats;this.lastStats=r,this.trackId=e;var v=o.of(e,l,r,n);return this.lastReport=v,v},t}(p);k.exports=s},6614:(k,S,a)=>{"use strict";var d=a(1778),p=a(8651),o=a(457),s=a(5021);k.exports=function(e,r,n){if("string"!=typeof e)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:e,enumerable:!0},localAudioTrackStats:{value:r.localAudioTrackStats.map(function(l){return new d(l.trackId,l,n)}),enumerable:!0},localVideoTrackStats:{value:r.localVideoTrackStats.map(function(l){return new p(l.trackId,l,n)}),enumerable:!0},remoteAudioTrackStats:{value:r.remoteAudioTrackStats.map(function(l){return new o(l.trackId,l)}),enumerable:!0},remoteVideoTrackStats:{value:r.remoteVideoTrackStats.map(function(l){return new s(l.trackId,l)}),enumerable:!0}})}},2697:k=>{"use strict";k.exports=function(a){return a.reduce(function(d,p){return"number"==typeof p?p+d:d},0)}},2313:k=>{"use strict";k.exports=function(d,p){if("string"!=typeof d)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:d,enumerable:!0},trackSid:{value:p.trackSid,enumerable:!0},timestamp:{value:p.timestamp,enumerable:!0},ssrc:{value:p.ssrc,enumerable:!0},packetsLost:{value:"number"==typeof p.packetsLost?p.packetsLost:null,enumerable:!0},codec:{value:"string"==typeof p.codecName?p.codecName:null,enumerable:!0}})}},8699:function(k,S,a){"use strict";var s,d=this&&this.__extends||(s=function(i,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(i,t)},function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=function(s){function i(t,e){var r=s.call(this)||this;return Object.defineProperties(r,{id:{enumerable:!0,value:t},kind:{enumerable:!0,value:e}}),r}return d(i,s),i.prototype.stop=function(){this.emit("stopped")},i}(a(3105).EventEmitter);k.exports=o},9616:function(k,S,a){"use strict";var J,d=this&&this.__extends||(J=function(V,D){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,b){E.__proto__=b}||function(E,b){for(var B in b)Object.prototype.hasOwnProperty.call(b,B)&&(E[B]=b[B])})(V,D)},function(V,D){if("function"!=typeof D&&null!==D)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function E(){this.constructor=V}J(V,D),V.prototype=null===D?Object.create(D):(E.prototype=D.prototype,new E)}),p=this&&this.__read||function(J,V){var D="function"==typeof Symbol&&J[Symbol.iterator];if(!D)return J;var b,Q,E=D.call(J),B=[];try{for(;(void 0===V||V-- >0)&&!(b=E.next()).done;)B.push(b.value)}catch(q){Q={error:q}}finally{try{b&&!b.done&&(D=E.return)&&D.call(E)}finally{if(Q)throw Q.error}}return B},o=this&&this.__spreadArray||function(J,V){for(var D=0,E=V.length,b=J.length;D<E;D++,b++)J[b]=V[D];return J},s=a(1856),i=a(3761),t=i.buildLogLevels,e=i.makeUUID,r=a(7394),n=a(4189),l=a(1190),v=0,y={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},m={closed:"close",open:"open",waiting:"waiting"},I=3005,H=global.window||global,U=H.WebSocket?H.WebSocket:a(6890),F={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},Z=new Map([[3e3,F.TIMEOUT],[3001,F.TIMEOUT],[3002,F.FAILED],[3003,F.FAILED],[3004,F.TIMEOUT],[3006,F.BUSY],[3007,F.TIMEOUT]]),ee=function(J){function V(D,E){var b=J.call(this,"early",y)||this;E=Object.assign({helloBody:null,maxConsecutiveFailedHellos:3,maxConsecutiveMissedHeartbeats:3,requestedHeartbeatTimeout:5e3,openTimeout:15e3,welcomeTimeout:5e3,Log:r,WebSocket:U},E);var B=t(E.logLevel),Q=new E.Log("default",b,B,E.loggerName),q=E.networkMonitor?new n(function(){var X=q.type,se="Network changed"+(X?" to "+X:"");Q.debug(se),b._close({code:3004,reason:se})}):null;Object.defineProperties(b,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:E.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:E.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++v},_log:{value:Q},_messageQueue:{value:[]},_networkMonitor:{value:q},_options:{value:E},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:D},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var K={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return b.on("stateChanged",function(X){for(var se=[],le=1;le<arguments.length;le++)se[le-1]=arguments[le];X in m&&b.emit.apply(b,o([m[X]],p(se)));var he={name:X,group:"signaling",level:K[b.state]};if("closed"===X){var me=p(se,1),pe=me[0];he.payload={reason:pe},he.level=pe===F.LOCAL?"info":"error"}b._eventObserver.emit("event",he)}),b._eventObserver.emit("event",{name:b.state,group:"signaling",level:K[b.state]}),b._connect(),b}return d(V,J),V.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},V.prototype._close=function(D){var E=D.code,b=D.reason;if("closed"!==this.state){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&E!==I&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var B=this._log;1e3===E?(B.debug("Closed"),this.transition("closed",null,[F.LOCAL])):(B.warn("Closed: "+E+" - "+b),E!==I&&this.transition("closed",null,[Z.get(E)||F.REMOTE]));var Q=this._ws.readyState,q=this._options.WebSocket;Q!==q.CLOSING&&Q!==q.CLOSED&&this._ws.close(E,b)}},V.prototype._connect=function(){var D=this,E=this._log;if("waiting"===this.state)this.transition("early");else if("early"!==this.state)return void E.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');this._ws=new this._options.WebSocket(this._serverUrl);var b=this._ws;E.debug("Created a new WebSocket:",b),b.addEventListener("close",function(Q){return D._close(Q)});var B=this._options.openTimeout;this._openTimeout=new l(function(){D._close({code:3007,reason:"Failed to open in "+B+" ms"})},B),b.addEventListener("open",function(){E.debug("WebSocket opened:",b),D._openTimeout.clear(),D._startHandshake(),D._networkMonitor&&D._networkMonitor.start()}),b.addEventListener("message",function(Q){E.debug("Incoming: "+Q.data);try{Q=JSON.parse(Q.data)}catch(q){return void D.emit("error",q)}switch(Q.type){case"bad":D._handleBad(Q);break;case"busy":D._handleBusy(Q);break;case"bye":break;case"msg":D._handleMessage(Q);case"heartbeat":D._handleHeartbeat();break;case"welcome":D._handleWelcome(Q);break;default:D._log.debug("Unknown message type: "+Q.type),D.emit("error",new Error("Unknown message type: "+Q.type))}})},V.prototype._handleBad=function(D){var E=D.reason,b=this._log;if(["connecting","open"].includes(this.state))return"connecting"===this.state?(b.warn("Closing: 3002 - "+E),void this._close({code:3002,reason:E})):(b.debug("Error: "+E),void this.emit("error",new Error(E)));b.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.')},V.prototype._handleBusy=function(D){var E=this,b=D.cookie,B=D.keepAlive,Q=D.retryAfter,q=this._log;if(["connecting","waiting"].includes(this.state)){this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var K=Q<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+Q+" ms";if(Q<0)return q.warn("Closing: 3006 - "+K),void this._close({code:3006,reason:K});this._hellosLeft=this._options.maxConsecutiveFailedHellos,this._cookie=b||null,B?(q.warn(K),this._busyWaitTimeout=new l(function(){return E._startHandshake()},Q)):(q.warn("Closing: 3005 - "+K),this._close({code:I,reason:K}),this._busyWaitTimeout=new l(function(){return E._connect()},Q)),this.transition("waiting",null,[B,Q])}else q.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.')},V.prototype._handleHeartbeat=function(){"open"===this.state?this._heartbeatTimeout.reset():this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.')},V.prototype._handleHeartbeatTimeout=function(){if("open"===this.state){var D=this._log,E=this._options.maxConsecutiveMissedHeartbeats;D.debug("Consecutive heartbeats missed: "+E);var b="Missed "+E+' "heartbeat" messages';D.warn("Closing: 3001 - "+b),this._close({code:3001,reason:b})}},V.prototype._handleMessage=function(D){"open"===this.state?this.emit("message",D.body):this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.')},V.prototype._handleWelcome=function(D){var E=this,b=D.negotiatedTimeout,B=this._log;if(["connecting","waiting"].includes(this.state)){"waiting"===this.state&&(B.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var q=b*this._options.maxConsecutiveMissedHeartbeats,K=b-200;this._welcomeTimeout.clear(),this._heartbeatTimeout=new l(function(){return E._handleHeartbeatTimeout()},q),this._messageQueue.splice(0).forEach(function(X){return E._send(X)}),this._sendHeartbeatTimeout=new l(function(){return E._sendHeartbeat()},K),this.transition("open")}else B.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.')},V.prototype._handleWelcomeTimeout=function(){if("connecting"===this.state){var D=this._log;if(this._hellosLeft<=0){var E="All handshake attempts failed";return D.warn("Closing: 3000 - "+E),void this._close({code:3e3,reason:E})}D.warn("Handshake attempt "+(this._options.maxConsecutiveFailedHellos-this._hellosLeft)+" failed"),this._startHandshake()}},V.prototype._send=function(D){if(this._ws.readyState===this._options.WebSocket.OPEN){var B=JSON.stringify(D);this._log.debug("Outgoing: "+B);try{this._ws.send(B),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch(q){var Q="Failed to send message";this._log.warn("Closing: 3003 - "+Q),this._close({code:3003,reason:Q})}}},V.prototype._sendHeartbeat=function(){"closed"!==this.state&&this._send({type:"heartbeat"})},V.prototype._sendHello=function(){var D=this._options,E=D.helloBody,b=D.requestedHeartbeatTimeout,B={id:e(),timeout:b,type:"hello",version:2};this._cookie&&(B.cookie=this._cookie),E&&(B.body=E),this._send(B)},V.prototype._sendOrEnqueue=function(D){var E=this;"closed"!==this.state&&("open"===this.state?function(B){return E._send(B)}:function(B){return E._messageQueue.push(B)})(D)},V.prototype._startHandshake=function(){var D=this;["early","waiting"].includes(this.state)&&this.transition("connecting"),"connecting"===this.state&&(this._hellosLeft--,this._sendHello(),this._welcomeTimeout=new l(function(){return D._handleWelcomeTimeout()},this._options.welcomeTimeout))},V.prototype.close=function(){"closed"!==this.state&&(this._sendOrEnqueue({type:"bye"}),this._close({code:1e3,reason:"Normal"}))},V.prototype.sendMessage=function(D){this._sendOrEnqueue({body:D,type:"msg"})},V}(s);ee.CloseReason=F,k.exports=ee},8264:(k,S,a)=>{"use strict";var d=a(3761).defer,p=function(){function o(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return o.prototype.put=function(s){this._hasValue=!0,this._value=s;var i=this._deferreds.shift();return i&&i.resolve(s),this},o.prototype.take=function(){var s=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=d();return this._deferreds.push(i),i.promise.then(function(t){return s._hasValue=!1,t})},o}();k.exports=p},1222:function(k){"use strict";var S=this&&this.__read||function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var v,m,l=n.call(e),y=[];try{for(;(void 0===r||r-- >0)&&!(v=l.next()).done;)y.push(v.value)}catch(f){m={error:f}}finally{try{v&&!v.done&&(n=l.return)&&n.call(l)}finally{if(m)throw m.error}}return y};k.exports={isAndroid:function(){return/Android/.test(navigator.userAgent)},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},isMobile:function(){return/Mobi/.test(navigator.userAgent)},isNonChromiumEdge:function(e){return"chrome"===e&&/Edge/.test(navigator.userAgent)&&("undefined"==typeof chrome||void 0===chrome.runtime)},mobileWebKitBrowser:function(e){return"safari"!==e?null:"brave"in navigator?"brave":["edge","edg"].find(function(r){return navigator.userAgent.toLowerCase().includes(r)})||null},rebrandedChromeBrowser:function(e){if("chrome"!==e)return null;if("brave"in navigator)return"brave";var l=function(e){for(var r=[],n=[],l=0;l<e.length;l++)if("("===e[l])r.push(l);else if(")"===e[l]&&r.length>0){var v=r.pop();0===r.length&&n.push(e.substring(v,l+1))}return n}(navigator.userAgent).reduce(function(m,f){return m.replace(f,"")},navigator.userAgent).match(/[^\s]+/g)||[];return S(l.map(function(m){return m.split("/")[0].toLowerCase()})).slice(2).find(function(m){return!["chrome","mobile","safari"].includes(m)})||null}}},617:function(k){"use strict";var S=this&&this.__read||function(p,o){var s="function"==typeof Symbol&&p[Symbol.iterator];if(!s)return p;var t,r,i=s.call(p),e=[];try{for(;(void 0===o||o-- >0)&&!(t=i.next()).done;)e.push(t.value)}catch(n){r={error:n}}finally{try{t&&!t.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}return e},a=this&&this.__spreadArray||function(p,o){for(var s=0,i=o.length,t=p.length;s<i;s++,t++)p[t]=o[s];return p},d=function(){function p(o,s){var i=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:s}}),Object.defineProperty(this,"_promise",{value:new Promise(function(t,e){o(function(r){i._isCancelable=!1,t(r)},function(r){i._isCancelable=!1,e(r)},function(){return i._isCanceled})})})}return p.reject=function(o){return new p(function(i,t){t(o)},function(){})},p.resolve=function(o){return new p(function(i){i(o)},function(){})},p.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},p.prototype.catch=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.catch.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p.prototype.then=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.then.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p.prototype.finally=function(){var o=[].slice.call(arguments),s=this._promise;return new p(function(t,e){s.finally.apply(s,a([],S(o))).then(t,e)},this._onCancel)},p}();k.exports=d},9917:(k,S,a)=>{"use strict";var d=a(1730);k.exports.SDK_NAME=d.name+".js",k.exports.SDK_VERSION=d.version,k.exports.SDP_FORMAT="unified",k.exports.DEFAULT_ENVIRONMENT="prod",k.exports.DEFAULT_REALM="us1",k.exports.DEFAULT_REGION="gll",k.exports.DEFAULT_LOG_LEVEL="warn",k.exports.DEFAULT_LOGGER_NAME="twilio-video",k.exports.WS_SERVER=function(o,s){return s="gll"===s?"global":encodeURIComponent(s),"prod"===o?"wss://"+s+".vss.twilio.com/signaling":"wss://"+s+".vss."+o+".twilio.com/signaling"},k.exports.PUBLISH_MAX_ATTEMPTS=5,k.exports.PUBLISH_BACKOFF_JITTER=10,k.exports.PUBLISH_BACKOFF_MS=20,k.exports.typeErrors={ILLEGAL_INVOKE:function(o,s){return new TypeError("Illegal call to "+o+": "+s)},INVALID_TYPE:function(o,s){return new TypeError(o+" must be "+function(o){return["a","e","i","o","u"].includes(o.toLowerCase()[0])?"an":"a"}(s)+" "+s)},INVALID_VALUE:function(o,s){return new RangeError(o+" must be one of "+s.join(", "))},REQUIRED_ARGUMENT:function(o){return new TypeError(o+" must be specified")}},k.exports.DEFAULT_FRAME_RATE=24,k.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,k.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,k.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,k.exports.DEFAULT_NQ_LEVEL_LOCAL=1,k.exports.DEFAULT_NQ_LEVEL_REMOTE=0,k.exports.MAX_NQ_LEVEL=3,k.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,k.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,k.exports.iceRestartBackoffConfig={factor:1.1,initialDelay:1,maxDelay:1e3*k.exports.DEFAULT_SESSION_TIMEOUT_SEC,randomisationFactor:.5},k.exports.reconnectBackoffConfig={factor:1.5,initialDelay:80,randomisationFactor:.5},k.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},k.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},k.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},k.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},k.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}},3305:(k,S,a)=>{"use strict";var d=a(1923);k.exports=function(i){var t=a(9057),e={},r=t.getOrCreate(e),n=3;return function l(){return n--,d(r,i.srcObject,250).then(function(v){return!!v&&(!(n>0)||l())}).catch(function(){return!0})}().finally(function(){t.release(e)})}},4139:k=>{"use strict";var S=null;k.exports=function(t){return S=S||document.createElement("canvas"),new Promise(function(e){var r=3;setTimeout(function n(){return r--,function(t){try{var e=S.getContext("2d");e.drawImage(t,0,0,50,50);var n=e.getImageData(0,0,50,50).data.filter(function(v,y){return(y+1)%4});return 0===Math.max.apply(Math,n)}catch(v){return console.log("Error checking silence: ",v),!1}}(t)?r>0?setTimeout(n,250):e(!0):e(!1)},250)})}},296:k=>{"use strict";var S=function(){function a(d){var p=this;void 0===d&&(d=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){p._emitVisible("visible"===document.visibilityState)}}});for(var o=0;o<d;o++)this._listeners.push([])}return a.prototype.clear=function(){for(var d=this._listeners.length,p=0;p<d;p++)this._listeners[p]=[]},a.prototype._listenerCount=function(){return this._listeners.reduce(function(d,p){return d+p.length},0)},a.prototype._emitVisible=function(d){for(var p=this,o=Promise.resolve(),s=function(t){o=o.then(function(){return p._emitVisiblePhase(t,d)})},i=1;i<=this._listeners.length;i++)s(i);return o},a.prototype._emitVisiblePhase=function(d,p){return Promise.all(this._listeners[d-1].map(function(s){var i=s(p);return i instanceof Promise?i:Promise.resolve(i)}))},a.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},a.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},a.prototype.onVisibilityChange=function(d,p){if("number"!=typeof d||d<=0||d>this._listeners.length)throw new Error("invalid phase: ",d);return this._listeners[d-1].push(p),1===this._listenerCount()&&this._start(),this},a.prototype.offVisibilityChange=function(d,p){if("number"!=typeof d||d<=0||d>this._listeners.length)throw new Error("invalid phase: ",d);var o=this._listeners[d-1],s=o.indexOf(p);return-1!==s&&(o.splice(s,1),0===this._listenerCount()&&this._stop()),this},a}();k.exports=new S(2)},8326:function(k,S,a){"use strict";var t,d=this&&this.__extends||(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)Object.prototype.hasOwnProperty.call(l,v)&&(n[v]=l[v])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),p=a(3105).EventEmitter,o=["signaling","room","media","quality","video-processor","preflight"],s=["debug","error","info","warning"],i=function(t){function e(r,n,l,v){void 0===v&&(v=null);var y=t.call(this)||this;return y.on("event",function(m){var f=m.name,u=m.group,c=m.level,h=m.payload;if("string"!=typeof f)throw l.error("Unexpected name: ",f),new Error("Unexpected name: ",f);if(!o.includes(u))throw l.error("Unexpected group: ",u),new Error("Unexpected group: ",u);if(!s.includes(c))throw l.error("Unexpected level: ",c),new Error("Unexpected level: ",c);var P=Date.now(),O=P-n,w=Object.assign({elapsedTime:O,level:c},h||{});r.publish(u,f,w);var R=Object.assign({elapsedTime:O,group:u,level:c,name:f,timestamp:P},h?{payload:h}:{});l[{debug:"debug",error:"error",info:"info",warning:"warn"}[c]]("event",R),v&&"signaling"===u&&v.emit("event",R)}),y}return d(e,t),e}(p);k.exports=i},7060:k=>{"use strict";var S=function(){function a(d){d=Object.assign({getKey:function(o){return o},getValue:function(o){return o},isLessThanOrEqualTo:function(o,s){return o<=s}},d),Object.defineProperties(this,{_getKey:{value:d.getKey},_getValue:{value:d.getValue},_isLessThanOrEqualTo:{value:d.isLessThanOrEqualTo},_map:{value:new Map}})}return a.prototype.toMap=function(){return new Map(this._map)},a.prototype.updateAndFilter=function(d){return d.filter(this.update,this)},a.prototype.update=function(d){var p=this._getKey(d),o=this._getValue(d);return!(this._map.has(p)&&this._isLessThanOrEqualTo(o,this._map.get(p))||(this._map.set(p,o),0))},a}();k.exports=S},3761:function(k,S,a){"use strict";var $,d=this&&this.__extends||($=function(te,ne){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,j){W.__proto__=j}||function(W,j){for(var x in j)Object.prototype.hasOwnProperty.call(j,x)&&(W[x]=j[x])})(te,ne)},function(te,ne){if("function"!=typeof ne&&null!==ne)throw new TypeError("Class extends value "+String(ne)+" is not a constructor or null");function W(){this.constructor=te}$(te,ne),te.prototype=null===ne?Object.create(ne):(W.prototype=ne.prototype,new W)}),p=this&&this.__read||function($,te){var ne="function"==typeof Symbol&&$[Symbol.iterator];if(!ne)return $;var j,Y,W=ne.call($),x=[];try{for(;(void 0===te||te-- >0)&&!(j=W.next()).done;)x.push(j.value)}catch(N){Y={error:N}}finally{try{j&&!j.done&&(ne=W.return)&&ne.call(W)}finally{if(Y)throw Y.error}}return x},o=this&&this.__spreadArray||function($,te){for(var ne=0,W=te.length,j=$.length;ne<W;ne++,j++)$[j]=te[ne];return $},s=a(9917),i=s.typeErrors,t=s.trackPriority,e=a(4911),r=a(3187).sessionSID;function c(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"Unknown"}function T($,te,ne,W){if(!(W in te)&&!W.match(/^on[a-z]+$/)){var j;try{j=typeof $[W]}catch(x){}"function"===j&&(te[W]=function(){for(var x,Y=[],N=0;N<arguments.length;N++)Y[N]=arguments[N];return(x=this[ne])[W].apply(x,o([],p(Y)))})}}function L($){return"object"==typeof $&&!Array.isArray($)}function Z($){Object.getOwnPropertyNames($).forEach(function(te){te.startsWith("_")&&J($,te)})}function J($,te){var ne=Object.getOwnPropertyDescriptor($,te);ne.enumerable=!1,Object.defineProperty($,te,ne)}function V($,te){void 0===te&&(te=[]),te.forEach(function(ne){$.hasOwnProperty(ne)&&J($,ne)})}function D($){return $.map(Q)}function Q($){return Array.isArray($)?D($):$ instanceof Set?function($){return D(o([],p($)))}($):$ instanceof Map?function($){return o([],p($.entries())).reduce(function(te,ne){var W,j=p(ne,2);return Object.assign(((W={})[j[0]]=Q(j[1]),W),te)},{})}($):$&&"object"==typeof $?function($){return Object.entries($).reduce(function(te,ne){var W,j=p(ne,2);return Object.assign(((W={})[j[0]]=Q(j[1]),W),te)},{})}($):$}function X($){return me($,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:he},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function le($){return me($,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function he($){return me($,[{prop:t.PRIORITY_HIGH,type:"object",transform:le},{prop:t.PRIORITY_LOW,type:"object",transform:le},{prop:t.PRIORITY_STANDARD,type:"object",transform:le}])}function me($,te){return te.reduce(function(ne,W){var j,x=W.prop,N=W.payloadProp,fe=W.transform;return typeof $[x]===W.type?Object.assign(((j={})[void 0===N?x:N]=(void 0===fe?function(_e){return _e}:fe)($[x]),j),ne):ne},{})}S.constants=s,S.createBandwidthProfilePayload=function($){return me($,[{prop:"video",type:"object",transform:X}])},S.createMediaSignalingPayload=function($,te,ne,W,j,x){var Y={transports:[{type:"data-channel"}]};return Object.assign($?{active_speaker:Y}:{},te?{network_quality:Y}:{},x?{render_hints:Y}:{},j?{publisher_hints:Y}:{},ne?{track_priority:Y}:{},W?{track_switch_off:Y}:{})},S.createRoomConnectEventPayload=function($){function te(j){return j?"true":"false"}var ne={sessionSID:r,iceServers:($.iceServers||[]).length,audioTracks:($.tracks||[]).filter(function(j){return"audio"===j.kind}).length,videoTracks:($.tracks||[]).filter(function(j){return"video"===j.kind}).length,dataTracks:($.tracks||[]).filter(function(j){return"data"===j.kind}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(j){var x=p(j,2),Y=x[0],N=x[1];ne[N=N||Y]=te(!!$[Y])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(j){var x=p(j,2),Y=x[0],N=x[1];N=N||Y,"number"==typeof $[Y]?ne[N]=$[Y]:isNaN(Number($[Y]))||(ne[N]=Number($[Y]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(j){var x=p(j,2),Y=x[0],N=x[1];N=N||Y,"string"==typeof $[Y]?ne[N]=$[Y]:"number"==typeof $[Y]&&"name"===Y&&(ne[N]=$[Y].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(j){j in $&&(ne[j]=JSON.stringify($[j]))}),"networkQuality"in $&&(ne.networkQualityConfiguration={},L($.networkQuality)?["local","remote"].forEach(function(j){"number"==typeof $.networkQuality[j]&&(ne.networkQualityConfiguration[j]=$.networkQuality[j])}):(ne.networkQualityConfiguration.remote=0,ne.networkQualityConfiguration.local=$.networkQuality?1:0)),$.bandwidthProfile&&$.bandwidthProfile.video){var W=$.bandwidthProfile.video||{};ne.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(j){"number"==typeof W[j]||"string"==typeof W[j]?ne.bandwidthProfileOptions[j]=W[j]:"boolean"==typeof W[j]?ne.bandwidthProfileOptions[j]=te(W[j]):"object"==typeof W[j]&&(ne.bandwidthProfileOptions[j]=JSON.stringify(W[j]))})}return{group:"room",name:"connect",level:"info",payload:ne}},S.createSubscribePayload=function($){return{rules:[{type:$?"include":"exclude",all:!0}],revision:1}},S.asLocalTrack=function($,te){if($ instanceof te.LocalAudioTrack||$ instanceof te.LocalVideoTrack||$ instanceof te.LocalDataTrack)return $;if($ instanceof te.MediaStreamTrack)return"audio"===$.kind?new te.LocalAudioTrack($,te):new te.LocalVideoTrack($,te);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},S.asLocalTrackPublication=function($,te,ne,W){return new(0,{audio:W.LocalAudioTrackPublication,video:W.LocalVideoTrackPublication,data:W.LocalDataTrackPublication}[$.kind])(te,$,ne,W)},S.capitalize=function($){return $[0].toUpperCase()+$.slice(1)},S.deprecateEvents=function($,te,ne,W){var j=new Set;te.on("newListener",function x(Y){ne.has(Y)&&!j.has(Y)&&(W.deprecated($+"#"+Y+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(ne.get(Y)?" Use "+$+"#"+ne.get(Y)+" instead.":"")),j.add(Y)),j.size>=ne.size&&te.removeListener("newListener",x)})},S.difference=function($,te){$=Array.isArray($)?new Set($):new Set($.values()),te=Array.isArray(te)?new Set(te):new Set(te.values());var ne=new Set;return $.forEach(function(W){te.has(W)||ne.add(W)}),ne},S.filterObject=function($,te){return Object.keys($).reduce(function(ne,W){return $[W]!==te&&(ne[W]=$[W]),ne},{})},S.flatMap=function($,te){var ne=$ instanceof Map||$ instanceof Set?Array.from($.values()):$;return te=te||function(j){return j},ne.reduce(function(W,j){var x=te(j);return W.concat(x)},[])},S.getPlatform=function(){var $=c(),ne=p($.match(/\(([^)]+)\)/)||[],2)[1];return p((void 0===ne?"unknown":ne).split(";").map(function(Y){return Y.trim()}),1)[0].toLowerCase()},S.getUserAgent=c,S.hidePrivateProperties=Z,S.hidePrivateAndCertainPublicPropertiesInClass=function($,te){return function(ne){function W(){for(var j=[],x=0;x<arguments.length;x++)j[x]=arguments[x];var Y=ne.apply(this,o([],p(j)))||this;return Z(Y),V(Y,te),Y}return d(W,ne),W}($)},S.isDeepEqual=function _($,te){if($===te)return!0;if(typeof $!=typeof te)return!1;if(null===$)return null===te;if(null===te)return!1;if(Array.isArray($))return Array.isArray(te)&&$.length===te.length&&$.every(function(j,x){return _(j,te[x])});if("object"==typeof $){var ne=Object.keys($).sort(),W=Object.keys(te).sort();return!Array.isArray(te)&&_(ne,W)&&ne.every(function(j){return _($[j],te[j])})}return!1},S.isNonArrayObject=L,S.inRange=function($,te,ne){return te<=$&&$<=ne},S.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function($){var te=16*Math.random()|0;return("x"===$?te:3&te|8).toString(16)})},S.oncePerTick=function($){var te=null;function ne(){te=null,$()}return function(){te&&clearTimeout(te),te=setTimeout(ne)}},S.promiseFromEvents=function($,te,ne,W){return new Promise(function(j,x){function Y(){var re=[].slice.call(arguments);W&&te.removeListener(W,N),j.apply(void 0,o([],p(re)))}function N(){var re=[].slice.call(arguments);te.removeListener(ne,Y),x.apply(void 0,o([],p(re)))}te.once(ne,Y),W&&te.once(W,N),$()})},S.getOrNull=function($,te){return te.split(".").reduce(function(ne,W){return ne?ne[W]:null},$)},S.defer=function(){var $={};return $.promise=new Promise(function(te,ne){$.resolve=te,$.reject=ne}),$},S.delegateMethods=function($,te,ne){for(var W in $)T($,te,ne,W)},S.proxyProperties=function($,te,ne){Object.getOwnPropertyNames($).forEach(function(W){!function($,te,ne,W){if(!(W in te)){if(W.match(/^on[a-z]+$/))return Object.defineProperty(te,W,{value:null,writable:!0}),void ne.addEventListener(W.slice(2),function(){for(var j=[],x=0;x<arguments.length;x++)j[x]=arguments[x];te.dispatchEvent.apply(te,o([],p(j)))});Object.defineProperty(te,W,{enumerable:!0,get:function(){return ne[W]}})}}(0,te,ne,W)})},S.legacyPromise=function($,te,ne){return te?$.then(function(W){te(W)},function(W){ne(W)}):$},S.buildLogLevels=function($){return"string"==typeof $?{default:$,media:$,signaling:$,webrtc:$}:$},S.trackClass=function($,te){return(te=te?"Local":"")+($.kind||"").replace(/\w{1}/,function(ne){return ne.toUpperCase()})+"Track"},S.trackPublicationClass=function($,te){return(te=te?"Local":"")+($.kind||"").replace(/\w{1}/,function(ne){return ne.toUpperCase()})+"TrackPublication"},S.valueToJSON=Q,S.withJitter=function($,te){var ne=Math.random();return $-te+Math.floor(2*te*ne+.5)},S.isChromeScreenShareTrack=function($){return"chrome"===e.guessBrowser()&&"video"===$.kind&&"displaySurface"in $.getSettings()},S.isUserMediaTrack=function($){return"string"==typeof $.getSettings().deviceId},S.waitForSometime=function($){return void 0===$&&($=10),new Promise(function(te){return setTimeout(te,$)})},S.waitForEvent=function($,te){return new Promise(function(ne){$.addEventListener(te,function W(j){$.removeEventListener(te,W),ne(j)})})}},3066:function(k,S,a){"use strict";var u,d=this&&this.__extends||(u=function(c,h){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,O){P.__proto__=O}||function(P,O){for(var w in O)Object.prototype.hasOwnProperty.call(O,w)&&(P[w]=O[w])})(c,h)},function(c,h){if("function"!=typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function P(){this.constructor=c}u(c,h),c.prototype=null===h?Object.create(h):(P.prototype=h.prototype,new P)}),p=a(3105).EventEmitter,o=a(3761).getUserAgent,e=global.window||global,r=e.WebSocket?e.WebSocket:a(6890),n=a(3761),l=function(u){function c(h,P,O,w,R,C){var T=u.call(this)||this;return C=Object.assign({gateway:y(w,R)+"/v1/VideoEvents",maxReconnectAttempts:5,reconnectIntervalMs:50,userAgent:o(),WebSocket:r},C),Object.defineProperties(T,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:n.defer()},_reconnectAttemptsLeft:{value:C.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:C.WebSocket}}),T._readyToConnect.promise.then(function(g){var _=g.roomSid,L=g.participantSid,I=T;T.on("disconnected",function M(A){if(I._session=null,A&&I._reconnectAttemptsLeft>0)return I.emit("reconnecting"),void function(u,c,h,P,O,w,R){var C=Date.now()-u._connectTimestamp,T=R.reconnectIntervalMs-C;T>0?setTimeout(function(){v(u,c,h,P,O,w,R)},T):v(u,c,h,P,O,w,R)}(I,h,P,O,_,L,C);I.removeListener("disconnected",M)}),v(T,h,P,O,_,L,C)}).catch(function(){}),T}return d(c,u),c.prototype.connect=function(h,P){this._readyToConnect.resolve({roomSid:h,participantSid:P})},c.prototype._publish=function(h){h.session=this._session,this._ws.send(JSON.stringify(h))},c.prototype.disconnect=function(){if(null===this._ws||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch(h){}return this.emit("disconnected"),!0},c.prototype.publish=function(h,P,O){return(null===this._ws||this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED)&&(("string"==typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:h,name:P,payload:O,timestamp:Date.now(),type:"event",version:1}),!0)},c}(p);function v(u,c,h,P,O,w,R){u._connectTimestamp=Date.now(),u._reconnectAttemptsLeft--,u._ws=new R.WebSocket(R.gateway);var C=u._ws;C.addEventListener("close",function(T){1e3!==T.code?u.emit("disconnected",new Error("WebSocket Error "+T.code+": "+T.reason)):u.emit("disconnected")}),C.addEventListener("message",function(T){!function(u,c,h){switch(c.type){case"connected":u._session=c.session,u._reconnectAttemptsLeft=h.maxReconnectAttempts,u._eventQueue.splice(0).forEach(u._publish,u),u.emit("connected");break;case"error":u._ws.close(),u.emit("disconnected",new Error(c.message))}}(u,JSON.parse(T.data),R)}),C.addEventListener("open",function(){var T={type:"connect",token:c,version:1};T.publisher={name:h,sdkVersion:P,userAgent:R.userAgent,participantSid:w,roomSid:O},C.send(JSON.stringify(T))})}function y(u,c){return"prod"===u?"wss://sdkgw."+c+".twilio.com":"wss://sdkgw."+u+"-"+c+".twilio.com"}k.exports=l},7217:k=>{"use strict";var S=function(){function a(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return a.prototype.connect=function(){},a.prototype.disconnect=function(){return!!this._connected&&(this._connected=!1,!0)},a.prototype.publish=function(){return this._connected},a}();k.exports=S},9388:(k,S,a)=>{"use strict";var d=a(3761).defer,p=function(){function o(){Object.defineProperties(this,{_audio:{value:d(),writable:!0},_video:{value:d(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return o.prototype.resolveDeferred=function(s){"audio"===s?this._audio.resolve():this._video.resolve()},o.prototype.startDeferred=function(s){"audio"===s?this._audio=d():this._video=d()},o.prototype.whenResolved=function(s){return"audio"===s?this._audio.promise:this._video.promise},o}();k.exports=new p},7394:function(k,S,a){"use strict";var r,d=this&&this.__read||function(c,h){var P="function"==typeof Symbol&&c[Symbol.iterator];if(!P)return c;var w,C,O=P.call(c),R=[];try{for(;(void 0===h||h-- >0)&&!(w=O.next()).done;)R.push(w.value)}catch(T){C={error:T}}finally{try{w&&!w.done&&(P=O.return)&&P.call(O)}finally{if(C)throw C.error}}return R},p=this&&this.__spreadArray||function(c,h){for(var P=0,O=h.length,w=c.length;P<O;P++,w++)c[w]=h[P];return c},o=a(6828).getLogger,s=a(9917),i=s.DEFAULT_LOG_LEVEL,t=s.DEFAULT_LOGGER_NAME,e=a(9917).typeErrors,l=function(){function c(h,P,O,w,R){if("string"!=typeof h)throw e.INVALID_TYPE("moduleName","string");if(!P)throw e.REQUIRED_ARGUMENT("component");"object"!=typeof O&&(O={}),R=R||o,u(O),Object.defineProperties(this,{_component:{value:P},_logLevels:{value:O},_warnings:{value:new Set},_loggerName:{get:function(){var T=w&&"string"==typeof w?w:t;return this._logLevelsEqual||(T=T+"-"+h),T}},_logger:{get:function(){var T=R(this._loggerName),g=this._logLevels[h]||i;return T.setDefaultLevel(g="off"===g?"silent":g),T}},_logLevelsEqual:{get:function(){return 1===new Set(Object.values(this._logLevels)).size}},logLevel:{get:function(){return c.getLevelByName(O[h]||i)}},name:{get:P.toString.bind(P)}})}return c.getLevelByName=function(h){return isNaN(h)?(f(h=h.toUpperCase()),c[h]):parseInt(h,10)},c.prototype.createLog=function(h,P){var O=this._loggerName;return this._logLevelsEqual||(O=O.substring(0,O.lastIndexOf("-"))),new c(h,P,this._logLevels,O)},c.prototype.setLevels=function(h){return u(h),Object.assign(this._logLevels,h),this},c.prototype.log=function(h,P){var O=c._levels[h];if(!O)throw e.INVALID_VALUE("logLevel",y);O=O.toLowerCase();var w=[(new Date).toISOString(),O,this.name];return(this._logger[O]||function(){}).apply(void 0,p([],d(w.concat(P)))),this},c.prototype.debug=function(){return this.log(c.DEBUG,[].slice.call(arguments))},c.prototype.deprecated=function(h){var P=function(c){if((r=r||new Map).has(c))return r.get(c);var h=new Set;return r.set(c,h),h}(this._component.constructor);return P.has(h)?this:(P.add(h),this.warn(h))},c.prototype.info=function(){return this.log(c.INFO,[].slice.call(arguments))},c.prototype.warn=function(){return this.log(c.WARN,[].slice.call(arguments))},c.prototype.warnOnce=function(h){return this._warnings.has(h)?this:(this._warnings.add(h),this.warn(h))},c.prototype.error=function(){return this.log(c.ERROR,[].slice.call(arguments))},c.prototype.throw=function(h,P){throw h.clone&&(h=h.clone(P)),this.log(c.ERROR,h),h},c}();Object.defineProperties(l,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var v={},y=[],m=l._levels.map(function(c,h){return v[c]=!0,y.push(h),c});function f(c){if(!(c in v))throw e.INVALID_VALUE("level",m)}function u(c){Object.keys(c).forEach(function(h){f(c[h].toUpperCase())})}k.exports=l},2100:k=>{"use strict";var S=function(){function a(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return a.prototype.get=function(){var d=this._samples;return(d[1].numerator-d[0].numerator)/(d[1].denominator-d[0].denominator||1/0)},a.prototype.putSample=function(d,p){var o=this._samples;o.shift(),o.push({denominator:p,numerator:d})},a}();k.exports=S},4189:k=>{"use strict";var S=function(){function a(d,p){var o=this,s=(p=Object.assign({navigator,window},p)).navigator,i=s.connection||{type:null},t=i.type,e=i.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var v=t!==o.type&&o.isOnline;t=o.type,v&&d()}},_target:{value:i}}:{_events:{value:["online"]},_listener:{value:d},_target:{value:p.window}};Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return"boolean"!=typeof s.onLine||s.onLine}},type:{enumerable:!0,get:function(){return i.type||null}},_listener:e._listener,_events:e._events,_target:e._target})}return a.prototype.start=function(){var d=this;this._events.forEach(function(p){d._target.addEventListener(p,d._listener)})},a.prototype.stop=function(){var d=this;this._events.forEach(function(p){d._target.removeEventListener(p,d._listener)})},a}();k.exports=S},5092:function(k){"use strict";var o,S=this&&this.__extends||(o=function(s,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(s,i)},function(s,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=s}o(s,i),s.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}),a=function(){function o(s){Object.defineProperties(this,{_callback:{value:s}})}return o.prototype.observe=function(){},o.prototype.unobserve=function(){},o.prototype.makeVisible=function(s){var i=this._makeFakeEntry(s,!0);this._callback([i])},o.prototype.makeInvisible=function(s){var i=this._makeFakeEntry(s,!1);this._callback([i])},o.prototype._makeFakeEntry=function(s,i){return{target:s,isIntersecting:i}},o}(),d=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return S(s,o),s}(a),p=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return S(s,o),s.prototype.resize=function(i){var t=this._makeFakeEntry(i,!0);this._callback([t])},s}(a);k.exports={NullIntersectionObserver:d,NullResizeObserver:p,NullObserver:a}},3028:function(k,S,a){"use strict";var d=this&&this.__read||function(M,A){var H="function"==typeof Symbol&&M[Symbol.iterator];if(!H)return M;var F,ee,U=H.call(M),Z=[];try{for(;(void 0===A||A-- >0)&&!(F=U.next()).done;)Z.push(F.value)}catch(J){ee={error:J}}finally{try{F&&!F.done&&(H=U.return)&&H.call(U)}finally{if(ee)throw ee.error}}return Z},p=a(3761),o=p.difference,s=p.flatMap,i=a(8726),t={0:"PCMU",8:"PCMA"};function e(M){return Array.from(n(M)).reduce(function(A,H){var U=H[0],F=H[1],Z=A.get(F)||[];return A.set(F,Z.concat(U))},new Map)}function r(M){return y(M).reduce(function(A,H){var U=v(H);return U?A.set(U,H):A},new Map)}function n(M){return m(M).reduce(function(A,H){var U=new RegExp("a=rtpmap:"+H+" ([^/]+)"),F=M.match(U),Z=F?F[1].toLowerCase():t[H]?t[H].toLowerCase():"";return A.set(H,Z)},new Map)}function l(M,A){var H=new RegExp("^a=fmtp:"+M+" (.+)$","m"),U=A.match(H);return U&&U[1].split(";").reduce(function(F,Z){var ee=d(Z.split("="),2),V=ee[1];return F[ee[0]]=isNaN(V)?V:parseInt(V,10),F},{})}function v(M){var A=M.match(/^a=mid:(.+)$/m);return A&&A[1]}function y(M,A,H){return M.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(U){return"m="+U}).filter(function(U){var F=new RegExp("m="+(A||".*"),"gm"),Z=new RegExp("a="+(H||".*"),"gm");return F.test(U)&&Z.test(U)})}function m(M){var H=M.split("\r\n")[0].match(/([0-9]+)/g);return H?H.slice(1).map(function(U){return parseInt(U,10)}):[]}function u(M,A){var H=A.split("\r\n"),U=H[0],F=H.slice(1);return[U=U.replace(/([0-9]+\s?)+$/,M.join(" "))].concat(F).join("\r\n")}function T(M,A){var H=y(M);return[M.split("\r\nm=")[0]].concat(H.map(function(F){if(!/^m=(audio|video)/.test(F))return F;var Z=v(F);if(!Z)return F;var ee=A.get(Z);if(!ee)return F;var J=(F.match(/^a=msid:(.+)$/m)||[])[1];if(!J)return F;var V=d(J.split(" "),2),D=V[0],E=V[1],b=new RegExp("msid:"+D+(E?" "+E:"")+"$","gm");return F.replace(b,"msid:"+D+" "+ee)})).join("\r\n")}function L(M,A){return"a=fmtp:"+M+" "+Object.entries(A).map(function(U){var F=d(U,2);return F[0]+"="+F[1]}).join(";")}S.addOrRewriteNewTrackIds=function(M,A,H){var U=Array.from(H).reduce(function(F,Z){var ee=d(Z,2),V=ee[1];return y(M,ee[0],"send(only|recv)").map(v).filter(function(b){return!A.has(b)}).forEach(function(b,B){return F.set(b,V[B])}),F},new Map);return T(M,U)},S.addOrRewriteTrackIds=T,S.createCodecMapForMediaSection=e,S.createPtToCodecName=n,S.disableRtx=function(M){var A=y(M);return[M.split("\r\nm=")[0]].concat(A.map(function(U){if(!/^m=video/.test(U))return U;var Z=e(U).get("rtx");if(!Z)return U;var ee=new Set(m(U));Z.forEach(function(E){return ee.delete(E)});var J=U.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),V=J&&J[1],D=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(V?[new RegExp("^a=ssrc:"+V+" .+$")]:[]);return U=U.split("\r\n").filter(function(E){return D.every(function(b){return!b.test(E)})}).join("\r\n"),u(Array.from(ee),U)})).join("\r\n")},S.enableDtxForOpus=function(M,A){var H=y(M),U=M.split("\r\nm=")[0];return A=A||H.filter(function(F){return/^m=audio/.test(F)}).map(v),[U].concat(H.map(function(F){if(!/^m=audio/.test(F))return F;var ee=e(F).get("opus");if(!ee)return F;var J=l(ee,F);if(!J)return F;var V=L(ee,J),D=new RegExp(V),E=v(F);A.includes(E)?J.usedtx=1:delete J.usedtx;var b=L(ee,J);return F.replace(D,b)})).join("\r\n")},S.filterLocalCodecs=function(M,A){var H=y(M),U=M.split("\r\nm=")[0],F=r(A);return[U].concat(H.map(function(Z){return function(M,A,H){if(!/^m=(audio|video)/.test(M))return M;var U=v(M),F=U&&A.get(U);if(!F)return M;var Z=n(F),ee=e(M),J=s(Array.from(Z),function(b){var B=d(b,2),Q=B[0],q=B[1];return"rtx"===q||H.includes(q)?[]:function(M,A,H,U,F){var Z=H.get(M)||[];if(Z.length<=1)return Z;var ee=l(A,F);if(!ee)return Z;var J=Z.find(function(V){var D=l(V,U);return D&&Object.keys(ee).every(function(E){return ee[E]===D[E]})});return"number"==typeof J?[J]:Z}(q,Q,ee,M,F)}),V=ee.get("rtx")||[];J=J.concat(V.filter(function(b){var B=l(b,M);return B&&J.includes(B.apt)}));var D=M.split("\r\n").filter(function(b){var B=b.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),Q=B&&B[2];return!B||Q&&J.includes(parseInt(Q,10))});return u(m(M).filter(function(b){return J.includes(b)}),D.join("\r\n"))}(Z,F,[])})).join("\r\n")},S.getMediaSections=y,S.removeSSRCAttributes=function(M,A){return M.split("\r\n").filter(function(H){return!A.find(function(U){return new RegExp("a=ssrc:.*"+U+":","g").test(H)})}).join("\r\n")},S.revertSimulcast=function(M,A,H,U){void 0===U&&(U=!1);var F=r(H),Z=r(A),ee=y(M);return[M.split("\r\nm=")[0]].concat(ee.map(function(V){if(V=V.replace(/\r\n$/,""),!/^m=video/.test(V))return V;var D=V.match(/^a=mid:(.+)$/m),E=D&&D[1];if(!E)return V;var b=F.get(E),B=n(b),Q=m(b),q=Q.length&&"vp8"===B.get(Q[0]);return U||!q?Z.get(E).replace(/\r\n$/,""):V})).concat("").join("\r\n")},S.setCodecPreferences=function(M,A,H){var U=y(M);return[M.split("\r\nm=")[0]].concat(U.map(function(Z){if(!/^m=(audio|video)/.test(Z))return Z;var ee=Z.match(/^m=(audio|video)/)[1],J=e(Z),D=function(M,A){A=A.map(function(Z){return Z.codec.toLowerCase()});var H=s(A,function(Z){return M.get(Z)||[]}),U=o(Array.from(M.keys()),A),F=s(U,function(Z){return M.get(Z)});return H.concat(F)}(J,"audio"===ee?A:H),E=u(D,Z),b=J.get("pcma")||[],B=J.get("pcmu")||[];return("audio"===ee?new Set(b.concat(B)):new Set).has(D[0])?E.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):E})).join("\r\n")},S.setSimulcast=function(M,A){var H=y(M);return[M.split("\r\nm=")[0]].concat(H.map(function(F){if(F=F.replace(/\r\n$/,""),!/^m=video/.test(F))return F;var Z=e(F),ee=m(F),J=new Set(Z.get("vp8")||[]);return ee.some(function(D){return J.has(D)})?i(F,A):F})).concat("").join("\r\n")}},556:(k,S,a)=>{"use strict";var d=a(4135).RTCSessionDescription,p=a(3028),o=p.createPtToCodecName,s=p.getMediaSections;function e(u){var c=o(u);u=function(u,c){return Array.from(c.keys()).reduce(function(h,P){var O=new RegExp("^a=rtpmap:"+P+" rtx.+$","gm");return(h.match(O)||[]).slice("rtx"===c.get(P)?1:0).reduce(function(w,R){var C=new RegExp("\r\n"+R),T=new RegExp("\r\na=fmtp:"+P+" apt=[0-9]+");return w.replace(C,"").replace(T,"")},h)},u)}(u,c);var h=function(u){var c=new Map;return u.forEach(function(h,P){var O=c.get(h)||new Set;return c.set(h,O.add(P))}),c}(c),P=h.get("rtx")||new Set,O=new Set,R=function(u,c){var h=Array.from(u).reduce(function(P,O){var w=O[0],R=O[1],C=P.get(R)||new Set;return P.set(R,C.add(w))},new Map);return Array.from(h).reduce(function(P,O){var w=O[0],R=Array.from(O[1]);return R.length>1?(R.forEach(function(C){c.add(C)}),P):P.set(w,R[0])},new Map)}(function(u,c,h,P){return Array.from(h).reduce(function(O,w){var R=new RegExp("a=fmtp:"+w+" apt=(\\d+)"),C=u.match(R);if(!C)return P.add(w),O;var T=Number.parseInt(C[1]);return c.has(T)?"rtx"===c.get(T)?(P.add(w),O):O.set(w,T):(P.add(w),O)},new Map)}(u,c,P,O),O),C=Array.from(O);return["h264","vp8","vp9"].reduce(function(_,L){var I=h.get(L)||new Set;return Array.from(I).reduce(function(M,A){return R.has(A)?M:M.add(A)},_)},new Set).forEach(function(_){if(C.length){var L=C.shift();u=function(u,c,h){return u.endsWith("\r\n")?u+"a=fmtp:"+c+" apt="+h+"\r\n":u+"\r\na=fmtp:"+c+" apt="+h}(u=y(u,L),L,_)}}),C.forEach(function(_){u=function(u,c){var h=new RegExp("a=rtpmap:"+c+".*\r\n","gm");return u.replace(h,"")}(u=y(u,_),_)}),u}function y(u,c){var h=new RegExp("a=fmtp:"+c+".*\r\n","gm");return u.replace(h,"")}k.exports=function(u){var c={type:u.type};return"rollback"!==u.type&&(c.sdp=function(u){var c=s(u);return[u.split("\r\nm=")[0]].concat(c.map(e)).join("\r\n")}(u.sdp)),new d(c)}},8726:function(k,S,a){"use strict";var d=this&&this.__read||function(f,u){var c="function"==typeof Symbol&&f[Symbol.iterator];if(!c)return f;var P,w,h=c.call(f),O=[];try{for(;(void 0===u||u-- >0)&&!(P=h.next()).done;)O.push(P.value)}catch(R){w={error:R}}finally{try{P&&!P.done&&(c=h.return)&&c.call(h)}finally{if(w)throw w.error}}return O},p=a(3761),o=p.difference,s=p.flatMap;function i(){return String(Math.floor(4294967295*Math.random()))}var t=function(){function f(u,c,h){Object.defineProperties(this,{cName:{enumerable:!0,value:h},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:c},trackId:{enumerable:!0,value:u}})}return f.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var u=[i(),i()];u.forEach(function(c){this.primarySSRCs.add(c)},this),this.rtxPairs.size&&u.forEach(function(c){this.rtxPairs.set(i(),c)},this)}},f.prototype.addSSRC=function(u,c,h){c?this.rtxPairs.set(u,c):this.primarySSRCs.add(u),this.isSimulcastEnabled=this.isSimulcastEnabled||h},f.prototype.toSdpLines=function(u){var c=this,h=u?[]:Array.from(this.rtxPairs.entries()).map(function(T){return T.reverse()}),P=Array.from(this.primarySSRCs.values()),O=h.length?s(h):P,w=s(O,function(T){return["a=ssrc:"+T+" cname:"+c.cName,"a=ssrc:"+T+" msid:"+c.streamId+" "+c.trackId]}),R=h.map(function(T){return"a=ssrc-group:FID "+T.join(" ")}),C=["a=ssrc-group:SIM "+P.join(" ")];return R.concat(w).concat(C)},f}();function e(f,u){return(f.match(new RegExp(u,"gm"))||[]).map(function(h){return(h.match(new RegExp(u))||[]).slice(1)})}k.exports=function(f,u){var c=function(f){var u=function(f){return new Set(s(e(f,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(f),c=function(f){return new Map(e(f,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map(function(c){return c.reverse()}))}(f);return function(f){var u=d(s(e(f,"^a=msid:(.+) (.+)$")),2),c=u[0],h=u[1];return s(e(f,"^a=ssrc:(.+) cname:.+$")).map(function(O){return[O,c,h]})}(f).reduce(function(P,O){var w=O[0],R=O[1],C=O[2],T=P.get(C)||new t(C,R,function(f,u,c){return f.match(new RegExp("a=ssrc:"+u+" cname:(.+)"))[1]}(f,w)),g=c.get(w)||null;return T.addSSRC(w,g,u.has(w)),P.set(C,T)},new Map)}(f),h=Array.from(c.keys()),P=Array.from(u.keys()),O=o(h,P),w=o(P,h);s(O,function(M){return c.get(M)}).forEach(function(M){M.addSimulcastSSRCs(),u.set(M.trackId,M)}),P=Array.from(u.keys());var C=o(P,w),T=s(C,function(M){return u.get(M)}),g=!f.match(/a=rtpmap:[0-9]+ rtx/),_=s(T,function(M){return M.toSdpLines(g)}),L=s(new Set(f.split("\r\n").concat(_))),I="a=x-google-flag:conference";return f.match(I)||L.push(I),L.join("\r\n")}},5612:(k,S,a)=>{"use strict";var d=a(3028).getMediaSections,p=function(){function o(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return o.prototype.match=function(s){return this._midsToTrackIds.get(s.transceiver.mid)||null},o.prototype.update=function(s){var i=d(s,"(audio|video)");this._midsToTrackIds=i.reduce(function(t,e){var r=e.match(/^a=mid:(.+)$/m)||[],n=e.match(/^a=msid:.+ (.+)$/m)||[],l=r[1],v=n[1];return l&&v?t.set(l,v):t},this._midsToTrackIds)},o}();k.exports=p},3187:(k,S)=>{var a="1234567890abcdef";function p(o){for(var s="",i=0;i<32;i++)s+=a.charAt(Math.floor(Math.random()*a.length));return""+o+s}S.sessionSID=p("SS"),S.createSID=p},563:(k,S,a)=>{"use strict";var d=a(4911),p=d.guessBrowser,o=d.support,s=a(1222),i=s.isAndroid,t=s.isMobile,e=s.isNonChromiumEdge,r=s.rebrandedChromeBrowser,n=s.mobileWebKitBrowser,l=["crios","edg","edge","electron","headlesschrome"],v=["chrome","firefox"],y=["chrome","safari"],m=[];k.exports=function(){var u=p();if(!u)return!1;var c=r(u),h=n(u),P=i()?v:y;return!!u&&o()&&(!c||l.includes(c))&&!e(u)&&(!h||m.includes(h))&&(!t()||P.includes(u))}},1190:k=>{"use strict";var S=function(){function a(d,p,o){void 0===o&&(o=!0),Object.defineProperties(this,{_delay:{value:p,writable:!0},_fn:{value:d},_timeout:{value:null,writable:!0}}),o&&this.start()}return Object.defineProperty(a.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),a.prototype.setDelay=function(d){this._delay=d},a.prototype.start=function(){var d=this;this.isSet||(this._timeout=setTimeout(function(){var p=d._fn;d.clear(),p()},this._delay))},a.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},a.prototype.reset=function(){this.clear(),this.start()},a}();k.exports=S},7061:function(k,S,a){"use strict";var W,d=this&&this.__extends||(W=function(j,x){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,N){Y.__proto__=N}||function(Y,N){for(var re in N)Object.prototype.hasOwnProperty.call(N,re)&&(Y[re]=N[re])})(j,x)},function(j,x){if("function"!=typeof x&&null!==x)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function Y(){this.constructor=j}W(j,x),j.prototype=null===x?Object.create(x):(Y.prototype=x.prototype,new Y)}),p=a(8208),o={};S.createTwilioError=function(j,x){return x="string"==typeof x&&x?x:"Unknown error",o[j="number"==typeof j?j:0]?new o[j]:new p(j,x)};var s=function(W){function j(){var x=W.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenInvalidError=s,Object.defineProperty(o,20101,{value:s});var i=function(W){function j(){var x=W.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenHeaderInvalidError=i,Object.defineProperty(o,20102,{value:i});var t=function(W){function j(){var x=W.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenIssuerInvalidError=t,Object.defineProperty(o,20103,{value:t});var e=function(W){function j(){var x=W.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenExpiredError=e,Object.defineProperty(o,20104,{value:e});var r=function(W){function j(){var x=W.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenNotYetValidError=r,Object.defineProperty(o,20105,{value:r});var n=function(W){function j(){var x=W.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenGrantsInvalidError=n,Object.defineProperty(o,20106,{value:n});var l=function(W){function j(){var x=W.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.AccessTokenSignatureInvalidError=l,Object.defineProperty(o,20107,{value:l});var v=function(W){function j(){var x=W.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingConnectionError=v,Object.defineProperty(o,53e3,{value:v});var y=function(W){function j(){var x=W.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingConnectionDisconnectedError=y,Object.defineProperty(o,53001,{value:y});var m=function(W){function j(){var x=W.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingConnectionTimeoutError=m,Object.defineProperty(o,53002,{value:m});var f=function(W){function j(){var x=W.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingIncomingMessageInvalidError=f,Object.defineProperty(o,53003,{value:f});var u=function(W){function j(){var x=W.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingOutgoingMessageInvalidError=u,Object.defineProperty(o,53004,{value:u});var c=function(W){function j(){var x=W.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.SignalingServerBusyError=c,Object.defineProperty(o,53006,{value:c});var h=function(W){function j(){var x=W.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomNameInvalidError=h,Object.defineProperty(o,53100,{value:h});var P=function(W){function j(){var x=W.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomNameTooLongError=P,Object.defineProperty(o,53101,{value:P});var O=function(W){function j(){var x=W.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomNameCharsInvalidError=O,Object.defineProperty(o,53102,{value:O});var w=function(W){function j(){var x=W.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomCreateFailedError=w,Object.defineProperty(o,53103,{value:w});var R=function(W){function j(){var x=W.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomConnectFailedError=R,Object.defineProperty(o,53104,{value:R});var C=function(W){function j(){var x=W.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomMaxParticipantsExceededError=C,Object.defineProperty(o,53105,{value:C});var T=function(W){function j(){var x=W.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomNotFoundError=T,Object.defineProperty(o,53106,{value:T});var g=function(W){function j(){var x=W.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomMaxParticipantsOutOfRangeError=g,Object.defineProperty(o,53107,{value:g});var _=function(W){function j(){var x=W.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomTypeInvalidError=_,Object.defineProperty(o,53108,{value:_});var L=function(W){function j(){var x=W.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomTimeoutOutOfRangeError=L,Object.defineProperty(o,53109,{value:L});var I=function(W){function j(){var x=W.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomStatusCallbackMethodInvalidError=I,Object.defineProperty(o,53110,{value:I});var M=function(W){function j(){var x=W.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomStatusCallbackInvalidError=M,Object.defineProperty(o,53111,{value:M});var A=function(W){function j(){var x=W.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomStatusInvalidError=A,Object.defineProperty(o,53112,{value:A});var H=function(W){function j(){var x=W.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomRoomExistsError=H,Object.defineProperty(o,53113,{value:H});var U=function(W){function j(){var x=W.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomInvalidParametersError=U,Object.defineProperty(o,53114,{value:U});var F=function(W){function j(){var x=W.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomMediaRegionInvalidError=F,Object.defineProperty(o,53115,{value:F});var Z=function(W){function j(){var x=W.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomMediaRegionUnavailableError=Z,Object.defineProperty(o,53116,{value:Z});var ee=function(W){function j(){var x=W.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomSubscriptionOperationNotSupportedError=ee,Object.defineProperty(o,53117,{value:ee});var J=function(W){function j(){var x=W.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomCompletedError=J,Object.defineProperty(o,53118,{value:J});var V=function(W){function j(){var x=W.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomAudioOnlyFlagNotSupportedError=V,Object.defineProperty(o,53124,{value:V});var D=function(W){function j(){var x=W.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.RoomTrackKindNotSupportedError=D,Object.defineProperty(o,53125,{value:D});var E=function(W){function j(){var x=W.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantIdentityInvalidError=E,Object.defineProperty(o,53200,{value:E});var b=function(W){function j(){var x=W.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantIdentityTooLongError=b,Object.defineProperty(o,53201,{value:b});var B=function(W){function j(){var x=W.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantIdentityCharsInvalidError=B,Object.defineProperty(o,53202,{value:B});var Q=function(W){function j(){var x=W.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantMaxTracksExceededError=Q,Object.defineProperty(o,53203,{value:Q});var q=function(W){function j(){var x=W.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantNotFoundError=q,Object.defineProperty(o,53204,{value:q});var K=function(W){function j(){var x=W.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ParticipantDuplicateIdentityError=K,Object.defineProperty(o,53205,{value:K});var X=function(W){function j(){var x=W.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackInvalidError=X,Object.defineProperty(o,53300,{value:X});var se=function(W){function j(){var x=W.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackNameInvalidError=se,Object.defineProperty(o,53301,{value:se});var le=function(W){function j(){var x=W.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackNameTooLongError=le,Object.defineProperty(o,53302,{value:le});var he=function(W){function j(){var x=W.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackNameCharsInvalidError=he,Object.defineProperty(o,53303,{value:he});var me=function(W){function j(){var x=W.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackNameIsDuplicatedError=me,Object.defineProperty(o,53304,{value:me});var pe=function(W){function j(){var x=W.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.TrackServerTrackCapacityReachedError=pe,Object.defineProperty(o,53305,{value:pe});var ye=function(W){function j(){var x=W.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaClientLocalDescFailedError=ye,Object.defineProperty(o,53400,{value:ye});var ve=function(W){function j(){var x=W.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaServerLocalDescFailedError=ve,Object.defineProperty(o,53401,{value:ve});var ke=function(W){function j(){var x=W.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaClientRemoteDescFailedError=ke,Object.defineProperty(o,53402,{value:ke});var be=function(W){function j(){var x=W.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaServerRemoteDescFailedError=be,Object.defineProperty(o,53403,{value:be});var Ee=function(W){function j(){var x=W.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaNoSupportedCodecError=Ee,Object.defineProperty(o,53404,{value:Ee});var ae=function(W){function j(){var x=W.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaConnectionError=ae,Object.defineProperty(o,53405,{value:ae});var $=function(W){function j(){var x=W.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.MediaDTLSTransportFailedError=$,Object.defineProperty(o,53407,{value:$});var te=function(W){function j(){var x=W.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ConfigurationAcquireFailedError=te,Object.defineProperty(o,53500,{value:te});var ne=function(W){function j(){var x=W.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(x,j.prototype),x}return d(j,W),j}(p);S.ConfigurationAcquireTurnFailedError=ne,Object.defineProperty(o,53501,{value:ne})},8208:function(k){"use strict";var o,S=this&&this.__extends||(o=function(s,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(s,i)},function(s,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=s}o(s,i),s.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}),a=this&&this.__read||function(o,s){var i="function"==typeof Symbol&&o[Symbol.iterator];if(!i)return o;var e,n,t=i.call(o),r=[];try{for(;(void 0===s||s-- >0)&&!(e=t.next()).done;)r.push(e.value)}catch(l){n={error:l}}finally{try{e&&!e.done&&(i=t.return)&&i.call(t)}finally{if(n)throw n.error}}return r},d=this&&this.__spreadArray||function(o,s){for(var i=0,t=s.length,e=o.length;i<t;i++,e++)o[e]=s[i];return o},p=function(o){function s(i){var t=this,e=[].slice.call(arguments,1);t=o.apply(this,d([],a(e)))||this,Object.setPrototypeOf(t,s.prototype);var r=Error.apply(t,e);return r.name="TwilioError",Object.defineProperty(t,"code",{value:i,enumerable:!0}),Object.getOwnPropertyNames(r).forEach(function(n){Object.defineProperty(this,n,{value:r[n],enumerable:!0})},t),t}return S(s,o),s.prototype.toString=function(){return this.name+" "+this.code+(this.message?": "+this.message:"")},s}(Error);k.exports=p},6901:(k,S,a)=>{"use strict";var p=a(3761).isNonArrayObject,o=a(9917),s=o.typeErrors,i=o.clientTrackSwitchOffControl,t=o.videoContentPreferencesMode,e=o.subscriptionMode,r=o.trackPriority,n=o.trackSwitchOffMode;function y(f,u,c){return void 0===c&&(c=[]),void 0===f?null:null!==f&&p(f)?c.reduce(function(h,P){var O=P.prop,w=P.type,R=P.values;if(h||!(O in f))return h;var C=f[O];return w&&typeof C!==w||"number"===w&&isNaN(C)?s.INVALID_TYPE(u+"."+O,w):Array.isArray(R)&&!R.includes(C)?s.INVALID_VALUE(u+"."+O,R):h},null):s.INVALID_TYPE(u,"object")}S.kG=function(f){var u=y(f,"options.bandwidthProfile");return!f||u||(u=y(f.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(t)},{prop:"dominantSpeakerPriority",values:Object.values(r)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(i)},{prop:"trackSwitchOffMode",values:Object.values(n)}]))?u:f.video?"maxTracks"in f.video&&"clientTrackSwitchOffControl"in f.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in f.video&&"contentPreferencesMode"in f.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):function(f){var u="options.bandwidthProfile.video.renderDimensions",c=y(f,u);return f?c||Object.values(r).reduce(function(h,P){return h||y(f[P],u+"."+P,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):c}(f.video.renderDimensions):null},S.Wv=function(f,u){if(!(f instanceof u.LocalAudioTrack||f instanceof u.LocalDataTrack||f instanceof u.LocalVideoTrack||f instanceof u.MediaStreamTrack))throw s.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}},6828:k=>{var S=function(){},a="undefined",d=typeof window!==a&&typeof window.navigator!==a&&/Trident\/|MSIE /.test(window.navigator.userAgent),p=["trace","debug","info","warn","error"];function o(m,f){var u=m[f];if("function"==typeof u.bind)return u.bind(m);try{return Function.prototype.bind.call(u,m)}catch(c){return function(){return Function.prototype.apply.apply(u,[m,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(m){return"debug"===m&&(m="log"),typeof console!==a&&("trace"===m&&d?s:void 0!==console[m]?o(console,m):void 0!==console.log?o(console,"log"):S)}function t(m,f){for(var u=0;u<p.length;u++){var c=p[u];this[c]=u<m?S:this.methodFactory(c,m,f)}this.log=this.debug}function e(m,f,u){return function(){typeof console!==a&&(t.call(this,f,u),this[m].apply(this,arguments))}}function r(m,f,u){return i(m)||e.apply(this,arguments)}function n(m,f,u){var h,c=this,P="loglevel";function w(){var C;if(typeof window!==a&&P){try{C=window.localStorage[P]}catch(_){}if(typeof C===a)try{var T=window.document.cookie,g=T.indexOf(encodeURIComponent(P)+"=");-1!==g&&(C=/^([^;]+)/.exec(T.slice(g))[1])}catch(_){}return void 0===c.levels[C]&&(C=void 0),C}}"string"==typeof m?P+=":"+m:"symbol"==typeof m&&(P=void 0),c.name=m,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=u||r,c.getLevel=function(){return h},c.setLevel=function(C,T){if("string"==typeof C&&void 0!==c.levels[C.toUpperCase()]&&(C=c.levels[C.toUpperCase()]),!("number"==typeof C&&C>=0&&C<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+C;if(h=C,!1!==T&&function(C){var T=(p[C]||"silent").toUpperCase();if(typeof window!==a&&P){try{return void(window.localStorage[P]=T)}catch(g){}try{window.document.cookie=encodeURIComponent(P)+"="+T+";"}catch(g){}}}(C),t.call(c,C,m),typeof console===a&&C<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(C){w()||c.setLevel(C,!1)},c.enableAll=function(C){c.setLevel(c.levels.TRACE,C)},c.disableAll=function(C){c.setLevel(c.levels.SILENT,C)};var R=w();null==R&&(R=null==f?"WARN":f),c.setLevel(R,!1)}var l=new n,v={};l.getLogger=function(f){if("symbol"!=typeof f&&"string"!=typeof f||""===f)throw new TypeError("You must supply a name when creating a logger.");var u=v[f];return u||(u=v[f]=new n(f,l.getLevel(),l.methodFactory)),u};var y=typeof window!==a?window.log:void 0;l.noConflict=function(){return typeof window!==a&&window.log===l&&(window.log=y),l},l.getLoggers=function(){return v},l.default=l,k.exports=l},9057:k=>{"use strict";var S="undefined"!=typeof AudioContext?AudioContext:"undefined"!=typeof webkitAudioContext?webkitAudioContext:null,a=function(){function d(p){p=Object.assign({AudioContext:S},p),Object.defineProperties(this,{_AudioContext:{value:p.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:d}})}return d.prototype.getOrCreate=function(p){if(!this._holders.has(p)&&(this._holders.add(p),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch(o){}return this._audioContext},d.prototype.release=function(p){this._holders.has(p)&&(this._holders.delete(p),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},d}();k.exports=new a},1923:k=>{"use strict";k.exports=function(d,p,o){o="number"==typeof o?o:250;var s=d.createMediaStreamSource(p),i=d.createAnalyser();i.fftSize=2048,s.connect(i);var t=new Uint8Array(i.fftSize),e=!1;return setTimeout(function(){e=!0},o),function r(){return e?Promise.resolve(!0):(i.getByteTimeDomainData(t),t.some(function(n){return 128!==n&&0!==n})?Promise.resolve(!1):function(d){return d="number"==typeof d?d:0,new Promise(function(p){return setTimeout(p,d)})}().then(r))}().then(function(n){return s.disconnect(),n},function(n){throw s.disconnect(),n})}},8201:(k,S,a)=>{"use strict";var d=a(1923);k.exports=function(o,s,i,t,e){t="number"==typeof t?t:3;var r=0,n=a(9057),l={},v=n.getOrCreate(l);return function y(){return s(i).then(function(m){return(i.audio?d(v,m,e).catch(function(u){return o.warn("Encountered an error while detecting silence",u),!0}):Promise.resolve(!1)).then(function(u){return u?t<=0?(o.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),m):(o.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++r+"."),m.getTracks().forEach(function(c){return c.stop()}),t--,y()):(o.info("Got a non-silent audio MediaStreamTrack; returning it."),m)})})}().then(function(m){return n.release(l),m},function(m){throw n.release(l),m})}},633:(k,S,a)=>{"use strict";var d=a(4911).flatMap,p=a(4911).guessBrowser,o=a(4911).guessBrowserVersion,s=a(1225).getSdpFormat,i=p(),t=o(),e="chrome"===i,r="firefox"===i,n="safari"===i,l=e?t.major:null;function u(g){var _=Array.from(g.values()).find(function(F){return"candidate-pair"===F.type&&F.nominated});if(!_)return null;var L=g.get(_.localCandidateId),I=g.get(_.remoteCandidateId),M=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],A=M.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),H=L?A.reduce(function(F,Z){return F[Z.key]=typeof L[Z.key]===Z.type?L[Z.key]:"deleted"!==Z.key&&null,F},{}):null,U=I?M.reduce(function(F,Z){return F[Z.key]=typeof I[Z.key]===Z.type?I[Z.key]:null,F},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(F){return"inprogress"===F?"in-progress":F}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(F,Z){return F[Z.key]=typeof _[Z.key]===Z.type?Z.fixup?Z.fixup(_[Z.key]):_[Z.key]:null,F},{localCandidate:H,remoteCandidate:U})}function c(g){var _=Array.from(g.values()).find(function(Z){return"candidate-pair"===Z.type&&Z.nominated});if(!_)return null;var L=g.get(_.localCandidateId),I=g.get(_.remoteCandidateId),M=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],A=M.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),H={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},U=L?A.reduce(function(Z,ee){var J=ee.ffKeys&&ee.ffKeys.find(function(V){return V in L})||ee.key;return Z[ee.key]=typeof L[J]===ee.type?"candidateType"===J&&H[L[J]]||L[J]:"deleted"!==J&&null,Z},{}):null,F=I?M.reduce(function(Z,ee){var J=ee.ffKeys&&ee.ffKeys.find(function(V){return V in I})||ee.key;return Z[ee.key]=typeof I[J]===ee.type?"candidateType"===J&&H[I[J]]||I[J]:null,Z},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(Z,ee){return Z[ee.key]=typeof _[ee.key]===ee.type?_[ee.key]:null,Z},{localCandidate:U,remoteCandidate:F})}function h(g,_,L){var I="local"===L?"getSenders":"getReceivers";return g[I]?g[I]().map(function(A){return A.track}).filter(function(A){return A&&A.kind===_}):d(g["local"===L?"getLocalStreams":"getRemoteStreams"](),function(A){return A["audio"===_?"getAudioTracks":"getVideoTracks"]()})}function O(g,_){return new Promise(function(L,I){l&&l<67?g.getStats(function(M){L([R(M,_)])},null,I):g.getStats(_).then(function(M){L(function(g){var _=null,L=[],I=null,M=null,A=null,H=null,U=null;g.forEach(function(V){switch(V.type){case"inbound-rtp":_=V;break;case"outbound-rtp":L.push(V);break;case"media-source":U=V;break;case"track":A=V;break;case"codec":H=V;break;case"remote-inbound-rtp":I=V;break;case"remote-outbound-rtp":M=V}});var F=A&&A.remoteSource,ee=[],J=F?M:I;return(F?[_]:L).forEach(function(V){var D={},E=[V,U,A,H,J&&J.ssrc===V.ssrc?J:null];function b(Y){var N=E.find(function(re){return re&&void 0!==re[Y]})||null;return N?N[Y]:null}var B=b("ssrc");"number"==typeof B&&(D.ssrc=String(B));var Q=b("timestamp");D.timestamp=Math.round(Q);var q=b("mimeType");"string"==typeof q&&(q=q.split("/"),D.codecName=q[q.length-1]);var K=b("roundTripTime");"number"==typeof K&&(D.roundTripTime=Math.round(1e3*K));var X=b("jitter");"number"==typeof X&&(D.jitter=Math.round(1e3*X));var se=b("frameWidth");"number"==typeof se&&(F?D.frameWidthReceived=se:(D.frameWidthSent=se,D.frameWidthInput=A.frameWidth));var le=b("frameHeight");"number"==typeof le&&(F?D.frameHeightReceived=le:(D.frameHeightSent=le,D.frameHeightInput=A.frameHeight));var he=b("framesPerSecond");"number"==typeof he&&(D[F?"frameRateReceived":"frameRateSent"]=he);var me=b("bytesReceived");"number"==typeof me&&(D.bytesReceived=me);var pe=b("bytesSent");"number"==typeof pe&&(D.bytesSent=pe);var ye=b("packetsLost");"number"==typeof ye&&(D.packetsLost=ye);var ve=b("packetsReceived");"number"==typeof ve&&(D.packetsReceived=ve);var ke=b("packetsSent");"number"==typeof ke&&(D.packetsSent=ke);var be=b("audioLevel");"number"==typeof be&&(be=Math.round(32767*be),F?D.audioOutputLevel=be:D.audioInputLevel=be);var Ee=b("totalPacketSendDelay");"number"==typeof Ee&&(D.totalPacketSendDelay=Ee);var ae=b("totalEncodeTime");"number"==typeof ae&&(D.totalEncodeTime=ae);var $=b("framesEncoded");"number"==typeof $&&(D.framesEncoded=$);var te=b("estimatedPlayoutTimestamp");"number"==typeof te&&(D.estimatedPlayoutTimestamp=te);var ne=b("totalDecodeTime");"number"==typeof ne&&(D.totalDecodeTime=ne);var W=b("framesDecoded");"number"==typeof W&&(D.framesDecoded=W);var j=b("jitterBufferDelay");"number"==typeof j&&(D.jitterBufferDelay=j);var x=b("jitterBufferEmittedCount");"number"==typeof x&&(D.jitterBufferEmittedCount=x),ee.push(D)}),ee}(M))},I)})}function R(g,_){var L=g.result().find(function(M){return"ssrc"===M.type&&M.stat("googTrackId")===_.id}),I={};return L&&(I.timestamp=Math.round(Number(L.timestamp)),I=L.names().reduce(function(M,A){switch(A){case"googCodecName":M.codecName=L.stat(A);break;case"googRtt":M.roundTripTime=Number(L.stat(A));break;case"googJitterReceived":M.jitter=Number(L.stat(A));break;case"googFrameWidthInput":M.frameWidthInput=Number(L.stat(A));break;case"googFrameHeightInput":M.frameHeightInput=Number(L.stat(A));break;case"googFrameWidthSent":M.frameWidthSent=Number(L.stat(A));break;case"googFrameHeightSent":M.frameHeightSent=Number(L.stat(A));break;case"googFrameWidthReceived":M.frameWidthReceived=Number(L.stat(A));break;case"googFrameHeightReceived":M.frameHeightReceived=Number(L.stat(A));break;case"googFrameRateInput":M.frameRateInput=Number(L.stat(A));break;case"googFrameRateSent":M.frameRateSent=Number(L.stat(A));break;case"googFrameRateReceived":M.frameRateReceived=Number(L.stat(A));break;case"ssrc":M[A]=L.stat(A);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":M[A]=Number(L.stat(A))}return M},I)),I}function T(g,_){g=g||new Map;var L=null,I=null;g.forEach(function(ve){if(!ve.isRemote)switch(ve.type){case"inbound-rtp":L=ve,I=g.get(ve.remoteId);break;case"outbound-rtp":I=ve,L=g.get(ve.remoteId)}});var M=_?L:I,A=_?I:L;function H(ve){return M&&void 0!==M[ve]?M[ve]:A&&void 0!==A[ve]?A[ve]:null}var U={},F=H("timestamp");U.timestamp=Math.round(F);var Z=H("ssrc");"number"==typeof Z&&(U.ssrc=String(Z));var ee=H("bytesSent");"number"==typeof ee&&(U.bytesSent=ee);var J=H("packetsLost");"number"==typeof J&&(U.packetsLost=J);var V=H("packetsSent");"number"==typeof V&&(U.packetsSent=V);var D=H("roundTripTime");"number"==typeof D&&(U.roundTripTime=Math.round(1e3*D));var E=H("jitter");"number"==typeof E&&(U.jitter=Math.round(1e3*E));var b=H("framerateMean");"number"==typeof b&&(U.frameRateSent=Math.round(b));var B=H("bytesReceived");"number"==typeof B&&(U.bytesReceived=B);var Q=H("packetsReceived");"number"==typeof Q&&(U.packetsReceived=Q);var q=H("framerateMean");"number"==typeof q&&(U.frameRateReceived=Math.round(q));var K=H("totalPacketSendDelay");"number"==typeof K&&(U.totalPacketSendDelay=K);var X=H("totalEncodeTime");"number"==typeof X&&(U.totalEncodeTime=X);var se=H("framesEncoded");"number"==typeof se&&(U.framesEncoded=se);var le=H("estimatedPlayoutTimestamp");"number"==typeof le&&(U.estimatedPlayoutTimestamp=le);var he=H("totalDecodeTime");"number"==typeof he&&(U.totalDecodeTime=he);var me=H("framesDecoded");"number"==typeof me&&(U.framesDecoded=me);var pe=H("jitterBufferDelay");"number"==typeof pe&&(U.jitterBufferDelay=pe);var ye=H("jitterBufferEmittedCount");return"number"==typeof ye&&(U.jitterBufferEmittedCount=ye),U}k.exports=function(g,_){return g&&"function"==typeof g.getStats?function(g,_){var L=h(g,"audio","local"),I=h(g,"video","local"),M=h(g,"audio"),A=h(g,"video"),H={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},U=d([[L,"localAudioTrackStats",!1],[I,"localVideoTrackStats",!1],[M,"remoteAudioTrackStats",!0],[A,"remoteVideoTrackStats",!0]],function(F){var ee=F[1],J=F[2];return F[0].map(function(V){return function(g,_,L){return void 0!==(L=L||{}).testForChrome||e?O(g,_):void 0!==L.testForFirefox||r?function(g,_,L){return new Promise(function(I,M){g.getStats(_).then(function(A){I([T(A,L)])},M)})}(g,_,L.isRemote):void 0!==L.testForSafari||n?void 0!==L.testForSafari||"unified"===s()?O(g,_):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(g,V,Object.assign({isRemote:J},_)).then(function(D){D.forEach(function(E){E.trackId=V.id,H[ee].push(E)})})})});return Promise.all(U).then(function(){return function(g,_){return void 0!==(_=_||{}).testForChrome||e||void 0!==_.testForSafari||n?g.getStats().then(u):void 0!==_.testForFirefox||r?g.getStats().then(c):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(g,_)}).then(function(F){return H.activeIceCandidatePair=F,H})}(g,_):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},2214:k=>{"use strict";k.exports=function(a){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia?(a=a||{audio:!0,video:!0},navigator.mediaDevices.getUserMedia(a)):Promise.reject(new Error("getUserMedia is not supported"))}},4135:(k,S,a)=>{"use strict";var d={};Object.defineProperties(d,{getStats:{enumerable:!0,value:a(633)},getUserMedia:{enumerable:!0,value:a(2214)},MediaStream:{enumerable:!0,value:a(5308)},MediaStreamTrack:{enumerable:!0,value:a(5476)},RTCIceCandidate:{enumerable:!0,value:a(9033)},RTCPeerConnection:{enumerable:!0,value:a(4916)},RTCSessionDescription:{enumerable:!0,value:a(2842)}}),k.exports=d},5308:k=>{"use strict";k.exports="function"==typeof MediaStream?MediaStream:function(){throw new Error("MediaStream is not supported")}},5476:k=>{"use strict";k.exports="function"==typeof MediaStreamTrack?MediaStreamTrack:function(){throw new Error("MediaStreamTrack is not supported")}},9033:k=>{"use strict";k.exports="function"==typeof RTCIceCandidate?RTCIceCandidate:function(){throw new Error("RTCIceCandidate is not supported")}},1107:(k,S,a)=>{"use strict";var d=a(932),p=a(7328),o=a(1732).inherits,s=a(2774),i=a(5308),t=a(7845),e=a(1225),r=a(4911),n=a(4911).isIOSChrome,l="unified"===e.getSdpFormat();function v(w,R){if(!(this instanceof v))return new v(w,R);p.call(this),w=w||{};var C=Object.assign(w.iceTransportPolicy?{iceTransports:w.iceTransportPolicy}:{},w);r.interceptEvent(this,"datachannel"),r.interceptEvent(this,"signalingstatechange");var T=e.getSdpFormat(C.sdpSemantics),g=new RTCPeerConnection(C,R);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new i},_peerConnection:{value:g},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:T},_senders:{value:new Map},_signalingStateLatch:{value:new s},_tracksToSSRCs:{value:new Map,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:g.localDescription}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:g.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":g.signalingState}}});var _=this;g.addEventListener("datachannel",function(I){P(I.channel),_.dispatchEvent(I)}),g.addEventListener("signalingstatechange",function(){"stable"===g.signalingState&&(_._appliedTracksToSSRCs=new Map(_._tracksToSSRCs)),!_._pendingLocalOffer&&!_._pendingRemoteOffer&&_.dispatchEvent.apply(_,arguments)}),g.ontrack=function(){},"function"!=typeof RTCPeerConnection.prototype.addTrack&&g.addStream(this._localStream),r.proxyProperties(RTCPeerConnection.prototype,this,g)}function y(w,R,C){var A,U,_=R?w._pendingLocalOffer:w._pendingRemoteOffer,I=R?"have-local-offer":"have-remote-offer",M=R?"setLocalDescription":"setRemoteDescription";if(!R&&(R?w._pendingRemoteOffer:w._pendingLocalOffer)&&"answer"===C.type)A=function(w,R){return w._peerConnection.setLocalDescription(w._pendingLocalOffer).then(function(){return w._pendingLocalOffer=null,w.setRemoteDescription(R)}).then(function(){w._signalingStateLatch.lower()})}(w,C);else if("offer"===C.type){if(w.signalingState!==I&&"stable"!==w.signalingState)return Promise.reject(new Error("Cannot set "+(R?"local":"remote")+" offer in state "+w.signalingState));!_&&"low"===w._signalingStateLatch.state&&w._signalingStateLatch.raise();var H=w.signalingState;U=u(C),R?w._pendingLocalOffer=U:w._pendingRemoteOffer=U,A=Promise.resolve(),w.signalingState!==H&&A.then(function(){w.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===C.type&&(w.signalingState!==I?A=Promise.reject(new Error("Cannot rollback "+(R?"local":"remote")+" description in "+w.signalingState)):(R?w._pendingLocalOffer=null:w._pendingRemoteOffer=null,w._rolledBackTracksToSSRCs=new Map(w._tracksToSSRCs),w._tracksToSSRCs=new Map(w._appliedTracksToSSRCs),(A=Promise.resolve()).then(function(){w.dispatchEvent(new Event("signalingstatechange"))})));return A||w._peerConnection[M](u(C))}function f(w,R){return!!w.getTransceivers().find(function(C){return C.receiver&&C.receiver.track&&C.receiver.track.kind===R})}function u(w){return w instanceof d&&w._description?w._description:new RTCSessionDescription(w)}function c(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function P(w){return Object.defineProperty(w,"maxRetransmits",{value:65535===w.maxRetransmits?null:w.maxRetransmits}),c()&&Object.defineProperty(w,"maxPacketLifeTime",{value:65535===w.maxRetransmitTime?null:w.maxRetransmitTime}),w}function O(w,R,C){return"unified"===w?e.updateUnifiedPlanTrackIdsToSSRCs(R,C):e.updatePlanBTrackIdsToSSRCs(R,C)}o(v,p),"function"!=typeof RTCPeerConnection.prototype.addTrack?(v.prototype.addTrack=function(){var R=[].slice.call(arguments),C=R[0];if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+C.id+", "+C.kind+"]: RTCPeerConnection is closed");var T=this._senders.get(C);if(T&&T.track)throw new Error("Cannot add MediaStreamTrack ["+C.id+", "+C.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(C),this._peerConnection.addStream(this._localStream),T=new t(C),this._senders.set(C,T),T},v.prototype.removeTrack=function(R){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");var C=R.track;!C||(R=this._senders.get(C))&&R.track&&(R.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(C),this._peerConnection.addStream(this._localStream))},v.prototype.getSenders=function(){return Array.from(this._senders.values())}):v.prototype.removeTrack=function(R){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");try{this._peerConnection.removeTrack(R)}catch(C){}},v.prototype.addIceCandidate=function(R){var T,C=[].slice.call(arguments),g=this;return T="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return g._peerConnection.addIceCandidate(R)}):this._peerConnection.addIceCandidate(R),C.length>1?r.legacyPromise(T,C[1],C[2]):T},v.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},v.prototype.createAnswer=function(){var C,R=[].slice.call(arguments),T=this;return C=this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return T._signalingStateLatch.lower(),T._peerConnection.createAnswer()}).then(function(_){return T._pendingRemoteOffer=null,T._rolledBackTracksToSSRCs.clear(),new d({type:"answer",sdp:O(T._sdpFormat,T._tracksToSSRCs,_.sdp)})},function(_){throw T._pendingRemoteOffer=null,_}):this._peerConnection.createAnswer().then(function(g){return T._rolledBackTracksToSSRCs.clear(),new d({type:"answer",sdp:O(T._sdpFormat,T._tracksToSSRCs,g.sdp)})}),R.length>1?r.legacyPromise(C,R[0],R[1]):C},v.prototype.createOffer=function(){var R=[].slice.call(arguments),C=(R.length>1?R[2]:R[0])||{},T=this;if(n()){if(C.offerToReceiveVideo&&!this._audioTransceiver&&(!l||!f(this,"audio"))){delete C.offerToReceiveAudio;try{this._audioTransceiver=l?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(_){return Promise.reject(_)}}if(C.offerToReceiveVideo&&!this._videoTransceiver&&(!l||!f(this,"video"))){delete C.offerToReceiveVideo;try{this._videoTransceiver=l?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(_){return Promise.reject(_)}}}var g=this._peerConnection.createOffer(C).then(function(_){return T._rolledBackTracksToSSRCs.clear(),new d({type:_.type,sdp:O(T._sdpFormat,T._tracksToSSRCs,_.sdp)})});return R.length>1?r.legacyPromise(g,R[0],R[1]):g},v.prototype.createDataChannel=function(R,C){var w;w=C,w=Object.assign({},w),c()&&"maxPacketLifeTime"in w&&(w.maxRetransmitTime=w.maxPacketLifeTime);var T=this._peerConnection.createDataChannel(R,C=w);return P(T),T},v.prototype.setLocalDescription=function(){var R=[].slice.call(arguments),C=R[0];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var T=y(this,!0,C);return R.length>1?r.legacyPromise(T,R[1],R[2]):T},v.prototype.setRemoteDescription=function(){var R=[].slice.call(arguments),C=R[0];this._rolledBackTracksToSSRCs.clear();var T=y(this,!1,C);return R.length>1?r.legacyPromise(T,R[1],R[2]):T},r.delegateMethods(RTCPeerConnection.prototype,v.prototype,"_peerConnection"),k.exports=v},2294:(k,S,a)=>{"use strict";var d=a(7328),p=a(1512),o=a(1732).inherits,s=a(1225).updateUnifiedPlanTrackIdsToSSRCs,i=a(4911),t="object"==typeof navigator&&navigator.userAgent&&(navigator.userAgent.match(/Firefox\/61/)||navigator.userAgent.match(/Firefox\/62/));function e(v){if(!(this instanceof e))return new e(v);d.call(this),i.interceptEvent(this,"signalingstatechange");var y=new RTCPeerConnection(v);Object.defineProperties(this,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:y},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},localDescription:{enumerable:!0,get:function(){return l(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.signalingState}}});var f,m=this;y.addEventListener("signalingstatechange",function(){if(!m._rollingBack&&m.signalingState!==f){f=m.signalingState;var c=m.dispatchEvent.apply.bind(m.dispatchEvent,m,arguments);m._isClosed?setTimeout(c):c()}}),i.proxyProperties(RTCPeerConnection.prototype,this,y)}function r(v,y,m){var f=y?"setLocalDescription":"setRemoteDescription";return v._rollingBack=!0,v._peerConnection[f](new p({type:"rollback"})).then(m).then(function(c){return v._rollingBack=!1,c},function(c){throw v._rollingBack=!1,c})}function n(v,y,m){if(!v._initiallyNegotiatedDtlsRole&&"offer"!==y.type){var f=y.sdp.match(/a=setup:([a-z]+)/);if(f){var u=f[1];v._initiallyNegotiatedDtlsRole=m?{active:"passive",passive:"active"}[u]:u}}}function l(v,y){return v&&"answer"===v.type&&y?new p({type:v.type,sdp:v.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+y)}):v}o(e,d),Object.defineProperty(e.prototype,"peerIdentity",{enumerable:!0,value:Promise.resolve({idp:"",name:""})}),t&&(e.prototype.addTrack=function(){var y=arguments[0],m=this._peerConnection.addTrack.apply(this._peerConnection,arguments);return m.replaceTrack(y),m}),e.prototype.createAnswer=function(){var m,y=[].slice.call(arguments),f=this;return m=this._peerConnection.createAnswer().then(function(c){return n(f,c),l(c,f._initiallyNegotiatedDtlsRole)}),"function"==typeof y[0]?i.legacyPromise(m,y[0],y[1]):m},e.prototype.createOffer=function(){var f,y=[].slice.call(arguments),m=(y.length>1?y[2]:y[0])||{},u=this;if("have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState){var c="have-local-offer"===this.signalingState;f=r(this,c,function(){return u.createOffer(m)})}else f=u._peerConnection.createOffer(m);return f=f.then(function(h){return new p({type:h.type,sdp:s(u._tracksToSSRCs,h.sdp)})}),y.length>1?i.legacyPromise(f,y[0],y[1]):f},e.prototype.setLocalDescription=function(){var f,y=[].slice.call(arguments),m=y[0];return m&&"answer"===m.type&&"have-local-offer"===this.signalingState&&(f=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),f?y.length>1?i.legacyPromise(f,y[1],y[2]):f:this._peerConnection.setLocalDescription.apply(this._peerConnection,y)},e.prototype.setRemoteDescription=function(){var f,y=[].slice.call(arguments),m=y[0],u=this;return m&&"have-remote-offer"===this.signalingState&&("answer"===m.type?f=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===m.type&&(f=r(this,!1,function(){return u._peerConnection.setRemoteDescription(m)}))),f||(f=this._peerConnection.setRemoteDescription(m)),f=f.then(function(){n(u,m,!0)}),y.length>1?i.legacyPromise(f,y[1],y[2]):f},e.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},i.delegateMethods(RTCPeerConnection.prototype,e.prototype,"_peerConnection"),k.exports=e},4916:(k,S,a)=>{"use strict";if("function"==typeof RTCPeerConnection)switch((0,a(4911).guessBrowser)()){case"chrome":k.exports=a(1107);break;case"firefox":k.exports=a(2294);break;case"safari":k.exports=a(1453);break;default:k.exports=RTCPeerConnection}else k.exports=function(){throw new Error("RTCPeerConnection is not supported")}},1453:(k,S,a)=>{"use strict";var d=a(7328),p=a(1732).inherits,o=a(2774),s=a(1225),i=a(4911),t="unified"===s.getSdpFormat(),e=t?s.updateUnifiedPlanTrackIdsToSSRCs:s.updatePlanBTrackIdsToSSRCs;function r(m){if(!(this instanceof r))return new r(m);d.call(this),i.interceptEvent(this,"datachannel"),i.interceptEvent(this,"iceconnectionstatechange"),i.interceptEvent(this,"signalingstatechange"),i.interceptEvent(this,"track");var f=new RTCPeerConnection(m);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:f},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new o},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription}},iceConnectionState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState}},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState}}});var u=this;f.addEventListener("datachannel",function(h){y(h.channel),u.dispatchEvent(h)}),f.addEventListener("iceconnectionstatechange",function(){u._isClosed||u.dispatchEvent.apply(u,arguments)}),f.addEventListener("signalingstatechange",function(){u._isClosed||("stable"===f.signalingState&&(u._appliedTracksToSSRCs=new Map(u._tracksToSSRCs)),!u._pendingLocalOffer&&!u._pendingRemoteOffer&&u.dispatchEvent.apply(u,arguments))}),f.addEventListener("track",function(h){u._pendingRemoteOffer=null,u.dispatchEvent(h)}),i.proxyProperties(RTCPeerConnection.prototype,this,f)}function n(m,f,u){var T,P=f?m._pendingLocalOffer:m._pendingRemoteOffer,w=f?"have-local-offer":"have-remote-offer",R=f?"setLocalDescription":"setRemoteDescription";if(!f&&(f?m._pendingRemoteOffer:m._pendingLocalOffer)&&"answer"===u.type)return function(m,f){return m._peerConnection.setLocalDescription(m._pendingLocalOffer).then(function(){return m._pendingLocalOffer=null,m.setRemoteDescription(f)}).then(function(){m._signalingStateLatch.lower()})}(m,u);if("offer"===u.type){if(m.signalingState!==w&&"stable"!==m.signalingState)return Promise.reject(new Error("Cannot set "+(f?"local":"remote")+" offer in state "+m.signalingState));!P&&"low"===m._signalingStateLatch.state&&m._signalingStateLatch.raise();var C=m.signalingState;return T=u,f?m._pendingLocalOffer=T:m._pendingRemoteOffer=T,m.signalingState!==C?Promise.resolve().then(function(){m.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}return"rollback"===u.type?m.signalingState!==w?Promise.reject(new Error("Cannot rollback "+(f?"local":"remote")+" description in "+m.signalingState)):(f?m._pendingLocalOffer=null:m._pendingRemoteOffer=null,m._rolledBackTracksToSSRCs=new Map(m._tracksToSSRCs),m._tracksToSSRCs=new Map(m._appliedTracksToSSRCs),Promise.resolve().then(function(){m.dispatchEvent(new Event("signalingstatechange"))})):m._peerConnection[R](u)}function v(m,f){return!!m.getTransceivers().find(function(u){return u.receiver&&u.receiver.track&&u.receiver.track.kind===f})}function y(m){return Object.defineProperties(m,{maxPacketLifeTime:{value:65535===m.maxPacketLifeTime?null:m.maxPacketLifeTime},maxRetransmits:{value:65535===m.maxRetransmits?null:m.maxRetransmits}})}p(r,d),r.prototype.addIceCandidate=function(f){var u=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return u._peerConnection.addIceCandidate(f)}):this._peerConnection.addIceCandidate(f)},r.prototype.createOffer=function(f){f=Object.assign({},f);var u=this;if(f.offerToReceiveVideo&&!this._audioTransceiver&&(!t||!v(this,"audio"))){delete f.offerToReceiveAudio;try{this._audioTransceiver=t?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(c){return Promise.reject(c)}}if(f.offerToReceiveVideo&&!this._videoTransceiver&&(!t||!v(this,"video"))){delete f.offerToReceiveVideo;try{this._videoTransceiver=t?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(c){return Promise.reject(c)}}return this._peerConnection.createOffer(f).then(function(c){return u._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:c.type,sdp:e(u._tracksToSSRCs,c.sdp)})})},r.prototype.createAnswer=function(f){var u=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return u._signalingStateLatch.lower(),u._peerConnection.createAnswer()}).then(function(h){return u._pendingRemoteOffer=null,u._rolledBackTracksToSSRCs.clear(),t?new RTCSessionDescription({type:h.type,sdp:e(u._tracksToSSRCs,h.sdp)}):h},function(h){throw u._pendingRemoteOffer=null,h}):this._peerConnection.createAnswer(f).then(function(h){return u._rolledBackTracksToSSRCs.clear(),t?new RTCSessionDescription({type:h.type,sdp:e(u._tracksToSSRCs,h.sdp)}):h})},r.prototype.createDataChannel=function(f,u){var c=this._peerConnection.createDataChannel(f,u);return y(c),c},r.prototype.removeTrack=function(f){f.replaceTrack(null),this._peerConnection.removeTrack(f)},r.prototype.setLocalDescription=function(f){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),n(this,!0,f)},r.prototype.setRemoteDescription=function(f){return this._rolledBackTracksToSSRCs.clear(),n(this,!1,f)},r.prototype.close=function(){if(!this._isClosed){this._isClosed=!0,this._peerConnection.close();var f=this;setTimeout(function(){f.dispatchEvent(new Event("iceconnectionstatechange")),f.dispatchEvent(new Event("signalingstatechange"))})}},i.delegateMethods(RTCPeerConnection.prototype,r.prototype,"_peerConnection"),k.exports=r},7845:k=>{"use strict";k.exports=function(a){Object.defineProperties(this,{track:{enumerable:!0,value:a,writable:!0}})}},932:k=>{"use strict";k.exports=function S(a){if(!(this instanceof S))return new S(a);var d=a&&"rollback"===a.type?null:new RTCSessionDescription(a);Object.defineProperties(this,{_description:{get:function(){return d}},sdp:{enumerable:!0,value:d?d.sdp:a.sdp},type:{enumerable:!0,value:d?d.type:a.type}})}},1512:k=>{"use strict";k.exports=RTCSessionDescription},2842:(k,S,a)=>{"use strict";if("function"==typeof RTCSessionDescription)switch((0,a(4911).guessBrowser)()){case"chrome":k.exports=a(932);break;case"firefox":k.exports=a(1512);break;default:k.exports=RTCSessionDescription}else k.exports=function(){throw new Error("RTCSessionDescription is not supported")}},7328:(k,S,a)=>{"use strict";var d=a(3105).EventEmitter;function p(){Object.defineProperties(this,{_eventEmitter:{value:new d}})}p.prototype.dispatchEvent=function(s){return this._eventEmitter.emit(s.type,s)},p.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)},p.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)},k.exports=p},4911:(k,S)=>{"use strict";function d(u,c,h,P){if(!(P in c)&&!P.match(/^on[a-z]+$/)){var O=!1;try{var w=Object.getOwnPropertyDescriptor(u,P);O=w&&!!w.get}catch(C){}if(!O){var R;try{R=typeof u[P]}catch(C){}"function"===R&&(c[P]=function(){return this[h][P].apply(this[h],arguments)})}}}function i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:null}function t(u){return void 0===u&&(u=i()),/Chrome|CriOS/.test(u)?"chrome":/Firefox|FxiOS/.test(u)?"firefox":/Safari|iPhone|iPad|iPod/.test(u)?"safari":null}S.defer=function(){var u={};return u.promise=new Promise(function(c,h){u.resolve=c,u.reject=h}),u},S.delegateMethods=function(u,c,h){for(var P in u)d(u,c,h,P)},S.difference=function(u,c){u=Array.isArray(u)?new Set(u):new Set(u.values()),c=Array.isArray(c)?new Set(c):new Set(c.values());var h=new Set;return u.forEach(function(P){c.has(P)||h.add(P)}),h},S.flatMap=function(u,c){return(u instanceof Map||u instanceof Set?Array.from(u.values()):u).reduce(function(P,O){var w=c(O);return P.concat(w)},[])},S.guessBrowser=t,S.guessBrowserVersion=function(u){void 0===u&&(u=i());var c={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[t(u)];if(!c)return null;var h=new RegExp("("+c+")/([^\\s]+)"),P=(u.match(h)||[])[2];if(!P)return null;var O=P.split(".").map(Number);return{major:isNaN(O[0])?null:O[0],minor:isNaN(O[1])?null:O[1]}},S.isIOSChrome=function(u){return void 0===u&&(u=i()),/Mobi/.test(u)&&"chrome"===t()&&/iPad|iPhone|iPod/.test(u)},S.interceptEvent=function(u,c){var h=null;Object.defineProperty(u,"on"+c,{get:function(){return h},set:function(P){h&&this.removeEventListener(c,h),"function"==typeof P?this.addEventListener(c,h=P):h=null}})},S.legacyPromise=function(u,c,h){return c?u.then(function(P){c(P)},function(P){h(P)}):u},S.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var c=16*Math.random()|0;return("x"===u?c:3&c|8).toString(16)})},S.proxyProperties=function(u,c,h){Object.getOwnPropertyNames(u).forEach(function(P){!function(u,c,h,P){if(!(P in c)){if(P.match(/^on[a-z]+$/))return Object.defineProperty(c,P,{value:null,writable:!0}),void h.addEventListener(P.slice(2),function(){c.dispatchEvent.apply(c,arguments)});Object.defineProperty(c,P,{enumerable:!0,get:function(){return h[P]}})}}(0,c,h,P)})},S.support=function(){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"function"==typeof RTCPeerConnection}},2774:(k,S,a)=>{"use strict";var d=a(4911).defer,p={high:new Set(["low"]),low:new Set(["high"])};function o(i){if(!(this instanceof o))return new o(i);var t=i||"low";Object.defineProperties(this,{_state:{set:function(e){if(t!==e){var r=this._whenDeferreds.get(t=e);r.forEach(function(n){n.resolve(this)},this),r.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])},state:{enumerable:!0,get:function(){return this._state}}})}function s(i,t){return new Error('Cannot transition from "'+i+'" to "'+t+'"')}o.prototype.lower=function(){return this.transition("low")},o.prototype.raise=function(){return this.transition("high")},o.prototype.transition=function(t){if(!p[this.state].has(t))throw s(this.state,t);return this._state=t,this},o.prototype.when=function(t){if(this.state===t)return Promise.resolve(this);if(!p[this.state].has(t))return Promise.reject(s(this.state,t));var e=d();return this._whenDeferreds.get(t).add(e),e.promise},k.exports=o},1225:(k,S,a)=>{"use strict";var d=a(4911).flatMap,p=a(4911).guessBrowser,o=null,i=null;function e(g){return g&&function(){if("boolean"==typeof o)return o;if("undefined"==typeof RTCPeerConnection)return o=!1;try{new RTCPeerConnection({sdpSemantics:"foo"}),o=!1}catch(g){o=!0}return o}()?{"plan-b":"planb","unified-plan":"unified"}[g]:function(){if(!i)if("undefined"!=typeof RTCPeerConnection&&"addTransceiver"in RTCPeerConnection.prototype)try{(new RTCPeerConnection).addTransceiver("audio"),i="unified"}catch(g){i="planb"}else i="planb";return i}()}function l(g,_){return(_.match(new RegExp(g,"gm"))||[]).reduce(function(I,M){var A=M.match(new RegExp(g));return A?I.add(A[1]):I},new Set)}function v(g,_){return l(g,_)}function y(g){return v("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",g)}function m(g){return v("^a=msid:.+ +(.+) *$",g)}function f(g,_){return l("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+_+" *$",g)}function u(g,_,L){return _=_||".*",L=L||".*",g.split("\r\nm=").slice(1).map(function(I){return"m="+I}).filter(function(I){var M=new RegExp("m="+_,"gm"),A=new RegExp("a="+L,"gm");return M.test(I)&&A.test(I)})}function c(g){return Array.from(l("^a=ssrc:([0-9]+) +.*$",g))}function h(g,_){var L=u(g),I=new RegExp("^a=msid:[^ ]+ +"+_+" *$","gm"),M=L.filter(function(A){return A.match(I)});return new Set(d(M,c))}function P(g,_,L){return new Map(Array.from(g(L)).map(function(I){return[I,_(L,I)]}))}function O(g){return P(y,f,g)}function w(g){return P(m,h,g)}function R(g,_,L){var I=g(L),M=new Map;I.forEach(function(U,F){if(_.has(F)){var Z=Array.from(_.get(F)),ee=Array.from(U);Z.forEach(function(J,V){var D=ee[V];M.set(D,J);var b="a=ssrc:"+J+" $1";L=L.replace(new RegExp("^a=ssrc:"+D+" (.*)$","gm"),b)})}else _.set(F,U)});var A="^(a=ssrc-group:[^ ]+ +)(.*)$";return(L.match(new RegExp(A,"gm"))||[]).forEach(function(U){var F=U.match(new RegExp(A));if(F){var Z=F[1],J=F[2].split(" ").map(function(V){return M.get(V)||V}).join(" ");L=L.replace(F[0],Z+J)}}),L}S.getSdpFormat=function(g){return{chrome:e(g),firefox:"unified",safari:"undefined"!=typeof RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}[p()]||null},S.getMediaSections=u,S.getPlanBTrackIds=y,S.getUnifiedPlanTrackIds=m,S.getPlanBSSRCs=f,S.getUnifiedPlanSSRCs=h,S.updatePlanBTrackIdsToSSRCs=function(g,_){return R(O,g,_)},S.updateUnifiedPlanTrackIdsToSSRCs=function(g,_){return R(w,g,_)}},6890:k=>{k.exports=WebSocket},826:k=>{k.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},7775:(k,S,a)=>{"use strict";var d=a(7316),p=a(2197),o=a(3446),s=a(7579);function i(ae){return ae.call.bind(ae)}var t="undefined"!=typeof BigInt,e="undefined"!=typeof Symbol,r=i(Object.prototype.toString),n=i(Number.prototype.valueOf),l=i(String.prototype.valueOf),v=i(Boolean.prototype.valueOf);if(t)var y=i(BigInt.prototype.valueOf);if(e)var m=i(Symbol.prototype.valueOf);function f(ae,$){if("object"!=typeof ae)return!1;try{return $(ae),!0}catch(te){return!1}}function M(ae){return"[object Map]"===r(ae)}function H(ae){return"[object Set]"===r(ae)}function F(ae){return"[object WeakMap]"===r(ae)}function ee(ae){return"[object WeakSet]"===r(ae)}function V(ae){return"[object ArrayBuffer]"===r(ae)}function D(ae){return"undefined"!=typeof ArrayBuffer&&(V.working?V(ae):ae instanceof ArrayBuffer)}function E(ae){return"[object DataView]"===r(ae)}function b(ae){return"undefined"!=typeof DataView&&(E.working?E(ae):ae instanceof DataView)}S.isArgumentsObject=d,S.isGeneratorFunction=p,S.isTypedArray=s,S.isPromise=function(ae){return"undefined"!=typeof Promise&&ae instanceof Promise||null!==ae&&"object"==typeof ae&&"function"==typeof ae.then&&"function"==typeof ae.catch},S.isArrayBufferView=function(ae){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(ae):s(ae)||b(ae)},S.isUint8Array=function(ae){return"Uint8Array"===o(ae)},S.isUint8ClampedArray=function(ae){return"Uint8ClampedArray"===o(ae)},S.isUint16Array=function(ae){return"Uint16Array"===o(ae)},S.isUint32Array=function(ae){return"Uint32Array"===o(ae)},S.isInt8Array=function(ae){return"Int8Array"===o(ae)},S.isInt16Array=function(ae){return"Int16Array"===o(ae)},S.isInt32Array=function(ae){return"Int32Array"===o(ae)},S.isFloat32Array=function(ae){return"Float32Array"===o(ae)},S.isFloat64Array=function(ae){return"Float64Array"===o(ae)},S.isBigInt64Array=function(ae){return"BigInt64Array"===o(ae)},S.isBigUint64Array=function(ae){return"BigUint64Array"===o(ae)},M.working="undefined"!=typeof Map&&M(new Map),S.isMap=function(ae){return"undefined"!=typeof Map&&(M.working?M(ae):ae instanceof Map)},H.working="undefined"!=typeof Set&&H(new Set),S.isSet=function(ae){return"undefined"!=typeof Set&&(H.working?H(ae):ae instanceof Set)},F.working="undefined"!=typeof WeakMap&&F(new WeakMap),S.isWeakMap=function(ae){return"undefined"!=typeof WeakMap&&(F.working?F(ae):ae instanceof WeakMap)},ee.working="undefined"!=typeof WeakSet&&ee(new WeakSet),S.isWeakSet=function(ae){return ee(ae)},V.working="undefined"!=typeof ArrayBuffer&&V(new ArrayBuffer),S.isArrayBuffer=D,E.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&E(new DataView(new ArrayBuffer(1),0,1)),S.isDataView=b;var B="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function Q(ae){return"[object SharedArrayBuffer]"===r(ae)}function q(ae){return void 0!==B&&(void 0===Q.working&&(Q.working=Q(new B)),Q.working?Q(ae):ae instanceof B)}function me(ae){return f(ae,n)}function pe(ae){return f(ae,l)}function ye(ae){return f(ae,v)}function ve(ae){return t&&f(ae,y)}function ke(ae){return e&&f(ae,m)}S.isSharedArrayBuffer=q,S.isAsyncFunction=function(ae){return"[object AsyncFunction]"===r(ae)},S.isMapIterator=function(ae){return"[object Map Iterator]"===r(ae)},S.isSetIterator=function(ae){return"[object Set Iterator]"===r(ae)},S.isGeneratorObject=function(ae){return"[object Generator]"===r(ae)},S.isWebAssemblyCompiledModule=function(ae){return"[object WebAssembly.Module]"===r(ae)},S.isNumberObject=me,S.isStringObject=pe,S.isBooleanObject=ye,S.isBigIntObject=ve,S.isSymbolObject=ke,S.isBoxedPrimitive=function(ae){return me(ae)||pe(ae)||ye(ae)||ve(ae)||ke(ae)},S.isAnyArrayBuffer=function(ae){return"undefined"!=typeof Uint8Array&&(D(ae)||q(ae))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(ae){Object.defineProperty(S,ae,{enumerable:!1,value:function(){throw new Error(ae+" is not supported in userland")}})})},1732:(k,S,a)=>{var d=Object.getOwnPropertyDescriptors||function(b){for(var B=Object.keys(b),Q={},q=0;q<B.length;q++)Q[B[q]]=Object.getOwnPropertyDescriptor(b,B[q]);return Q},p=/%[sdj%]/g;S.format=function(E){if(!R(E)){for(var b=[],B=0;B<arguments.length;B++)b.push(t(arguments[B]));return b.join(" ")}B=1;for(var Q=arguments,q=Q.length,K=String(E).replace(p,function(se){if("%%"===se)return"%";if(B>=q)return se;switch(se){case"%s":return String(Q[B++]);case"%d":return Number(Q[B++]);case"%j":try{return JSON.stringify(Q[B++])}catch(le){return"[Circular]"}default:return se}}),X=Q[B];B<q;X=Q[++B])P(X)||!_(X)?K+=" "+X:K+=" "+t(X);return K},S.deprecate=function(E,b){if("undefined"!=typeof process&&!0===process.noDeprecation)return E;if("undefined"==typeof process)return function(){return S.deprecate(E,b).apply(this,arguments)};var B=!1;return function(){if(!B){if(process.throwDeprecation)throw new Error(b);process.traceDeprecation?console.trace(b):console.error(b),B=!0}return E.apply(this,arguments)}};var o={},s=/^$/;if(process.env.NODE_DEBUG){var i=process.env.NODE_DEBUG;i=i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+i+"$","i")}function t(E,b){var B={seen:[],stylize:r};return arguments.length>=3&&(B.depth=arguments[2]),arguments.length>=4&&(B.colors=arguments[3]),h(b)?B.showHidden=b:b&&S._extend(B,b),T(B.showHidden)&&(B.showHidden=!1),T(B.depth)&&(B.depth=2),T(B.colors)&&(B.colors=!1),T(B.customInspect)&&(B.customInspect=!0),B.colors&&(B.stylize=e),l(B,E,B.depth)}function e(E,b){var B=t.styles[b];return B?"\x1b["+t.colors[B][0]+"m"+E+"\x1b["+t.colors[B][1]+"m":E}function r(E,b){return E}function l(E,b,B){if(E.customInspect&&b&&M(b.inspect)&&b.inspect!==S.inspect&&(!b.constructor||b.constructor.prototype!==b)){var Q=b.inspect(B,E);return R(Q)||(Q=l(E,Q,B)),Q}var q=function(E,b){if(T(b))return E.stylize("undefined","undefined");if(R(b)){var B="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return E.stylize(B,"string")}return w(b)?E.stylize(""+b,"number"):h(b)?E.stylize(""+b,"boolean"):P(b)?E.stylize("null","null"):void 0}(E,b);if(q)return q;var K=Object.keys(b),X=function(E){var b={};return E.forEach(function(B,Q){b[B]=!0}),b}(K);if(E.showHidden&&(K=Object.getOwnPropertyNames(b)),I(b)&&(K.indexOf("message")>=0||K.indexOf("description")>=0))return y(b);if(0===K.length){if(M(b))return E.stylize("[Function"+(b.name?": "+b.name:"")+"]","special");if(g(b))return E.stylize(RegExp.prototype.toString.call(b),"regexp");if(L(b))return E.stylize(Date.prototype.toString.call(b),"date");if(I(b))return y(b)}var ye,le="",he=!1,me=["{","}"];return c(b)&&(he=!0,me=["[","]"]),M(b)&&(le=" [Function"+(b.name?": "+b.name:"")+"]"),g(b)&&(le=" "+RegExp.prototype.toString.call(b)),L(b)&&(le=" "+Date.prototype.toUTCString.call(b)),I(b)&&(le=" "+y(b)),0!==K.length||he&&0!=b.length?B<0?g(b)?E.stylize(RegExp.prototype.toString.call(b),"regexp"):E.stylize("[Object]","special"):(E.seen.push(b),ye=he?function(E,b,B,Q,q){for(var K=[],X=0,se=b.length;X<se;++X)ee(b,String(X))?K.push(f(E,b,B,Q,String(X),!0)):K.push("");return q.forEach(function(le){le.match(/^\d+$/)||K.push(f(E,b,B,Q,le,!0))}),K}(E,b,B,X,K):K.map(function(ve){return f(E,b,B,X,ve,he)}),E.seen.pop(),function(E,b,B){return E.reduce(function(K,X){return X.indexOf("\n"),K+X.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?B[0]+(""===b?"":b+"\n ")+" "+E.join(",\n  ")+" "+B[1]:B[0]+b+" "+E.join(", ")+" "+B[1]}(ye,le,me)):me[0]+le+me[1]}function y(E){return"["+Error.prototype.toString.call(E)+"]"}function f(E,b,B,Q,q,K){var X,se,le;if((le=Object.getOwnPropertyDescriptor(b,q)||{value:b[q]}).get?se=E.stylize(le.set?"[Getter/Setter]":"[Getter]","special"):le.set&&(se=E.stylize("[Setter]","special")),ee(Q,q)||(X="["+q+"]"),se||(E.seen.indexOf(le.value)<0?(se=P(B)?l(E,le.value,null):l(E,le.value,B-1)).indexOf("\n")>-1&&(se=K?se.split("\n").map(function(he){return"  "+he}).join("\n").substr(2):"\n"+se.split("\n").map(function(he){return"   "+he}).join("\n")):se=E.stylize("[Circular]","special")),T(X)){if(K&&q.match(/^\d+$/))return se;(X=JSON.stringify(""+q)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(X=X.substr(1,X.length-2),X=E.stylize(X,"name")):(X=X.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),X=E.stylize(X,"string"))}return X+": "+se}function c(E){return Array.isArray(E)}function h(E){return"boolean"==typeof E}function P(E){return null===E}function w(E){return"number"==typeof E}function R(E){return"string"==typeof E}function T(E){return void 0===E}function g(E){return _(E)&&"[object RegExp]"===H(E)}function _(E){return"object"==typeof E&&null!==E}function L(E){return _(E)&&"[object Date]"===H(E)}function I(E){return _(E)&&("[object Error]"===H(E)||E instanceof Error)}function M(E){return"function"==typeof E}function H(E){return Object.prototype.toString.call(E)}function U(E){return E<10?"0"+E.toString(10):E.toString(10)}S.debuglog=function(E){if(E=E.toUpperCase(),!o[E])if(s.test(E)){var b=process.pid;o[E]=function(){var B=S.format.apply(S,arguments);console.error("%s %d: %s",E,b,B)}}else o[E]=function(){};return o[E]},S.inspect=t,t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},t.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},S.types=a(7775),S.isArray=c,S.isBoolean=h,S.isNull=P,S.isNullOrUndefined=function(E){return null==E},S.isNumber=w,S.isString=R,S.isSymbol=function(E){return"symbol"==typeof E},S.isUndefined=T,S.isRegExp=g,S.types.isRegExp=g,S.isObject=_,S.isDate=L,S.types.isDate=L,S.isError=I,S.types.isNativeError=I,S.isFunction=M,S.isPrimitive=function(E){return null===E||"boolean"==typeof E||"number"==typeof E||"string"==typeof E||"symbol"==typeof E||void 0===E},S.isBuffer=a(826);var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Z(){var E=new Date,b=[U(E.getHours()),U(E.getMinutes()),U(E.getSeconds())].join(":");return[E.getDate(),F[E.getMonth()],b].join(" ")}function ee(E,b){return Object.prototype.hasOwnProperty.call(E,b)}S.log=function(){console.log("%s - %s",Z(),S.format.apply(S,arguments))},S.inherits=a(9879),S._extend=function(E,b){if(!b||!_(b))return E;for(var B=Object.keys(b),Q=B.length;Q--;)E[B[Q]]=b[B[Q]];return E};var J="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function V(E,b){if(!E){var B=new Error("Promise was rejected with a falsy value");B.reason=E,E=B}return b(E)}S.promisify=function(b){if("function"!=typeof b)throw new TypeError('The "original" argument must be of type Function');if(J&&b[J]){var B;if("function"!=typeof(B=b[J]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(B,J,{value:B,enumerable:!1,writable:!1,configurable:!0}),B}function B(){for(var Q,q,K=new Promise(function(le,he){Q=le,q=he}),X=[],se=0;se<arguments.length;se++)X.push(arguments[se]);X.push(function(le,he){le?q(le):Q(he)});try{b.apply(this,X)}catch(le){q(le)}return K}return Object.setPrototypeOf(B,Object.getPrototypeOf(b)),J&&Object.defineProperty(B,J,{value:B,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(B,d(b))},S.promisify.custom=J,S.callbackify=function(E){if("function"!=typeof E)throw new TypeError('The "original" argument must be of type Function');function b(){for(var B=[],Q=0;Q<arguments.length;Q++)B.push(arguments[Q]);var q=B.pop();if("function"!=typeof q)throw new TypeError("The last argument must be of type Function");var K=this,X=function(){return q.apply(K,arguments)};E.apply(this,B).then(function(se){process.nextTick(X.bind(null,null,se))},function(se){process.nextTick(V.bind(null,se,X))})}return Object.setPrototypeOf(b,Object.getPrototypeOf(E)),Object.defineProperties(b,d(E)),b}},3446:(k,S,a)=>{"use strict";var d=a(708),p=a(5127),o=a(9568),s=o("Object.prototype.toString"),i=a(1407)(),t="undefined"==typeof globalThis?global:globalThis,e=p(),r=o("String.prototype.slice"),n={},l=a(7168),v=Object.getPrototypeOf;i&&l&&v&&d(e,function(f){if("function"==typeof t[f]){var u=new t[f];if(Symbol.toStringTag in u){var c=v(u),h=l(c,Symbol.toStringTag);if(!h){var P=v(c);h=l(P,Symbol.toStringTag)}n[f]=h.get}}});var m=a(7579);k.exports=function(u){return!!m(u)&&(i&&Symbol.toStringTag in u?function(u){var c=!1;return d(n,function(h,P){if(!c)try{var O=h.call(u);O===P&&(c=O)}catch(w){}}),c}(u):r(s(u),8,-1))}},7725:(k,S,a)=>{"use strict";a.r(S),a.d(S,{MainModule:()=>j});var d=a(8583),p=a(4889),o=a(7716);function s(x,Y,N,re,fe,Se,_e){try{var Te=x[Se](_e),Pe=Te.value}catch(Ie){return void N(Ie)}Te.done?Y(Pe):Promise.resolve(Pe).then(re,fe)}function i(x){return function(){var Y=this,N=arguments;return new Promise(function(re,fe){var Se=x.apply(Y,N);function _e(Pe){s(Se,re,fe,_e,Te,"next",Pe)}function Te(Pe){s(Se,re,fe,_e,Te,"throw",Pe)}_e(void 0)})}}var t=a(8987);const e=["preview"];function r(x,Y){1&x&&(o.TgZ(0,"div"),o._uU(1,"Loading preview... Please wait."),o.qZA())}let n=(()=>{class x{constructor(N,re){this.renderer=N,this.cd=re,this.localTracks=[]}get tracks(){return this.localTracks}ngAfterViewInit(){var N=this;return i(function*(){N.previewElement&&N.previewElement.nativeElement&&(yield N.initializeDevice())})()}initializePreview(N){var re=this;return i(function*(){yield re.initializeDevice(N)})()}showPreviewCamera(){var N=this;return i(function*(){return yield N.initializeDevice(),N.videoTrack})()}finalizePreview(){try{this.videoTrack&&this.videoTrack.detach().forEach(N=>N.remove()),this.videoTrack=null}catch(N){console.error(N)}}initializeDevice(N){var re=this;return i(function*(){try{re.isInitializing=!0,re.finalizePreview(),re.videoTrack=N?yield(0,t.createLocalVideoTrack)({deviceId:N}):yield(0,t.createLocalVideoTrack)();const fe=re.videoTrack.attach();re.renderer.setStyle(fe,"height","100%"),re.removeNodeChildren(re.previewElement),re.renderer.appendChild(re.previewElement.nativeElement,fe)}finally{re.isInitializing=!1,re.cd.detectChanges()}})()}removeNodeChildren(N){const re=N.nativeElement.children;for(let fe of re)this.renderer.removeChild(N.nativeElement,fe)}}return x.\u0275fac=function(N){return new(N||x)(o.Y36(o.Qsj),o.Y36(o.sBO))},x.\u0275cmp=o.Xpm({type:x,selectors:[["app-camera"]],viewQuery:function(N,re){if(1&N&&o.Gf(e,5),2&N){let fe;o.iGM(fe=o.CRH())&&(re.previewElement=fe.first)}},decls:3,vars:1,consts:[["id","preview",2,"height","35vh"],["preview",""],[4,"ngIf"]],template:function(N,re){1&N&&(o.TgZ(0,"div",0,1),o.YNc(2,r,2,0,"div",2),o.qZA()),2&N&&(o.xp6(2),o.Q6J("ngIf",re.isInitializing))},directives:[d.O5],styles:[""]}),x})();var l=a(665),v=a(9765),y=a(9112),m=a(3190),u=a(8307),c=a(7393);class P{constructor(Y){this.value=Y}call(Y,N){return N.subscribe(new O(Y,this.value))}}class O extends c.L{constructor(Y,N){super(Y),this.value=N}_next(Y){this.destination.next(this.value)}}var w=a(9761),R=a(8002),C=a(2340),T=a(1841);let g=(()=>{class x{constructor(N){this.httpClient=N}get(N){return this.httpClient.get(`${C.N.apiUrl}/api/rooms/${N}`)}getAll(){return this.httpClient.get(`${C.N.apiUrl}/api/rooms`)}create(N){return this.httpClient.post(`${C.N.apiUrl}/api/rooms`,{name:N})}}return x.\u0275fac=function(N){return new(N||x)(o.LFG(T.eN))},x.\u0275prov=o.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();function _(x,Y){1&x&&(o.TgZ(0,"span"),o._uU(1,"Create"),o.qZA())}function L(x,Y){1&x&&(o.TgZ(0,"span"),o._uU(1,"Creating..."),o.qZA())}const I=function(x){return["/room",x]},M=function(x){return{name:x}};function A(x,Y){if(1&x&&(o.TgZ(0,"button",9),o.TgZ(1,"span",10),o._uU(2),o.qZA(),o.TgZ(3,"span"),o._uU(4),o.qZA(),o.O4$(),o.TgZ(5,"svg",11),o._UZ(6,"path",12),o.qZA(),o.qZA()),2&x){const N=Y.$implicit,re=o.oxw(2);o.Q6J("routerLink",o.VKq(6,I,N.name))("queryParams",o.VKq(8,M,re.form.controls.name.value))("disabled",re.form.controls.name.invalid),o.xp6(2),o.AsE("",N.participantCount||0,"/",N.maxParticipants||0,""),o.xp6(2),o.Oqu(N.name)}}function H(x,Y){if(1&x){const N=o.EpF();o.ynx(0),o.TgZ(1,"form",1),o.NdJ("ngSubmit",function(){return o.CHM(N),o.oxw().createRoom()}),o.TgZ(2,"div",2),o.TgZ(3,"p"),o._uU(4,"Who are you?"),o.qZA(),o._UZ(5,"input",3),o.qZA(),o.TgZ(6,"h2"),o._uU(7,"Join a room"),o.qZA(),o.TgZ(8,"p"),o._uU(9,"Create a room by naming it:"),o.qZA(),o.TgZ(10,"div",4),o.TgZ(11,"div",2),o._UZ(12,"input",5),o.qZA(),o.TgZ(13,"button",6),o.YNc(14,_,2,0,"span",0),o.YNc(15,L,2,0,"span",0),o.qZA(),o.qZA(),o.qZA(),o.TgZ(16,"h2"),o._uU(17,"Available rooms"),o.qZA(),o.TgZ(18,"div",7),o.YNc(19,A,7,10,"button",8),o.qZA(),o.BQk()}if(2&x){const N=Y.ngIf,re=o.oxw();o.xp6(1),o.Q6J("formGroup",re.form),o.xp6(12),o.Q6J("disabled",N.creatingRoom||re.form.invalid),o.xp6(1),o.Q6J("ngIf",!N.creatingRoom),o.xp6(1),o.Q6J("ngIf",N.creatingRoom),o.xp6(4),o.Q6J("ngForOf",N.rooms)}}let U=(()=>{class x{constructor(N,re,fe){this.roomsService=re,this.router=fe,this.createRoomSubject=new v.xQ,this.refreshRoomsSubject=new v.xQ,this.form=N.group({name:[null,l.kI.required],roomName:[null,l.kI.required]});const Se=this.refreshRoomsSubject.pipe(function(x,Y){return(0,m.w)(()=>x)}(re.getAll())),_e=this.createRoomSubject.pipe((0,m.w)(Te=>this.roomsService.create(Te).pipe((0,u.b)(Pe=>this.router.navigate(["/room",Pe.name],{queryParams:{name:this.form.controls.name.value}})),Y=>Y.lift(new P(!1)),(0,w.O)(!0))),(0,w.O)(!1));this.model$=(0,y.aj)([Se,_e]).pipe((0,R.U)(([Te,Pe])=>({rooms:Te,creatingRoom:Pe})))}createRoom(){!this.form.controls.roomName.value||this.createRoomSubject.next(this.form.controls.roomName.value)}ngAfterViewInit(){this.refreshRoomsSubject.next()}}return x.\u0275fac=function(N){return new(N||x)(o.Y36(l.qu),o.Y36(g),o.Y36(p.F0))},x.\u0275cmp=o.Xpm({type:x,selectors:[["app-rooms"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-group"],["formControlName","name","type","text",1,"form-control"],[1,"d-flex","flex-column"],["formControlName","roomName","type","text",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"card-container"],["class","card","type","button",3,"routerLink","queryParams","disabled",4,"ngFor","ngForOf"],["type","button",1,"card",3,"routerLink","queryParams","disabled"],[1,"badge","badge-sm","badge-secondary","mr-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",1,"material-icons"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"]],template:function(N,re){1&N&&(o.YNc(0,H,20,5,"ng-container",0),o.ALo(1,"async")),2&N&&o.Q6J("ngIf",o.lcZ(1,1,re.model$))},directives:[d.O5,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,d.sg,p.rH],pipes:[d.Ov],styles:[""],changeDetection:0}),x})(),F=(()=>{class x{}return x.\u0275fac=function(N){return new(N||x)},x.\u0275cmp=o.Xpm({type:x,selectors:[["ng-component"]],decls:10,vars:0,consts:[["role","main",1,"content"],[1,"card","highlight-card","card-small"],["id","clouds","xmlns","http://www.w3.org/2000/svg","width","2611.084","height","485.677","viewBox","0 0 2611.084 485.677"],["id","Path_39","data-name","Path 39","d","M2379.709,863.793c10-93-77-171-168-149-52-114-225-105-264,15-75,3-140,59-152,133-30,2.83-66.725,9.829-93.5,26.25-26.771-16.421-63.5-23.42-93.5-26.25-12-74-77-130-152-133-39-120-212-129-264-15-54.084-13.075-106.753,9.173-138.488,48.9-31.734-39.726-84.4-61.974-138.487-48.9-52-114-225-105-264,15a162.027,162.027,0,0,0-103.147,43.044c-30.633-45.365-87.1-72.091-145.206-58.044-52-114-225-105-264,15-75,3-140,59-152,133-53,5-127,23-130,83-2,42,35,72,70,86,49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33,61.112,8.015,113.854-5.72,150.492-29.764a165.62,165.62,0,0,0,110.861-3.236c47,94,178,113,251,33,31.385,4.116,60.563,2.495,86.487-3.311,25.924,5.806,55.1,7.427,86.488,3.311,73,80,204,61,251-33a165.625,165.625,0,0,0,120,0c51,13,108,15,157-5a147.188,147.188,0,0,0,33.5-18.694,147.217,147.217,0,0,0,33.5,18.694c49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33C2446.709,1093.793,2554.709,922.793,2379.709,863.793Z","transform","translate(142.69 -634.312)","fill","#eee"]],template:function(N,re){1&N&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"span"),o._uU(3,"Video preview"),o.qZA(),o.qZA(),o._UZ(4,"app-camera"),o._UZ(5,"app-rooms"),o.O4$(),o.TgZ(6,"svg",2),o.TgZ(7,"title"),o._uU(8,"Gray Clouds Background"),o.qZA(),o._UZ(9,"path",3),o.qZA(),o.qZA())},directives:[n,U],encapsulation:2,changeDetection:0}),x})();const Z=["list"];function ee(x,Y){1&x&&(o.TgZ(0,"div"),o._uU(1,"You are alone"),o.qZA())}const J=["*"];let V=(()=>{class x{constructor(N){this.renderer=N,this.participantsChanged=new o.vpe}get participantCount(){return this.participants?this.participants.size:0}get isAlone(){return 0===this.participantCount}clear(){this.participants&&this.participants.clear()}initialize(N){this.participants=N,this.participants&&this.participants.forEach(re=>this.registerParticipantEvents(re))}add(N){this.participants&&N&&(this.participants.set(N.sid,N),this.registerParticipantEvents(N))}remove(N){this.participants&&this.participants.has(N.sid)&&this.participants.delete(N.sid)}loudest(N){this.dominantSpeaker=N}registerParticipantEvents(N){N&&(N.tracks.forEach(re=>this.subscribe(re)),N.on("trackPublished",re=>this.subscribe(re)),N.on("trackUnpublished",re=>{re&&re.track&&this.detachRemoteTrack(re.track)}))}subscribe(N){N&&N.on&&(N.on("subscribed",re=>this.attachRemoteTrack(re)),N.on("unsubscribed",re=>this.detachRemoteTrack(re)))}attachRemoteTrack(N){if(this.isAttachable(N)){const re=N.attach();this.renderer.data.id=N.sid,this.renderer.setStyle(re,"width","95%"),this.renderer.setStyle(re,"margin-left","2.5%"),this.renderer.appendChild(this.listRef.nativeElement,re),this.participantsChanged.emit(!0)}}detachRemoteTrack(N){this.isDetachable(N)&&(N.detach().forEach(re=>re.remove()),this.participantsChanged.emit(!0))}isAttachable(N){return!!N&&(void 0!==N.attach||void 0!==N.attach)}isDetachable(N){return!!N&&(void 0!==N.detach||void 0!==N.detach)}}return x.\u0275fac=function(N){return new(N||x)(o.Y36(o.Qsj))},x.\u0275cmp=o.Xpm({type:x,selectors:[["app-room-grid"]],viewQuery:function(N,re){if(1&N&&o.Gf(Z,5),2&N){let fe;o.iGM(fe=o.CRH())&&(re.listRef=fe.first)}},outputs:{participantsChanged:"participantsChanged"},ngContentSelectors:J,decls:5,vars:1,consts:[[1,"d-flex","flex-column","flex-wrap"],[4,"ngIf"],["list",""]],template:function(N,re){1&N&&(o.F$t(),o.TgZ(0,"div",0),o.Hsn(1),o.YNc(2,ee,2,0,"div",1),o._UZ(3,"div",null,2),o.qZA()),2&N&&(o.xp6(2),o.Q6J("ngIf",re.isAlone))},directives:[d.O5],styles:[""]}),x})();var D=a(5435),E=a(8049),b=a(6465),Q=a(6102);const X=new class extends Q.v{}(class extends b.o{constructor(Y,N){super(Y,N),this.scheduler=Y,this.work=N}schedule(Y,N=0){return N>0?super.schedule(Y,N):(this.delay=N,this.state=Y,this.scheduler.flush(this),this)}execute(Y,N){return N>0||this.closed?super.execute(Y,N):this._execute(Y,N)}requestAsyncId(Y,N,re=0){return null!==re&&re>0||null===re&&this.delay>0?super.requestAsyncId(Y,N,re):Y.flush(this)}});var se=a(5319),le=a(1593);class pe extends c.L{constructor(Y,N,re=0){super(Y),this.scheduler=N,this.delay=re}static dispatch(Y){const{notification:N,destination:re}=Y;N.observe(re),this.unsubscribe()}scheduleMessage(Y){this.destination.add(this.scheduler.schedule(pe.dispatch,this.delay,new ye(Y,this.destination)))}_next(Y){this.scheduleMessage(le.P.createNext(Y))}_error(Y){this.scheduleMessage(le.P.createError(Y)),this.unsubscribe()}_complete(){this.scheduleMessage(le.P.createComplete()),this.unsubscribe()}}class ye{constructor(Y,N){this.notification=Y,this.destination=N}}var ve=a(7971),ke=a(8858);class be extends v.xQ{constructor(Y=Number.POSITIVE_INFINITY,N=Number.POSITIVE_INFINITY,re){super(),this.scheduler=re,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=Y<1?1:Y,this._windowTime=N<1?1:N,N===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(Y){if(!this.isStopped){const N=this._events;N.push(Y),N.length>this._bufferSize&&N.shift()}super.next(Y)}nextTimeWindow(Y){this.isStopped||(this._events.push(new Ee(this._getNow(),Y)),this._trimBufferThenGetEvents()),super.next(Y)}_subscribe(Y){const N=this._infiniteTimeWindow,re=N?this._events:this._trimBufferThenGetEvents(),fe=this.scheduler,Se=re.length;let _e;if(this.closed)throw new ve.N;if(this.isStopped||this.hasError?_e=se.w.EMPTY:(this.observers.push(Y),_e=new ke.W(this,Y)),fe&&Y.add(Y=new pe(Y,fe)),N)for(let Te=0;Te<Se&&!Y.closed;Te++)Y.next(re[Te]);else for(let Te=0;Te<Se&&!Y.closed;Te++)Y.next(re[Te].value);return this.hasError?Y.error(this.thrownError):this.isStopped&&Y.complete(),_e}_getNow(){return(this.scheduler||X).now()}_trimBufferThenGetEvents(){const Y=this._getNow(),N=this._bufferSize,re=this._windowTime,fe=this._events,Se=fe.length;let _e=0;for(;_e<Se&&!(Y-fe[_e].time<re);)_e++;return Se>N&&(_e=Math.max(_e,Se-N)),_e>0&&fe.splice(0,_e),fe}}class Ee{constructor(Y,N){this.time=Y,this.value=N}}let ae=(()=>{class x{constructor(N){this.http=N,this.roomBroadcast=new be,this.roomsUpdated$=this.roomBroadcast.asObservable()}getAuthToken(N){var re=this;return i(function*(){return(yield re.http.get(`${C.N.apiUrl}/api/auth/token/${N}`).toPromise()).token})()}joinOrCreateRoom(N,re,fe){var Se=this;return i(function*(){let _e=null;try{const Te=yield Se.getAuthToken(re);_e=yield(0,t.connect)(Te,{name:N,tracks:fe,dominantSpeaker:!0})}catch(Te){console.error(`Unable to connect to Room: ${Te.message}`)}finally{_e&&Se.roomBroadcast.next(!0)}return _e})()}nudge(){this.roomBroadcast.next(!0)}}return x.\u0275fac=function(N){return new(N||x)(o.LFG(T.eN))},x.\u0275prov=o.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();const te=[{path:"",component:F},{path:"room/:id",component:(()=>{class x{constructor(N,re,fe){this.route=N,this.router=re,this.videoCallService=fe}ngAfterViewInit(){const N=this.route.params.pipe((0,R.U)(fe=>fe.id),(0,D.h)(fe=>fe)),re=this.route.queryParams.pipe((0,R.U)(fe=>fe.name));N.pipe((0,E.P)(),(0,m.w)(fe=>re.pipe((0,R.U)(Se=>({id:fe,identity:Se}))))).subscribe(fe=>this.onRoomChanged(fe.id,fe.identity))}onLeaveRoom(N){var re=this;return i(function*(){re.activeRoom&&(re.activeRoom.disconnect(),re.activeRoom=null),re.roomGrid.clear(),yield re.router.navigate(["/"])})()}onRoomChanged(N,re){var fe=this;return i(function*(){if(N){fe.activeRoom&&fe.activeRoom.disconnect();const Se=yield Promise.all([(0,t.createLocalAudioTrack)(),fe.camera.showPreviewCamera()]);fe.activeRoom=yield fe.videoCallService.joinOrCreateRoom(N,re,Se),fe.roomGrid.initialize(fe.activeRoom.participants),fe.registerRoomEvents()}})()}onParticipantsChanged(N){this.videoCallService.nudge()}registerRoomEvents(){this.activeRoom.on("disconnected",N=>N.localParticipant.tracks.forEach(re=>this.detachLocalTrack(re.track))).on("participantConnected",N=>this.roomGrid.add(N)).on("participantDisconnected",N=>this.roomGrid.remove(N)).on("dominantSpeakerChanged",N=>this.roomGrid.loudest(N))}detachLocalTrack(N){this.isDetachable(N)&&N.detach().forEach(re=>re.remove())}isDetachable(N){return!!N&&(void 0!==N.detach||void 0!==N.detach)}}return x.\u0275fac=function(N){return new(N||x)(o.Y36(p.gz),o.Y36(p.F0),o.Y36(ae))},x.\u0275cmp=o.Xpm({type:x,selectors:[["ng-component"]],viewQuery:function(N,re){if(1&N&&(o.Gf(n,5),o.Gf(V,5)),2&N){let fe;o.iGM(fe=o.CRH())&&(re.camera=fe.first),o.iGM(fe=o.CRH())&&(re.roomGrid=fe.first)}},decls:11,vars:0,consts:[["role","main",1,"content"],[1,"d-flex","flex-column","flex-wrap"],[3,"participantsChanged"],[1,"card-container"],["type","button",1,"btn","btn-danger",3,"click"],["id","clouds","xmlns","http://www.w3.org/2000/svg","width","2611.084","height","485.677","viewBox","0 0 2611.084 485.677"],["id","Path_39","data-name","Path 39","d","M2379.709,863.793c10-93-77-171-168-149-52-114-225-105-264,15-75,3-140,59-152,133-30,2.83-66.725,9.829-93.5,26.25-26.771-16.421-63.5-23.42-93.5-26.25-12-74-77-130-152-133-39-120-212-129-264-15-54.084-13.075-106.753,9.173-138.488,48.9-31.734-39.726-84.4-61.974-138.487-48.9-52-114-225-105-264,15a162.027,162.027,0,0,0-103.147,43.044c-30.633-45.365-87.1-72.091-145.206-58.044-52-114-225-105-264,15-75,3-140,59-152,133-53,5-127,23-130,83-2,42,35,72,70,86,49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33,61.112,8.015,113.854-5.72,150.492-29.764a165.62,165.62,0,0,0,110.861-3.236c47,94,178,113,251,33,31.385,4.116,60.563,2.495,86.487-3.311,25.924,5.806,55.1,7.427,86.488,3.311,73,80,204,61,251-33a165.625,165.625,0,0,0,120,0c51,13,108,15,157-5a147.188,147.188,0,0,0,33.5-18.694,147.217,147.217,0,0,0,33.5,18.694c49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33C2446.709,1093.793,2554.709,922.793,2379.709,863.793Z","transform","translate(142.69 -634.312)","fill","#eee"]],template:function(N,re){1&N&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"app-room-grid",2),o.NdJ("participantsChanged",function(Se){return re.onParticipantsChanged(Se)}),o._UZ(3,"app-camera"),o.qZA(),o.qZA(),o.TgZ(4,"div",3),o.TgZ(5,"button",4),o.NdJ("click",function(){return re.onLeaveRoom(!0)}),o._uU(6,"Leave room"),o.qZA(),o.qZA(),o.O4$(),o.TgZ(7,"svg",5),o.TgZ(8,"title"),o._uU(9,"Gray Clouds Background"),o.qZA(),o._UZ(10,"path",6),o.qZA(),o.qZA())},directives:[V,n],styles:[""]}),x})()}];let ne=(()=>{class x{}return x.\u0275fac=function(N){return new(N||x)},x.\u0275mod=o.oAB({type:x}),x.\u0275inj=o.cJS({imports:[[p.Bz.forChild(te)],p.Bz]}),x})();var W=a(8319);let j=(()=>{class x{}return x.\u0275fac=function(N){return new(N||x)},x.\u0275mod=o.oAB({type:x}),x.\u0275inj=o.cJS({imports:[[d.ez,ne,l.UX,W.IJ]]}),x})()},5127:k=>{"use strict";var S=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],a="undefined"==typeof globalThis?global:globalThis;k.exports=function(){for(var p=[],o=0;o<S.length;o++)"function"==typeof a[S[o]]&&(p[p.length]=S[o]);return p}},7168:(k,S,a)=>{"use strict";var p=a(8540)("%Object.getOwnPropertyDescriptor%",!0);if(p)try{p([],"length")}catch(o){p=null}k.exports=p},1730:k=>{"use strict";k.exports=JSON.parse('{"name":"twilio-video","title":"Twilio Video","description":"Twilio Video JavaScript Library","version":"2.21.1","homepage":"https://twilio.com","author":"Mark Andrus Roberts <mroberts@twilio.com>","contributors":["Ryan Rowland <rrowland@twilio.com>","Manjesh Malavalli <mmalavalli@twilio.com>","Makarand Patwardhan <mpatwardhan@twilio.com>"],"keywords":["twilio","webrtc","library","javascript","video","rooms"],"repository":{"type":"git","url":"https://github.com/twilio/twilio-video.js.git"},"devDependencies":{"@babel/core":"^7.14.2","@babel/preset-env":"^7.14.2","@babel/preset-typescript":"^7.13.0","@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","@typescript-eslint/eslint-plugin":"^4.13.0","@typescript-eslint/parser":"^4.0.0","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1","browserify":"^17.0.0","cheerio":"^0.22.0","cors":"^2.8.5","electron":"^9.1.0","envify":"^4.0.0","eslint":"^6.2.1","eslint-config-standard":"^14.0.0","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","express":"^4.16.2","glob":"^7.1.7","ink-docstrap":"^1.3.2","inquirer":"^7.0.0","is-docker":"^2.0.0","jsdoc":"^3.5.5","jsdoc-babel":"^0.5.0","json-loader":"^0.5.7","karma":"^5.0.2","karma-browserify":"^8.0.0","karma-chrome-launcher":"^2.0.0","karma-edgium-launcher":"^4.0.0-0","karma-electron":"^6.1.0","karma-firefox-launcher":"^1.3.0","karma-htmlfile-reporter":"^0.3.8","karma-junit-reporter":"^1.2.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-spec-reporter":"0.0.32","karma-typescript":"^5.5.1","karma-typescript-es6-transform":"^5.5.1","mocha":"^3.2.0","mock-require":"^3.0.3","ncp":"^2.0.0","node-http-server":"^8.1.2","npm-run-all":"^4.0.2","nyc":"^15.1.0","requirejs":"^2.3.3","rimraf":"^2.6.1","simple-git":"^1.126.0","sinon":"^4.0.1","ts-node":"4.0.1","tslint":"5.8.0","twilio":"^3.49.0","twilio-release-tool":"^1.0.2","typescript":"4.2.2","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0","watchify":"^3.11.1","webrtc-adapter":"^7.7.1"},"engines":{"node":">=0.12"},"license":"BSD-3-Clause","main":"./es5/index.js","types":"./tsdef/index.d.ts","scripts":{"lint:js":"eslint ./lib ./test/*.js ./docker/**/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/** ","lint:ts":"eslint ./tsdef/*.ts ./lib/**/*.ts","lint":"npm-run-all lint:js lint:ts","printVersion":"node --version && npm --version","test:unit":"npm-run-all printVersion build:es5 && nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov --reporter=text mocha -r ts-node/register ./test/unit/*","test:serversiderender":"mocha ./test/serversiderender/index.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:integration":"npm run build:es5 && node ./scripts/karma.js karma/integration.conf.js","test:umd:install":"npm install puppeteer@5.5.0","test:umd":"mocha ./test/umd/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules package-lock.json && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:install":"npm install chromedriver && npm install selenium-webdriver && npm install geckodriver && npm install puppeteer","test:framework":"npm-run-all test:framework:install test:framework:no-framework test:framework:react","test":"npm-run-all test:unit test:integration","build:es5":"rimraf ./es5 && tsc tsdef/twilio-video-tests.ts --noEmit --lib es2018,dom && tsc ","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":"uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments \\"/^! twilio-video.js/\\" -b beautify=false,ascii_only=true","build":"npm-run-all clean lint docs test:unit test:integration build:es5 build:js build:min.js test:umd","build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js","docs":"node ./scripts/docs.js ./dist/docs","watch":"tsc -w","clean":"rimraf ./coverage ./es5 ./dist"},"dependencies":{"backoff":"^2.5.0","events":"^3.3.0","util":"^0.12.4","ws":"^7.4.6","xmlhttprequest":"^1.8.0"},"browser":{"ws":"./src/ws.js","xmlhttprequest":"./src/xmlhttprequest.js"},"_resolved":"https://registry.npmjs.org/twilio-video/-/twilio-video-2.21.1.tgz","_integrity":"sha512-odVq6tBF2OGwtOncvGuQjyuv6fAIkIWVzZZxlYnFkbUen6eq3A9fCtNuKLb+GnXFwXLzzRHByi3yJzQgkWbJow==","_from":"twilio-video@2.21.1"}')}}]);